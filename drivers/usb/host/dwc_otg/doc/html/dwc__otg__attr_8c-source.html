<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_attr.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_attr.c</h1><a href="dwc__otg__attr_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* ==========================================================================</span>
00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_attr.c $</span>
00003 <span class="comment"> * $Revision: #44 $</span>
00004 <span class="comment"> * $Date: 2010/11/29 $</span>
00005 <span class="comment"> * $Change: 1636033 $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
00031 <span class="comment"> * DAMAGE.</span>
00032 <span class="comment"> * ========================================================================== */</span>
00033 
00311 <span class="preprocessor">#include "<a class="code" href="dwc__otg__os__dep_8h.html">dwc_otg_os_dep.h</a>"</span>
00312 <span class="preprocessor">#include "dwc_os.h"</span>
00313 <span class="preprocessor">#include "<a class="code" href="dwc__otg__driver_8h.html">dwc_otg_driver.h</a>"</span>
00314 <span class="preprocessor">#include "<a class="code" href="dwc__otg__attr_8h.html">dwc_otg_attr.h</a>"</span>
00315 <span class="preprocessor">#include "<a class="code" href="dwc__otg__core__if_8h.html">dwc_otg_core_if.h</a>"</span>
00316 <span class="preprocessor">#include "<a class="code" href="dwc__otg__pcd__if_8h.html">dwc_otg_pcd_if.h</a>"</span>
00317 <span class="preprocessor">#include "<a class="code" href="dwc__otg__hcd__if_8h.html">dwc_otg_hcd_if.h</a>"</span>
00318 
00319 <span class="comment">/*</span>
00320 <span class="comment"> * MACROs for defining sysfs attribute</span>
00321 <span class="comment"> */</span>
00322 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00323 <span class="preprocessor"></span>
00324 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
00325 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
00326 <span class="preprocessor">{ \</span>
00327 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
00328 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev);             \</span>
00329 <span class="preprocessor">        uint32_t val; \</span>
00330 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
00331 <span class="preprocessor">        return sprintf (buf, "%s = 0x%x\n", _string_, val); \</span>
00332 <span class="preprocessor">}</span>
00333 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
00334 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
00335 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
00336 <span class="preprocessor">{ \</span>
00337 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
00338 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
00339 <span class="preprocessor">        uint32_t set = simple_strtoul(buf, NULL, 16); \</span>
00340 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_(otg_dev-&gt;core_if, set);\</span>
00341 <span class="preprocessor">        return count; \</span>
00342 <span class="preprocessor">}</span>
00343 <span class="preprocessor"></span>
00344 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00345 <span class="preprocessor"></span>
00346 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
00347 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
00348 <span class="preprocessor">{ \</span>
00349 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);      \</span>
00350 <span class="preprocessor">        uint32_t val; \</span>
00351 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
00352 <span class="preprocessor">        return sprintf (buf, "%s = 0x%x\n", _string_, val); \</span>
00353 <span class="preprocessor">}</span>
00354 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
00355 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
00356 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
00357 <span class="preprocessor">{ \</span>
00358 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
00359 <span class="preprocessor">        uint32_t set = simple_strtoul(buf, NULL, 16); \</span>
00360 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_(otg_dev-&gt;core_if, set);\</span>
00361 <span class="preprocessor">        return count; \</span>
00362 <span class="preprocessor">}</span>
00363 <span class="preprocessor"></span>
00364 <span class="preprocessor">#endif</span>
00365 <span class="preprocessor"></span>
00366 <span class="comment">/*</span>
00367 <span class="comment"> * MACROs for defining sysfs attribute for 32-bit registers</span>
00368 <span class="comment"> */</span>
00369 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00370 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
00371 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
00372 <span class="preprocessor">{ \</span>
00373 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
00374 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
00375 <span class="preprocessor">        uint32_t val; \</span>
00376 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
00377 <span class="preprocessor">        return sprintf (buf, "%s = 0x%08x\n", _string_, val); \</span>
00378 <span class="preprocessor">}</span>
00379 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
00380 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
00381 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
00382 <span class="preprocessor">{ \</span>
00383 <span class="preprocessor">        struct lm_device *lm_dev = container_of(_dev, struct lm_device, dev); \</span>
00384 <span class="preprocessor">        dwc_otg_device_t *otg_dev = lm_get_drvdata(lm_dev); \</span>
00385 <span class="preprocessor">        uint32_t val = simple_strtoul(buf, NULL, 16); \</span>
00386 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_ (otg_dev-&gt;core_if, val); \</span>
00387 <span class="preprocessor">        return count; \</span>
00388 <span class="preprocessor">}</span>
00389 <span class="preprocessor"></span><span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00390 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
00391 <span class="preprocessor">static ssize_t _otg_attr_name_##_show (struct device *_dev, struct device_attribute *attr, char *buf) \</span>
00392 <span class="preprocessor">{ \</span>
00393 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
00394 <span class="preprocessor">        uint32_t val; \</span>
00395 <span class="preprocessor">        val = dwc_otg_get_##_otg_attr_name_ (otg_dev-&gt;core_if); \</span>
00396 <span class="preprocessor">        return sprintf (buf, "%s = 0x%08x\n", _string_, val); \</span>
00397 <span class="preprocessor">}</span>
00398 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
00399 <span class="preprocessor">static ssize_t _otg_attr_name_##_store (struct device *_dev, struct device_attribute *attr, \</span>
00400 <span class="preprocessor">                                        const char *buf, size_t count) \</span>
00401 <span class="preprocessor">{ \</span>
00402 <span class="preprocessor">        dwc_otg_device_t *otg_dev = dev_get_drvdata(_dev);  \</span>
00403 <span class="preprocessor">        uint32_t val = simple_strtoul(buf, NULL, 16); \</span>
00404 <span class="preprocessor">        dwc_otg_set_##_otg_attr_name_ (otg_dev-&gt;core_if, val); \</span>
00405 <span class="preprocessor">        return count; \</span>
00406 <span class="preprocessor">}</span>
00407 <span class="preprocessor"></span>
00408 <span class="preprocessor">#endif</span>
00409 <span class="preprocessor"></span>
00410 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_RW(_otg_attr_name_,_string_) \</span>
00411 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
00412 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_STORE(_otg_attr_name_,_string_) \</span>
00413 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0644,_otg_attr_name_##_show,_otg_attr_name_##_store);</span>
00414 <span class="preprocessor"></span>
00415 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_BITFIELD_RO(_otg_attr_name_,_string_) \</span>
00416 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_BITFIELD_SHOW(_otg_attr_name_,_string_) \</span>
00417 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0444,_otg_attr_name_##_show,NULL);</span>
00418 <span class="preprocessor"></span>
00419 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG32_RW(_otg_attr_name_,_addr_,_string_) \</span>
00420 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
00421 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_STORE(_otg_attr_name_,_string_) \</span>
00422 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0644,_otg_attr_name_##_show,_otg_attr_name_##_store);</span>
00423 <span class="preprocessor"></span>
00424 <span class="preprocessor">#define DWC_OTG_DEVICE_ATTR_REG32_RO(_otg_attr_name_,_addr_,_string_) \</span>
00425 <span class="preprocessor">DWC_OTG_DEVICE_ATTR_REG_SHOW(_otg_attr_name_,_string_) \</span>
00426 <span class="preprocessor">DEVICE_ATTR(_otg_attr_name_,0444,_otg_attr_name_##_show,NULL);</span>
00427 <span class="preprocessor"></span>
<a name="l00434"></a><a class="code" href="dwc__otg__attr_8c.html#a50">00434</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a50">regoffset_show</a>(<span class="keyword">struct</span> device *_dev,
00435                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00436 {
00437 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00438 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00439         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00440 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00441 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00442 <span class="preprocessor">#endif</span>
00443 <span class="preprocessor"></span>
00444         <span class="keywordflow">return</span> snprintf(buf, <span class="keyword">sizeof</span>(<span class="stringliteral">"0xFFFFFFFF\n"</span>) + 1, <span class="stringliteral">"0x%08x\n"</span>,
00445                         otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset);
00446 }
00447 
<a name="l00451"></a><a class="code" href="dwc__otg__attr_8c.html#a51">00451</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a51">regoffset_store</a>(<span class="keyword">struct</span> device *_dev,
00452                                <span class="keyword">struct</span> device_attribute *attr,
00453                                <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00454 {
00455 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00456 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00457         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00458 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00459 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00460 <span class="preprocessor">#endif</span>
00461 <span class="preprocessor"></span>
00462         uint32_t offset = simple_strtoul(buf, NULL, 16);
00463 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00464 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (offset &lt; SZ_256K) {
00465 <span class="preprocessor">#elif  defined(PCI_INTERFACE)</span>
00466 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (offset &lt; 0x00040000) {
00467 <span class="preprocessor">#endif</span>
00468 <span class="preprocessor"></span>                otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset = offset;
00469         } <span class="keywordflow">else</span> {
00470                 dev_err(_dev, <span class="stringliteral">"invalid offset\n"</span>);
00471         }
00472 
00473         <span class="keywordflow">return</span> count;
00474 }
00475 
00476 DEVICE_ATTR(regoffset, S_IRUGO | S_IWUSR, regoffset_show, regoffset_store);
00477 
<a name="l00482"></a><a class="code" href="dwc__otg__attr_8c.html#a52">00482</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a52">regvalue_show</a>(<span class="keyword">struct</span> device *_dev,
00483                              <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00484 {
00485 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00486 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00487         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00488 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00489 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00490 <span class="preprocessor">#endif</span>
00491 <span class="preprocessor"></span>
00492         uint32_t val;
00493         <span class="keyword">volatile</span> uint32_t *addr;
00494 
00495         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset != 0xFFFFFFFF &amp;&amp; 0 != otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base) {
00496                 <span class="comment">/* Calculate the address */</span>
00497                 addr = (uint32_t *) (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset +
00498                                      (uint8_t *) otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base);
00499                 val = DWC_READ_REG32(addr);
00500                 <span class="keywordflow">return</span> snprintf(buf,
00501                                 <span class="keyword">sizeof</span>(<span class="stringliteral">"Reg@0xFFFFFFFF = 0xFFFFFFFF\n"</span>) + 1,
00502                                 <span class="stringliteral">"Reg@0x%06x = 0x%08x\n"</span>, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset,
00503                                 val);
00504         } <span class="keywordflow">else</span> {
00505                 dev_err(_dev, <span class="stringliteral">"Invalid offset (0x%0x)\n"</span>, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset);
00506                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"invalid offset\n"</span>);
00507         }
00508 }
00509 
<a name="l00515"></a><a class="code" href="dwc__otg__attr_8c.html#a53">00515</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a53">regvalue_store</a>(<span class="keyword">struct</span> device *_dev,
00516                               <span class="keyword">struct</span> device_attribute *attr,
00517                               <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00518 {
00519 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00520 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00521         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00522 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00523 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00524 <span class="preprocessor">#endif</span>
00525 <span class="preprocessor"></span>
00526         <span class="keyword">volatile</span> uint32_t *addr;
00527         uint32_t val = simple_strtoul(buf, NULL, 16);
00528         <span class="comment">//dev_dbg(_dev, "Offset=0x%08x Val=0x%08x\n", otg_dev-&gt;reg_offset, val);</span>
00529         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset != 0xFFFFFFFF &amp;&amp; 0 != otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base) {
00530                 <span class="comment">/* Calculate the address */</span>
00531                 addr = (uint32_t *) (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset +
00532                                      (uint8_t *) otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base);
00533                 DWC_WRITE_REG32(addr, val);
00534         } <span class="keywordflow">else</span> {
00535                 dev_err(_dev, <span class="stringliteral">"Invalid Register Offset (0x%08x)\n"</span>,
00536                         otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset);
00537         }
00538         <span class="keywordflow">return</span> count;
00539 }
00540 
00541 DEVICE_ATTR(regvalue, S_IRUGO | S_IWUSR, regvalue_show, regvalue_store);
00542 
00543 <span class="comment">/*</span>
00544 <span class="comment"> * Attributes</span>
00545 <span class="comment"> */</span>
00546 DWC_OTG_DEVICE_ATTR_BITFIELD_RO(mode, <span class="stringliteral">"Mode"</span>);
00547 DWC_OTG_DEVICE_ATTR_BITFIELD_RW(hnpcapable, <span class="stringliteral">"HNPCapable"</span>);
00548 DWC_OTG_DEVICE_ATTR_BITFIELD_RW(srpcapable, <span class="stringliteral">"SRPCapable"</span>);
00549 DWC_OTG_DEVICE_ATTR_BITFIELD_RW(hsic_connect, <span class="stringliteral">"HSIC Connect"</span>);
00550 DWC_OTG_DEVICE_ATTR_BITFIELD_RW(inv_sel_hsic, <span class="stringliteral">"Invert Select HSIC"</span>);
00551 
00552 <span class="comment">//DWC_OTG_DEVICE_ATTR_BITFIELD_RW(buspower,&amp;(otg_dev-&gt;core_if-&gt;core_global_regs-&gt;gotgctl),(1&lt;&lt;8),8,"Mode");</span>
00553 <span class="comment">//DWC_OTG_DEVICE_ATTR_BITFIELD_RW(bussuspend,&amp;(otg_dev-&gt;core_if-&gt;core_global_regs-&gt;gotgctl),(1&lt;&lt;8),8,"Mode");</span>
00554 DWC_OTG_DEVICE_ATTR_BITFIELD_RO(busconnected, <span class="stringliteral">"Bus Connected"</span>);
00555 
00556 DWC_OTG_DEVICE_ATTR_REG32_RW(gotgctl, 0, <span class="stringliteral">"GOTGCTL"</span>);
00557 DWC_OTG_DEVICE_ATTR_REG32_RW(gusbcfg,
00558                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>),
00559                              <span class="stringliteral">"GUSBCFG"</span>);
00560 DWC_OTG_DEVICE_ATTR_REG32_RW(grxfsiz,
00561                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>),
00562                              <span class="stringliteral">"GRXFSIZ"</span>);
00563 DWC_OTG_DEVICE_ATTR_REG32_RW(gnptxfsiz,
00564                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>),
00565                              <span class="stringliteral">"GNPTXFSIZ"</span>);
00566 DWC_OTG_DEVICE_ATTR_REG32_RW(gpvndctl,
00567                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o13">gpvndctl</a>),
00568                              <span class="stringliteral">"GPVNDCTL"</span>);
00569 DWC_OTG_DEVICE_ATTR_REG32_RW(ggpio,
00570                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o14">ggpio</a>),
00571                              <span class="stringliteral">"GGPIO"</span>);
00572 DWC_OTG_DEVICE_ATTR_REG32_RW(guid, &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o15">guid</a>),
00573                              <span class="stringliteral">"GUID"</span>);
00574 DWC_OTG_DEVICE_ATTR_REG32_RO(gsnpsid,
00575                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o16">gsnpsid</a>),
00576                              <span class="stringliteral">"GSNPSID"</span>);
00577 DWC_OTG_DEVICE_ATTR_BITFIELD_RW(devspeed, <span class="stringliteral">"Device Speed"</span>);
00578 DWC_OTG_DEVICE_ATTR_BITFIELD_RO(enumspeed, <span class="stringliteral">"Device Enumeration Speed"</span>);
00579 
00580 DWC_OTG_DEVICE_ATTR_REG32_RO(hptxfsiz,
00581                              &amp;(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>),
00582                              <span class="stringliteral">"HPTXFSIZ"</span>);
00583 DWC_OTG_DEVICE_ATTR_REG32_RW(hprt0, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, <span class="stringliteral">"HPRT0"</span>);
00584 
00591 <span class="keyword">static</span> ssize_t hnp_show(<span class="keyword">struct</span> device *_dev,
00592                         <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00593 {
00594 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00595 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00596         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00597 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00598 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00599 <span class="preprocessor">#endif</span>
00600 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HstNegScs = 0x%x\n"</span>,
00601                        <a class="code" href="dwc__otg__core__if_8h.html#a162">dwc_otg_get_hnpstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00602 }
00603 
<a name="l00607"></a><a class="code" href="dwc__otg__attr_8c.html#a55">00607</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a55">hnp_store</a>(<span class="keyword">struct</span> device *_dev,
00608                          <span class="keyword">struct</span> device_attribute *attr,
00609                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00610 {
00611 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00612 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00613         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00614 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00615 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00616 <span class="preprocessor">#endif</span>
00617 <span class="preprocessor"></span>        uint32_t in = simple_strtoul(buf, NULL, 16);
00618         <a class="code" href="dwc__otg__core__if_8h.html#a164">dwc_otg_set_hnpreq</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, in);
00619         <span class="keywordflow">return</span> count;
00620 }
00621 
00622 DEVICE_ATTR(hnp, 0644, hnp_show, hnp_store);
00623 
<a name="l00630"></a><a class="code" href="dwc__otg__attr_8c.html#a56">00630</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a56">srp_show</a>(<span class="keyword">struct</span> device *_dev,
00631                         <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00632 {
00633 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00634 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00635 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00636         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00637 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00638 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00639 <span class="preprocessor">#endif</span>
00640 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"SesReqScs = 0x%x\n"</span>,
00641                        <a class="code" href="dwc__otg__core__if_8h.html#a163">dwc_otg_get_srpstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00642 <span class="preprocessor">#else</span>
00643 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Host Only Mode!\n"</span>);
00644 <span class="preprocessor">#endif</span>
00645 <span class="preprocessor"></span>}
00646 
<a name="l00650"></a><a class="code" href="dwc__otg__attr_8c.html#a57">00650</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a57">srp_store</a>(<span class="keyword">struct</span> device *_dev,
00651                          <span class="keyword">struct</span> device_attribute *attr,
00652                          <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00653 {
00654 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00655 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00656 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00657         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00658 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00659 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00660 <span class="preprocessor">#endif</span>
00661 <span class="preprocessor"></span>        <a class="code" href="dwc__otg__pcd__if_8h.html#a33">dwc_otg_pcd_initiate_srp</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>);
00662 <span class="preprocessor">#endif</span>
00663 <span class="preprocessor"></span>        <span class="keywordflow">return</span> count;
00664 }
00665 
00666 DEVICE_ATTR(srp, 0644, srp_show, srp_store);
00667 
<a name="l00674"></a><a class="code" href="dwc__otg__attr_8c.html#a58">00674</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a58">buspower_show</a>(<span class="keyword">struct</span> device *_dev,
00675                              <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00676 {
00677 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00678 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00679         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00680 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00681 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00682 <span class="preprocessor">#endif</span>
00683 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Bus Power = 0x%x\n"</span>,
00684                        <a class="code" href="dwc__otg__core__if_8h.html#a175">dwc_otg_get_prtpower</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00685 }
00686 
<a name="l00690"></a><a class="code" href="dwc__otg__attr_8c.html#a59">00690</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a59">buspower_store</a>(<span class="keyword">struct</span> device *_dev,
00691                               <span class="keyword">struct</span> device_attribute *attr,
00692                               <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00693 {
00694 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00695 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00696         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00697 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00698 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00699 <span class="preprocessor">#endif</span>
00700 <span class="preprocessor"></span>        uint32_t on = simple_strtoul(buf, NULL, 16);
00701         <a class="code" href="dwc__otg__core__if_8h.html#a177">dwc_otg_set_prtpower</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, on);
00702         <span class="keywordflow">return</span> count;
00703 }
00704 
00705 DEVICE_ATTR(buspower, 0644, buspower_show, buspower_store);
00706 
<a name="l00713"></a><a class="code" href="dwc__otg__attr_8c.html#a60">00713</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a60">bussuspend_show</a>(<span class="keyword">struct</span> device *_dev,
00714                                <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00715 {
00716 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00717 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00718         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00719 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00720 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00721 <span class="preprocessor">#endif</span>
00722 <span class="preprocessor"></span>
00723         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Bus Suspend = 0x%x\n"</span>,
00724                        <a class="code" href="dwc__otg__core__if_8h.html#a178">dwc_otg_get_prtsuspend</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00725 }
00726 
<a name="l00730"></a><a class="code" href="dwc__otg__attr_8c.html#a61">00730</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a61">bussuspend_store</a>(<span class="keyword">struct</span> device *_dev,
00731                                 <span class="keyword">struct</span> device_attribute *attr,
00732                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00733 {
00734 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00735 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00736         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00737 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00738 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00739 <span class="preprocessor">#endif</span>
00740 <span class="preprocessor"></span>
00741         uint32_t in = simple_strtoul(buf, NULL, 16);
00742         <a class="code" href="dwc__otg__core__if_8h.html#a179">dwc_otg_set_prtsuspend</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, in);
00743         <span class="keywordflow">return</span> count;
00744 }
00745 
00746 DEVICE_ATTR(bussuspend, 0644, bussuspend_show, bussuspend_store);
00747 
<a name="l00751"></a><a class="code" href="dwc__otg__attr_8c.html#a62">00751</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a62">mode_ch_tim_en_show</a>(<span class="keyword">struct</span> device *_dev,
00752                                    <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00753 {
00754 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00755 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00756         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00757 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00758 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00759 <span class="preprocessor">#endif</span>
00760 <span class="preprocessor"></span>
00761         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Mode Change Ready Timer Enable = 0x%x\n"</span>,
00762                        <a class="code" href="dwc__otg__core__if_8h.html#a180">dwc_otg_get_mode_ch_tim</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00763 }
00764 
<a name="l00768"></a><a class="code" href="dwc__otg__attr_8c.html#a63">00768</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a63">mode_ch_tim_en_store</a>(<span class="keyword">struct</span> device *_dev,
00769                                     <span class="keyword">struct</span> device_attribute *attr,
00770                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00771 {
00772 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00773 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00774         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00775 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00776 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>
00779         uint32_t in = simple_strtoul(buf, NULL, 16);
00780         <a class="code" href="dwc__otg__core__if_8h.html#a181">dwc_otg_set_mode_ch_tim</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, in);
00781         <span class="keywordflow">return</span> count;
00782 }
00783 
00784 DEVICE_ATTR(mode_ch_tim_en, 0644, mode_ch_tim_en_show, mode_ch_tim_en_store);
00785 
<a name="l00789"></a><a class="code" href="dwc__otg__attr_8c.html#a64">00789</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a64">fr_interval_show</a>(<span class="keyword">struct</span> device *_dev,
00790                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00791 {
00792 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00793 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00794         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00795 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00796 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00797 <span class="preprocessor">#endif</span>
00798 <span class="preprocessor"></span>
00799         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Frame Interval = 0x%x\n"</span>,
00800                        <a class="code" href="dwc__otg__core__if_8h.html#a182">dwc_otg_get_fr_interval</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00801 }
00802 
<a name="l00806"></a><a class="code" href="dwc__otg__attr_8c.html#a65">00806</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a65">fr_interval_store</a>(<span class="keyword">struct</span> device *_dev,
00807                                  <span class="keyword">struct</span> device_attribute *attr,
00808                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00809 {
00810 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00811 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00812         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00813 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00814 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00815 <span class="preprocessor">#endif</span>
00816 <span class="preprocessor"></span>
00817         uint32_t in = simple_strtoul(buf, NULL, 10);
00818         <a class="code" href="dwc__otg__core__if_8h.html#a183">dwc_otg_set_fr_interval</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, in);
00819         <span class="keywordflow">return</span> count;
00820 }
00821 
00822 DEVICE_ATTR(fr_interval, 0644, fr_interval_show, fr_interval_store);
00823 
<a name="l00827"></a><a class="code" href="dwc__otg__attr_8c.html#a66">00827</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a66">remote_wakeup_show</a>(<span class="keyword">struct</span> device *_dev,
00828                                   <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00829 {
00830 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00831 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00832 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00833         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00834 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00835 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00836 <span class="preprocessor">#endif</span>
00837 <span class="preprocessor"></span>
00838         <span class="keywordflow">return</span> sprintf(buf,
00839                        <span class="stringliteral">"Remote Wakeup Sig = %d Enabled = %d LPM Remote Wakeup = %d\n"</span>,
00840                        <a class="code" href="dwc__otg__core__if_8h.html#a185">dwc_otg_get_remotewakesig</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>),
00841                        <a class="code" href="dwc__otg__pcd_8c.html#a49">dwc_otg_pcd_get_rmwkup_enable</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>),
00842                        <a class="code" href="dwc__otg__cil_8c.html#a185">dwc_otg_get_lpm_remotewakeenabled</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
00843 <span class="preprocessor">#else</span>
00844 <span class="preprocessor"></span>        <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Host Only Mode!\n"</span>);
00845 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
00846 }
00847 
<a name="l00854"></a><a class="code" href="dwc__otg__attr_8c.html#a67">00854</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a67">remote_wakeup_store</a>(<span class="keyword">struct</span> device *_dev,
00855                                    <span class="keyword">struct</span> device_attribute *attr,
00856                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00857 {
00858 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00859 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00860 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00861         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00862 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00863 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00864 <span class="preprocessor">#endif</span>
00865 <span class="preprocessor"></span>
00866         uint32_t val = simple_strtoul(buf, NULL, 16);
00867 
00868         <span class="keywordflow">if</span> (val &amp; 1) {
00869                 <a class="code" href="dwc__otg__pcd__if_8h.html#a34">dwc_otg_pcd_remote_wakeup</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>, 1);
00870         } <span class="keywordflow">else</span> {
00871                 <a class="code" href="dwc__otg__pcd__if_8h.html#a34">dwc_otg_pcd_remote_wakeup</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>, 0);
00872         }
00873 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
00874         <span class="keywordflow">return</span> count;
00875 }
00876 
00877 DEVICE_ATTR(remote_wakeup, S_IRUGO | S_IWUSR, remote_wakeup_show,
00878             remote_wakeup_store);
00879 
<a name="l00883"></a><a class="code" href="dwc__otg__attr_8c.html#a68">00883</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a68">rem_wakeup_pwrdn_show</a>(<span class="keyword">struct</span> device *_dev,
00884                                      <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00885 {
00886 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00887 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00888 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00889         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00890 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00891 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00892 <span class="preprocessor">#endif</span>
00893 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__core__if_8h.html#a176">dwc_otg_get_core_state</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
00894                 DWC_PRINTF(<span class="stringliteral">"Core is in hibernation\n"</span>);
00895         } <span class="keywordflow">else</span> {
00896                 DWC_PRINTF(<span class="stringliteral">"Core is not in hibernation\n"</span>);
00897         }
00898 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
00899         <span class="keywordflow">return</span> 0;
00900 }
00901 
00902 <span class="keyword">extern</span> <span class="keywordtype">int</span> dwc_otg_device_hibernation_restore(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
00903                                               <span class="keywordtype">int</span> rem_wakeup, <span class="keywordtype">int</span> reset);
00904 
<a name="l00908"></a><a class="code" href="dwc__otg__attr_8c.html#a70">00908</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a70">rem_wakeup_pwrdn_store</a>(<span class="keyword">struct</span> device *_dev,
00909                                       <span class="keyword">struct</span> device_attribute *attr,
00910                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00911 {
00912 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00913 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00914 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00915         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00916 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00917 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00918 <span class="preprocessor">#endif</span>
00919 <span class="preprocessor"></span>        dwc_otg_device_hibernation_restore(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, 1, 0);
00920 <span class="preprocessor">#endif</span>
00921 <span class="preprocessor"></span>        <span class="keywordflow">return</span> count;
00922 }
00923 
00924 DEVICE_ATTR(rem_wakeup_pwrdn, S_IRUGO | S_IWUSR, rem_wakeup_pwrdn_show,
00925             rem_wakeup_pwrdn_store);
00926 
00927 <span class="keyword">static</span> ssize_t disconnect_us(<span class="keyword">struct</span> device *_dev,
00928                              <span class="keyword">struct</span> device_attribute *attr,
00929                              <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
00930 {
00931 
00932 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00933 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
00934 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00935         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00936 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00937 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00938 <span class="preprocessor">#endif</span>
00939 <span class="preprocessor"></span>        uint32_t val = simple_strtoul(buf, NULL, 16);
00940         DWC_PRINTF(<span class="stringliteral">"The Passed value is %04x\n"</span>, val);
00941 
00942         <a class="code" href="dwc__otg__pcd__if_8h.html#a35">dwc_otg_pcd_disconnect_us</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>, 50);
00943 
00944 <span class="preprocessor">#endif </span><span class="comment">/* DWC_HOST_ONLY */</span>
00945         <span class="keywordflow">return</span> count;
00946 }
00947 
00948 DEVICE_ATTR(disconnect_us, S_IWUSR, 0, disconnect_us);
00949 
<a name="l00954"></a><a class="code" href="dwc__otg__attr_8c.html#a72">00954</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a72">regdump_show</a>(<span class="keyword">struct</span> device *_dev,
00955                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00956 {
00957 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00958 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00959         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00960 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00961 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00962 <span class="preprocessor">#endif</span>
00963 <span class="preprocessor"></span>
00964         <a class="code" href="dwc__otg__core__if_8h.html#a161">dwc_otg_dump_global_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
00965         <span class="keywordflow">if</span> (dwc_otg_is_host_mode(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
00966                 <a class="code" href="dwc__otg__core__if_8h.html#a160">dwc_otg_dump_host_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
00967         } <span class="keywordflow">else</span> {
00968                 <a class="code" href="dwc__otg__core__if_8h.html#a158">dwc_otg_dump_dev_registers</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
00969 
00970         }
00971         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Register Dump\n"</span>);
00972 }
00973 
00974 DEVICE_ATTR(regdump, S_IRUGO | S_IWUSR, regdump_show, 0);
00975 
<a name="l00980"></a><a class="code" href="dwc__otg__attr_8c.html#a73">00980</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a73">spramdump_show</a>(<span class="keyword">struct</span> device *_dev,
00981                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
00982 {
00983 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00984 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
00985         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
00986 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00987 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
00988 <span class="preprocessor">#endif</span>
00989 <span class="preprocessor"></span>
00990         <a class="code" href="dwc__otg__core__if_8h.html#a159">dwc_otg_dump_spram</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
00991 
00992         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"SPRAM Dump\n"</span>);
00993 }
00994 
00995 DEVICE_ATTR(spramdump, S_IRUGO | S_IWUSR, spramdump_show, 0);
00996 
<a name="l01000"></a><a class="code" href="dwc__otg__attr_8c.html#a74">01000</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a74">hcddump_show</a>(<span class="keyword">struct</span> device *_dev,
01001                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01002 {
01003 <span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
01004 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
01005 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01006         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01007 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01008 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01009 <span class="preprocessor">#endif</span>
01010 <span class="preprocessor"></span>
01011         <a class="code" href="dwc__otg__hcd__if_8h.html#a23">dwc_otg_hcd_dump_state</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o3">hcd</a>);
01012 <span class="preprocessor">#endif </span><span class="comment">/* DWC_DEVICE_ONLY */</span>
01013         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HCD Dump\n"</span>);
01014 }
01015 
01016 DEVICE_ATTR(hcddump, S_IRUGO | S_IWUSR, hcddump_show, 0);
01017 
<a name="l01023"></a><a class="code" href="dwc__otg__attr_8c.html#a75">01023</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a75">hcd_frrem_show</a>(<span class="keyword">struct</span> device *_dev,
01024                               <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01025 {
01026 <span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
01027 <span class="preprocessor"></span><span class="preprocessor">#ifdef LM_INTERFACE</span>
01028 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01029         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01030 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01031 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01032 <span class="preprocessor">#endif</span>
01033 <span class="preprocessor"></span>
01034         <a class="code" href="dwc__otg__hcd__if_8h.html#a24">dwc_otg_hcd_dump_frrem</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o3">hcd</a>);
01035 <span class="preprocessor">#endif </span><span class="comment">/* DWC_DEVICE_ONLY */</span>
01036         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"HCD Dump Frame Remaining\n"</span>);
01037 }
01038 
01039 DEVICE_ATTR(hcd_frrem, S_IRUGO | S_IWUSR, hcd_frrem_show, 0);
01040 
<a name="l01045"></a><a class="code" href="dwc__otg__attr_8c.html#a4">01045</a> <span class="preprocessor">#define RW_REG_COUNT 10000000</span>
01046 <span class="preprocessor"></span><span class="preprocessor">#define MSEC_PER_JIFFIE 1000/HZ</span>
01047 <span class="preprocessor"></span><span class="keyword">static</span> ssize_t rd_reg_test_show(<span class="keyword">struct</span> device *_dev,
01048                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01049 {
01050 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01051 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01052         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01053 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01054 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01055 <span class="preprocessor">#endif</span>
01056 <span class="preprocessor"></span>
01057         <span class="keywordtype">int</span> i;
01058         <span class="keywordtype">int</span> time;
01059         <span class="keywordtype">int</span> start_jiffies;
01060 
01061         printk(<span class="stringliteral">"HZ %d, MSEC_PER_JIFFIE %d, loops_per_jiffy %lu\n"</span>,
01062                HZ, MSEC_PER_JIFFIE, loops_per_jiffy);
01063         start_jiffies = jiffies;
01064         <span class="keywordflow">for</span> (i = 0; i &lt; RW_REG_COUNT; i++) {
01065                 <a class="code" href="dwc__otg__core__if_8h.html#a200">dwc_otg_get_gnptxfsiz</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
01066         }
01067         time = jiffies - start_jiffies;
01068         <span class="keywordflow">return</span> sprintf(buf,
01069                        <span class="stringliteral">"Time to read GNPTXFSIZ reg %d times: %d msecs (%d jiffies)\n"</span>,
01070                        <a class="code" href="dwc__otg__attr_8c.html#a4">RW_REG_COUNT</a>, time * MSEC_PER_JIFFIE, time);
01071 }
01072 
01073 DEVICE_ATTR(rd_reg_test, S_IRUGO | S_IWUSR, rd_reg_test_show, 0);
01074 
<a name="l01079"></a><a class="code" href="dwc__otg__attr_8c.html#a77">01079</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__attr_8c.html#a77">wr_reg_test_show</a>(<span class="keyword">struct</span> device *_dev,
01080                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01081 {
01082 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01083 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01084         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01085 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01086 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01087 <span class="preprocessor">#endif</span>
01088 <span class="preprocessor"></span>
01089         uint32_t reg_val;
01090         <span class="keywordtype">int</span> i;
01091         <span class="keywordtype">int</span> time;
01092         <span class="keywordtype">int</span> start_jiffies;
01093 
01094         printk(<span class="stringliteral">"HZ %d, MSEC_PER_JIFFIE %d, loops_per_jiffy %lu\n"</span>,
01095                HZ, MSEC_PER_JIFFIE, loops_per_jiffy);
01096         reg_val = <a class="code" href="dwc__otg__core__if_8h.html#a200">dwc_otg_get_gnptxfsiz</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
01097         start_jiffies = jiffies;
01098         <span class="keywordflow">for</span> (i = 0; i &lt; RW_REG_COUNT; i++) {
01099                 dwc_otg_set_gnptxfsiz(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, reg_val);
01100         }
01101         time = jiffies - start_jiffies;
01102         <span class="keywordflow">return</span> sprintf(buf,
01103                        <span class="stringliteral">"Time to write GNPTXFSIZ reg %d times: %d msecs (%d jiffies)\n"</span>,
01104                        <a class="code" href="dwc__otg__attr_8c.html#a4">RW_REG_COUNT</a>, time * MSEC_PER_JIFFIE, time);
01105 }
01106 
01107 DEVICE_ATTR(wr_reg_test, S_IRUGO | S_IWUSR, wr_reg_test_show, 0);
01108 
01109 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01110 <span class="preprocessor"></span>
01114 <span class="keyword">static</span> ssize_t lpmresp_show(<span class="keyword">struct</span> device *_dev,
01115                             <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01116 {
01117 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01118 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01119         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01120 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01121 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01122 <span class="preprocessor">#endif</span>
01123 <span class="preprocessor"></span>
01124         <span class="keywordflow">if</span> (!dwc_otg_get_param_lpm_enable(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>))
01125                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"** LPM is DISABLED **\n"</span>);
01126 
01127         <span class="keywordflow">if</span> (!dwc_otg_is_device_mode(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
01128                 <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"** Current mode is not device mode\n"</span>);
01129         }
01130         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"lpm_response = %d\n"</span>,
01131                        <a class="code" href="dwc__otg__core__if_8h.html#a188">dwc_otg_get_lpmresponse</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
01132 }
01133 
01137 <span class="keyword">static</span> ssize_t lpmresp_store(<span class="keyword">struct</span> device *_dev,
01138                              <span class="keyword">struct</span> device_attribute *attr,
01139                              <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
01140 {
01141 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01142 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01143         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01144 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01145 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01146 <span class="preprocessor">#endif</span>
01147 <span class="preprocessor"></span>
01148         uint32_t val = simple_strtoul(buf, NULL, 16);
01149 
01150         <span class="keywordflow">if</span> (!dwc_otg_get_param_lpm_enable(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
01151                 <span class="keywordflow">return</span> 0;
01152         }
01153 
01154         <span class="keywordflow">if</span> (!dwc_otg_is_device_mode(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
01155                 <span class="keywordflow">return</span> 0;
01156         }
01157 
01158         <a class="code" href="dwc__otg__core__if_8h.html#a189">dwc_otg_set_lpmresponse</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, val);
01159         <span class="keywordflow">return</span> count;
01160 }
01161 
01162 DEVICE_ATTR(lpm_response, S_IRUGO | S_IWUSR, lpmresp_show, lpmresp_store);
01163 
01167 <span class="keyword">static</span> ssize_t sleepstatus_show(<span class="keyword">struct</span> device *_dev,
01168                                 <span class="keyword">struct</span> device_attribute *attr, <span class="keywordtype">char</span> *buf)
01169 {
01170 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01171 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01172         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01173 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01174 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01175 <span class="preprocessor">#endif</span>
01176 <span class="preprocessor"></span>
01177         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"Sleep Status = %d\n"</span>,
01178                        <a class="code" href="dwc__otg__core__if_8h.html#a186">dwc_otg_get_lpm_portsleepstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>));
01179 }
01180 
01184 <span class="keyword">static</span> ssize_t sleepstatus_store(<span class="keyword">struct</span> device *_dev,
01185                                  <span class="keyword">struct</span> device_attribute *attr,
01186                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t count)
01187 {
01188 <span class="preprocessor">#ifdef LM_INTERFACE</span>
01189 <span class="preprocessor"></span>        <span class="keyword">struct </span>lm_device *lm_dev = container_of(_dev, <span class="keyword">struct</span> lm_device, dev);
01190         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(lm_dev);
01191 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
01192 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = dev_get_drvdata(_dev);
01193 <span class="preprocessor">#endif</span>
01194 <span class="preprocessor"></span>
01195         <a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *core_if = otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>;
01196 
01197         <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__core__if_8h.html#a186">dwc_otg_get_lpm_portsleepstatus</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>)) {
01198                 <span class="keywordflow">if</span> (dwc_otg_is_host_mode(core_if)) {
01199 
01200                         DWC_PRINTF(<span class="stringliteral">"Host initiated resume\n"</span>);
01201                         <a class="code" href="dwc__otg__core__if_8h.html#a184">dwc_otg_set_prtresume</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>, 1);
01202                 }
01203         }
01204 
01205         <span class="keywordflow">return</span> count;
01206 }
01207 
01208 DEVICE_ATTR(sleep_status, S_IRUGO | S_IWUSR, sleepstatus_show,
01209             sleepstatus_store);
01210 
01211 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_USB_DWC_OTG_LPM_ENABLE */</span>
01212 
<a name="l01218"></a><a class="code" href="dwc__otg__attr_8h.html#a25">01218</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__attr_8c.html#a78">dwc_otg_attr_create</a>(
01219 #ifdef LM_INTERFACE
01220                                 <span class="keyword">struct</span> lm_device *dev
01221 #elif  defined(PCI_INTERFACE)
01222                                 <span class="keyword">struct</span> pci_dev *dev
01223 #endif
01224     )
01225 {
01226         <span class="keywordtype">int</span> error;
01227 
01228         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regoffset);
01229         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regvalue);
01230         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_mode);
01231         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hnpcapable);
01232         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_srpcapable);
01233         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hsic_connect);
01234         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_inv_sel_hsic);
01235         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hnp);
01236         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_srp);
01237         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_buspower);
01238         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_bussuspend);
01239         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_mode_ch_tim_en);
01240         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_fr_interval);
01241         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_busconnected);
01242         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gotgctl);
01243         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gusbcfg);
01244         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_grxfsiz);
01245         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gnptxfsiz);
01246         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gpvndctl);
01247         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_ggpio);
01248         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_guid);
01249         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_gsnpsid);
01250         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_devspeed);
01251         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_enumspeed);
01252         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hptxfsiz);
01253         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hprt0);
01254         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_remote_wakeup);
01255         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_rem_wakeup_pwrdn);
01256         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_disconnect_us);
01257         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_regdump);
01258         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_spramdump);
01259         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hcddump);
01260         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_hcd_frrem);
01261         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_rd_reg_test);
01262         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_wr_reg_test);
01263 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01264 <span class="preprocessor"></span>        error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_lpm_response);
01265         error = device_create_file(&amp;dev-&gt;dev, &amp;dev_attr_sleep_status);
01266 <span class="preprocessor">#endif</span>
01267 <span class="preprocessor"></span>}
01268 
<a name="l01272"></a><a class="code" href="dwc__otg__attr_8h.html#a26">01272</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__attr_8c.html#a79">dwc_otg_attr_remove</a>(
01273 #ifdef LM_INTERFACE
01274                                 <span class="keyword">struct</span> lm_device *dev
01275 #elif  defined(PCI_INTERFACE)
01276                                 <span class="keyword">struct</span> pci_dev *dev
01277 #endif
01278     )
01279 {
01280         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regoffset);
01281         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regvalue);
01282         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_mode);
01283         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hnpcapable);
01284         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_srpcapable);
01285         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hsic_connect);
01286         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_inv_sel_hsic);
01287         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hnp);
01288         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_srp);
01289         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_buspower);
01290         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_bussuspend);
01291         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_mode_ch_tim_en);
01292         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_fr_interval);
01293         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_busconnected);
01294         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gotgctl);
01295         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gusbcfg);
01296         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_grxfsiz);
01297         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gnptxfsiz);
01298         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gpvndctl);
01299         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_ggpio);
01300         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_guid);
01301         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_gsnpsid);
01302         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_devspeed);
01303         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_enumspeed);
01304         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hptxfsiz);
01305         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hprt0);
01306         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_remote_wakeup);
01307         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_rem_wakeup_pwrdn);
01308         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_disconnect_us);
01309         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_regdump);
01310         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_spramdump);
01311         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hcddump);
01312         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_hcd_frrem);
01313         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_rd_reg_test);
01314         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_wr_reg_test);
01315 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01316 <span class="preprocessor"></span>        device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_lpm_response);
01317         device_remove_file(&amp;dev-&gt;dev, &amp;dev_attr_sleep_status);
01318 <span class="preprocessor">#endif</span>
01319 <span class="preprocessor"></span>}
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:37 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
