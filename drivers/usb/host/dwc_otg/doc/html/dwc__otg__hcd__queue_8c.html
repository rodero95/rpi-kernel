<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_hcd_queue.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_hcd_queue.c File Reference</h1>This file contains the functions to manage Queue Heads and Queue Transfer Descriptors. <a href="#_details">More...</a>
<p>
<code>#include "<a class="el" href="dwc__otg__hcd_8h-source.html">dwc_otg_hcd.h</a>"</code><br>
<code>#include "<a class="el" href="dwc__otg__regs_8h-source.html">dwc_otg_regs.h</a>"</code><br>

<p>
<a href="dwc__otg__hcd__queue_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0" doxytag="dwc_otg_hcd_queue.c::BitStuffTime"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>BitStuffTime</b>(bytecount)&nbsp;&nbsp;&nbsp;((8 * 7* bytecount) / 6)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a1" doxytag="dwc_otg_hcd_queue.c::HS_HOST_DELAY"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>HS_HOST_DELAY</b>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a2" doxytag="dwc_otg_hcd_queue.c::FS_LS_HOST_DELAY"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>FS_LS_HOST_DELAY</b>&nbsp;&nbsp;&nbsp;1000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a3" doxytag="dwc_otg_hcd_queue.c::HUB_LS_SETUP"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>HUB_LS_SETUP</b>&nbsp;&nbsp;&nbsp;333</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a4" doxytag="dwc_otg_hcd_queue.c::NS_TO_US"></a>
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NS_TO_US</b>(ns)&nbsp;&nbsp;&nbsp;((ns + 500) / 1000)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a5">SCHEDULE_SLOP</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a QH structure.  <a href="#a5"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a6">dwc_otg_hcd_qh_free</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free each QTD in the QH's QTD-list then free the QH.  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a7" doxytag="dwc_otg_hcd_queue.c::calc_bus_time"></a>
uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><b>calc_bus_time</b> (int speed, int is_in, int is_isoc, int bytecount)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a8">qh_init</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, dwc_otg_hcd_urb_t *urb)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a9">dwc_otg_hcd_qh_create</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, dwc_otg_hcd_urb_t *urb, int atomic_alloc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocates and initializes a QH.  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a10">periodic_channel_available</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that a channel is available for a periodic transfer.  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a11">check_periodic_bandwidth</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that there is sufficient bandwidth for the specified QH in the periodic schedule.  <a href="#a11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a12">check_max_xfer_size</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks that the max transfer size allowed in a host channel is large enough to handle the maximum data transfer in a single (micro)frame for a periodic transfer.  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a13">schedule_periodic</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Schedules an interrupt or isochronous transfer in the periodic schedule.  <a href="#a13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a14">dwc_otg_hcd_qh_add</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function adds a QH to either the non periodic or periodic schedule if it is not already in the schedule.  <a href="#a14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a15">deschedule_periodic</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Removes an interrupt or isochronous transfer from the periodic schedule.  <a href="#a15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a16">dwc_otg_hcd_qh_remove</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Removes a QH from either the non-periodic or periodic schedule.  <a href="#a16"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a17">dwc_otg_hcd_qh_deactivate</a> (<a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *qh, int sched_next_periodic_split)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deactivates a QH.  <a href="#a17"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a18">dwc_otg_hcd_qtd_create</a> (dwc_otg_hcd_urb_t *urb, int atomic_alloc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocates and initializes a QTD.  <a href="#a18"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a19">dwc_otg_hcd_qtd_init</a> (<a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *qtd, dwc_otg_hcd_urb_t *urb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a QTD structure.  <a href="#a19"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__hcd__queue_8c.html#a20">dwc_otg_hcd_qtd_add</a> (<a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *qtd, <a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *hcd, <a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> **qh, int atomic_alloc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function adds a QTD to the QTD-list of a QH.  <a href="#a20"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains the functions to manage Queue Heads and Queue Transfer Descriptors. 
<p>

<p>
Definition in file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a5" doxytag="dwc_otg_hcd_queue.c::SCHEDULE_SLOP"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SCHEDULE_SLOP&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes a QH structure. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to init. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>Holds the information about the device/endpoint that we need to initialize the QH. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00154">154</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_free"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_hcd_qh_free           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free each QTD in the QH's QTD-list then free the QH. 
<p>
QH should already be removed from a list. QTD list should already be empty if called from URB Dequeue.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>HCD instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>The QH to free. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00053">53</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="dwc_otg_hcd_queue.c::qh_init"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void qh_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>dwc_otg_hcd_urb_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>urb</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000019">Todo:</a></b></dt><dd>Account for split transfers in the bus time.</dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00155">155</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_create"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a>* dwc_otg_hcd_qh_create           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>dwc_otg_hcd_urb_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>urb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>atomic_alloc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function allocates and initializes a QH. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>Holds the information about the device/endpoint that we need to initialize the QH. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>atomic_alloc</em>&nbsp;</td><td>Flag to do atomic allocation if needed</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns pointer to the newly allocated QH, or NULL on error.</dd></dl>
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000020">Todo:</a></b></dt><dd>add memflags argument</dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00290">290</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dwc_otg_hcd_queue.c::periodic_channel_available"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int periodic_channel_available           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hcd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks that a channel is available for a periodic transfer. 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00319">319</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="dwc_otg_hcd_queue.c::check_periodic_bandwidth"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int check_periodic_bandwidth           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks that there is sufficient bandwidth for the specified QH in the periodic schedule. 
<p>
For simplicity, this calculation assumes that all the transfers in the periodic schedule may occur in the same (micro)frame.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH containing periodic bandwidth required.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00352">352</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="dwc_otg_hcd_queue.c::check_max_xfer_size"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int check_max_xfer_size           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks that the max transfer size allowed in a host channel is large enough to handle the maximum data transfer in a single (micro)frame for a periodic transfer. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for a periodic endpoint.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00392">392</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="dwc_otg_hcd_queue.c::schedule_periodic"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int schedule_periodic           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Schedules an interrupt or isochronous transfer in the periodic schedule. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for the periodic transfer. The QH should already contain the scheduling information.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00421">421</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_add"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dwc_otg_hcd_qh_add           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function adds a QH to either the non periodic or periodic schedule if it is not already in the schedule. 
<p>
If the QH is already in the schedule, no action is taken.<p>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00468">468</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="dwc_otg_hcd_queue.c::deschedule_periodic"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void deschedule_periodic           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Removes an interrupt or isochronous transfer from the periodic schedule. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure for the DWC OTG controller. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH for the periodic transfer. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00502">502</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_remove"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_hcd_qh_remove           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Removes a QH from either the non-periodic or periodic schedule. 
<p>
Memory is not freed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hcd</em>&nbsp;</td><td>The HCD state structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>qh</em>&nbsp;</td><td>QH to remove from schedule. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00519">519</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qh_deactivate"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_hcd_qh_deactivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sched_next_periodic_split</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Deactivates a QH. 
<p>
For non-periodic QHs, removes the QH from the active non-periodic schedule. The QH is added to the inactive non-periodic schedule if any QTDs are still attached to the QH.<p>
For periodic QHs, the QH is removed from the periodic queued schedule. If there are any QTDs still attached to the QH, the QH is added to either the periodic inactive schedule or the periodic ready schedule and its next scheduled frame is calculated. The QH is placed in the ready schedule if the scheduled frame has been reached already. Otherwise it's placed in the inactive schedule. If there are no QTDs attached to the QH, the QH is completely removed from the periodic schedule. 
<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00558">558</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_create"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a>* dwc_otg_hcd_qtd_create           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">dwc_otg_hcd_urb_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>urb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>atomic_alloc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function allocates and initializes a QTD. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>The URB to create a QTD from. Each URB-QTD pair will end up pointing to each other so each pair should have a unique correlation. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>atomic_alloc</em>&nbsp;</td><td>Flag to do atomic alloc if needed</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns pointer to the newly allocated QTD, or NULL on error. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00638">638</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_init"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_hcd_qtd_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qtd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>dwc_otg_hcd_urb_t *&nbsp;</td>
          <td class="mdname" nowrap> <em>urb</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes a QTD structure. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qtd</em>&nbsp;</td><td>The QTD to initialize. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>urb</em>&nbsp;</td><td>The URB to use for initialization. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00656">656</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="dwc_otg_hcd_queue.c::dwc_otg_hcd_qtd_add"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dwc_otg_hcd_qtd_add           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structdwc__otg__qtd.html">dwc_otg_qtd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>qtd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__hcd.html">dwc_otg_hcd_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>hcd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdwc__otg__qh.html">dwc_otg_qh_t</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>qh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>atomic_alloc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function adds a QTD to the QTD-list of a QH. 
<p>
It will find the correct QH to place the QTD into. If it does not find a QH, then it will create a new QH. If the QH to which the QTD is added is not currently scheduled, it is placed into the proper schedule based on its EP type.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>qtd</em>&nbsp;</td><td>The QTD to add </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hcd</em>&nbsp;</td><td>The DWC HCD structure </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>qh</em>&nbsp;</td><td>out parameter to return queue head </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>atomic_alloc</em>&nbsp;</td><td>Flag to do atomic alloc if needed</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 if successful, negative error code otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__hcd__queue_8c-source.html#l00694">694</a> of file <a class="el" href="dwc__otg__hcd__queue_8c-source.html">dwc_otg_hcd_queue.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:38 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
