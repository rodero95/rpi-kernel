<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_pcd_linux.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_pcd_linux.c File Reference</h1>This file implements the Peripheral Controller Driver. <a href="#_details">More...</a>
<p>
<code>#include "<a class="el" href="dwc__otg__os__dep_8h-source.html">dwc_otg_os_dep.h</a>"</code><br>
<code>#include "<a class="el" href="dwc__otg__pcd__if_8h-source.html">dwc_otg_pcd_if.h</a>"</code><br>
<code>#include "<a class="el" href="dwc__otg__pcd_8h-source.html">dwc_otg_pcd.h</a>"</code><br>
<code>#include "<a class="el" href="dwc__otg__driver_8h-source.html">dwc_otg_driver.h</a>"</code><br>
<code>#include "<a class="el" href="dwc__otg__dbg_8h-source.html">dwc_otg_dbg.h</a>"</code><br>

<p>
<a href="dwc__otg__pcd__linux_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><b>gadget_wrapper</b></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a4" doxytag="dwc_otg_pcd_linux.c::dump_msg"></a>
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>dump_msg</b> (const u8 *buf, unsigned int length)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a5" doxytag="dwc_otg_pcd_linux.c::ep_from_handle"></a>
<a class="el" href="structdwc__otg__pcd__ep.html">dwc_otg_pcd_ep</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a5">ep_from_handle</a> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd, void *handle)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the dwc_otg_pcd_ep_t* from usb_ep* pointer - NULL in case if the endpoint is not found. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a6">ep_enable</a> (struct usb_ep *usb_ep, const struct usb_endpoint_descriptor *ep_desc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is called by the Gadget Driver for each EP to be configured for the current configuration (SET_CONFIGURATION).  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a7">ep_disable</a> (struct usb_ep *usb_ep)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is called when an EP is disabled due to disconnect or change in configuration.  <a href="#a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">usb_request *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a8">dwc_otg_pcd_alloc_request</a> (struct usb_ep *ep, gfp_t gfp_flags)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocates a request object to use with the specified endpoint.  <a href="#a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a9">dwc_otg_pcd_free_request</a> (struct usb_ep *ep, struct usb_request *req)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function frees a request object.  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a10">ep_queue</a> (struct usb_ep *usb_ep, struct usb_request *usb_req, gfp_t gfp_flags)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is used to submit an I/O Request to an EP.  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a11" doxytag="dwc_otg_pcd_linux.c::ep_dequeue"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a11">ep_dequeue</a> (struct usb_ep *usb_ep, struct usb_request *usb_req)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function cancels an I/O request from an EP. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a12">ep_halt</a> (struct usb_ep *usb_ep, int value)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">usb_ep_set_halt stalls an endpoint.  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a13">iso_ep_start</a> (struct usb_ep *usb_ep, struct usb_iso_request *req, gfp_t gfp_flags)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is used to submit an ISOC Transfer Request to an EP.  <a href="#a13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a14" doxytag="dwc_otg_pcd_linux.c::iso_ep_stop"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a14">iso_ep_stop</a> (struct usb_ep *usb_ep, struct usb_iso_request *req)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function stops ISO EP Periodic Data Transfer. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a15" doxytag="dwc_otg_pcd_linux.c::alloc_iso_request"></a>
usb_iso_request *&nbsp;</td><td class="memItemRight" valign="bottom"><b>alloc_iso_request</b> (struct usb_ep *ep, int packets, gfp_t gfp_flags)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a16" doxytag="dwc_otg_pcd_linux.c::free_iso_request"></a>
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>free_iso_request</b> (struct usb_ep *ep, struct usb_iso_request *req)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a17" doxytag="dwc_otg_pcd_linux.c::get_frame_number"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a17">get_frame_number</a> (struct usb_gadget *gadget)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Gets the USB Frame number of the last SOF. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a18">wakeup</a> (struct usb_gadget *gadget)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiates Session Request Protocol (SRP) to wakeup the host if no session is in progress.  <a href="#a18"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a19" doxytag="dwc_otg_pcd_linux.c::_setup"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_setup</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd, uint8_t *bytes)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a20" doxytag="dwc_otg_pcd_linux.c::_isoc_complete"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_isoc_complete</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd, void *ep_handle, void *req_handle, int proc_buf_num)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a21" doxytag="dwc_otg_pcd_linux.c::_complete"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_complete</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd, void *ep_handle, void *req_handle, int32_t status, uint32_t actual)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a22" doxytag="dwc_otg_pcd_linux.c::_connect"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_connect</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd, int speed)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a23" doxytag="dwc_otg_pcd_linux.c::_disconnect"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_disconnect</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a24" doxytag="dwc_otg_pcd_linux.c::_resume"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_resume</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a25" doxytag="dwc_otg_pcd_linux.c::_suspend"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_suspend</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a26" doxytag="dwc_otg_pcd_linux.c::_hnp_changed"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a26">_hnp_changed</a> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function updates the otg values in the gadget structure. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a27" doxytag="dwc_otg_pcd_linux.c::_reset"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_reset</b> (<a class="el" href="structdwc__otg__pcd.html">dwc_otg_pcd_t</a> *pcd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a28" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_irq"></a>
irqreturn_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a28">dwc_otg_pcd_irq</a> (int irq, void *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is the top level PCD interrupt handler. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a29">gadget_add_eps</a> (struct gadget_wrapper *d)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initialized the usb_ep structures to there default state.  <a href="#a29"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a30">dwc_otg_pcd_gadget_release</a> (struct device *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function releases the Gadget device.  <a href="#a30"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a31" doxytag="dwc_otg_pcd_linux.c::alloc_wrapper"></a>
gadget_wrapper *&nbsp;</td><td class="memItemRight" valign="bottom"><b>alloc_wrapper</b> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a32" doxytag="dwc_otg_pcd_linux.c::free_wrapper"></a>
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>free_wrapper</b> (struct gadget_wrapper *d)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a33" doxytag="dwc_otg_pcd_linux.c::pcd_init"></a>
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a33">pcd_init</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function initialized the PCD portion of the driver. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a34" doxytag="dwc_otg_pcd_linux.c::pcd_remove"></a>
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a34">pcd_remove</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cleanup the PCD. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a35">usb_gadget_probe_driver</a> (struct usb_gadget_driver *driver, int(*bind)(struct usb_gadget *))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function registers a gadget driver with the PCD.  <a href="#a35"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a36" doxytag="dwc_otg_pcd_linux.c::EXPORT_SYMBOL"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>EXPORT_SYMBOL</b> (usb_gadget_probe_driver)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dwc__otg__pcd__linux_8c.html#a37">usb_gadget_unregister_driver</a> (struct usb_gadget_driver *driver)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function unregisters a gadget driver.  <a href="#a37"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a38" doxytag="dwc_otg_pcd_linux.c::EXPORT_SYMBOL"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><b>EXPORT_SYMBOL</b> (usb_gadget_unregister_driver)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0" doxytag="dwc_otg_pcd_linux.c::gadget_wrapper"></a>
gadget_wrapper *&nbsp;</td><td class="memItemRight" valign="bottom"><b>gadget_wrapper</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">usb_isoc_ep_ops&nbsp;</td><td class="memItemRight" valign="bottom"><b>dwc_otg_pcd_ep_ops</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const struct usb_gadget_ops&nbsp;</td><td class="memItemRight" valign="bottom"><b>dwc_otg_pcd_ops</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const struct <a class="el" href="structdwc__otg__pcd__function__ops.html">dwc_otg_pcd_function_ops</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>fops</b></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This file implements the Peripheral Controller Driver. 
<p>
The Peripheral Controller Driver (PCD) is responsible for translating requests from the Function Driver into the appropriate actions on the DWC_otg controller. It isolates the Function Driver from the specifics of the controller by providing an API to the Function Driver.<p>
The Peripheral Controller Driver for Linux will implement the Gadget API, so that the existing Gadget drivers can be used. (Gadget Driver is the Linux terminology for a Function Driver.)<p>
The Linux Gadget API is defined in the header file <code>&lt;linux/usb_gadget.h&gt;</code>. The USB EP operations API is defined in the structure <code>usb_ep_ops</code> and the USB Controller API is defined in the structure <code>usb_gadget_ops</code>.
<p>
Definition in file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="dwc_otg_pcd_linux.c::ep_enable"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ep_enable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>usb_ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct usb_endpoint_descriptor *&nbsp;</td>
          <td class="mdname" nowrap> <em>ep_desc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is called by the Gadget Driver for each EP to be configured for the current configuration (SET_CONFIGURATION). 
<p>
This function initializes the dwc_otg_ep_t data structure, and then calls dwc_otg_ep_activate. 
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00121">121</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="dwc_otg_pcd_linux.c::ep_disable"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ep_disable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>usb_ep</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is called when an EP is disabled due to disconnect or change in configuration. 
<p>
Any pending requests will terminate with a status of -ESHUTDOWN.<p>
This function modifies the dwc_otg_ep_t data structure for this EP, and then calls dwc_otg_ep_deactivate. 
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00177">177</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_alloc_request"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct usb_request* dwc_otg_pcd_alloc_request           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>gfp_t&nbsp;</td>
          <td class="mdname" nowrap> <em>gfp_flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function allocates a request object to use with the specified endpoint. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ep</em>&nbsp;</td><td>The endpoint to be used with with the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gfp_flags</em>&nbsp;</td><td>the GFP_* flags to use. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00203">203</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_free_request"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_pcd_free_request           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct usb_request *&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function frees a request object. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ep</em>&nbsp;</td><td>The endpoint associated with the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>The request being freed </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00230">230</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dwc_otg_pcd_linux.c::ep_queue"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ep_queue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>usb_ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct usb_request *&nbsp;</td>
          <td class="mdname" nowrap> <em>usb_req</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>gfp_t&nbsp;</td>
          <td class="mdname" nowrap> <em>gfp_flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to submit an I/O Request to an EP. 
<p>
<ul>
<li>When the request completes the request's completion callback is called to return the request to the driver.</li><li>An EP, except control EPs, may have multiple requests pending.</li><li>Once submitted the request cannot be examined or modified.</li><li>Each request is turned into one or more packets.</li><li>A BULK EP can queue any amount of data; the transfer is packetized.</li><li>Zero length Packets are specified with the request 'zero' flag. </li></ul>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00317">317</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="dwc_otg_pcd_linux.c::ep_halt"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ep_halt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>usb_ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
usb_ep_set_halt stalls an endpoint. 
<p>
usb_ep_clear_halt clears an endpoint halt and resets its data toggle.<p>
Both of these functions are implemented with the same underlying function. The behavior depends on the value argument.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>usb_ep</em>&nbsp;</td><td>the Endpoint to halt or clear halt. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>value</em>&nbsp;</td><td><ul>
<li>0 means clear_halt.</li><li>1 means set_halt,</li><li>2 means clear stall lock flag.</li><li>3 means set stall lock flag. </li></ul>
</td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00430">430</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="dwc_otg_pcd_linux.c::iso_ep_start"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int iso_ep_start           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_ep *&nbsp;</td>
          <td class="mdname" nowrap> <em>usb_ep</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct usb_iso_request *&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>gfp_t&nbsp;</td>
          <td class="mdname" nowrap> <em>gfp_flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to submit an ISOC Transfer Request to an EP. 
<p>
<ul>
<li>Every time a sync period completes the request's completion callback is called to provide data to the gadget driver.</li><li>Once submitted the request cannot be modified.</li><li>Each request is turned into periodic data packets untill ISO Transfer is stopped.. </li></ul>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00461">461</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="dwc_otg_pcd_linux.c::wakeup"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int wakeup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_gadget *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>gadget</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initiates Session Request Protocol (SRP) to wakeup the host if no session is in progress. 
<p>
If a session is already in progress, but the device is suspended, remote wakeup signaling is started. 
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00646">646</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="dwc_otg_pcd_linux.c::gadget_add_eps"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void gadget_add_eps           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct gadget_wrapper *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>d</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function initialized the usb_ep structures to there default state. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>d</em>&nbsp;</td><td>Pointer on gadget_wrapper.</td></tr>
  </table>
</dl>
<p>
Initialize the EP0 structure. <p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000042">Todo:</a></b></dt><dd>NGS: What should the max packet size be set to here? Before EP type is set? <p>
NGS: What should the max packet size be set to here? Before EP type is set? <p>
NGS: What should the max packet size be set to here? Before EP type is set? </dd></dl>
<p>
Initialize the EP structures. 
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00950">950</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_gadget_release"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dwc_otg_pcd_gadget_release           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct device *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dev</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function releases the Gadget device. 
<p>
required by device_unregister().<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000043">Todo:</a></b></dt><dd>Should this do something? Should it free the PCD? </dd></dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l01067">1067</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="dwc_otg_pcd_linux.c::usb_gadget_probe_driver"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int usb_gadget_probe_driver           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_gadget_driver *&nbsp;</td>
          <td class="mdname" nowrap> <em>driver</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int(*)(struct usb_gadget *)&nbsp;</td>
          <td class="mdname" nowrap> <em>bind</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function registers a gadget driver with the PCD. 
<p>
When a driver is successfully registered, it will receive control requests including set_configuration(), which enables non-control requests. then usb traffic follows until a disconnect is reported. then a host may connect again, or the driver might get unbound.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>driver</em>&nbsp;</td><td>The driver being registered </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bind</em>&nbsp;</td><td>The bind function of gadget driver </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l01234">1234</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="dwc_otg_pcd_linux.c::usb_gadget_unregister_driver"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int usb_gadget_unregister_driver           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct usb_gadget_driver *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>driver</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function unregisters a gadget driver. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>driver</em>&nbsp;</td><td>The driver being unregistered </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l01294">1294</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_ep_ops"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct usb_isoc_ep_ops dwc_otg_pcd_ep_ops<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ep_ops = {
                   .enable = ep_enable,
                   .disable = ep_disable,

                   .alloc_request = dwc_otg_pcd_alloc_request,
                   .free_request = dwc_otg_pcd_free_request,






                   .queue = ep_queue,
                   .dequeue = ep_dequeue,

                   .set_halt = ep_halt,
                   .fifo_status = 0,
                   .fifo_flush = 0,
                   },
        .iso_ep_start = iso_ep_start,
        .iso_ep_stop = iso_ep_stop,
        .alloc_iso_request = alloc_iso_request,
        .free_iso_request = free_iso_request,
}
</pre></div>
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00546">546</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="dwc_otg_pcd_linux.c::dwc_otg_pcd_ops"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const struct usb_gadget_ops dwc_otg_pcd_ops<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .get_frame = get_frame_number,
        .wakeup = wakeup,



        
}
</pre></div>
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00661">661</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="dwc_otg_pcd_linux.c::fops"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structdwc__otg__pcd__function__ops.html">dwc_otg_pcd_function_ops</a> fops<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .complete = _complete,

        .isoc_complete = _isoc_complete,

        .setup = _setup,
        .disconnect = _disconnect,
        .connect = _connect,
        .resume = _resume,
        .suspend = _suspend,
        .hnp_changed = _hnp_changed,
        .reset = _reset,






}
</pre></div>
<p>
Definition at line <a class="el" href="dwc__otg__pcd__linux_8c-source.html#l00909">909</a> of file <a class="el" href="dwc__otg__pcd__linux_8c-source.html">dwc_otg_pcd_linux.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:38 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
