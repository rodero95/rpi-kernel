<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_cil.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_cil.h</h1><a href="dwc__otg__cil_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* ==========================================================================</span>
00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_cil.h $</span>
00003 <span class="comment"> * $Revision: #122 $</span>
00004 <span class="comment"> * $Date: 2011/10/24 $</span>
00005 <span class="comment"> * $Change: 1871160 $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
00031 <span class="comment"> * DAMAGE.</span>
00032 <span class="comment"> * ========================================================================== */</span>
00033 
00034 <span class="preprocessor">#if !defined(__DWC_CIL_H__)</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define __DWC_CIL_H__</span>
00036 <span class="preprocessor"></span>
00037 <span class="preprocessor">#include "dwc_list.h"</span>
00038 <span class="preprocessor">#include "<a class="code" href="dwc__otg__dbg_8h.html">dwc_otg_dbg.h</a>"</span>
00039 <span class="preprocessor">#include "<a class="code" href="dwc__otg__regs_8h.html">dwc_otg_regs.h</a>"</span>
00040 
00041 <span class="preprocessor">#include "<a class="code" href="dwc__otg__core__if_8h.html">dwc_otg_core_if.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="dwc__otg__adp_8h.html">dwc_otg_adp.h</a>"</span>
00043 
00049 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
00050 <span class="preprocessor"></span>
00051 <span class="preprocessor">#define MAX_DMA_DESCS_PER_EP    256</span>
00052 <span class="preprocessor"></span>
00056 <span class="keyword">typedef</span> <span class="keyword">enum</span> _data_buffer_mode {
00057         BM_STANDARD = 0,        <span class="comment">/* data buffer is in normal mode */</span>
00058         BM_SG = 1,              <span class="comment">/* data buffer uses the scatter/gather mode */</span>
00059         BM_CONCAT = 2,          <span class="comment">/* data buffer uses the concatenation mode */</span>
00060         BM_CIRCULAR = 3,        <span class="comment">/* data buffer uses the circular DMA mode */</span>
00061         BM_ALIGN = 4            <span class="comment">/* data buffer is in buffer alignment mode */</span>
00062 } data_buffer_mode_e;
00063 <span class="preprocessor">#endif //DWC_UTE_CFI</span>
00064 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="dwc__otg__cil_8h.html#a1">00067</a> <span class="preprocessor">#define OTG_CORE_REV_2_60a      0x4F54260A</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_71a      0x4F54271A</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_72a      0x4F54272A</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_80a      0x4F54280A</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_81a      0x4F54281A</span>
00072 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_90a      0x4F54290A</span>
00073 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_91a      0x4F54291A</span>
00074 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_92a      0x4F54292A</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_93a      0x4F54293A</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define OTG_CORE_REV_2_94a      0x4F54294A</span>
00077 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="structiso__pkt__info.html">00081</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structiso__pkt__info.html">iso_pkt_info</a> {
00082         uint32_t offset;
00083         uint32_t length;
00084         int32_t status;
00085 } <a class="code" href="structiso__pkt__info.html">iso_pkt_info_t</a>;
00086 
<a name="l00092"></a><a class="code" href="structdwc__ep.html">00092</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdwc__ep.html">dwc_ep</a> {
<a name="l00094"></a><a class="code" href="structdwc__ep.html#o0">00094</a>         uint8_t num;
<a name="l00096"></a><a class="code" href="structdwc__ep.html#o1">00096</a>         <span class="keywordtype">unsigned</span> is_in:1;
<a name="l00098"></a><a class="code" href="structdwc__ep.html#o2">00098</a>         <span class="keywordtype">unsigned</span> active:1;
00099 
<a name="l00103"></a><a class="code" href="structdwc__ep.html#o3">00103</a>         <span class="keywordtype">unsigned</span> tx_fifo_num:4;
<a name="l00105"></a><a class="code" href="structdwc__ep.html#o4">00105</a>         <span class="keywordtype">unsigned</span> type:2;
00106 <span class="preprocessor">#define DWC_OTG_EP_TYPE_CONTROL    0</span>
00107 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_EP_TYPE_ISOC       1</span>
00108 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_EP_TYPE_BULK       2</span>
00109 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_EP_TYPE_INTR       3</span>
00110 <span class="preprocessor"></span>
<a name="l00112"></a><a class="code" href="structdwc__ep.html#o5">00112</a>         <span class="keywordtype">unsigned</span> data_pid_start:1;
<a name="l00114"></a><a class="code" href="structdwc__ep.html#o6">00114</a>         <span class="keywordtype">unsigned</span> even_odd_frame:1;
<a name="l00116"></a><a class="code" href="structdwc__ep.html#o7">00116</a>         <span class="keywordtype">unsigned</span> maxpacket:11;
00117 
<a name="l00119"></a><a class="code" href="structdwc__ep.html#o8">00119</a>         uint32_t maxxfer;
00120 
<a name="l00129"></a><a class="code" href="structdwc__ep.html#z32_0">00129</a>         dwc_dma_t dma_addr;
00130 
00131         dwc_dma_t dma_desc_addr;
00132         <a class="code" href="structdwc__otg__dev__dma__desc.html">dwc_otg_dev_dma_desc_t</a> *desc_addr;
00133 
00134         uint8_t *start_xfer_buff;
<a name="l00136"></a><a class="code" href="structdwc__ep.html#z32_4">00136</a>         uint8_t *xfer_buff;
<a name="l00138"></a><a class="code" href="structdwc__ep.html#z32_5">00138</a>         <span class="keywordtype">unsigned</span> xfer_len:19;
<a name="l00140"></a><a class="code" href="structdwc__ep.html#z32_6">00140</a>         <span class="keywordtype">unsigned</span> xfer_count:19;
<a name="l00142"></a><a class="code" href="structdwc__ep.html#z32_7">00142</a>         <span class="keywordtype">unsigned</span> sent_zlp:1;
<a name="l00144"></a><a class="code" href="structdwc__ep.html#z32_8">00144</a>         <span class="keywordtype">unsigned</span> total_len:19;
00145 
<a name="l00147"></a><a class="code" href="structdwc__ep.html#z32_9">00147</a>         <span class="keywordtype">unsigned</span> stall_clear_flag:1;
00148 
00149 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
00150 <span class="preprocessor"></span>        <span class="comment">/* The buffer mode */</span>
00151         data_buffer_mode_e buff_mode;
00152 
00153         <span class="comment">/* The chain of DMA descriptors.</span>
00154 <span class="comment">         * MAX_DMA_DESCS_PER_EP will be allocated for each active EP.</span>
00155 <span class="comment">         */</span>
00156         dwc_otg_dma_desc_t *descs;
00157 
00158         <span class="comment">/* The DMA address of the descriptors chain start */</span>
00159         dma_addr_t descs_dma_addr;
00161         uint32_t cfi_req_len;
00162 <span class="preprocessor">#endif                          //DWC_UTE_CFI</span>
00163 <span class="preprocessor"></span>
<a name="l00165"></a><a class="code" href="dwc__otg__cil_8h.html#a15">00165</a> <span class="preprocessor">#define MAX_DMA_DESC_CNT 256</span>
00166 <span class="preprocessor"></span>
<a name="l00167"></a><a class="code" href="structdwc__ep.html#z32_10">00167</a>         uint32_t desc_cnt;
00168         
00170         uint32_t bInterval;
<a name="l00172"></a><a class="code" href="structdwc__ep.html#z32_12">00172</a>         uint32_t frame_num;
<a name="l00174"></a><a class="code" href="structdwc__ep.html#z32_13">00174</a>         uint8_t frm_overrun;
00175 
00176 <span class="preprocessor">#ifdef DWC_UTE_PER_IO</span>
00177 <span class="preprocessor"></span>
00178         uint32_t xiso_frame_num;
00180         uint32_t xiso_bInterval;
00182         <span class="keywordtype">int</span> xiso_active_xfers;
00183         <span class="keywordtype">int</span> xiso_queued_xfers;
00184 <span class="preprocessor">#endif</span>
00185 <span class="preprocessor"></span><span class="preprocessor">#ifdef DWC_EN_ISOC</span>
00186 <span class="preprocessor"></span>
<a name="l00191"></a><a class="code" href="structdwc__ep.html#z32_14">00191</a>         dwc_dma_t dma_addr0;
00192         dwc_dma_t dma_addr1;
00193 
00194         dwc_dma_t iso_dma_desc_addr;
00195         <a class="code" href="structdwc__otg__dev__dma__desc.html">dwc_otg_dev_dma_desc_t</a> *iso_desc_addr;
00196 
<a name="l00198"></a><a class="code" href="structdwc__ep.html#z32_18">00198</a>         uint8_t *xfer_buff0;
00199         uint8_t *xfer_buff1;
00200 
<a name="l00202"></a><a class="code" href="structdwc__ep.html#z32_20">00202</a>         uint32_t proc_buf_num;
<a name="l00204"></a><a class="code" href="structdwc__ep.html#z32_21">00204</a>         uint32_t buf_proc_intrvl;
<a name="l00206"></a><a class="code" href="structdwc__ep.html#z32_22">00206</a>         uint32_t data_per_frame;
00207 
00208         <span class="comment">/* todo - pattern data support is to be implemented in the future */</span>
<a name="l00210"></a><a class="code" href="structdwc__ep.html#z32_23">00210</a>         uint32_t data_pattern_frame;
<a name="l00212"></a><a class="code" href="structdwc__ep.html#z32_24">00212</a>         uint32_t sync_frame;
00213 
<a name="l00215"></a><a class="code" href="structdwc__ep.html#z32_11">00215</a>         uint32_t bInterval;
<a name="l00217"></a><a class="code" href="structdwc__ep.html#z32_25">00217</a>         uint32_t pkt_per_frm;
<a name="l00219"></a><a class="code" href="structdwc__ep.html#z32_26">00219</a>         uint32_t next_frame;
<a name="l00221"></a><a class="code" href="structdwc__ep.html#z32_27">00221</a>         uint32_t pkt_cnt;
<a name="l00223"></a><a class="code" href="structdwc__ep.html#z32_28">00223</a>         <a class="code" href="structiso__pkt__info.html">iso_pkt_info_t</a> *pkt_info;
<a name="l00225"></a><a class="code" href="structdwc__ep.html#z32_29">00225</a>         uint32_t cur_pkt;
<a name="l00227"></a><a class="code" href="structdwc__ep.html#z32_30">00227</a>         uint8_t *cur_pkt_addr;
<a name="l00229"></a><a class="code" href="structdwc__ep.html#z32_31">00229</a>         uint32_t cur_pkt_dma_addr;
00230 <span class="preprocessor">#endif                          </span><span class="comment">/* DWC_EN_ISOC */</span>
00231 
00233 } <a class="code" href="structdwc__ep.html">dwc_ep_t</a>;
00234 
00235 <span class="comment">/*</span>
00236 <span class="comment"> * Reasons for halting a host channel.</span>
00237 <span class="comment"> */</span>
00238 <span class="keyword">typedef</span> <span class="keyword">enum</span> dwc_otg_halt_status {
00239         DWC_OTG_HC_XFER_NO_HALT_STATUS,
00240         DWC_OTG_HC_XFER_COMPLETE,
00241         DWC_OTG_HC_XFER_URB_COMPLETE,
00242         DWC_OTG_HC_XFER_ACK,
00243         DWC_OTG_HC_XFER_NAK,
00244         DWC_OTG_HC_XFER_NYET,
00245         DWC_OTG_HC_XFER_STALL,
00246         DWC_OTG_HC_XFER_XACT_ERR,
00247         DWC_OTG_HC_XFER_FRAME_OVERRUN,
00248         DWC_OTG_HC_XFER_BABBLE_ERR,
00249         DWC_OTG_HC_XFER_DATA_TOGGLE_ERR,
00250         DWC_OTG_HC_XFER_AHB_ERR,
00251         DWC_OTG_HC_XFER_PERIODIC_INCOMPLETE,
00252         DWC_OTG_HC_XFER_URB_DEQUEUE
00253 } dwc_otg_halt_status_e;
00254 
<a name="l00260"></a><a class="code" href="structdwc__hc.html">00260</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdwc__hc.html">dwc_hc</a> {
<a name="l00262"></a><a class="code" href="structdwc__hc.html#o0">00262</a>         uint8_t hc_num;
00263 
<a name="l00265"></a><a class="code" href="structdwc__hc.html#o1">00265</a>         <span class="keywordtype">unsigned</span> dev_addr:7;
00266 
<a name="l00268"></a><a class="code" href="structdwc__hc.html#o2">00268</a>         <span class="keywordtype">unsigned</span> ep_num:4;
00269 
<a name="l00271"></a><a class="code" href="structdwc__hc.html#o3">00271</a>         <span class="keywordtype">unsigned</span> ep_is_in:1;
00272 
<a name="l00280"></a><a class="code" href="structdwc__hc.html#o4">00280</a>         <span class="keywordtype">unsigned</span> speed:2;
00281 <span class="preprocessor">#define DWC_OTG_EP_SPEED_LOW    0</span>
00282 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_EP_SPEED_FULL   1</span>
00283 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_EP_SPEED_HIGH   2</span>
00284 <span class="preprocessor"></span>
<a name="l00293"></a><a class="code" href="structdwc__hc.html#o5">00293</a>         <span class="keywordtype">unsigned</span> ep_type:2;
00294 
<a name="l00296"></a><a class="code" href="structdwc__hc.html#o6">00296</a>         <span class="keywordtype">unsigned</span> max_packet:11;
00297 
<a name="l00306"></a><a class="code" href="structdwc__hc.html#o7">00306</a>         <span class="keywordtype">unsigned</span> data_pid_start:2;
00307 <span class="preprocessor">#define DWC_OTG_HC_PID_DATA0 0</span>
00308 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_HC_PID_DATA2 1</span>
00309 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_HC_PID_DATA1 2</span>
00310 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_HC_PID_MDATA 3</span>
00311 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_HC_PID_SETUP 3</span>
00312 <span class="preprocessor"></span>
<a name="l00314"></a><a class="code" href="structdwc__hc.html#o8">00314</a>         <span class="keywordtype">unsigned</span> multi_count:2;
00315 
<a name="l00320"></a><a class="code" href="structdwc__hc.html#z34_0">00320</a>         uint8_t *xfer_buff;
<a name="l00325"></a><a class="code" href="structdwc__hc.html#z34_1">00325</a>         dwc_dma_t align_buff;
<a name="l00327"></a><a class="code" href="structdwc__hc.html#z34_2">00327</a>         uint32_t xfer_len;
<a name="l00329"></a><a class="code" href="structdwc__hc.html#z34_3">00329</a>         uint32_t xfer_count;
<a name="l00331"></a><a class="code" href="structdwc__hc.html#z34_4">00331</a>         uint16_t start_pkt_count;
00332 
<a name="l00337"></a><a class="code" href="structdwc__hc.html#z34_5">00337</a>         uint8_t xfer_started;
00338 
<a name="l00343"></a><a class="code" href="structdwc__hc.html#z34_6">00343</a>         uint8_t do_ping;
00344 
<a name="l00349"></a><a class="code" href="structdwc__hc.html#z34_7">00349</a>         uint8_t error_state;
00350 
<a name="l00357"></a><a class="code" href="structdwc__hc.html#z34_8">00357</a>         uint8_t halt_on_queue;
00358 
<a name="l00363"></a><a class="code" href="structdwc__hc.html#z34_9">00363</a>         uint8_t halt_pending;
00364 
<a name="l00368"></a><a class="code" href="structdwc__hc.html#z34_10">00368</a>         dwc_otg_halt_status_e halt_status;
00369 
00370         <span class="comment">/*</span>
00371 <span class="comment">         * Split settings for the host channel</span>
00372 <span class="comment">         */</span>
<a name="l00373"></a><a class="code" href="structdwc__hc.html#z34_11">00373</a>         uint8_t do_split;                  
<a name="l00374"></a><a class="code" href="structdwc__hc.html#z34_12">00374</a>         uint8_t complete_split;    
<a name="l00375"></a><a class="code" href="structdwc__hc.html#z34_13">00375</a>         uint8_t hub_addr;                  
<a name="l00377"></a><a class="code" href="structdwc__hc.html#z34_14">00377</a>         uint8_t port_addr;                 
<a name="l00384"></a><a class="code" href="structdwc__hc.html#z34_15">00384</a>         uint8_t xact_pos;
00385 
<a name="l00387"></a><a class="code" href="structdwc__hc.html#z34_16">00387</a>         uint8_t short_read;
00388 
<a name="l00393"></a><a class="code" href="structdwc__hc.html#z34_17">00393</a>         uint8_t requests;
00394 
<a name="l00398"></a><a class="code" href="structdwc__hc.html#z34_18">00398</a>         <span class="keyword">struct </span><a class="code" href="structdwc__otg__qh.html">dwc_otg_qh</a> *qh;
00399 
00403          DWC_CIRCLEQ_ENTRY(<a class="code" href="structdwc__hc.html">dwc_hc</a>) hc_list_entry;
00404 
<a name="l00409"></a><a class="code" href="structdwc__hc.html#z36_0">00409</a>         uint16_t ntd;
00410 
<a name="l00412"></a><a class="code" href="structdwc__hc.html#z36_1">00412</a>         dwc_dma_t desc_list_addr;
00413 
<a name="l00415"></a><a class="code" href="structdwc__hc.html#z36_2">00415</a>         uint8_t schinfo;
00416 
00418 } <a class="code" href="structdwc__hc.html">dwc_hc_t</a>;
00419 
<a name="l00424"></a><a class="code" href="structdwc__otg__core__params.html">00424</a> typedef struct <a class="code" href="structdwc__otg__core__params.html">dwc_otg_core_params</a> {
00425         int32_t opt;
00426 
<a name="l00434"></a><a class="code" href="structdwc__otg__core__params.html#o1">00434</a>         int32_t otg_cap;
00435 
<a name="l00443"></a><a class="code" href="structdwc__otg__core__params.html#o2">00443</a>         int32_t dma_enable;
00444 
<a name="l00452"></a><a class="code" href="structdwc__otg__core__params.html#o3">00452</a>         int32_t dma_desc_enable;
<a name="l00456"></a><a class="code" href="structdwc__otg__core__params.html#o4">00456</a>         int32_t dma_burst_size; <span class="comment">/* Translate this to GAHBCFG values */</span>
00457 
<a name="l00466"></a><a class="code" href="structdwc__otg__core__params.html#o5">00466</a>         int32_t speed;
<a name="l00472"></a><a class="code" href="structdwc__otg__core__params.html#o6">00472</a>         int32_t host_support_fs_ls_low_power;
00473 
<a name="l00482"></a><a class="code" href="structdwc__otg__core__params.html#o7">00482</a>         int32_t host_ls_low_power_phy_clk;
00483 
<a name="l00488"></a><a class="code" href="structdwc__otg__core__params.html#o8">00488</a>         int32_t enable_dynamic_fifo;
00489 
<a name="l00496"></a><a class="code" href="structdwc__otg__core__params.html#o9">00496</a>         int32_t data_fifo_size;
00497 
<a name="l00502"></a><a class="code" href="structdwc__otg__core__params.html#o10">00502</a>         int32_t dev_rx_fifo_size;
00503 
<a name="l00508"></a><a class="code" href="structdwc__otg__core__params.html#o11">00508</a>         int32_t dev_nperio_tx_fifo_size;
00509 
<a name="l00514"></a><a class="code" href="structdwc__otg__core__params.html#o12">00514</a>         uint32_t dev_perio_tx_fifo_size[MAX_PERIO_FIFOS];
00515 
<a name="l00520"></a><a class="code" href="structdwc__otg__core__params.html#o13">00520</a>         int32_t host_rx_fifo_size;
00521 
<a name="l00526"></a><a class="code" href="structdwc__otg__core__params.html#o14">00526</a>         int32_t host_nperio_tx_fifo_size;
00527 
<a name="l00532"></a><a class="code" href="structdwc__otg__core__params.html#o15">00532</a>         int32_t host_perio_tx_fifo_size;
00533 
<a name="l00537"></a><a class="code" href="structdwc__otg__core__params.html#o16">00537</a>         int32_t max_transfer_size;
00538 
<a name="l00542"></a><a class="code" href="structdwc__otg__core__params.html#o17">00542</a>         int32_t max_packet_count;
00543 
<a name="l00548"></a><a class="code" href="structdwc__otg__core__params.html#o18">00548</a>         int32_t host_channels;
00549 
<a name="l00556"></a><a class="code" href="structdwc__otg__core__params.html#o19">00556</a>         int32_t dev_endpoints;
00557 
<a name="l00566"></a><a class="code" href="structdwc__otg__core__params.html#o20">00566</a>         int32_t phy_type;
00567 
<a name="l00579"></a><a class="code" href="structdwc__otg__core__params.html#o21">00579</a>         int32_t phy_utmi_width;
00580 
<a name="l00591"></a><a class="code" href="structdwc__otg__core__params.html#o22">00591</a>         int32_t phy_ulpi_ddr;
00592 
<a name="l00597"></a><a class="code" href="structdwc__otg__core__params.html#o23">00597</a>         int32_t phy_ulpi_ext_vbus;
00598 
<a name="l00605"></a><a class="code" href="structdwc__otg__core__params.html#o24">00605</a>         int32_t i2c_enable;
00606 
00607         int32_t ulpi_fs_ls;
00608 
00609         int32_t ts_dline;
00610 
<a name="l00617"></a><a class="code" href="structdwc__otg__core__params.html#o27">00617</a>         int32_t en_multiple_tx_fifo;
00618 
<a name="l00623"></a><a class="code" href="structdwc__otg__core__params.html#o28">00623</a>         uint32_t dev_tx_fifo_size[MAX_TX_FIFOS];
00624 
<a name="l00630"></a><a class="code" href="structdwc__otg__core__params.html#o29">00630</a>         uint32_t thr_ctl;
00631 
<a name="l00635"></a><a class="code" href="structdwc__otg__core__params.html#o30">00635</a>         uint32_t tx_thr_length;
00636 
<a name="l00640"></a><a class="code" href="structdwc__otg__core__params.html#o31">00640</a>         uint32_t rx_thr_length;
00641 
<a name="l00645"></a><a class="code" href="structdwc__otg__core__params.html#o32">00645</a>         int32_t lpm_enable;
00646 
<a name="l00652"></a><a class="code" href="structdwc__otg__core__params.html#o33">00652</a>         int32_t pti_enable;
00653 
<a name="l00659"></a><a class="code" href="structdwc__otg__core__params.html#o34">00659</a>         int32_t mpi_enable;
00660 
<a name="l00665"></a><a class="code" href="structdwc__otg__core__params.html#o35">00665</a>         int32_t ic_usb_cap;
00666 
<a name="l00673"></a><a class="code" href="structdwc__otg__core__params.html#o36">00673</a>         int32_t ahb_thr_ratio;
00674 
<a name="l00679"></a><a class="code" href="structdwc__otg__core__params.html#o37">00679</a>         int32_t adp_supp_enable;
00680 
<a name="l00685"></a><a class="code" href="structdwc__otg__core__params.html#o38">00685</a>         int32_t reload_ctl;
00686 
<a name="l00691"></a><a class="code" href="structdwc__otg__core__params.html#o39">00691</a>         int32_t dev_out_nak;
00692 
<a name="l00699"></a><a class="code" href="structdwc__otg__core__params.html#o40">00699</a>         int32_t cont_on_bna;
00700 
<a name="l00707"></a><a class="code" href="structdwc__otg__core__params.html#o41">00707</a>         int32_t ahb_single;
00708 
<a name="l00714"></a><a class="code" href="structdwc__otg__core__params.html#o42">00714</a>         int32_t power_down;
00715 
<a name="l00720"></a><a class="code" href="structdwc__otg__core__params.html#o43">00720</a>         int32_t otg_ver;
00721 
00722 } <a class="code" href="structdwc__otg__core__params.html">dwc_otg_core_params_t</a>;
00723 
00724 <span class="preprocessor">#ifdef DEBUG</span>
00725 <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if</a>;
00726 <span class="keyword">typedef</span> <span class="keyword">struct </span>hc_xfer_info {
00727         <span class="keyword">struct </span><a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if</a> *core_if;
00728         <a class="code" href="structdwc__hc.html">dwc_hc_t</a> *hc;
00729 } hc_xfer_info_t;
00730 <span class="preprocessor">#endif</span>
00731 <span class="preprocessor"></span>
00732 <span class="keyword">typedef</span> <span class="keyword">struct </span>ep_xfer_info {
00733         <span class="keyword">struct </span><a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if</a> *core_if;
00734         <a class="code" href="structdwc__ep.html">dwc_ep_t</a> *ep;
00735         uint8_t state;
00736 } ep_xfer_info_t;
00737 <span class="comment">/*</span>
00738 <span class="comment"> * Device States</span>
00739 <span class="comment"> */</span>
<a name="l00740"></a><a class="code" href="dwc__otg__cil_8h.html#a129">00740</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="dwc__otg__cil_8h.html#a129">dwc_otg_lx_state</a> {
00742         DWC_OTG_L0,
00744         DWC_OTG_L1,
00746         DWC_OTG_L2,
00748         <a class="code" href="dwc__otg__cil_8h.html#a129a59">DWC_OTG_L3</a>
00749 } dwc_otg_lx_state_e;
00750 
00751 <span class="keyword">struct </span>dwc_otg_global_regs_backup {
00752         uint32_t gotgctl_local;
00753         uint32_t gintmsk_local;
00754         uint32_t gahbcfg_local;
00755         uint32_t gusbcfg_local;
00756         uint32_t grxfsiz_local;
00757         uint32_t gnptxfsiz_local;
00758 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
00759 <span class="preprocessor"></span>        uint32_t glpmcfg_local;
00760 <span class="preprocessor">#endif</span>
00761 <span class="preprocessor"></span>        uint32_t gi2cctl_local;
00762         uint32_t hptxfsiz_local;
00763         uint32_t pcgcctl_local;
00764         uint32_t gdfifocfg_local;
00765         uint32_t dtxfsiz_local[MAX_EPS_CHANNELS];
00766         uint32_t gpwrdn_local;
00767 };
00768 
00769 <span class="keyword">struct </span>dwc_otg_host_regs_backup {
00770         uint32_t hcfg_local;
00771         uint32_t haintmsk_local;
00772         uint32_t hcintmsk_local[MAX_EPS_CHANNELS];
00773         uint32_t hprt0_local;
00774         uint32_t hfir_local;
00775 };
00776 
00777 <span class="keyword">struct </span>dwc_otg_dev_regs_backup {
00778         uint32_t dcfg;
00779         uint32_t dctl;
00780         uint32_t daintmsk;
00781         uint32_t diepmsk;
00782         uint32_t doepmsk;
00783         uint32_t diepctl[MAX_EPS_CHANNELS];
00784         uint32_t dieptsiz[MAX_EPS_CHANNELS];
00785         uint32_t diepdma[MAX_EPS_CHANNELS];
00786 };
<a name="l00792"></a><a class="code" href="structdwc__otg__core__if.html">00792</a> <span class="keyword">struct </span><a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if</a> {
<a name="l00794"></a><a class="code" href="structdwc__otg__core__if.html#o0">00794</a>         <a class="code" href="structdwc__otg__core__params.html">dwc_otg_core_params_t</a> *core_params;
00795 
<a name="l00797"></a><a class="code" href="structdwc__otg__core__if.html#o1">00797</a>         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *core_global_regs;
00798 
<a name="l00800"></a><a class="code" href="structdwc__otg__core__if.html#o2">00800</a>         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if;
<a name="l00802"></a><a class="code" href="structdwc__otg__core__if.html#o3">00802</a>         <a class="code" href="structdwc__otg__host__if.html">dwc_otg_host_if_t</a> *host_if;
00803 
<a name="l00805"></a><a class="code" href="structdwc__otg__core__if.html#o4">00805</a>         uint32_t snpsid;
00806 
00807         <span class="comment">/*</span>
00808 <span class="comment">         * Set to 1 if the core PHY interface bits in USBCFG have been</span>
00809 <span class="comment">         * initialized.</span>
00810 <span class="comment">         */</span>
00811         uint8_t phy_init_done;
00812 
00813         <span class="comment">/*</span>
00814 <span class="comment">         * SRP Success flag, set by srp success interrupt in FS I2C mode</span>
00815 <span class="comment">         */</span>
00816         uint8_t srp_success;
00817         uint8_t srp_timer_started;
<a name="l00820"></a><a class="code" href="structdwc__otg__core__if.html#o8">00820</a>         dwc_timer_t *srp_timer;
00821 
00822 <span class="preprocessor">#ifdef DWC_DEV_SRPCAP</span>
00823 <span class="preprocessor"></span>        <span class="comment">/* This timer is needed to power on the hibernated host core if SRP is not</span>
00824 <span class="comment">         * initiated on connected SRP capable device for limited period of time</span>
00825 <span class="comment">         */</span>
00826         uint8_t pwron_timer_started;
00827         dwc_timer_t *pwron_timer;
00828 <span class="preprocessor">#endif</span>
00829 <span class="preprocessor"></span>        <span class="comment">/* Common configuration information */</span>
<a name="l00831"></a><a class="code" href="structdwc__otg__core__if.html#o9">00831</a>         <span class="keyword">volatile</span> uint32_t *pcgcctl;
00832 <span class="preprocessor">#define DWC_OTG_PCGCCTL_OFFSET 0xE00</span>
00833 <span class="preprocessor"></span>
<a name="l00835"></a><a class="code" href="structdwc__otg__core__if.html#o10">00835</a>         uint32_t *data_fifo[MAX_EPS_CHANNELS];
00836 <span class="preprocessor">#define DWC_OTG_DATA_FIFO_OFFSET 0x1000</span>
00837 <span class="preprocessor"></span><span class="preprocessor">#define DWC_OTG_DATA_FIFO_SIZE 0x1000</span>
00838 <span class="preprocessor"></span>
<a name="l00840"></a><a class="code" href="structdwc__otg__core__if.html#o11">00840</a>         uint16_t total_fifo_size;
<a name="l00842"></a><a class="code" href="structdwc__otg__core__if.html#o12">00842</a>         uint16_t rx_fifo_size;
<a name="l00844"></a><a class="code" href="structdwc__otg__core__if.html#o13">00844</a>         uint16_t nperio_tx_fifo_size;
00845 
<a name="l00847"></a><a class="code" href="structdwc__otg__core__if.html#o14">00847</a>         uint8_t dma_enable;
00848 
<a name="l00850"></a><a class="code" href="structdwc__otg__core__if.html#o15">00850</a>         uint8_t dma_desc_enable;
00851 
<a name="l00853"></a><a class="code" href="structdwc__otg__core__if.html#o16">00853</a>         uint8_t pti_enh_enable;
00854 
<a name="l00856"></a><a class="code" href="structdwc__otg__core__if.html#o17">00856</a>         uint8_t multiproc_int_enable;
00857 
<a name="l00859"></a><a class="code" href="structdwc__otg__core__if.html#o18">00859</a>         uint8_t en_multiple_tx_fifo;
00860 
<a name="l00863"></a><a class="code" href="structdwc__otg__core__if.html#o19">00863</a>         uint8_t queuing_high_bandwidth;
00864 
<a name="l00866"></a><a class="code" href="structdwc__otg__core__if.html#o20">00866</a>         <a class="code" href="unionhwcfg1__data.html">hwcfg1_data_t</a> hwcfg1;
00867         <a class="code" href="unionhwcfg2__data.html">hwcfg2_data_t</a> hwcfg2;
00868         <a class="code" href="unionhwcfg3__data.html">hwcfg3_data_t</a> hwcfg3;
00869         <a class="code" href="unionhwcfg4__data.html">hwcfg4_data_t</a> hwcfg4;
00870         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> hptxfsiz;
00871 
<a name="l00873"></a><a class="code" href="structdwc__otg__core__if.html#o25">00873</a>         <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg;
00874         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
00875 
<a name="l00881"></a><a class="code" href="structdwc__otg__core__if.html#o27">00881</a>         uint8_t op_state;
00882 
<a name="l00888"></a><a class="code" href="structdwc__otg__core__if.html#o28">00888</a>         uint8_t restart_hcd_on_session_req;
00889 
<a name="l00892"></a><a class="code" href="dwc__otg__cil_8h.html#a27">00892</a> <span class="preprocessor">#define A_HOST          (1)</span>
00893 <span class="preprocessor"></span>
<a name="l00894"></a><a class="code" href="dwc__otg__cil_8h.html#a28">00894</a> <span class="preprocessor">#define A_SUSPEND       (2)</span>
00895 <span class="preprocessor"></span>
<a name="l00896"></a><a class="code" href="dwc__otg__cil_8h.html#a29">00896</a> <span class="preprocessor">#define A_PERIPHERAL    (3)</span>
00897 <span class="preprocessor"></span>
<a name="l00898"></a><a class="code" href="dwc__otg__cil_8h.html#a30">00898</a> <span class="preprocessor">#define B_PERIPHERAL    (4)</span>
00899 <span class="preprocessor"></span>
<a name="l00900"></a><a class="code" href="dwc__otg__cil_8h.html#a31">00900</a> <span class="preprocessor">#define B_HOST          (5)</span>
00901 <span class="preprocessor"></span>
<a name="l00903"></a><a class="code" href="structdwc__otg__core__if.html#o29">00903</a>         <span class="keyword">struct </span><a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks</a> *hcd_cb;
<a name="l00905"></a><a class="code" href="structdwc__otg__core__if.html#o30">00905</a>         <span class="keyword">struct </span><a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks</a> *pcd_cb;
00906 
<a name="l00908"></a><a class="code" href="structdwc__otg__core__if.html#o31">00908</a>         uint32_t p_tx_msk;
<a name="l00910"></a><a class="code" href="structdwc__otg__core__if.html#o32">00910</a>         uint32_t tx_msk;
00911 
<a name="l00913"></a><a class="code" href="structdwc__otg__core__if.html#o33">00913</a>         dwc_workq_t *wq_otg;
00914 
<a name="l00916"></a><a class="code" href="structdwc__otg__core__if.html#o34">00916</a>         dwc_timer_t *wkp_timer;
<a name="l00918"></a><a class="code" href="structdwc__otg__core__if.html#o35">00918</a>         uint32_t start_doeptsiz_val[MAX_EPS_CHANNELS];
00919         ep_xfer_info_t ep_xfer_info[MAX_EPS_CHANNELS];
00920         dwc_timer_t *ep_xfer_timer[MAX_EPS_CHANNELS];
00921 <span class="preprocessor">#ifdef DEBUG</span>
00922 <span class="preprocessor"></span>        uint32_t start_hcchar_val[MAX_EPS_CHANNELS];
00923 
00924         hc_xfer_info_t hc_xfer_info[MAX_EPS_CHANNELS];
00925         dwc_timer_t *hc_xfer_timer[MAX_EPS_CHANNELS];
00926 
00927         uint32_t hfnum_7_samples;
00928         uint64_t hfnum_7_frrem_accum;
00929         uint32_t hfnum_0_samples;
00930         uint64_t hfnum_0_frrem_accum;
00931         uint32_t hfnum_other_samples;
00932         uint64_t hfnum_other_frrem_accum;
00933 <span class="preprocessor">#endif</span>
00934 <span class="preprocessor"></span>
00935 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
00936 <span class="preprocessor"></span>        uint16_t pwron_rxfsiz;
00937         uint16_t pwron_gnptxfsiz;
00938         uint16_t pwron_txfsiz[15];
00939 
00940         uint16_t init_rxfsiz;
00941         uint16_t init_gnptxfsiz;
00942         uint16_t init_txfsiz[15];
00943 <span class="preprocessor">#endif</span>
00944 <span class="preprocessor"></span>
<a name="l00946"></a><a class="code" href="structdwc__otg__core__if.html#o38">00946</a>         dwc_otg_lx_state_e lx_state;
00947 
<a name="l00949"></a><a class="code" href="structdwc__otg__core__if.html#o39">00949</a>         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr_backup;
<a name="l00951"></a><a class="code" href="structdwc__otg__core__if.html#o40">00951</a>         <span class="keyword">struct </span>dwc_otg_host_regs_backup *hr_backup;
<a name="l00953"></a><a class="code" href="structdwc__otg__core__if.html#o41">00953</a>         <span class="keyword">struct </span>dwc_otg_dev_regs_backup *dr_backup;
00954 
<a name="l00956"></a><a class="code" href="structdwc__otg__core__if.html#o42">00956</a>         uint32_t power_down;
00957 
<a name="l00959"></a><a class="code" href="structdwc__otg__core__if.html#o43">00959</a>         uint32_t adp_enable;
00960 
<a name="l00962"></a><a class="code" href="structdwc__otg__core__if.html#o44">00962</a>         dwc_otg_adp_t adp;
00963 
<a name="l00965"></a><a class="code" href="structdwc__otg__core__if.html#o45">00965</a>         <span class="keywordtype">int</span> hibernation_suspend;
00966 
<a name="l00968"></a><a class="code" href="structdwc__otg__core__if.html#o46">00968</a>         uint32_t otg_ver;
00969 
<a name="l00971"></a><a class="code" href="structdwc__otg__core__if.html#o47">00971</a>         uint8_t otg_sts;
00972 
<a name="l00974"></a><a class="code" href="structdwc__otg__core__if.html#o48">00974</a>         dwc_spinlock_t *lock;
00975 
<a name="l00978"></a><a class="code" href="structdwc__otg__core__if.html#o49">00978</a>         uint8_t start_predict;
00979 
<a name="l00982"></a><a class="code" href="structdwc__otg__core__if.html#o50">00982</a>         uint8_t nextep_seq[MAX_EPS_CHANNELS];
00983 
<a name="l00985"></a><a class="code" href="structdwc__otg__core__if.html#o51">00985</a>         uint8_t first_in_nextep_seq;
00986 
<a name="l00988"></a><a class="code" href="structdwc__otg__core__if.html#o52">00988</a>         uint32_t frame_num; 
00989 
00990 };
00991 
00992 <span class="preprocessor">#ifdef DEBUG</span>
00993 <span class="preprocessor"></span><span class="comment">/*</span>
00994 <span class="comment"> * This function is called when transfer is timed out.</span>
00995 <span class="comment"> */</span>
00996 <span class="keyword">extern</span> <span class="keywordtype">void</span> hc_xfer_timeout(<span class="keywordtype">void</span> *ptr);
00997 <span class="preprocessor">#endif</span>
00998 <span class="preprocessor"></span>
00999 <span class="comment">/*</span>
01000 <span class="comment"> * This function is called when transfer is timed out on endpoint.</span>
01001 <span class="comment"> */</span>
01002 <span class="keyword">extern</span> <span class="keywordtype">void</span> ep_xfer_timeout(<span class="keywordtype">void</span> *ptr);
01003 
01004 <span class="comment">/*</span>
01005 <span class="comment"> * The following functions are functions for works</span>
01006 <span class="comment"> * using during handling some interrupts</span>
01007 <span class="comment"> */</span>
01008 <span class="keyword">extern</span> <span class="keywordtype">void</span> w_conn_id_status_change(<span class="keywordtype">void</span> *p);
01009 
01010 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil__intr_8c.html#a6">w_wakeup_detected</a>(<span class="keywordtype">void</span> *p);
01011 
01013 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a63">dwc_otg_save_global_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01015 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a64">dwc_otg_save_dev_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01017 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a65">dwc_otg_save_host_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01019 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a66">dwc_otg_restore_global_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01021 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a67">dwc_otg_restore_host_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keywordtype">int</span> reset);
01023 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a68">dwc_otg_restore_dev_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01024                                     <span class="keywordtype">int</span> rem_wakeup);
01025 <span class="keyword">extern</span> <span class="keywordtype">int</span> restore_lpm_i2c_regs(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01026 <span class="keyword">extern</span> <span class="keywordtype">int</span> restore_essential_regs(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keywordtype">int</span> rmode,
01027                                   <span class="keywordtype">int</span> is_host);
01028 
01029 <span class="keyword">extern</span> <span class="keywordtype">int</span> dwc_otg_host_hibernation_restore(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01030                                             <span class="keywordtype">int</span> restore_mode, <span class="keywordtype">int</span> reset);
01031 <span class="keyword">extern</span> <span class="keywordtype">int</span> dwc_otg_device_hibernation_restore(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01032                                               <span class="keywordtype">int</span> rem_wakeup, <span class="keywordtype">int</span> reset);
01033 
01034 <span class="comment">/*</span>
01035 <span class="comment"> * The following functions support initialization of the CIL driver component</span>
01036 <span class="comment"> * and the DWC_otg controller.</span>
01037 <span class="comment"> */</span>
01038 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a73">dwc_otg_core_host_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01039 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a74">dwc_otg_core_dev_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01040 
01046 <span class="keyword">extern</span> <span class="keywordtype">void</span> dwc_otg_wakeup(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01047 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a76">dwc_otg_read_setup_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01048                                       uint32_t * _dest);
01049 <span class="keyword">extern</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a77">dwc_otg_get_frame_number</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01050 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a78">dwc_otg_ep0_activate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01051 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a79">dwc_otg_ep_activate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01052 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a80">dwc_otg_ep_deactivate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01053 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a81">dwc_otg_ep_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01054                                       <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01055 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a82">dwc_otg_ep_start_zl_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01056                                          <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01057 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a83">dwc_otg_ep0_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01058                                        <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01059 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a84">dwc_otg_ep0_continue_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01060                                           <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01061 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a85">dwc_otg_ep_write_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01062                                     <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep, <span class="keywordtype">int</span> _dma);
01063 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a86">dwc_otg_ep_set_stall</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01064 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a87">dwc_otg_ep_clear_stall</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01065                                    <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep);
01066 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a88">dwc_otg_enable_device_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01067 
01068 <span class="preprocessor">#ifdef DWC_EN_ISOC</span>
01069 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a89">dwc_otg_iso_ep_start_frm_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01070                                               <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep);
01071 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__pcd_8c.html#a13">dwc_otg_iso_ep_start_buf_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01072                                               <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep);
01073 <span class="preprocessor">#endif </span><span class="comment">/* DWC_EN_ISOC */</span>
01074 
01081 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a91">dwc_otg_hc_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01082 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a92">dwc_otg_hc_halt</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01083                             <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc, dwc_otg_halt_status_e _halt_status);
01084 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a93">dwc_otg_hc_cleanup</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01085 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a94">dwc_otg_hc_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01086                                       <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01087 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a95">dwc_otg_hc_continue_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01088                                         <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01089 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a96">dwc_otg_hc_do_ping</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01090 <span class="keyword">extern</span> <span class="keywordtype">void</span> dwc_otg_hc_write_packet(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01091                                     <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc);
01092 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a98">dwc_otg_enable_host_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01093 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a99">dwc_otg_disable_host_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01094 
01095 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a100">dwc_otg_hc_start_transfer_ddma</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01096                                            <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc);
01097 
01098 <span class="keyword">extern</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a101">calc_frame_interval</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01099 
01100 <span class="comment">/* Macro used to clear one channel interrupt */</span>
01101 <span class="preprocessor">#define clear_hc_int(_hc_regs_, _intr_) \</span>
01102 <span class="preprocessor">do { \</span>
01103 <span class="preprocessor">        hcint_data_t hcint_clear = {.d32 = 0}; \</span>
01104 <span class="preprocessor">        hcint_clear.b._intr_ = 1; \</span>
01105 <span class="preprocessor">        DWC_WRITE_REG32(&amp;(_hc_regs_)-&gt;hcint, hcint_clear.d32); \</span>
01106 <span class="preprocessor">} while (0)</span>
01107 <span class="preprocessor"></span>
01108 <span class="comment">/*</span>
01109 <span class="comment"> * Macro used to disable one channel interrupt. Channel interrupts are</span>
01110 <span class="comment"> * disabled when the channel is halted or released by the interrupt handler.</span>
01111 <span class="comment"> * There is no need to handle further interrupts of that type until the</span>
01112 <span class="comment"> * channel is re-assigned. In fact, subsequent handling may cause crashes</span>
01113 <span class="comment"> * because the channel structures are cleaned up when the channel is released.</span>
01114 <span class="comment"> */</span>
01115 <span class="preprocessor">#define disable_hc_int(_hc_regs_, _intr_) \</span>
01116 <span class="preprocessor">do { \</span>
01117 <span class="preprocessor">        hcintmsk_data_t hcintmsk = {.d32 = 0}; \</span>
01118 <span class="preprocessor">        hcintmsk.b._intr_ = 1; \</span>
01119 <span class="preprocessor">        DWC_MODIFY_REG32(&amp;(_hc_regs_)-&gt;hcintmsk, hcintmsk.d32, 0); \</span>
01120 <span class="preprocessor">} while (0)</span>
01121 <span class="preprocessor"></span>
<a name="l01127"></a><a class="code" href="dwc__otg__cil_8h.html#a102">01127</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if)
01128 {
01129         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
01130         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = DWC_READ_REG32(_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
01131         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o3">prtena</a> = 0;
01132         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o2">prtconndet</a> = 0;
01133         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o4">prtenchng</a> = 0;
01134         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o6">prtovrcurrchng</a> = 0;
01135         <span class="keywordflow">return</span> hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>;
01136 }
01137 
01146 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a103">dwc_otg_read_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01147                                 uint8_t * dest, uint16_t bytes);
01148 
01149 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a104">dwc_otg_flush_tx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if, <span class="keyword">const</span> <span class="keywordtype">int</span> _num);
01150 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a105">dwc_otg_flush_rx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01151 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a106">dwc_otg_core_reset</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if);
01152 
<a name="l01156"></a><a class="code" href="dwc__otg__cil_8h.html#a107">01156</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a107">dwc_otg_read_core_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01157 {
01158         <span class="keywordflow">return</span> (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>) &amp;
01159                 DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>));
01160 }
01161 
<a name="l01165"></a><a class="code" href="dwc__otg__cil_8h.html#a108">01165</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a108">dwc_otg_read_otg_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01166 {
01167         <span class="keywordflow">return</span> (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o1">gotgint</a>));
01168 }
01169 
<a name="l01174"></a><a class="code" href="dwc__otg__cil_8h.html#a109">01174</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a109">dwc_otg_read_dev_all_in_ep_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
01175                                                        core_if)
01176 {
01177 
01178         uint32_t v;
01179 
01180         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01181                 v = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
01182                                    dev_global_regs-&gt;deachint) &amp;
01183                     DWC_READ_REG32(&amp;core_if-&gt;
01184                                    dev_if-&gt;dev_global_regs-&gt;deachintmsk);
01185         } <span class="keywordflow">else</span> {
01186                 v = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o6">daint</a>) &amp;
01187                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>);
01188         }
01189         <span class="keywordflow">return</span> (v &amp; 0xffff);
01190 }
01191 
<a name="l01196"></a><a class="code" href="dwc__otg__cil_8h.html#a110">01196</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a110">dwc_otg_read_dev_all_out_ep_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
01197                                                         core_if)
01198 {
01199         uint32_t v;
01200 
01201         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01202                 v = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
01203                                    dev_global_regs-&gt;deachint) &amp;
01204                     DWC_READ_REG32(&amp;core_if-&gt;
01205                                    dev_if-&gt;dev_global_regs-&gt;deachintmsk);
01206         } <span class="keywordflow">else</span> {
01207                 v = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o6">daint</a>) &amp;
01208                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>);
01209         }
01210 
01211         <span class="keywordflow">return</span> ((v &amp; 0xffff0000) &gt;&gt; 16);
01212 }
01213 
<a name="l01217"></a><a class="code" href="dwc__otg__cil_8h.html#a111">01217</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a111">dwc_otg_read_dev_in_ep_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
01218                                                    <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
01219 {
01220         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
01221         uint32_t v, msk, emp;
01222 
01223         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01224                 msk =
01225                     DWC_READ_REG32(&amp;dev_if-&gt;
01226                                    dev_global_regs-&gt;diepeachintmsk[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]);
01227                 emp =
01228                     DWC_READ_REG32(&amp;dev_if-&gt;
01229                                    dev_global_regs-&gt;dtknqr4_fifoemptymsk);
01230                 msk |= ((emp &gt;&gt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>) &amp; 0x1) &lt;&lt; 7;
01231                 v = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint) &amp; msk;
01232         } <span class="keywordflow">else</span> {
01233                 msk = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>);
01234                 emp =
01235                     DWC_READ_REG32(&amp;dev_if-&gt;
01236                                    dev_global_regs-&gt;dtknqr4_fifoemptymsk);
01237                 msk |= ((emp &gt;&gt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>) &amp; 0x1) &lt;&lt; 7;
01238                 v = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint) &amp; msk;
01239         }
01240 
01241         <span class="keywordflow">return</span> v;
01242 }
01243 
<a name="l01247"></a><a class="code" href="dwc__otg__cil_8h.html#a112">01247</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a112">dwc_otg_read_dev_out_ep_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
01248                                                     _core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * _ep)
01249 {
01250         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = _core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
01251         uint32_t v;
01252         <a class="code" href="uniondoepint__data.html">doepmsk_data_t</a> msk = {.d32 = 0 };
01253 
01254         <span class="keywordflow">if</span> (_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01255                 msk.<a class="code" href="uniondoepint__data.html#o0">d32</a> =
01256                     DWC_READ_REG32(&amp;dev_if-&gt;
01257                                    dev_global_regs-&gt;doepeachintmsk[_ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]);
01258                 <span class="keywordflow">if</span> (_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o16">pti_enh_enable</a>) {
01259                         msk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o12">pktdrpsts</a> = 1;
01260                 }
01261                 v = DWC_READ_REG32(&amp;dev_if-&gt;
01262                                    out_ep_regs[_ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;doepint) &amp; msk.<a class="code" href="uniondoepint__data.html#o0">d32</a>;
01263         } <span class="keywordflow">else</span> {
01264                 msk.<a class="code" href="uniondoepint__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>);
01265                 <span class="keywordflow">if</span> (_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o16">pti_enh_enable</a>) {
01266                         msk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o12">pktdrpsts</a> = 1;
01267                 }
01268                 v = DWC_READ_REG32(&amp;dev_if-&gt;
01269                                    out_ep_regs[_ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;doepint) &amp; msk.<a class="code" href="uniondoepint__data.html#o0">d32</a>;
01270         }
01271         <span class="keywordflow">return</span> v;
01272 }
01273 
<a name="l01277"></a><a class="code" href="dwc__otg__cil_8h.html#a113">01277</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a113">dwc_otg_read_host_all_channels_intr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
01278                                                            _core_if)
01279 {
01280         <span class="keywordflow">return</span> (DWC_READ_REG32(&amp;_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o5">haint</a>));
01281 }
01282 
01283 <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t dwc_otg_read_host_channel_intr(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
01284                                                       _core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * _hc)
01285 {
01286         <span class="keywordflow">return</span> (DWC_READ_REG32
01287                 (&amp;_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[_hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o2">hcint</a>));
01288 }
01289 
<a name="l01295"></a><a class="code" href="dwc__otg__cil_8h.html#a115">01295</a> <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a115">dwc_otg_mode</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if)
01296 {
01297         <span class="keywordflow">return</span> (DWC_READ_REG32(&amp;_core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>) &amp; 0x1);
01298 }
01299 
<a name="l01307"></a><a class="code" href="structdwc__otg__cil__callbacks.html">01307</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks</a> {
01309         int (*start) (<span class="keywordtype">void</span> *_p);
01311         int (*stop) (<span class="keywordtype">void</span> *_p);
01313         int (*disconnect) (<span class="keywordtype">void</span> *_p);
01315         int (*resume_wakeup) (<span class="keywordtype">void</span> *_p);
01317         int (*suspend) (<span class="keywordtype">void</span> *_p);
01319         int (*session_start) (<span class="keywordtype">void</span> *_p);
01320 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01321 <span class="preprocessor"></span>
01322         int (*sleep) (<span class="keywordtype">void</span> *_p);
01323 <span class="preprocessor">#endif</span>
01324 <span class="preprocessor"></span>
<a name="l01325"></a><a class="code" href="structdwc__otg__cil__callbacks.html#o6">01325</a>         <span class="keywordtype">void</span> *p;
01326 } <a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks_t</a>;
01327 
01328 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a116">dwc_otg_cil_register_pcd_callbacks</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01329                                                <a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks_t</a> * _cb,
01330                                                <span class="keywordtype">void</span> *_p);
01331 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a117">dwc_otg_cil_register_hcd_callbacks</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if,
01332                                                <a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks_t</a> * _cb,
01333                                                <span class="keywordtype">void</span> *_p);
01334 
01335 <span class="keywordtype">void</span> dwc_otg_initiate_srp(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
01336 
01338 
<a name="l01342"></a><a class="code" href="dwc__otg__cil_8h.html#a119">01342</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a119">cil_hcd_start</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01343 {
01344         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o0">start</a>) {
01345                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o0">start</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01346         }
01347 }
01348 
<a name="l01353"></a><a class="code" href="dwc__otg__cil_8h.html#a120">01353</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a120">cil_hcd_stop</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01354 {
01355         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o1">stop</a>) {
01356                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o1">stop</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01357         }
01358 }
01359 
<a name="l01364"></a><a class="code" href="dwc__otg__cil_8h.html#a121">01364</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a121">cil_hcd_disconnect</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01365 {
01366         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o2">disconnect</a>) {
01367                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o2">disconnect</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01368         }
01369 }
01370 
<a name="l01376"></a><a class="code" href="dwc__otg__cil_8h.html#a122">01376</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a122">cil_hcd_session_start</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01377 {
01378         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o5">session_start</a>) {
01379                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o5">session_start</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01380         }
01381 }
01382 
01383 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01384 <span class="preprocessor"></span>
01390 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> cil_hcd_sleep(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01391 {
01392         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;sleep) {
01393                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;sleep(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01394         }
01395 }
01396 <span class="preprocessor">#endif</span>
01397 <span class="preprocessor"></span>
<a name="l01402"></a><a class="code" href="dwc__otg__cil_8h.html#a123">01402</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a123">cil_hcd_resume</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01403 {
01404         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o3">resume_wakeup</a>) {
01405                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o3">resume_wakeup</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01406         }
01407 }
01408 
<a name="l01413"></a><a class="code" href="dwc__otg__cil_8h.html#a124">01413</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a124">cil_pcd_start</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01414 {
01415         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o0">start</a>) {
01416                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o0">start</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01417         }
01418 }
01419 
<a name="l01424"></a><a class="code" href="dwc__otg__cil_8h.html#a125">01424</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a125">cil_pcd_stop</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01425 {
01426         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o1">stop</a>) {
01427                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o1">stop</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01428         }
01429 }
01430 
<a name="l01435"></a><a class="code" href="dwc__otg__cil_8h.html#a126">01435</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a126">cil_pcd_suspend</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01436 {
01437         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o4">suspend</a>) {
01438                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o4">suspend</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01439         }
01440 }
01441 
<a name="l01446"></a><a class="code" href="dwc__otg__cil_8h.html#a127">01446</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a127">cil_pcd_resume</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01447 {
01448         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o3">resume_wakeup</a>) {
01449                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o3">resume_wakeup</a>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a>-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a>);
01450         }
01451 }
01452 
01454 
01455 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:37 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
