<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_driver.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_driver.c</h1><a href="dwc__otg__driver_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* ==========================================================================</span>
00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_driver.c $</span>
00003 <span class="comment"> * $Revision: #91 $</span>
00004 <span class="comment"> * $Date: 2011/10/24 $</span>
00005 <span class="comment"> * $Change: 1871159 $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
00031 <span class="comment"> * DAMAGE.</span>
00032 <span class="comment"> * ========================================================================== */</span>
00033 
00051 <span class="preprocessor">#include "<a class="code" href="dwc__otg__os__dep_8h.html">dwc_otg_os_dep.h</a>"</span>
00052 <span class="preprocessor">#include "dwc_os.h"</span>
00053 <span class="preprocessor">#include "<a class="code" href="dwc__otg__dbg_8h.html">dwc_otg_dbg.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="dwc__otg__driver_8h.html">dwc_otg_driver.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="dwc__otg__attr_8h.html">dwc_otg_attr.h</a>"</span>
00056 <span class="preprocessor">#include "<a class="code" href="dwc__otg__core__if_8h.html">dwc_otg_core_if.h</a>"</span>
00057 <span class="preprocessor">#include "<a class="code" href="dwc__otg__pcd__if_8h.html">dwc_otg_pcd_if.h</a>"</span>
00058 <span class="preprocessor">#include "<a class="code" href="dwc__otg__hcd__if_8h.html">dwc_otg_hcd_if.h</a>"</span>
00059 
00060 <span class="preprocessor">#define DWC_DRIVER_VERSION      "2.94a 27-OCT-2011"</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define DWC_DRIVER_DESC         "HS OTG USB Controller driver"</span>
00062 <span class="preprocessor"></span>
00063 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> dwc_driver_name[] = <span class="stringliteral">"dwc_otg"</span>;
00064 
00065 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__driver_8c.html#a5">pcd_init</a>(
00066 #ifdef LM_INTERFACE
00067                            <span class="keyword">struct</span> lm_device *_dev
00068 #elif  defined(PCI_INTERFACE)
00069                            <span class="keyword">struct</span> pci_dev *_dev
00070 #endif
00071     );
00072 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__driver_8c.html#a6">hcd_init</a>(
00073 #ifdef LM_INTERFACE
00074                            <span class="keyword">struct</span> lm_device *_dev
00075 #elif  defined(PCI_INTERFACE)
00076                            <span class="keyword">struct</span> pci_dev *_dev
00077 #endif
00078     );
00079 
00080 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__driver_8c.html#a7">pcd_remove</a>(
00081 #ifdef LM_INTERFACE
00082                              <span class="keyword">struct</span> lm_device *_dev
00083 #elif  defined(PCI_INTERFACE)
00084                              <span class="keyword">struct</span> pci_dev *_dev
00085 #endif
00086     );
00087 
00088 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__driver_8c.html#a8">hcd_remove</a>(
00089 #ifdef LM_INTERFACE
00090                               <span class="keyword">struct</span> lm_device *_dev
00091 #elif  defined(PCI_INTERFACE)
00092                               <span class="keyword">struct</span> pci_dev *_dev
00093 #endif
00094     );
00095 
00096 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__driver_8c.html#a9">dwc_otg_adp_start</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint8_t is_host);
00097 
00098 <span class="comment">/*-------------------------------------------------------------------------*/</span>
00099 <span class="comment">/* Encapsulate the module parameter settings */</span>
00100 
00101 <span class="keyword">struct </span>dwc_otg_driver_module_params {
00102         int32_t opt;
00103         int32_t otg_cap;
00104         int32_t dma_enable;
00105         int32_t dma_desc_enable;
00106         int32_t dma_burst_size;
00107         int32_t speed;
00108         int32_t host_support_fs_ls_low_power;
00109         int32_t host_ls_low_power_phy_clk;
00110         int32_t enable_dynamic_fifo;
00111         int32_t data_fifo_size;
00112         int32_t dev_rx_fifo_size;
00113         int32_t dev_nperio_tx_fifo_size;
00114         uint32_t dev_perio_tx_fifo_size[MAX_PERIO_FIFOS];
00115         int32_t host_rx_fifo_size;
00116         int32_t host_nperio_tx_fifo_size;
00117         int32_t host_perio_tx_fifo_size;
00118         int32_t max_transfer_size;
00119         int32_t max_packet_count;
00120         int32_t host_channels;
00121         int32_t dev_endpoints;
00122         int32_t phy_type;
00123         int32_t phy_utmi_width;
00124         int32_t phy_ulpi_ddr;
00125         int32_t phy_ulpi_ext_vbus;
00126         int32_t i2c_enable;
00127         int32_t ulpi_fs_ls;
00128         int32_t ts_dline;
00129         int32_t en_multiple_tx_fifo;
00130         uint32_t dev_tx_fifo_size[MAX_TX_FIFOS];
00131         uint32_t thr_ctl;
00132         uint32_t tx_thr_length;
00133         uint32_t rx_thr_length;
00134         int32_t pti_enable;
00135         int32_t mpi_enable;
00136         int32_t lpm_enable;
00137         int32_t ic_usb_cap;
00138         int32_t ahb_thr_ratio;
00139         int32_t power_down;
00140         int32_t reload_ctl;
00141         int32_t dev_out_nak;
00142         int32_t cont_on_bna;
00143         int32_t ahb_single;
00144         int32_t otg_ver;
00145         int32_t adp_enable;
00146 };
00147 
00148 <span class="keyword">static</span> <span class="keyword">struct </span>dwc_otg_driver_module_params dwc_otg_module_params = {
00149         .opt = -1,
00150         .otg_cap = -1,
00151         .dma_enable = -1,
00152         .dma_desc_enable = -1,
00153         .dma_burst_size = -1,
00154         .speed = -1,
00155         .host_support_fs_ls_low_power = -1,
00156         .host_ls_low_power_phy_clk = -1,
00157         .enable_dynamic_fifo = -1,
00158         .data_fifo_size = -1,
00159         .dev_rx_fifo_size = -1,
00160         .dev_nperio_tx_fifo_size = -1,
00161         .dev_perio_tx_fifo_size = {
00162                                    <span class="comment">/* dev_perio_tx_fifo_size_1 */</span>
00163                                    -1,
00164                                    -1,
00165                                    -1,
00166                                    -1,
00167                                    -1,
00168                                    -1,
00169                                    -1,
00170                                    -1,
00171                                    -1,
00172                                    -1,
00173                                    -1,
00174                                    -1,
00175                                    -1,
00176                                    -1,
00177                                    -1
00178                                    <span class="comment">/* 15 */</span>
00179                                    },
00180         .host_rx_fifo_size = -1,
00181         .host_nperio_tx_fifo_size = -1,
00182         .host_perio_tx_fifo_size = -1,
00183         .max_transfer_size = -1,
00184         .max_packet_count = -1,
00185         .host_channels = -1,
00186         .dev_endpoints = -1,
00187         .phy_type = -1,
00188         .phy_utmi_width = -1,
00189         .phy_ulpi_ddr = -1,
00190         .phy_ulpi_ext_vbus = -1,
00191         .i2c_enable = -1,
00192         .ulpi_fs_ls = -1,
00193         .ts_dline = -1,
00194         .en_multiple_tx_fifo = -1,
00195         .dev_tx_fifo_size = {
00196                              <span class="comment">/* dev_tx_fifo_size */</span>
00197                              -1,
00198                              -1,
00199                              -1,
00200                              -1,
00201                              -1,
00202                              -1,
00203                              -1,
00204                              -1,
00205                              -1,
00206                              -1,
00207                              -1,
00208                              -1,
00209                              -1,
00210                              -1,
00211                              -1
00212                              <span class="comment">/* 15 */</span>
00213                              },
00214         .thr_ctl = -1,
00215         .tx_thr_length = -1,
00216         .rx_thr_length = -1,
00217         .pti_enable = -1,
00218         .mpi_enable = -1,
00219         .lpm_enable = -1,
00220         .ic_usb_cap = -1,
00221         .ahb_thr_ratio = -1,
00222         .power_down = -1,
00223         .reload_ctl = -1,
00224         .dev_out_nak = -1,
00225         .cont_on_bna = -1,
00226         .ahb_single = -1,
00227         .otg_ver = -1,
00228         .adp_enable = -1,
00229 };
00230 
<a name="l00234"></a><a class="code" href="dwc__otg__driver_8c.html#a10">00234</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__driver_8c.html#a10">version_show</a>(<span class="keyword">struct</span> device_driver *dev, <span class="keywordtype">char</span> *buf)
00235 {
00236         <span class="keywordflow">return</span> snprintf(buf, <span class="keyword">sizeof</span>(DWC_DRIVER_VERSION) + 2, <span class="stringliteral">"%s\n"</span>,
00237                         DWC_DRIVER_VERSION);
00238 }
00239 
00240 <span class="keyword">static</span> DRIVER_ATTR(version, S_IRUGO, version_show, NULL);
00241 
<a name="l00245"></a><a class="code" href="dwc__otg__driver_8c.html#a4">00245</a> uint32_t <a class="code" href="dwc__otg__dbg_8h.html#a13">g_dbg_lvl</a> = 0;         <span class="comment">/* OFF */</span>
00246 
<a name="l00250"></a><a class="code" href="dwc__otg__driver_8c.html#a12">00250</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__driver_8c.html#a12">dbg_level_show</a>(<span class="keyword">struct</span> device_driver *drv, <span class="keywordtype">char</span> *buf)
00251 {
00252         <span class="keywordflow">return</span> sprintf(buf, <span class="stringliteral">"0x%0x\n"</span>, <a class="code" href="dwc__otg__dbg_8h.html#a13">g_dbg_lvl</a>);
00253 }
00254 
<a name="l00258"></a><a class="code" href="dwc__otg__driver_8c.html#a13">00258</a> <span class="keyword">static</span> ssize_t <a class="code" href="dwc__otg__driver_8c.html#a13">dbg_level_store</a>(<span class="keyword">struct</span> device_driver *drv, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf,
00259                                size_t count)
00260 {
00261         <a class="code" href="dwc__otg__dbg_8h.html#a13">g_dbg_lvl</a> = simple_strtoul(buf, NULL, 16);
00262         <span class="keywordflow">return</span> count;
00263 }
00264 
00265 <span class="keyword">static</span> DRIVER_ATTR(debuglevel, S_IRUGO | S_IWUSR, dbg_level_show,
00266                    dbg_level_store);
00267 
<a name="l00272"></a><a class="code" href="dwc__otg__driver_8c.html#a15">00272</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__driver_8c.html#a15">set_parameters</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00273 {
00274         <span class="keywordtype">int</span> retval = 0;
00275         <span class="keywordtype">int</span> i;
00276 
00277         <span class="keywordflow">if</span> (dwc_otg_module_params.otg_cap != -1) {
00278                 retval +=
00279                     <a class="code" href="dwc__otg__core__if_8h.html#a70">dwc_otg_set_param_otg_cap</a>(core_if,
00280                                               dwc_otg_module_params.otg_cap);
00281         }
00282         <span class="keywordflow">if</span> (dwc_otg_module_params.dma_enable != -1) {
00283                 retval +=
00284                     <a class="code" href="dwc__otg__core__if_8h.html#a74">dwc_otg_set_param_dma_enable</a>(core_if,
00285                                                  dwc_otg_module_params.
00286                                                  dma_enable);
00287         }
00288         <span class="keywordflow">if</span> (dwc_otg_module_params.dma_desc_enable != -1) {
00289                 retval +=
00290                     <a class="code" href="dwc__otg__core__if_8h.html#a76">dwc_otg_set_param_dma_desc_enable</a>(core_if,
00291                                                       dwc_otg_module_params.
00292                                                       dma_desc_enable);
00293         }
00294         <span class="keywordflow">if</span> (dwc_otg_module_params.opt != -1) {
00295                 retval +=
00296                     dwc_otg_set_param_opt(core_if, dwc_otg_module_params.opt);
00297         }
00298         <span class="keywordflow">if</span> (dwc_otg_module_params.dma_burst_size != -1) {
00299                 retval +=
00300                     <a class="code" href="dwc__otg__core__if_8h.html#a78">dwc_otg_set_param_dma_burst_size</a>(core_if,
00301                                                      dwc_otg_module_params.
00302                                                      dma_burst_size);
00303         }
00304         <span class="keywordflow">if</span> (dwc_otg_module_params.host_support_fs_ls_low_power != -1) {
00305                 retval +=
00306                     <a class="code" href="dwc__otg__core__if_8h.html#a82">dwc_otg_set_param_host_support_fs_ls_low_power</a>(core_if,
00307                                                                    dwc_otg_module_params.
00308                                                                    host_support_fs_ls_low_power);
00309         }
00310         <span class="keywordflow">if</span> (dwc_otg_module_params.enable_dynamic_fifo != -1) {
00311                 retval +=
00312                     <a class="code" href="dwc__otg__core__if_8h.html#a86">dwc_otg_set_param_enable_dynamic_fifo</a>(core_if,
00313                                                           dwc_otg_module_params.
00314                                                           enable_dynamic_fifo);
00315         }
00316         <span class="keywordflow">if</span> (dwc_otg_module_params.data_fifo_size != -1) {
00317                 retval +=
00318                     <a class="code" href="dwc__otg__core__if_8h.html#a88">dwc_otg_set_param_data_fifo_size</a>(core_if,
00319                                                      dwc_otg_module_params.
00320                                                      data_fifo_size);
00321         }
00322         <span class="keywordflow">if</span> (dwc_otg_module_params.dev_rx_fifo_size != -1) {
00323                 retval +=
00324                     <a class="code" href="dwc__otg__core__if_8h.html#a90">dwc_otg_set_param_dev_rx_fifo_size</a>(core_if,
00325                                                        dwc_otg_module_params.
00326                                                        dev_rx_fifo_size);
00327         }
00328         <span class="keywordflow">if</span> (dwc_otg_module_params.dev_nperio_tx_fifo_size != -1) {
00329                 retval +=
00330                     <a class="code" href="dwc__otg__core__if_8h.html#a92">dwc_otg_set_param_dev_nperio_tx_fifo_size</a>(core_if,
00331                                                               dwc_otg_module_params.
00332                                                               dev_nperio_tx_fifo_size);
00333         }
00334         <span class="keywordflow">if</span> (dwc_otg_module_params.host_rx_fifo_size != -1) {
00335                 retval +=
00336                     <a class="code" href="dwc__otg__core__if_8h.html#a96">dwc_otg_set_param_host_rx_fifo_size</a>(core_if,
00337                                                         dwc_otg_module_params.host_rx_fifo_size);
00338         }
00339         <span class="keywordflow">if</span> (dwc_otg_module_params.host_nperio_tx_fifo_size != -1) {
00340                 retval +=
00341                     <a class="code" href="dwc__otg__core__if_8h.html#a98">dwc_otg_set_param_host_nperio_tx_fifo_size</a>(core_if,
00342                                                                dwc_otg_module_params.
00343                                                                host_nperio_tx_fifo_size);
00344         }
00345         <span class="keywordflow">if</span> (dwc_otg_module_params.host_perio_tx_fifo_size != -1) {
00346                 retval +=
00347                     <a class="code" href="dwc__otg__core__if_8h.html#a100">dwc_otg_set_param_host_perio_tx_fifo_size</a>(core_if,
00348                                                               dwc_otg_module_params.
00349                                                               host_perio_tx_fifo_size);
00350         }
00351         <span class="keywordflow">if</span> (dwc_otg_module_params.max_transfer_size != -1) {
00352                 retval +=
00353                     <a class="code" href="dwc__otg__core__if_8h.html#a102">dwc_otg_set_param_max_transfer_size</a>(core_if,
00354                                                         dwc_otg_module_params.
00355                                                         max_transfer_size);
00356         }
00357         <span class="keywordflow">if</span> (dwc_otg_module_params.max_packet_count != -1) {
00358                 retval +=
00359                     <a class="code" href="dwc__otg__core__if_8h.html#a104">dwc_otg_set_param_max_packet_count</a>(core_if,
00360                                                        dwc_otg_module_params.
00361                                                        max_packet_count);
00362         }
00363         <span class="keywordflow">if</span> (dwc_otg_module_params.host_channels != -1) {
00364                 retval +=
00365                     <a class="code" href="dwc__otg__core__if_8h.html#a106">dwc_otg_set_param_host_channels</a>(core_if,
00366                                                     dwc_otg_module_params.
00367                                                     host_channels);
00368         }
00369         <span class="keywordflow">if</span> (dwc_otg_module_params.dev_endpoints != -1) {
00370                 retval +=
00371                     <a class="code" href="dwc__otg__core__if_8h.html#a108">dwc_otg_set_param_dev_endpoints</a>(core_if,
00372                                                     dwc_otg_module_params.
00373                                                     dev_endpoints);
00374         }
00375         <span class="keywordflow">if</span> (dwc_otg_module_params.phy_type != -1) {
00376                 retval +=
00377                     <a class="code" href="dwc__otg__core__if_8h.html#a110">dwc_otg_set_param_phy_type</a>(core_if,
00378                                                dwc_otg_module_params.phy_type);
00379         }
00380         <span class="keywordflow">if</span> (dwc_otg_module_params.speed != -1) {
00381                 retval +=
00382                     <a class="code" href="dwc__otg__core__if_8h.html#a80">dwc_otg_set_param_speed</a>(core_if,
00383                                             dwc_otg_module_params.speed);
00384         }
00385         <span class="keywordflow">if</span> (dwc_otg_module_params.host_ls_low_power_phy_clk != -1) {
00386                 retval +=
00387                     <a class="code" href="dwc__otg__core__if_8h.html#a84">dwc_otg_set_param_host_ls_low_power_phy_clk</a>(core_if,
00388                                                                 dwc_otg_module_params.
00389                                                                 host_ls_low_power_phy_clk);
00390         }
00391         <span class="keywordflow">if</span> (dwc_otg_module_params.phy_ulpi_ddr != -1) {
00392                 retval +=
00393                     <a class="code" href="dwc__otg__core__if_8h.html#a114">dwc_otg_set_param_phy_ulpi_ddr</a>(core_if,
00394                                                    dwc_otg_module_params.
00395                                                    phy_ulpi_ddr);
00396         }
00397         <span class="keywordflow">if</span> (dwc_otg_module_params.phy_ulpi_ext_vbus != -1) {
00398                 retval +=
00399                     <a class="code" href="dwc__otg__core__if_8h.html#a116">dwc_otg_set_param_phy_ulpi_ext_vbus</a>(core_if,
00400                                                         dwc_otg_module_params.
00401                                                         phy_ulpi_ext_vbus);
00402         }
00403         <span class="keywordflow">if</span> (dwc_otg_module_params.phy_utmi_width != -1) {
00404                 retval +=
00405                     <a class="code" href="dwc__otg__core__if_8h.html#a112">dwc_otg_set_param_phy_utmi_width</a>(core_if,
00406                                                      dwc_otg_module_params.
00407                                                      phy_utmi_width);
00408         }
00409         <span class="keywordflow">if</span> (dwc_otg_module_params.ulpi_fs_ls != -1) {
00410                 retval +=
00411                     dwc_otg_set_param_ulpi_fs_ls(core_if,
00412                                                  dwc_otg_module_params.ulpi_fs_ls);
00413         }
00414         <span class="keywordflow">if</span> (dwc_otg_module_params.ts_dline != -1) {
00415                 retval +=
00416                     dwc_otg_set_param_ts_dline(core_if,
00417                                                dwc_otg_module_params.ts_dline);
00418         }
00419         <span class="keywordflow">if</span> (dwc_otg_module_params.i2c_enable != -1) {
00420                 retval +=
00421                     <a class="code" href="dwc__otg__core__if_8h.html#a118">dwc_otg_set_param_i2c_enable</a>(core_if,
00422                                                  dwc_otg_module_params.
00423                                                  i2c_enable);
00424         }
00425         <span class="keywordflow">if</span> (dwc_otg_module_params.en_multiple_tx_fifo != -1) {
00426                 retval +=
00427                     <a class="code" href="dwc__otg__core__if_8h.html#a124">dwc_otg_set_param_en_multiple_tx_fifo</a>(core_if,
00428                                                           dwc_otg_module_params.
00429                                                           en_multiple_tx_fifo);
00430         }
00431         <span class="keywordflow">for</span> (i = 0; i &lt; 15; i++) {
00432                 <span class="keywordflow">if</span> (dwc_otg_module_params.dev_perio_tx_fifo_size[i] != -1) {
00433                         retval +=
00434                             <a class="code" href="dwc__otg__core__if_8h.html#a94">dwc_otg_set_param_dev_perio_tx_fifo_size</a>(core_if,
00435                                                                      dwc_otg_module_params.
00436                                                                      dev_perio_tx_fifo_size
00437                                                                      [i], i);
00438                 }
00439         }
00440 
00441         <span class="keywordflow">for</span> (i = 0; i &lt; 15; i++) {
00442                 <span class="keywordflow">if</span> (dwc_otg_module_params.dev_tx_fifo_size[i] != -1) {
00443                         retval += <a class="code" href="dwc__otg__core__if_8h.html#a126">dwc_otg_set_param_dev_tx_fifo_size</a>(core_if,
00444                                                                      dwc_otg_module_params.
00445                                                                      dev_tx_fifo_size
00446                                                                      [i], i);
00447                 }
00448         }
00449         <span class="keywordflow">if</span> (dwc_otg_module_params.thr_ctl != -1) {
00450                 retval +=
00451                     <a class="code" href="dwc__otg__core__if_8h.html#a128">dwc_otg_set_param_thr_ctl</a>(core_if,
00452                                               dwc_otg_module_params.thr_ctl);
00453         }
00454         <span class="keywordflow">if</span> (dwc_otg_module_params.mpi_enable != -1) {
00455                 retval +=
00456                     <a class="code" href="dwc__otg__core__if_8h.html#a138">dwc_otg_set_param_mpi_enable</a>(core_if,
00457                                                  dwc_otg_module_params.
00458                                                  mpi_enable);
00459         }
00460         <span class="keywordflow">if</span> (dwc_otg_module_params.pti_enable != -1) {
00461                 retval +=
00462                     <a class="code" href="dwc__otg__core__if_8h.html#a136">dwc_otg_set_param_pti_enable</a>(core_if,
00463                                                  dwc_otg_module_params.
00464                                                  pti_enable);
00465         }
00466         <span class="keywordflow">if</span> (dwc_otg_module_params.lpm_enable != -1) {
00467                 retval +=
00468                     <a class="code" href="dwc__otg__core__if_8h.html#a134">dwc_otg_set_param_lpm_enable</a>(core_if,
00469                                                  dwc_otg_module_params.
00470                                                  lpm_enable);
00471         }
00472         <span class="keywordflow">if</span> (dwc_otg_module_params.ic_usb_cap != -1) {
00473                 retval +=
00474                     <a class="code" href="dwc__otg__core__if_8h.html#a142">dwc_otg_set_param_ic_usb_cap</a>(core_if,
00475                                                  dwc_otg_module_params.
00476                                                  ic_usb_cap);
00477         }
00478         <span class="keywordflow">if</span> (dwc_otg_module_params.tx_thr_length != -1) {
00479                 retval +=
00480                     <a class="code" href="dwc__otg__core__if_8h.html#a130">dwc_otg_set_param_tx_thr_length</a>(core_if,
00481                                                     dwc_otg_module_params.tx_thr_length);
00482         }
00483         <span class="keywordflow">if</span> (dwc_otg_module_params.rx_thr_length != -1) {
00484                 retval +=
00485                     <a class="code" href="dwc__otg__core__if_8h.html#a132">dwc_otg_set_param_rx_thr_length</a>(core_if,
00486                                                     dwc_otg_module_params.
00487                                                     rx_thr_length);
00488         }
00489         <span class="keywordflow">if</span> (dwc_otg_module_params.ahb_thr_ratio != -1) {
00490                 retval +=
00491                     dwc_otg_set_param_ahb_thr_ratio(core_if,
00492                                                     dwc_otg_module_params.ahb_thr_ratio);
00493         }
00494         <span class="keywordflow">if</span> (dwc_otg_module_params.power_down != -1) {
00495                 retval +=
00496                     dwc_otg_set_param_power_down(core_if,
00497                                                  dwc_otg_module_params.<a class="code" href="structdwc__otg__core__if.html#o42">power_down</a>);
00498         }
00499         <span class="keywordflow">if</span> (dwc_otg_module_params.reload_ctl != -1) {
00500                 retval +=
00501                     dwc_otg_set_param_reload_ctl(core_if,
00502                                                  dwc_otg_module_params.reload_ctl);
00503         }
00504 
00505         <span class="keywordflow">if</span> (dwc_otg_module_params.dev_out_nak != -1) {
00506                 retval +=
00507                         dwc_otg_set_param_dev_out_nak(core_if,
00508                         dwc_otg_module_params.dev_out_nak);
00509         }
00510 
00511         <span class="keywordflow">if</span> (dwc_otg_module_params.cont_on_bna != -1) {
00512                 retval +=
00513                         dwc_otg_set_param_cont_on_bna(core_if,
00514                         dwc_otg_module_params.cont_on_bna);
00515         }
00516 
00517         <span class="keywordflow">if</span> (dwc_otg_module_params.ahb_single != -1) {
00518                 retval +=
00519                         dwc_otg_set_param_ahb_single(core_if,
00520                         dwc_otg_module_params.ahb_single);
00521         }
00522 
00523         <span class="keywordflow">if</span> (dwc_otg_module_params.otg_ver != -1) {
00524                 retval +=
00525                     dwc_otg_set_param_otg_ver(core_if,
00526                                               dwc_otg_module_params.<a class="code" href="structdwc__otg__core__if.html#o46">otg_ver</a>);
00527         }
00528         <span class="keywordflow">if</span> (dwc_otg_module_params.adp_enable != -1) {
00529                 retval +=
00530                     <a class="code" href="dwc__otg__core__if_8h.html#a140">dwc_otg_set_param_adp_enable</a>(core_if,
00531                                                  dwc_otg_module_params.
00532                                                  adp_enable);
00533         }
00534         <span class="keywordflow">return</span> retval;
00535 }
00536 
<a name="l00541"></a><a class="code" href="dwc__otg__driver_8c.html#a16">00541</a> <span class="keyword">static</span> irqreturn_t <a class="code" href="dwc__otg__driver_8c.html#a16">dwc_otg_common_irq</a>(<span class="keywordtype">int</span> irq, <span class="keywordtype">void</span> *dev)
00542 {
00543         int32_t retval = IRQ_NONE;
00544 
00545         retval = <a class="code" href="dwc__otg__core__if_8h.html#a69">dwc_otg_handle_common_intr</a>(dev);
00546         <span class="keywordflow">if</span> (retval != 0) {
00547                 S3C2410X_CLEAR_EINTPEND();
00548         }
00549         <span class="keywordflow">return</span> IRQ_RETVAL(retval);
00550 }
00551 
<a name="l00561"></a><a class="code" href="dwc__otg__driver_8c.html#a17">00561</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__driver_8c.html#a17">dwc_otg_driver_remove</a>(
00562 #ifdef LM_INTERFACE
00563                                          <span class="keyword">struct</span> lm_device *_dev
00564 #elif defined(PCI_INTERFACE)
00565                                          <span class="keyword">struct</span> pci_dev *_dev
00566 #endif
00567     )
00568 {
00569 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00570 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = lm_get_drvdata(_dev);
00571 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00572 <span class="preprocessor"></span>        <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *otg_dev = pci_get_drvdata(_dev);
00573 <span class="preprocessor">#endif</span>
00574 <span class="preprocessor"></span>
00575         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s(%p)\n"</span>, __func__, _dev);
00576 
00577         <span class="keywordflow">if</span> (!otg_dev) {
00578                 <span class="comment">/* Memory allocation for the dwc_otg_device failed. */</span>
00579                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s: otg_dev NULL!\n"</span>, __func__);
00580                 <span class="keywordflow">return</span>;
00581         }
00582 <span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
00583 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o3">hcd</a>) {
00584                 <a class="code" href="dwc__otg__driver_8c.html#a8">hcd_remove</a>(_dev);
00585         } <span class="keywordflow">else</span> {
00586                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s: otg_dev-&gt;hcd NULL!\n"</span>, __func__);
00587                 <span class="keywordflow">return</span>;
00588         }
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>
00591 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00592 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o2">pcd</a>) {
00593                 <a class="code" href="dwc__otg__driver_8c.html#a7">pcd_remove</a>(_dev);
00594         } <span class="keywordflow">else</span> {
00595                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s: otg_dev-&gt;pcd NULL!\n"</span>, __func__);
00596                 <span class="keywordflow">return</span>;
00597         }
00598 <span class="preprocessor">#endif</span>
00599 <span class="preprocessor"></span>        <span class="comment">/*</span>
00600 <span class="comment">         * Free the IRQ</span>
00601 <span class="comment">         */</span>
00602         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o4">common_irq_installed</a>) {
00603                 free_irq(_dev-&gt;irq, otg_dev);
00604         } <span class="keywordflow">else</span> {
00605                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s: There is no installed irq!\n"</span>, __func__);
00606                 <span class="keywordflow">return</span>;
00607         }
00608 
00609         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>) {
00610                 <a class="code" href="dwc__otg__core__if_8h.html#a63">dwc_otg_cil_remove</a>(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a>);
00611         } <span class="keywordflow">else</span> {
00612                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"%s: otg_dev-&gt;core_if NULL!\n"</span>, __func__);
00613                 <span class="keywordflow">return</span>;
00614         }
00615 
00616         <span class="comment">/*</span>
00617 <span class="comment">         * Remove the device attributes</span>
00618 <span class="comment">         */</span>
00619         <a class="code" href="dwc__otg__attr_8c.html#a79">dwc_otg_attr_remove</a>(_dev);
00620 
00621         <span class="comment">/*</span>
00622 <span class="comment">         * Return the memory.</span>
00623 <span class="comment">         */</span>
00624         <span class="keywordflow">if</span> (otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base) {
00625                 iounmap(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base);
00626         }
00627         DWC_FREE(otg_dev);
00628 
00629         <span class="comment">/*</span>
00630 <span class="comment">         * Clear the drvdata pointer.</span>
00631 <span class="comment">         */</span>
00632 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00633 <span class="preprocessor"></span>        lm_set_drvdata(_dev, 0);
00634 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00635 <span class="preprocessor"></span>    release_mem_region(otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.rsrc_start, otg_dev-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.rsrc_len);
00636         pci_set_drvdata(_dev, 0);
00637 <span class="preprocessor">#endif</span>
00638 <span class="preprocessor"></span>}
00639 
<a name="l00651"></a><a class="code" href="dwc__otg__driver_8c.html#a18">00651</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__driver_8c.html#a18">dwc_otg_driver_probe</a>(
00652 #ifdef LM_INTERFACE
00653                                        <span class="keyword">struct</span> lm_device *_dev
00654 #elif defined(PCI_INTERFACE)
00655                                        <span class="keyword">struct</span> pci_dev *_dev,
00656                                        <span class="keyword">const</span> <span class="keyword">struct</span> pci_device_id *<span class="keywordtype">id</span>
00657 #endif
00658     )
00659 {
00660         <span class="keywordtype">int</span> retval = 0;
00661         <a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a> *<a class="code" href="structdwc__otg__device.html">dwc_otg_device</a>;
00662 
00663         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"dwc_otg_driver_probe(%p)\n"</span>, _dev);
00664 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00665 <span class="preprocessor"></span>        dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"start=0x%08x\n"</span>, (<span class="keywordtype">unsigned</span>)_dev-&gt;resource.start);
00666 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00667 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!id) {
00668                 DWC_ERROR(<span class="stringliteral">"Invalid pci_device_id %p"</span>, <span class="keywordtype">id</span>);
00669                 <span class="keywordflow">return</span> -EINVAL;
00670         }
00671 
00672         <span class="keywordflow">if</span> (!_dev || (pci_enable_device(_dev) &lt; 0)) {
00673                 DWC_ERROR(<span class="stringliteral">"Invalid pci_device %p"</span>, _dev);
00674                 <span class="keywordflow">return</span> -ENODEV;
00675         }
00676         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"start=0x%08x\n"</span>, (<span class="keywordtype">unsigned</span>)pci_resource_start(_dev,0));
00677         <span class="comment">/* other stuff needed as well? */</span>
00678 
00679 <span class="preprocessor">#endif</span>
00680 <span class="preprocessor"></span>
00681         dwc_otg_device = DWC_ALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdwc__otg__device.html">dwc_otg_device_t</a>));
00682 
00683         <span class="keywordflow">if</span> (!dwc_otg_device) {
00684                 dev_err(&amp;_dev-&gt;dev, <span class="stringliteral">"kmalloc of dwc_otg_device failed\n"</span>);
00685                 <span class="keywordflow">return</span> -ENOMEM;
00686         }
00687 
00688         memset(dwc_otg_device, 0, <span class="keyword">sizeof</span>(*dwc_otg_device));
00689         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.reg_offset = 0xFFFFFFFF;
00690 
00691         <span class="comment">/*</span>
00692 <span class="comment">         * Map the DWC_otg Core memory into virtual address space.</span>
00693 <span class="comment">         */</span>
00694 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00695 <span class="preprocessor"></span>        dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base = ioremap(_dev-&gt;resource.start, SZ_256K);
00696 
00697         <span class="keywordflow">if</span> (!dwc_otg_device-&gt;os_dep.base) {
00698                 dev_err(&amp;_dev-&gt;dev, <span class="stringliteral">"ioremap() failed\n"</span>);
00699                 DWC_FREE(dwc_otg_device);
00700                 <span class="keywordflow">return</span> -ENOMEM;
00701         }
00702         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"base=0x%08x\n"</span>,
00703                 (<span class="keywordtype">unsigned</span>)dwc_otg_device-&gt;os_dep.base);
00704 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00705 <span class="preprocessor"></span>        _dev-&gt;current_state = PCI_D0;
00706         _dev-&gt;dev.power.power_state = PMSG_ON;
00707 
00708         <span class="keywordflow">if</span> (!_dev-&gt;irq) {
00709                 DWC_ERROR(<span class="stringliteral">"Found HC with no IRQ. Check BIOS/PCI %s setup!"</span>,
00710                           pci_name(_dev));
00711                 iounmap(dwc_otg_device-&gt;os_dep.base);
00712                 DWC_FREE(dwc_otg_device);
00713                 <span class="keywordflow">return</span> -ENODEV;
00714         }
00715 
00716         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.rsrc_start = pci_resource_start(_dev, 0);
00717         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.rsrc_len = pci_resource_len(_dev, 0);
00718         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"PCI resource: start=%08x, len=%08x\n"</span>,
00719                     (<span class="keywordtype">unsigned</span>)dwc_otg_device-&gt;os_dep.rsrc_start,
00720                     (<span class="keywordtype">unsigned</span>)dwc_otg_device-&gt;os_dep.rsrc_len);
00721         <span class="keywordflow">if</span> (!request_mem_region
00722             (dwc_otg_device-&gt;os_dep.rsrc_start, dwc_otg_device-&gt;os_dep.rsrc_len,
00723              <span class="stringliteral">"dwc_otg"</span>)) {
00724                 dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"error requesting memory\n"</span>);
00725                 iounmap(dwc_otg_device-&gt;os_dep.base);
00726                 DWC_FREE(dwc_otg_device);
00727                 <span class="keywordflow">return</span> -EFAULT;
00728         }
00729 
00730         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base =
00731             ioremap_nocache(dwc_otg_device-&gt;os_dep.rsrc_start,
00732                             dwc_otg_device-&gt;os_dep.rsrc_len);
00733         <span class="keywordflow">if</span> (dwc_otg_device-&gt;os_dep.base == NULL) {
00734                 dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"error mapping memory\n"</span>);
00735                 release_mem_region(dwc_otg_device-&gt;os_dep.rsrc_start,
00736                                    dwc_otg_device-&gt;os_dep.rsrc_len);
00737                 iounmap(dwc_otg_device-&gt;os_dep.base);
00738                 DWC_FREE(dwc_otg_device);
00739                 <span class="keywordflow">return</span> -EFAULT;
00740         }
00741         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"base=0x%p (before adjust) \n"</span>,
00742                 dwc_otg_device-&gt;os_dep.base);
00743         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base = (<span class="keywordtype">char</span> *)dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o0">os_dep</a>.base;
00744         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"base=0x%p (after adjust) \n"</span>,
00745                 dwc_otg_device-&gt;os_dep.base);
00746         dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"%s: mapped PA 0x%x to VA 0x%p\n"</span>, __func__,
00747                 (<span class="keywordtype">unsigned</span>)dwc_otg_device-&gt;os_dep.rsrc_start,
00748                 dwc_otg_device-&gt;os_dep.base);
00749 
00750         pci_set_master(_dev);
00751         pci_set_drvdata(_dev, dwc_otg_device);
00752 <span class="preprocessor">#endif</span>
00753 <span class="preprocessor"></span>
00754         <span class="comment">/*</span>
00755 <span class="comment">         * Initialize driver data to point to the global DWC_otg</span>
00756 <span class="comment">         * Device structure.</span>
00757 <span class="comment">         */</span>
00758 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00759 <span class="preprocessor"></span>        lm_set_drvdata(_dev, dwc_otg_device);
00760 <span class="preprocessor">#endif</span>
00761 <span class="preprocessor"></span>        dev_dbg(&amp;_dev-&gt;dev, <span class="stringliteral">"dwc_otg_device=0x%p\n"</span>, dwc_otg_device);
00762 
00763         dwc_otg_device-&gt;<a class="code" href="structdwc__otg__device.html#o1">core_if</a> = <a class="code" href="dwc__otg__core__if_8h.html#a61">dwc_otg_cil_init</a>(dwc_otg_device-&gt;os_dep.base);
00764         <span class="keywordflow">if</span> (!dwc_otg_device-&gt;core_if) {
00765                 dev_err(&amp;_dev-&gt;dev, <span class="stringliteral">"CIL initialization failed!\n"</span>);
00766                 retval = -ENOMEM;
00767                 <span class="keywordflow">goto</span> fail;
00768         }
00769 
00770         <span class="comment">/*</span>
00771 <span class="comment">         * Attempt to ensure this device is really a DWC_otg Controller.</span>
00772 <span class="comment">         * Read and verify the SNPSID register contents. The value should be</span>
00773 <span class="comment">         * 0x45F42XXX, which corresponds to "OT2", as in "OTG version 2.XX".</span>
00774 <span class="comment">         */</span>
00775 
00776         <span class="keywordflow">if</span> ((<a class="code" href="dwc__otg__core__if_8h.html#a165">dwc_otg_get_gsnpsid</a>(dwc_otg_device-&gt;core_if) &amp; 0xFFFFF000) !=
00777             0x4F542000) {
00778                 dev_err(&amp;_dev-&gt;dev, <span class="stringliteral">"Bad value for SNPSID: 0x%08x\n"</span>,
00779                         <a class="code" href="dwc__otg__cil_8c.html#a163">dwc_otg_get_gsnpsid</a>(dwc_otg_device-&gt;core_if));
00780                 retval = -EINVAL;
00781                 <span class="keywordflow">goto</span> fail;
00782         }
00783 
00784         <span class="comment">/*</span>
00785 <span class="comment">         * Validate parameter values.</span>
00786 <span class="comment">         */</span>
00787         <span class="keywordflow">if</span> (<a class="code" href="dwc__otg__driver_8c.html#a15">set_parameters</a>(dwc_otg_device-&gt;core_if)) {
00788                 retval = -EINVAL;
00789                 <span class="keywordflow">goto</span> fail;
00790         }
00791 
00792         <span class="comment">/*</span>
00793 <span class="comment">         * Create Device Attributes in sysfs</span>
00794 <span class="comment">         */</span>
00795         <a class="code" href="dwc__otg__attr_8c.html#a78">dwc_otg_attr_create</a>(_dev);
00796 
00797         <span class="comment">/*</span>
00798 <span class="comment">         * Disable the global interrupt until all the interrupt</span>
00799 <span class="comment">         * handlers are installed.</span>
00800 <span class="comment">         */</span>
00801         <a class="code" href="dwc__otg__core__if_8h.html#a65">dwc_otg_disable_global_interrupts</a>(dwc_otg_device-&gt;core_if);
00802 
00803         <span class="comment">/*</span>
00804 <span class="comment">         * Install the interrupt handler for the common interrupts before</span>
00805 <span class="comment">         * enabling common interrupts in core_init below.</span>
00806 <span class="comment">         */</span>
00807         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"registering (common) handler for irq%d\n"</span>,
00808                     _dev-&gt;irq);
00809         retval = request_irq(_dev-&gt;irq, <a class="code" href="dwc__otg__driver_8c.html#a16">dwc_otg_common_irq</a>,
00810                              IRQF_SHARED | IRQF_DISABLED | IRQ_LEVEL, <span class="stringliteral">"dwc_otg"</span>,
00811                              dwc_otg_device);
00812         <span class="keywordflow">if</span> (retval) {
00813                 DWC_ERROR(<span class="stringliteral">"request of irq%d failed\n"</span>, _dev-&gt;irq);
00814                 retval = -EBUSY;
00815                 <span class="keywordflow">goto</span> fail;
00816         } <span class="keywordflow">else</span> {
00817                 dwc_otg_device-&gt;common_irq_installed = 1;
00818         }
00819 
00820 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00821 <span class="preprocessor"></span>        set_irq_type(_dev-&gt;irq, IRQT_LOW);
00822 <span class="preprocessor">#endif</span>
00823 <span class="preprocessor"></span>        <span class="comment">/*</span>
00824 <span class="comment">         * Initialize the DWC_otg core.</span>
00825 <span class="comment">         */</span>
00826         <a class="code" href="dwc__otg__core__if_8h.html#a62">dwc_otg_core_init</a>(dwc_otg_device-&gt;core_if);
00827                 
00828 <span class="preprocessor">#ifndef DWC_HOST_ONLY</span>
00829 <span class="preprocessor"></span>        <span class="comment">/*</span>
00830 <span class="comment">         * Initialize the PCD</span>
00831 <span class="comment">         */</span>
00832         retval = <a class="code" href="dwc__otg__driver_8c.html#a5">pcd_init</a>(_dev);
00833         <span class="keywordflow">if</span> (retval != 0) {
00834                 DWC_ERROR(<span class="stringliteral">"pcd_init failed\n"</span>);
00835                 dwc_otg_device-&gt;pcd = NULL;
00836                 <span class="keywordflow">goto</span> fail;
00837         }       
00838 <span class="preprocessor">#endif</span>
00839 <span class="preprocessor"></span><span class="preprocessor">#ifndef DWC_DEVICE_ONLY</span>
00840 <span class="preprocessor"></span>        <span class="comment">/*</span>
00841 <span class="comment">         * Initialize the HCD</span>
00842 <span class="comment">         */</span>
00843         retval = <a class="code" href="dwc__otg__driver_8c.html#a6">hcd_init</a>(_dev);
00844         <span class="keywordflow">if</span> (retval != 0) {
00845                 DWC_ERROR(<span class="stringliteral">"hcd_init failed\n"</span>);
00846                 dwc_otg_device-&gt;hcd = NULL;
00847                 <span class="keywordflow">goto</span> fail;
00848         }
00849 <span class="preprocessor">#endif</span>
00850 <span class="preprocessor"></span><span class="preprocessor">#ifdef PCI_INTERFACE</span>
00851 <span class="preprocessor"></span>        pci_set_drvdata(_dev, dwc_otg_device);
00852         dwc_otg_device-&gt;os_dep.pcidev = _dev;
00853 <span class="preprocessor">#endif</span>
00854 <span class="preprocessor"></span>
00855         <span class="comment">/*</span>
00856 <span class="comment">         * Enable the global interrupt after all the interrupt</span>
00857 <span class="comment">         * handlers are installed if there is no ADP support else </span>
00858 <span class="comment">         * perform initial actions required for Internal ADP logic.</span>
00859 <span class="comment">         */</span>
00860         <span class="keywordflow">if</span> (!dwc_otg_get_param_adp_enable(dwc_otg_device-&gt;core_if))     
00861                 <a class="code" href="dwc__otg__core__if_8h.html#a64">dwc_otg_enable_global_interrupts</a>(dwc_otg_device-&gt;core_if);
00862         <span class="keywordflow">else</span>
00863                 <a class="code" href="dwc__otg__driver_8c.html#a9">dwc_otg_adp_start</a>(dwc_otg_device-&gt;core_if, 
00864                                                         dwc_otg_is_host_mode(dwc_otg_device-&gt;core_if));
00865 
00866         <span class="keywordflow">return</span> 0;
00867 
00868 fail:
00869         <a class="code" href="dwc__otg__driver_8c.html#a17">dwc_otg_driver_remove</a>(_dev);
00870         <span class="keywordflow">return</span> retval;
00871 }
00872 
00884 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00885 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">struct </span>lm_driver dwc_otg_driver = {
00886         .drv = {.name = (<span class="keywordtype">char</span> *)dwc_driver_name,},
00887         .probe = dwc_otg_driver_probe,
00888         .remove = dwc_otg_driver_remove,
00889 };
00890 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00891 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>pci_device_id pci_ids[] = { {
00892                                                  PCI_DEVICE(0x16c3, 0xabcd),
00893                                                  .driver_data =
00894                                                  (<span class="keywordtype">unsigned</span> long)0xdeadbeef,
00895                                                  }, { <span class="comment">/* end: all zeroes */</span> }
00896 };
00897 
00898 MODULE_DEVICE_TABLE(pci, pci_ids);
00899 
00900 <span class="comment">/* pci driver glue; this is a "new style" PCI driver module */</span>
00901 <span class="keyword">static</span> <span class="keyword">struct </span>pci_driver dwc_otg_driver = {
00902         .name = <span class="stringliteral">"dwc_otg"</span>,
00903         .id_table = pci_ids,
00904 
00905         .probe = dwc_otg_driver_probe,
00906         .remove = dwc_otg_driver_remove,
00907 
00908         .driver = {
00909                    .name = (<span class="keywordtype">char</span> *)dwc_driver_name,
00910                    },
00911 };
00912 <span class="preprocessor">#endif</span>
00913 <span class="preprocessor"></span>
<a name="l00924"></a><a class="code" href="dwc__otg__driver_8c.html#a19">00924</a> <span class="keyword">static</span> <span class="keywordtype">int</span> __init <a class="code" href="dwc__otg__driver_8c.html#a19">dwc_otg_driver_init</a>(<span class="keywordtype">void</span>)
00925 {
00926         <span class="keywordtype">int</span> retval = 0;
00927         <span class="keywordtype">int</span> error;
00928         printk(KERN_INFO <span class="stringliteral">"%s: version %s\n"</span>, dwc_driver_name,
00929                DWC_DRIVER_VERSION);
00930 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00931 <span class="preprocessor"></span>        retval = lm_driver_register(&amp;dwc_otg_driver);
00932 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00933 <span class="preprocessor"></span>        retval = pci_register_driver(&amp;dwc_otg_driver);
00934 <span class="preprocessor">#endif</span>
00935 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (retval &lt; 0) {
00936                 printk(KERN_ERR <span class="stringliteral">"%s retval=%d\n"</span>, __func__, retval);
00937                 <span class="keywordflow">return</span> retval;
00938         }
00939 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00940 <span class="preprocessor"></span>        error = driver_create_file(&amp;dwc_otg_driver.drv, &amp;driver_attr_version);
00941         error = driver_create_file(&amp;dwc_otg_driver.drv, &amp;driver_attr_debuglevel);
00942 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00943 <span class="preprocessor"></span>        error = driver_create_file(&amp;dwc_otg_driver.driver, &amp;driver_attr_version);
00944         error = driver_create_file(&amp;dwc_otg_driver.driver, &amp;driver_attr_debuglevel);
00945 <span class="preprocessor">#endif</span>
00946 <span class="preprocessor"></span>        <span class="keywordflow">return</span> retval;
00947 }
00948 
00949 module_init(dwc_otg_driver_init);
00950 
<a name="l00957"></a><a class="code" href="dwc__otg__driver_8c.html#a21">00957</a> <span class="keyword">static</span> <span class="keywordtype">void</span> __exit <a class="code" href="dwc__otg__driver_8c.html#a21">dwc_otg_driver_cleanup</a>(<span class="keywordtype">void</span>)
00958 {
00959         printk(KERN_DEBUG <span class="stringliteral">"dwc_otg_driver_cleanup()\n"</span>);
00960 
00961 <span class="preprocessor">#ifdef LM_INTERFACE</span>
00962 <span class="preprocessor"></span>        driver_remove_file(&amp;dwc_otg_driver.drv, &amp;driver_attr_debuglevel);
00963         driver_remove_file(&amp;dwc_otg_driver.drv, &amp;driver_attr_version);
00964         lm_driver_unregister(&amp;dwc_otg_driver);
00965 <span class="preprocessor">#elif defined(PCI_INTERFACE)</span>
00966 <span class="preprocessor"></span>        driver_remove_file(&amp;dwc_otg_driver.driver, &amp;driver_attr_debuglevel);
00967         driver_remove_file(&amp;dwc_otg_driver.driver, &amp;driver_attr_version);
00968         pci_unregister_driver(&amp;dwc_otg_driver);
00969 <span class="preprocessor">#endif</span>
00970 <span class="preprocessor"></span>
00971         printk(KERN_INFO <span class="stringliteral">"%s module removed\n"</span>, dwc_driver_name);
00972 }
00973 
00974 module_exit(dwc_otg_driver_cleanup);
00975 
00976 MODULE_DESCRIPTION(DWC_DRIVER_DESC);
00977 MODULE_AUTHOR(<span class="stringliteral">"Synopsys Inc."</span>);
00978 MODULE_LICENSE(<span class="stringliteral">"GPL"</span>);
00979 
00980 module_param_named(otg_cap, dwc_otg_module_params.otg_cap, <span class="keywordtype">int</span>, 0444);
00981 MODULE_PARM_DESC(otg_cap, <span class="stringliteral">"OTG Capabilities 0=HNP&amp;SRP 1=SRP Only 2=None"</span>);
00982 module_param_named(opt, dwc_otg_module_params.opt, <span class="keywordtype">int</span>, 0444);
00983 MODULE_PARM_DESC(opt, <span class="stringliteral">"OPT Mode"</span>);
00984 module_param_named(dma_enable, dwc_otg_module_params.dma_enable, <span class="keywordtype">int</span>, 0444);
00985 MODULE_PARM_DESC(dma_enable, <span class="stringliteral">"DMA Mode 0=Slave 1=DMA enabled"</span>);
00986 
00987 module_param_named(dma_desc_enable, dwc_otg_module_params.dma_desc_enable, <span class="keywordtype">int</span>,
00988                    0444);
00989 MODULE_PARM_DESC(dma_desc_enable,
00990                  <span class="stringliteral">"DMA Desc Mode 0=Address DMA 1=DMA Descriptor enabled"</span>);
00991 
00992 module_param_named(dma_burst_size, dwc_otg_module_params.dma_burst_size, <span class="keywordtype">int</span>,
00993                    0444);
00994 MODULE_PARM_DESC(dma_burst_size,
00995                  <span class="stringliteral">"DMA Burst Size 1, 4, 8, 16, 32, 64, 128, 256"</span>);
00996 module_param_named(speed, dwc_otg_module_params.speed, <span class="keywordtype">int</span>, 0444);
00997 MODULE_PARM_DESC(speed, <span class="stringliteral">"Speed 0=High Speed 1=Full Speed"</span>);
00998 module_param_named(host_support_fs_ls_low_power,
00999                    dwc_otg_module_params.host_support_fs_ls_low_power, <span class="keywordtype">int</span>,
01000                    0444);
01001 MODULE_PARM_DESC(host_support_fs_ls_low_power,
01002                  <span class="stringliteral">"Support Low Power w/FS or LS 0=Support 1=Don't Support"</span>);
01003 module_param_named(host_ls_low_power_phy_clk,
01004                    dwc_otg_module_params.host_ls_low_power_phy_clk, <span class="keywordtype">int</span>, 0444);
01005 MODULE_PARM_DESC(host_ls_low_power_phy_clk,
01006                  <span class="stringliteral">"Low Speed Low Power Clock 0=48Mhz 1=6Mhz"</span>);
01007 module_param_named(enable_dynamic_fifo,
01008                    dwc_otg_module_params.enable_dynamic_fifo, <span class="keywordtype">int</span>, 0444);
01009 MODULE_PARM_DESC(enable_dynamic_fifo, <span class="stringliteral">"0=cC Setting 1=Allow Dynamic Sizing"</span>);
01010 module_param_named(data_fifo_size, dwc_otg_module_params.data_fifo_size, <span class="keywordtype">int</span>,
01011                    0444);
01012 MODULE_PARM_DESC(data_fifo_size,
01013                  <span class="stringliteral">"Total number of words in the data FIFO memory 32-32768"</span>);
01014 module_param_named(dev_rx_fifo_size, dwc_otg_module_params.dev_rx_fifo_size,
01015                    <span class="keywordtype">int</span>, 0444);
01016 MODULE_PARM_DESC(dev_rx_fifo_size, <span class="stringliteral">"Number of words in the Rx FIFO 16-32768"</span>);
01017 module_param_named(dev_nperio_tx_fifo_size,
01018                    dwc_otg_module_params.dev_nperio_tx_fifo_size, <span class="keywordtype">int</span>, 0444);
01019 MODULE_PARM_DESC(dev_nperio_tx_fifo_size,
01020                  <span class="stringliteral">"Number of words in the non-periodic Tx FIFO 16-32768"</span>);
01021 module_param_named(dev_perio_tx_fifo_size_1,
01022                    dwc_otg_module_params.dev_perio_tx_fifo_size[0], <span class="keywordtype">int</span>, 0444);
01023 MODULE_PARM_DESC(dev_perio_tx_fifo_size_1,
01024                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01025 module_param_named(dev_perio_tx_fifo_size_2,
01026                    dwc_otg_module_params.dev_perio_tx_fifo_size[1], <span class="keywordtype">int</span>, 0444);
01027 MODULE_PARM_DESC(dev_perio_tx_fifo_size_2,
01028                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01029 module_param_named(dev_perio_tx_fifo_size_3,
01030                    dwc_otg_module_params.dev_perio_tx_fifo_size[2], <span class="keywordtype">int</span>, 0444);
01031 MODULE_PARM_DESC(dev_perio_tx_fifo_size_3,
01032                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01033 module_param_named(dev_perio_tx_fifo_size_4,
01034                    dwc_otg_module_params.dev_perio_tx_fifo_size[3], <span class="keywordtype">int</span>, 0444);
01035 MODULE_PARM_DESC(dev_perio_tx_fifo_size_4,
01036                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01037 module_param_named(dev_perio_tx_fifo_size_5,
01038                    dwc_otg_module_params.dev_perio_tx_fifo_size[4], <span class="keywordtype">int</span>, 0444);
01039 MODULE_PARM_DESC(dev_perio_tx_fifo_size_5,
01040                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01041 module_param_named(dev_perio_tx_fifo_size_6,
01042                    dwc_otg_module_params.dev_perio_tx_fifo_size[5], <span class="keywordtype">int</span>, 0444);
01043 MODULE_PARM_DESC(dev_perio_tx_fifo_size_6,
01044                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01045 module_param_named(dev_perio_tx_fifo_size_7,
01046                    dwc_otg_module_params.dev_perio_tx_fifo_size[6], <span class="keywordtype">int</span>, 0444);
01047 MODULE_PARM_DESC(dev_perio_tx_fifo_size_7,
01048                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01049 module_param_named(dev_perio_tx_fifo_size_8,
01050                    dwc_otg_module_params.dev_perio_tx_fifo_size[7], <span class="keywordtype">int</span>, 0444);
01051 MODULE_PARM_DESC(dev_perio_tx_fifo_size_8,
01052                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01053 module_param_named(dev_perio_tx_fifo_size_9,
01054                    dwc_otg_module_params.dev_perio_tx_fifo_size[8], <span class="keywordtype">int</span>, 0444);
01055 MODULE_PARM_DESC(dev_perio_tx_fifo_size_9,
01056                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01057 module_param_named(dev_perio_tx_fifo_size_10,
01058                    dwc_otg_module_params.dev_perio_tx_fifo_size[9], <span class="keywordtype">int</span>, 0444);
01059 MODULE_PARM_DESC(dev_perio_tx_fifo_size_10,
01060                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01061 module_param_named(dev_perio_tx_fifo_size_11,
01062                    dwc_otg_module_params.dev_perio_tx_fifo_size[10], <span class="keywordtype">int</span>, 0444);
01063 MODULE_PARM_DESC(dev_perio_tx_fifo_size_11,
01064                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01065 module_param_named(dev_perio_tx_fifo_size_12,
01066                    dwc_otg_module_params.dev_perio_tx_fifo_size[11], <span class="keywordtype">int</span>, 0444);
01067 MODULE_PARM_DESC(dev_perio_tx_fifo_size_12,
01068                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01069 module_param_named(dev_perio_tx_fifo_size_13,
01070                    dwc_otg_module_params.dev_perio_tx_fifo_size[12], <span class="keywordtype">int</span>, 0444);
01071 MODULE_PARM_DESC(dev_perio_tx_fifo_size_13,
01072                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01073 module_param_named(dev_perio_tx_fifo_size_14,
01074                    dwc_otg_module_params.dev_perio_tx_fifo_size[13], <span class="keywordtype">int</span>, 0444);
01075 MODULE_PARM_DESC(dev_perio_tx_fifo_size_14,
01076                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01077 module_param_named(dev_perio_tx_fifo_size_15,
01078                    dwc_otg_module_params.dev_perio_tx_fifo_size[14], <span class="keywordtype">int</span>, 0444);
01079 MODULE_PARM_DESC(dev_perio_tx_fifo_size_15,
01080                  <span class="stringliteral">"Number of words in the periodic Tx FIFO 4-768"</span>);
01081 module_param_named(host_rx_fifo_size, dwc_otg_module_params.host_rx_fifo_size,
01082                    <span class="keywordtype">int</span>, 0444);
01083 MODULE_PARM_DESC(host_rx_fifo_size, <span class="stringliteral">"Number of words in the Rx FIFO 16-32768"</span>);
01084 module_param_named(host_nperio_tx_fifo_size,
01085                    dwc_otg_module_params.host_nperio_tx_fifo_size, <span class="keywordtype">int</span>, 0444);
01086 MODULE_PARM_DESC(host_nperio_tx_fifo_size,
01087                  <span class="stringliteral">"Number of words in the non-periodic Tx FIFO 16-32768"</span>);
01088 module_param_named(host_perio_tx_fifo_size,
01089                    dwc_otg_module_params.host_perio_tx_fifo_size, <span class="keywordtype">int</span>, 0444);
01090 MODULE_PARM_DESC(host_perio_tx_fifo_size,
01091                  <span class="stringliteral">"Number of words in the host periodic Tx FIFO 16-32768"</span>);
01092 module_param_named(max_transfer_size, dwc_otg_module_params.max_transfer_size,
01093                    <span class="keywordtype">int</span>, 0444);
01095 MODULE_PARM_DESC(max_transfer_size,
01096                  <span class="stringliteral">"The maximum transfer size supported in bytes 2047-65535"</span>);
01097 module_param_named(max_packet_count, dwc_otg_module_params.max_packet_count,
01098                    <span class="keywordtype">int</span>, 0444);
01099 MODULE_PARM_DESC(max_packet_count,
01100                  <span class="stringliteral">"The maximum number of packets in a transfer 15-511"</span>);
01101 module_param_named(host_channels, dwc_otg_module_params.host_channels, <span class="keywordtype">int</span>,
01102                    0444);
01103 MODULE_PARM_DESC(host_channels,
01104                  <span class="stringliteral">"The number of host channel registers to use 1-16"</span>);
01105 module_param_named(dev_endpoints, dwc_otg_module_params.dev_endpoints, <span class="keywordtype">int</span>,
01106                    0444);
01107 MODULE_PARM_DESC(dev_endpoints,
01108                  <span class="stringliteral">"The number of endpoints in addition to EP0 available for device mode 1-15"</span>);
01109 module_param_named(phy_type, dwc_otg_module_params.phy_type, <span class="keywordtype">int</span>, 0444);
01110 MODULE_PARM_DESC(phy_type, <span class="stringliteral">"0=Reserved 1=UTMI+ 2=ULPI"</span>);
01111 module_param_named(phy_utmi_width, dwc_otg_module_params.phy_utmi_width, <span class="keywordtype">int</span>,
01112                    0444);
01113 MODULE_PARM_DESC(phy_utmi_width, <span class="stringliteral">"Specifies the UTMI+ Data Width 8 or 16 bits"</span>);
01114 module_param_named(phy_ulpi_ddr, dwc_otg_module_params.phy_ulpi_ddr, <span class="keywordtype">int</span>, 0444);
01115 MODULE_PARM_DESC(phy_ulpi_ddr,
01116                  <span class="stringliteral">"ULPI at double or single data rate 0=Single 1=Double"</span>);
01117 module_param_named(phy_ulpi_ext_vbus, dwc_otg_module_params.phy_ulpi_ext_vbus,
01118                    <span class="keywordtype">int</span>, 0444);
01119 MODULE_PARM_DESC(phy_ulpi_ext_vbus,
01120                  <span class="stringliteral">"ULPI PHY using internal or external vbus 0=Internal"</span>);
01121 module_param_named(i2c_enable, dwc_otg_module_params.i2c_enable, <span class="keywordtype">int</span>, 0444);
01122 MODULE_PARM_DESC(i2c_enable, <span class="stringliteral">"FS PHY Interface"</span>);
01123 module_param_named(ulpi_fs_ls, dwc_otg_module_params.ulpi_fs_ls, <span class="keywordtype">int</span>, 0444);
01124 MODULE_PARM_DESC(ulpi_fs_ls, <span class="stringliteral">"ULPI PHY FS/LS mode only"</span>);
01125 module_param_named(ts_dline, dwc_otg_module_params.ts_dline, <span class="keywordtype">int</span>, 0444);
01126 MODULE_PARM_DESC(ts_dline, <span class="stringliteral">"Term select Dline pulsing for all PHYs"</span>);
01127 module_param_named(debug, g_dbg_lvl, <span class="keywordtype">int</span>, 0444);
01128 MODULE_PARM_DESC(debug, <span class="stringliteral">""</span>);
01129 
01130 module_param_named(en_multiple_tx_fifo,
01131                    dwc_otg_module_params.en_multiple_tx_fifo, <span class="keywordtype">int</span>, 0444);
01132 MODULE_PARM_DESC(en_multiple_tx_fifo,
01133                  <span class="stringliteral">"Dedicated Non Periodic Tx FIFOs 0=disabled 1=enabled"</span>);
01134 module_param_named(dev_tx_fifo_size_1,
01135                    dwc_otg_module_params.dev_tx_fifo_size[0], <span class="keywordtype">int</span>, 0444);
01136 MODULE_PARM_DESC(dev_tx_fifo_size_1, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01137 module_param_named(dev_tx_fifo_size_2,
01138                    dwc_otg_module_params.dev_tx_fifo_size[1], <span class="keywordtype">int</span>, 0444);
01139 MODULE_PARM_DESC(dev_tx_fifo_size_2, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01140 module_param_named(dev_tx_fifo_size_3,
01141                    dwc_otg_module_params.dev_tx_fifo_size[2], <span class="keywordtype">int</span>, 0444);
01142 MODULE_PARM_DESC(dev_tx_fifo_size_3, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01143 module_param_named(dev_tx_fifo_size_4,
01144                    dwc_otg_module_params.dev_tx_fifo_size[3], <span class="keywordtype">int</span>, 0444);
01145 MODULE_PARM_DESC(dev_tx_fifo_size_4, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01146 module_param_named(dev_tx_fifo_size_5,
01147                    dwc_otg_module_params.dev_tx_fifo_size[4], <span class="keywordtype">int</span>, 0444);
01148 MODULE_PARM_DESC(dev_tx_fifo_size_5, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01149 module_param_named(dev_tx_fifo_size_6,
01150                    dwc_otg_module_params.dev_tx_fifo_size[5], <span class="keywordtype">int</span>, 0444);
01151 MODULE_PARM_DESC(dev_tx_fifo_size_6, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01152 module_param_named(dev_tx_fifo_size_7,
01153                    dwc_otg_module_params.dev_tx_fifo_size[6], <span class="keywordtype">int</span>, 0444);
01154 MODULE_PARM_DESC(dev_tx_fifo_size_7, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01155 module_param_named(dev_tx_fifo_size_8,
01156                    dwc_otg_module_params.dev_tx_fifo_size[7], <span class="keywordtype">int</span>, 0444);
01157 MODULE_PARM_DESC(dev_tx_fifo_size_8, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01158 module_param_named(dev_tx_fifo_size_9,
01159                    dwc_otg_module_params.dev_tx_fifo_size[8], <span class="keywordtype">int</span>, 0444);
01160 MODULE_PARM_DESC(dev_tx_fifo_size_9, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01161 module_param_named(dev_tx_fifo_size_10,
01162                    dwc_otg_module_params.dev_tx_fifo_size[9], <span class="keywordtype">int</span>, 0444);
01163 MODULE_PARM_DESC(dev_tx_fifo_size_10, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01164 module_param_named(dev_tx_fifo_size_11,
01165                    dwc_otg_module_params.dev_tx_fifo_size[10], <span class="keywordtype">int</span>, 0444);
01166 MODULE_PARM_DESC(dev_tx_fifo_size_11, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01167 module_param_named(dev_tx_fifo_size_12,
01168                    dwc_otg_module_params.dev_tx_fifo_size[11], <span class="keywordtype">int</span>, 0444);
01169 MODULE_PARM_DESC(dev_tx_fifo_size_12, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01170 module_param_named(dev_tx_fifo_size_13,
01171                    dwc_otg_module_params.dev_tx_fifo_size[12], <span class="keywordtype">int</span>, 0444);
01172 MODULE_PARM_DESC(dev_tx_fifo_size_13, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01173 module_param_named(dev_tx_fifo_size_14,
01174                    dwc_otg_module_params.dev_tx_fifo_size[13], <span class="keywordtype">int</span>, 0444);
01175 MODULE_PARM_DESC(dev_tx_fifo_size_14, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01176 module_param_named(dev_tx_fifo_size_15,
01177                    dwc_otg_module_params.dev_tx_fifo_size[14], <span class="keywordtype">int</span>, 0444);
01178 MODULE_PARM_DESC(dev_tx_fifo_size_15, <span class="stringliteral">"Number of words in the Tx FIFO 4-768"</span>);
01179 
01180 module_param_named(thr_ctl, dwc_otg_module_params.thr_ctl, <span class="keywordtype">int</span>, 0444);
01181 MODULE_PARM_DESC(thr_ctl,
01182                  <span class="stringliteral">"Thresholding enable flag bit 0 - non ISO Tx thr., 1 - ISO Tx thr., 2 - Rx thr.- bit 0=disabled 1=enabled"</span>);
01183 module_param_named(tx_thr_length, dwc_otg_module_params.tx_thr_length, <span class="keywordtype">int</span>,
01184                    0444);
01185 MODULE_PARM_DESC(tx_thr_length, <span class="stringliteral">"Tx Threshold length in 32 bit DWORDs"</span>);
01186 module_param_named(rx_thr_length, dwc_otg_module_params.rx_thr_length, <span class="keywordtype">int</span>,
01187                    0444);
01188 MODULE_PARM_DESC(rx_thr_length, <span class="stringliteral">"Rx Threshold length in 32 bit DWORDs"</span>);
01189 
01190 module_param_named(pti_enable, dwc_otg_module_params.pti_enable, <span class="keywordtype">int</span>, 0444);
01191 module_param_named(mpi_enable, dwc_otg_module_params.mpi_enable, <span class="keywordtype">int</span>, 0444);
01192 module_param_named(lpm_enable, dwc_otg_module_params.lpm_enable, <span class="keywordtype">int</span>, 0444);
01193 MODULE_PARM_DESC(lpm_enable, <span class="stringliteral">"LPM Enable 0=LPM Disabled 1=LPM Enabled"</span>);
01194 module_param_named(ic_usb_cap, dwc_otg_module_params.ic_usb_cap, <span class="keywordtype">int</span>, 0444);
01195 MODULE_PARM_DESC(ic_usb_cap,
01196                  <span class="stringliteral">"IC_USB Capability 0=IC_USB Disabled 1=IC_USB Enabled"</span>);
01197 module_param_named(ahb_thr_ratio, dwc_otg_module_params.ahb_thr_ratio, <span class="keywordtype">int</span>,
01198                    0444);
01199 MODULE_PARM_DESC(ahb_thr_ratio, <span class="stringliteral">"AHB Threshold Ratio"</span>);
01200 module_param_named(power_down, dwc_otg_module_params.power_down, <span class="keywordtype">int</span>, 0444);
01201 MODULE_PARM_DESC(power_down, <span class="stringliteral">"Power Down Mode"</span>);
01202 module_param_named(reload_ctl, dwc_otg_module_params.reload_ctl, <span class="keywordtype">int</span>, 0444);
01203 MODULE_PARM_DESC(reload_ctl, <span class="stringliteral">"HFIR Reload Control"</span>);
01204 module_param_named(dev_out_nak, dwc_otg_module_params.dev_out_nak, <span class="keywordtype">int</span>, 0444);
01205 MODULE_PARM_DESC(dev_out_nak, <span class="stringliteral">"Enable Device OUT NAK"</span>);
01206 module_param_named(cont_on_bna, dwc_otg_module_params.cont_on_bna, <span class="keywordtype">int</span>, 0444);
01207 MODULE_PARM_DESC(cont_on_bna, <span class="stringliteral">"Enable Enable Continue on BNA"</span>);
01208 module_param_named(ahb_single, dwc_otg_module_params.ahb_single, <span class="keywordtype">int</span>, 0444);
01209 MODULE_PARM_DESC(ahb_single, <span class="stringliteral">"Enable AHB Single Support"</span>);
01210 module_param_named(adp_enable, dwc_otg_module_params.adp_enable, <span class="keywordtype">int</span>, 0444);
01211 MODULE_PARM_DESC(adp_enable, <span class="stringliteral">"ADP Enable 0=ADP Disabled 1=ADP Enabled"</span>);
01212 module_param_named(otg_ver, dwc_otg_module_params.otg_ver, <span class="keywordtype">int</span>, 0444);
01213 MODULE_PARM_DESC(otg_ver, <span class="stringliteral">"OTG revision supported 0=OTG 1.3 1=OTG 2.0"</span>);
01214 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:37 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
