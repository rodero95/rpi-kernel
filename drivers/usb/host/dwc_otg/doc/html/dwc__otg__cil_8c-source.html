<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver: dwc_otg_cil.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dwc_otg_cil.c</h1><a href="dwc__otg__cil_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/* ==========================================================================</span>
00002 <span class="comment"> * $File: //dwh/usb_iip/dev/software/otg/linux/drivers/dwc_otg_cil.c $</span>
00003 <span class="comment"> * $Revision: #189 $</span>
00004 <span class="comment"> * $Date: 2011/10/24 $</span>
00005 <span class="comment"> * $Change: 1871160 $</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Synopsys HS OTG Linux Software Driver and documentation (hereinafter,</span>
00008 <span class="comment"> * "Software") is an Unsupported proprietary work of Synopsys, Inc. unless</span>
00009 <span class="comment"> * otherwise expressly agreed to in writing between Synopsys and you.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * The Software IS NOT an item of Licensed Software or Licensed Product under</span>
00012 <span class="comment"> * any End User Software License Agreement or Agreement for Licensed Product</span>
00013 <span class="comment"> * with Synopsys or any supplement thereto. You are permitted to use and</span>
00014 <span class="comment"> * redistribute this Software in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, provided that redistributions of source code must retain this</span>
00016 <span class="comment"> * notice. You may not view, use, disclose, copy or distribute this file or</span>
00017 <span class="comment"> * any information contained herein except pursuant to this license grant from</span>
00018 <span class="comment"> * Synopsys. If you do not agree with this notice, including the disclaimer</span>
00019 <span class="comment"> * below, then you are not authorized to use the Software.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * THIS SOFTWARE IS BEING DISTRIBUTED BY SYNOPSYS SOLELY ON AN "AS IS" BASIS</span>
00022 <span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
00023 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
00024 <span class="comment"> * ARE HEREBY DISCLAIMED. IN NO EVENT SHALL SYNOPSYS BE LIABLE FOR ANY DIRECT,</span>
00025 <span class="comment"> * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
00026 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
00027 <span class="comment"> * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
00028 <span class="comment"> * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
00029 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
00030 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH</span>
00031 <span class="comment"> * DAMAGE.</span>
00032 <span class="comment"> * ========================================================================== */</span>
00033 
00060 <span class="preprocessor">#include "dwc_os.h"</span>
00061 <span class="preprocessor">#include "<a class="code" href="dwc__otg__regs_8h.html">dwc_otg_regs.h</a>"</span>
00062 <span class="preprocessor">#include "<a class="code" href="dwc__otg__cil_8h.html">dwc_otg_cil.h</a>"</span>
00063 
00064 <span class="keyword">static</span> <span class="keywordtype">int</span> dwc_otg_setup_params(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if);
00065 
<a name="l00078"></a><a class="code" href="dwc__otg__core__if_8h.html#a61">00078</a> <a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *<a class="code" href="dwc__otg__core__if_8h.html#a61">dwc_otg_cil_init</a>(<span class="keyword">const</span> uint32_t * reg_base_addr)
00079 {
00080         <a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *core_if = 0;
00081         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = 0;
00082         <a class="code" href="structdwc__otg__host__if.html">dwc_otg_host_if_t</a> *host_if = 0;
00083         uint8_t *reg_base = (uint8_t *) reg_base_addr;
00084         <span class="keywordtype">int</span> i = 0;
00085 
00086         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"%s(%p)\n"</span>, __func__, reg_base_addr);
00087 
00088         core_if = DWC_ALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a>));
00089 
00090         <span class="keywordflow">if</span> (core_if == NULL) {
00091                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
00092                             <span class="stringliteral">"Allocation of dwc_otg_core_if_t failed\n"</span>);
00093                 <span class="keywordflow">return</span> 0;
00094         }
00095         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a> = (<a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *) reg_base;
00096 
00097         <span class="comment">/*</span>
00098 <span class="comment">         * Allocate the Device Mode structures.</span>
00099 <span class="comment">         */</span>
00100         dev_if = DWC_ALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a>));
00101 
00102         <span class="keywordflow">if</span> (dev_if == NULL) {
00103                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Allocation of dwc_otg_dev_if_t failed\n"</span>);
00104                 DWC_FREE(core_if);
00105                 <span class="keywordflow">return</span> 0;
00106         }
00107 
00108         dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a> =
00109             (<a class="code" href="structdwc__otg__dev__global__regs.html">dwc_otg_device_global_regs_t</a> *) (reg_base +
00110                                               DWC_DEV_GLOBAL_REG_OFFSET);
00111 
00112         <span class="keywordflow">for</span> (i = 0; i &lt; MAX_EPS_CHANNELS; i++) {
00113                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i] = (<a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *)
00114                     (reg_base + DWC_DEV_IN_EP_REG_OFFSET +
00115                      (i * DWC_EP_REG_OFFSET));
00116 
00117                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i] = (<a class="code" href="structdwc__otg__dev__out__ep__regs.html">dwc_otg_dev_out_ep_regs_t</a> *)
00118                     (reg_base + DWC_DEV_OUT_EP_REG_OFFSET +
00119                      (i * DWC_EP_REG_OFFSET));
00120                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"in_ep_regs[%d]-&gt;diepctl=%p\n"</span>,
00121                             i, &amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
00122                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"out_ep_regs[%d]-&gt;doepctl=%p\n"</span>,
00123                             i, &amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
00124         }
00125 
00126         dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o3">speed</a> = 0;      <span class="comment">// unknown</span>
00127 
00128         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a> = dev_if;
00129 
00130         <span class="comment">/*</span>
00131 <span class="comment">         * Allocate the Host Mode structures.</span>
00132 <span class="comment">         */</span>
00133         host_if = DWC_ALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdwc__otg__host__if.html">dwc_otg_host_if_t</a>));
00134 
00135         <span class="keywordflow">if</span> (host_if == NULL) {
00136                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
00137                             <span class="stringliteral">"Allocation of dwc_otg_host_if_t failed\n"</span>);
00138                 DWC_FREE(dev_if);
00139                 DWC_FREE(core_if);
00140                 <span class="keywordflow">return</span> 0;
00141         }
00142 
00143         host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a> = (<a class="code" href="structdwc__otg__host__global__regs.html">dwc_otg_host_global_regs_t</a> *)
00144             (reg_base + DWC_OTG_HOST_GLOBAL_REG_OFFSET);
00145 
00146         host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a> =
00147             (uint32_t *) (reg_base + DWC_OTG_HOST_PORT_REGS_OFFSET);
00148 
00149         <span class="keywordflow">for</span> (i = 0; i &lt; MAX_EPS_CHANNELS; i++) {
00150                 host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i] = (<a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *)
00151                     (reg_base + DWC_OTG_HOST_CHAN_REGS_OFFSET +
00152                      (i * DWC_OTG_CHAN_REGS_OFFSET));
00153                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hc_reg[%d]-&gt;hcchar=%p\n"</span>,
00154                             i, &amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
00155         }
00156 
00157         host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o3">num_host_channels</a> = MAX_EPS_CHANNELS;
00158         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a> = host_if;
00159 
00160         <span class="keywordflow">for</span> (i = 0; i &lt; MAX_EPS_CHANNELS; i++) {
00161                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[i] =
00162                     (uint32_t *) (reg_base + DWC_OTG_DATA_FIFO_OFFSET +
00163                                   (i * DWC_OTG_DATA_FIFO_SIZE));
00164                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"data_fifo[%d]=0x%08lx\n"</span>,
00165                             i, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[i]);
00166         }
00167 
00168         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a> = (uint32_t *) (reg_base + DWC_OTG_PCGCCTL_OFFSET);
00169 
00170         <span class="comment">/* Initiate lx_state to L3 disconnected state */</span>
00171         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o38">lx_state</a> = DWC_OTG_L3;
00172         <span class="comment">/*</span>
00173 <span class="comment">         * Store the contents of the hardware configuration registers here for</span>
00174 <span class="comment">         * easy access later.</span>
00175 <span class="comment">         */</span>
00176         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o20">hwcfg1</a>.<a class="code" href="unionhwcfg1__data.html#o0">d32</a> =
00177             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o17">ghwcfg1</a>);
00178         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o0">d32</a> =
00179             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o18">ghwcfg2</a>);
00180         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o0">d32</a> =
00181             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o19">ghwcfg3</a>);
00182         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o0">d32</a> =
00183             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o20">ghwcfg4</a>);
00184 
00185         <span class="comment">/* Force host mode to get HPTXFSIZ exact power on value */</span>
00186         {
00187                 <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> gusbcfg = {.<a class="code" href="unionhwcfg4__data.html#o0">d32</a> = 0 };
00188                 gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> =  DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
00189                 gusbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o25">force_host_mode</a> = 1;
00190                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
00191                 dwc_mdelay(100); 
00192                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o24">hptxfsiz</a>.<a class="code" href="unionfifosize__data.html#o0">d32</a> =
00193                 DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>);
00194                 gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> =  DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
00195                 gusbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o25">force_host_mode</a> = 0;
00196                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
00197                 dwc_mdelay(100); 
00198         }
00199 
00200         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hwcfg1=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o20">hwcfg1</a>.<a class="code" href="unionhwcfg1__data.html#o0">d32</a>);
00201         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hwcfg2=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o0">d32</a>);
00202         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hwcfg3=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o0">d32</a>);
00203         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hwcfg4=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o0">d32</a>);
00204 
00205         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o25">hcfg</a>.<a class="code" href="unionhcfg__data.html#o0">d32</a> =
00206             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
00207         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o26">dcfg</a>.<a class="code" href="uniondcfg__data.html#o0">d32</a> =
00208             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
00209 
00210         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"hcfg=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o25">hcfg</a>.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
00211         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"dcfg=%08x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o26">dcfg</a>.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
00212 
00213         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"op_mode=%0x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a>);
00214         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"arch=%0x\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o2">architecture</a>);
00215         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"num_dev_ep=%d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o6">num_dev_ep</a>);
00216         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"num_host_chan=%d\n"</span>,
00217                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o7">num_host_chan</a>);
00218         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"nonperio_tx_q_depth=0x%0x\n"</span>,
00219                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o12">nonperio_tx_q_depth</a>);
00220         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"host_perio_tx_q_depth=0x%0x\n"</span>,
00221                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o13">host_perio_tx_q_depth</a>);
00222         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"dev_token_q_depth=0x%0x\n"</span>,
00223                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o14">dev_token_q_depth</a>);
00224 
00225         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"Total FIFO SZ=%d\n"</span>,
00226                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o12">dfifo_depth</a>);
00227         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"xfer_size_cntr_width=%0x\n"</span>,
00228                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o1">xfer_size_cntr_width</a>);
00229 
00230         <span class="comment">/*</span>
00231 <span class="comment">         * Set the SRP sucess bit for FS-I2c</span>
00232 <span class="comment">         */</span>
00233         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o6">srp_success</a> = 0;
00234         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o7">srp_timer_started</a> = 0;
00235 
00236         <span class="comment">/*</span>
00237 <span class="comment">         * Create new workqueue and init works</span>
00238 <span class="comment">         */</span>
00239         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a> = DWC_WORKQ_ALLOC(<span class="stringliteral">"dwc_otg"</span>);
00240         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a> == 0) {
00241                 DWC_WARN(<span class="stringliteral">"DWC_WORKQ_ALLOC failed\n"</span>);
00242                 DWC_FREE(host_if);
00243                 DWC_FREE(dev_if);
00244                 DWC_FREE(core_if);
00245                 <span class="keywordflow">return</span> 0;
00246         }
00247 
00248         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o16">gsnpsid</a>);
00249 
00250         DWC_PRINTF(<span class="stringliteral">"Core Release: %x.%x%x%x\n"</span>,
00251                    (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &gt;&gt; 12 &amp; 0xF),
00252                    (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &gt;&gt; 8 &amp; 0xF),
00253                    (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &gt;&gt; 4 &amp; 0xF), (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &amp; 0xF));
00254 
00255         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o34">wkp_timer</a> = DWC_TIMER_ALLOC(<span class="stringliteral">"Wake Up Timer"</span>,
00256                                              <a class="code" href="dwc__otg__cil_8h.html#a62">w_wakeup_detected</a>, core_if);
00257         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o34">wkp_timer</a> == 0) {
00258                 DWC_WARN(<span class="stringliteral">"DWC_TIMER_ALLOC failed\n"</span>);
00259                 DWC_FREE(host_if);
00260                 DWC_FREE(dev_if);
00261                 DWC_WORKQ_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a>);
00262                 DWC_FREE(core_if);
00263                 <span class="keywordflow">return</span> 0;
00264         }
00265 
00266         <span class="keywordflow">if</span> (dwc_otg_setup_params(core_if)) {
00267                 DWC_WARN(<span class="stringliteral">"Error while setting core params\n"</span>);
00268         }
00269 
00270         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> = 0;
00271 
00273         dwc_otg_adp_init(core_if);
00274         
00275         <span class="keywordflow">return</span> core_if;
00276 }
00277 
<a name="l00285"></a><a class="code" href="dwc__otg__core__if_8h.html#a63">00285</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a63">dwc_otg_cil_remove</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00286 {
00287         <span class="comment">/* Disable all interrupts */</span>
00288         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, 1, 0);
00289         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, 0);
00290 
00291         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a>) {
00292                 DWC_WORKQ_WAIT_WORK_DONE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a>, 500);
00293                 DWC_WORKQ_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o33">wq_otg</a>);
00294         }
00295         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>) {
00296                 DWC_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>);
00297         }
00298         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>) {
00299                 DWC_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>);
00300         }
00301 
00303         dwc_otg_adp_remove(core_if);
00304         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>) {
00305                 DWC_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>);
00306         }
00307         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o34">wkp_timer</a>) {
00308                 DWC_TIMER_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o34">wkp_timer</a>);
00309         }
00310         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o8">srp_timer</a>) {
00311                 DWC_TIMER_FREE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o8">srp_timer</a>);
00312         }
00313         DWC_FREE(core_if);
00314 }
00315 
<a name="l00322"></a><a class="code" href="dwc__otg__core__if_8h.html#a64">00322</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a64">dwc_otg_enable_global_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00323 {
00324         <a class="code" href="uniongahbcfg__data.html">gahbcfg_data_t</a> ahbcfg = {.d32 = 0 };
00325         ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o1">glblintrmsk</a> = 1;       <span class="comment">/* Enable interrupts */</span>
00326         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, 0, ahbcfg.<a class="code" href="uniongahbcfg__data.html#o0">d32</a>);
00327 }
00328 
<a name="l00335"></a><a class="code" href="dwc__otg__core__if_8h.html#a65">00335</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a65">dwc_otg_disable_global_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00336 {
00337         <a class="code" href="uniongahbcfg__data.html">gahbcfg_data_t</a> ahbcfg = {.<a class="code" href="uniongahbcfg__data.html#o0">d32</a> = 0 };
00338         ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o1">glblintrmsk</a> = 1;       <span class="comment">/* Disable interrupts */</span>
00339         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, ahbcfg.<a class="code" href="uniongahbcfg__data.html#o0">d32</a>, 0);
00340 }
00341 
<a name="l00349"></a><a class="code" href="dwc__otg__cil_8c.html#a6">00349</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a6">dwc_otg_enable_common_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00350 {
00351         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
00352         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.d32 = 0 };
00353 
00354         <span class="comment">/* Clear any pending OTG Interrupts */</span>
00355         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o1">gotgint</a>, 0xFFFFFFFF);
00356 
00357         <span class="comment">/* Clear any pending interrupts */</span>
00358         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00359 
00360         <span class="comment">/*</span>
00361 <span class="comment">         * Enable the interrupts in the GINTMSK.</span>
00362 <span class="comment">         */</span>
00363         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o2">modemismatch</a> = 1;
00364         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o3">otgintr</a> = 1;
00365 
00366         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
00367                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o5">rxstsqlvl</a> = 1;
00368         }
00369 
00370         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o29">conidstschng</a> = 1;
00371         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o32">wkupintr</a> = 1;
00372         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o30">disconnect</a> = 0;
00373         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o12">usbsuspend</a> = 1;
00374         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o31">sessreqintr</a> = 1;
00375 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
00376 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o32">lpm_enable</a>) {
00377                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o28">lpmtranrcvd</a> = 1;
00378         }
00379 <span class="preprocessor">#endif</span>
00380 <span class="preprocessor"></span>        DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
00381 }
00382 
00383 <span class="comment">/*</span>
00384 <span class="comment"> * The restore operation is modified to support Synopsys Emulated Powerdown and</span>
00385 <span class="comment"> * Hibernation. This function is for exiting from Device mode hibernation by</span>
00386 <span class="comment"> * Host Initiated Resume/Reset and Device Initiated Remote-Wakeup.</span>
00387 <span class="comment"> * @param core_if Programming view of DWC_otg controller.</span>
00388 <span class="comment"> * @param rem_wakeup - indicates whether resume is initiated by Device or Host.</span>
00389 <span class="comment"> * @param reset - indicates whether resume is initiated by Reset.</span>
00390 <span class="comment"> */</span>
00391 <span class="keywordtype">int</span> dwc_otg_device_hibernation_restore(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
00392                                        <span class="keywordtype">int</span> rem_wakeup, <span class="keywordtype">int</span> reset)
00393 {
00394         <a class="code" href="uniongpwrdn__data.html">gpwrdn_data_t</a> gpwrdn = {.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = 0 };
00395         <a class="code" href="unionpcgcctl__data.html">pcgcctl_data_t</a> pcgcctl = {.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = 0 };
00396         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = 0 };
00397 
00398         <span class="keywordtype">int</span> timeout = 2000;
00399 
00400         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a>) {
00401                 DWC_PRINTF(<span class="stringliteral">"Already exited from Hibernation\n"</span>);
00402                 <span class="keywordflow">return</span> 1;
00403         }
00404 
00405         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(DBG_PCD, <span class="stringliteral">"%s called\n"</span>, __FUNCTION__);
00406         <span class="comment">/* Switch-on voltage to the core */</span>
00407         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o6">pwrdnswtch</a> = 1;
00408         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00409         dwc_udelay(10);
00410 
00411         <span class="comment">/* Reset core */</span>
00412         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00413         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o5">pwrdnrstn</a> = 1;
00414         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00415         dwc_udelay(10);
00416 
00417         <span class="comment">/* Assert Restore signal */</span>
00418         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00419         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o3">restore</a> = 1;
00420         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, 0, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>);
00421         dwc_udelay(10);
00422 
00423         <span class="comment">/* Disable power clamps */</span>
00424         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00425         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o4">pwrdnclmp</a> = 1;
00426         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00427 
00428         <span class="keywordflow">if</span> (rem_wakeup) {
00429                 dwc_udelay(70);
00430         }
00431 
00432         <span class="comment">/* Deassert Reset core */</span>
00433         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00434         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o5">pwrdnrstn</a> = 1;
00435         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, 0, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>);
00436         dwc_udelay(10);
00437 
00438         <span class="comment">/* Disable PMU interrupt */</span>
00439         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00440         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o1">pmuintsel</a> = 1;
00441         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00442 
00443         <span class="comment">/* Mask interrupts from gpwrdn */</span>
00444         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00445         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o15">connect_det_msk</a> = 1;
00446         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o17">srp_det_msk</a> = 1;
00447         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o13">disconn_det_msk</a> = 1;
00448         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o11">rst_det_msk</a> = 1;
00449         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o9">lnstchng_msk</a> = 1;
00450         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00451 
00452         <span class="comment">/* Indicates that we are going out from hibernation */</span>
00453         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> = 0;
00454 
00455         <span class="comment">/*</span>
00456 <span class="comment">         * Set Restore Essential Regs bit in PCGCCTL register, restore_mode = 1</span>
00457 <span class="comment">         * indicates restore from remote_wakeup</span>
00458 <span class="comment">         */</span>
00459         restore_essential_regs(core_if, rem_wakeup, 0);
00460 
00461         <span class="comment">/*</span>
00462 <span class="comment">         * Wait a little for seeing new value of variable hibernation_suspend if</span>
00463 <span class="comment">         * Restore done interrupt received before polling</span>
00464 <span class="comment">         */</span>
00465         dwc_udelay(10);
00466 
00467         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> == 0) {
00468                 <span class="comment">/*</span>
00469 <span class="comment">                 * Wait For Restore_done Interrupt. This mechanism of polling the </span>
00470 <span class="comment">                 * interrupt is introduced to avoid any possible race conditions</span>
00471 <span class="comment">                 */</span>
00472                 <span class="keywordflow">do</span> {
00473                         <a class="code" href="uniongintsts__data.html">gintsts_data_t</a> gintsts;
00474                         gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> =
00475                             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>);
00476                         <span class="keywordflow">if</span> (gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o17">restoredone</a>) {
00477                                 gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> = 0;
00478                                 gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o17">restoredone</a> = 1;
00479                                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;
00480                                                 gintsts, gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a>);
00481                                 DWC_PRINTF(<span class="stringliteral">"Restore Done Interrupt seen\n"</span>);
00482                                 <span class="keywordflow">break</span>;
00483                         }
00484                         dwc_udelay(10);
00485                 } <span class="keywordflow">while</span> (--timeout);
00486                 <span class="keywordflow">if</span> (!timeout) {
00487                         DWC_PRINTF(<span class="stringliteral">"Restore Done interrupt wasn't generated here\n"</span>);
00488                 }
00489         }
00490         <span class="comment">/* Clear all pending interupts */</span>
00491         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00492 
00493         <span class="comment">/* De-assert Restore */</span>
00494         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00495         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o3">restore</a> = 1;
00496         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00497         dwc_udelay(10);
00498 
00499         <span class="keywordflow">if</span> (!rem_wakeup) {
00500                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = 0;
00501                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o21">b</a>.<a class="code" href="unionpcgcctl__data.html#o4">rstpdwnmodule</a> = 1;
00502                 DWC_MODIFY_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a>, 0);
00503         }
00504 
00505         <span class="comment">/* Restore GUSBCFG and DCFG */</span>
00506         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>,
00507                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>-&gt;gusbcfg_local);
00508         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>,
00509                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o26">dcfg</a>);
00510 
00511         <span class="comment">/* De-assert Wakeup Logic */</span>
00512         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00513         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o2">pmuactv</a> = 1;
00514         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00515         dwc_udelay(10);
00516 
00517         <span class="keywordflow">if</span> (!rem_wakeup) {
00518                 <span class="comment">/* Set Device programming done bit */</span>
00519                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o10">pwronprgdone</a> = 1;
00520                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, 0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
00521         } <span class="keywordflow">else</span> {
00522                 <span class="comment">/* Start Remote Wakeup Signaling */</span>
00523                 dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a>-&gt;dctl;
00524                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o1">rmtwkupsig</a> = 1;
00525                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
00526         }
00527 
00528         dwc_mdelay(2);
00529         <span class="comment">/* Clear all pending interupts */</span>
00530         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00531 
00532         <span class="comment">/* Restore global registers */</span>
00533         <a class="code" href="dwc__otg__cil_8h.html#a66">dwc_otg_restore_global_regs</a>(core_if);
00534         <span class="comment">/* Restore device global registers */</span>
00535         <a class="code" href="dwc__otg__cil_8h.html#a68">dwc_otg_restore_dev_regs</a>(core_if, rem_wakeup);
00536 
00537         <span class="keywordflow">if</span> (rem_wakeup) {
00538                 dwc_mdelay(7);
00539                 dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = 0;
00540                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o1">rmtwkupsig</a> = 1;
00541                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>, 0);
00542         }
00543 
00544         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> = 0;
00545         <span class="comment">/* The core will be in ON STATE */</span>
00546         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o38">lx_state</a> = DWC_OTG_L0;
00547         DWC_PRINTF(<span class="stringliteral">"Hibernation recovery completes here\n"</span>);
00548 
00549         <span class="keywordflow">return</span> 1;
00550 }
00551 
00552 <span class="comment">/*</span>
00553 <span class="comment"> * The restore operation is modified to support Synopsys Emulated Powerdown and</span>
00554 <span class="comment"> * Hibernation. This function is for exiting from Host mode hibernation by</span>
00555 <span class="comment"> * Host Initiated Resume/Reset and Device Initiated Remote-Wakeup.</span>
00556 <span class="comment"> * @param core_if Programming view of DWC_otg controller.</span>
00557 <span class="comment"> * @param rem_wakeup - indicates whether resume is initiated by Device or Host.</span>
00558 <span class="comment"> * @param reset - indicates whether resume is initiated by Reset.</span>
00559 <span class="comment"> */</span>
00560 <span class="keywordtype">int</span> dwc_otg_host_hibernation_restore(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
00561                                      <span class="keywordtype">int</span> rem_wakeup, <span class="keywordtype">int</span> reset)
00562 {
00563         <a class="code" href="uniongpwrdn__data.html">gpwrdn_data_t</a> gpwrdn = {.d32 = 0 };
00564         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0 = {.d32 = 0 };
00565 
00566         <span class="keywordtype">int</span> timeout = 2000;
00567 
00568         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(DBG_HCD, <span class="stringliteral">"%s called\n"</span>, __FUNCTION__);
00569         <span class="comment">/* Switch-on voltage to the core */</span>
00570         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o6">pwrdnswtch</a> = 1;
00571         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00572         dwc_udelay(10);
00573 
00574         <span class="comment">/* Reset core */</span>
00575         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00576         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o5">pwrdnrstn</a> = 1;
00577         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00578         dwc_udelay(10);
00579 
00580         <span class="comment">/* Assert Restore signal */</span>
00581         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00582         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o3">restore</a> = 1;
00583         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, 0, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>);
00584         dwc_udelay(10);
00585 
00586         <span class="comment">/* Disable power clamps */</span>
00587         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00588         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o4">pwrdnclmp</a> = 1;
00589         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00590 
00591         <span class="keywordflow">if</span> (!rem_wakeup) {
00592                 dwc_udelay(50);
00593         }
00594 
00595         <span class="comment">/* Deassert Reset core */</span>
00596         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00597         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o5">pwrdnrstn</a> = 1;
00598         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, 0, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>);
00599         dwc_udelay(10);
00600 
00601         <span class="comment">/* Disable PMU interrupt */</span>
00602         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00603         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o1">pmuintsel</a> = 1;
00604         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00605 
00606         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00607         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o15">connect_det_msk</a> = 1;
00608         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o17">srp_det_msk</a> = 1;
00609         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o13">disconn_det_msk</a> = 1;
00610         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o11">rst_det_msk</a> = 1;
00611         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o9">lnstchng_msk</a> = 1;
00612         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00613 
00614         <span class="comment">/* Indicates that we are going out from hibernation */</span>
00615         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> = 0;
00616 
00617         <span class="comment">/* Set Restore Essential Regs bit in PCGCCTL register */</span>
00618         restore_essential_regs(core_if, rem_wakeup, 1);
00619 
00620         <span class="comment">/* Wait a little for seeing new value of variable hibernation_suspend if</span>
00621 <span class="comment">         * Restore done interrupt received before polling */</span>
00622         dwc_udelay(10);
00623 
00624         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> == 0) {
00625                 <span class="comment">/* Wait For Restore_done Interrupt. This mechanism of polling the</span>
00626 <span class="comment">                 * interrupt is introduced to avoid any possible race conditions</span>
00627 <span class="comment">                 */</span>
00628                 <span class="keywordflow">do</span> {
00629                         <a class="code" href="uniongintsts__data.html">gintsts_data_t</a> gintsts;
00630                         gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>);
00631                         <span class="keywordflow">if</span> (gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o17">restoredone</a>) {
00632                                 gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> = 0;
00633                                 gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o17">restoredone</a> = 1;
00634                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a>);
00635                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(DBG_HCD,<span class="stringliteral">"Restore Done Interrupt seen\n"</span>);   
00636                                 <span class="keywordflow">break</span>;
00637                         }
00638                         dwc_udelay(10);
00639                 } <span class="keywordflow">while</span> (--timeout);
00640                 <span class="keywordflow">if</span> (!timeout) {
00641                         DWC_WARN(<span class="stringliteral">"Restore Done interrupt wasn't generated\n"</span>);
00642                 }
00643         }
00644 
00645         <span class="comment">/* Set the flag's value to 0 again after receiving restore done interrupt */</span>
00646         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a> = 0;
00647 
00648         <span class="comment">/* This step is not described in functional spec but if not wait for this</span>
00649 <span class="comment">         * delay, mismatch interrupts occurred because just after restore core is</span>
00650 <span class="comment">         * in Device mode(gintsts.curmode == 0) */</span>
00651         dwc_mdelay(100);
00652 
00653         <span class="comment">/* Clear all pending interrupts */</span>
00654         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00655 
00656         <span class="comment">/* De-assert Restore */</span>
00657         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00658         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o3">restore</a> = 1;
00659         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00660         dwc_udelay(10);
00661 
00662         <span class="comment">/* Restore GUSBCFG and HCFG */</span>
00663         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>,
00664                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>-&gt;gusbcfg_local);
00665         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>,
00666                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>-&gt;hcfg_local);
00667 
00668         <span class="comment">/* De-assert Wakeup Logic */</span>
00669         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a> = 0;
00670         gpwrdn.<a class="code" href="uniongpwrdn__data.html#o26">b</a>.<a class="code" href="uniongpwrdn__data.html#o2">pmuactv</a> = 1;
00671         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>, gpwrdn.<a class="code" href="uniongpwrdn__data.html#o0">d32</a>, 0);
00672         dwc_udelay(10);
00673 
00674         <span class="comment">/* Start the Resume operation by programming HPRT0 */</span>
00675         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>-&gt;hprt0_local;
00676         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> = 1;
00677         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o3">prtena</a> = 0;
00678         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o8">prtsusp</a> = 0;
00679         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00680 
00681         DWC_PRINTF(<span class="stringliteral">"Resume Starts Now\n"</span>);
00682         <span class="keywordflow">if</span> (!reset) {           <span class="comment">// Indicates it is Resume Operation</span>
00683                 hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>-&gt;hprt0_local;
00684                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o7">prtres</a> = 1;
00685                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> = 1;
00686                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o3">prtena</a> = 0;
00687                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o8">prtsusp</a> = 0;
00688                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00689 
00690                 <span class="keywordflow">if</span> (!rem_wakeup)
00691                         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o7">prtres</a> = 0;
00692                 <span class="comment">/* Wait for Resume time and then program HPRT again */</span>
00693                 dwc_mdelay(100);
00694                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00695 
00696         } <span class="keywordflow">else</span> {                <span class="comment">// Indicates it is Reset Operation</span>
00697                 hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>-&gt;hprt0_local;
00698                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o9">prtrst</a> = 1;
00699                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> = 1;
00700                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o3">prtena</a> = 0;
00701                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o8">prtsusp</a> = 0;
00702                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00703                 <span class="comment">/* Wait for Reset time and then program HPRT again */</span>
00704                 dwc_mdelay(60);
00705                 hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o9">prtrst</a> = 0;
00706                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00707         }
00708         <span class="comment">/* Clear all interrupt status */</span>
00709         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(core_if);
00710         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o2">prtconndet</a> = 1;
00711         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o4">prtenchng</a> = 1;
00712         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
00713 
00714         <span class="comment">/* Clear all pending interupts */</span>
00715         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00716 
00717         <span class="comment">/* Restore global registers */</span>
00718         <a class="code" href="dwc__otg__cil_8h.html#a66">dwc_otg_restore_global_regs</a>(core_if);
00719         <span class="comment">/* Restore host global registers */</span>
00720         <a class="code" href="dwc__otg__cil_8h.html#a67">dwc_otg_restore_host_regs</a>(core_if, reset);
00721 
00722         <span class="comment">/* The core will be in ON STATE */</span>
00723         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o38">lx_state</a> = DWC_OTG_L0;
00724         DWC_PRINTF(<span class="stringliteral">"Hibernation recovery is complete here\n"</span>);
00725         <span class="keywordflow">return</span> 0;
00726 }
00727 
<a name="l00729"></a><a class="code" href="dwc__otg__cil_8h.html#a63">00729</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a63">dwc_otg_save_global_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00730 {
00731         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr;
00732         <span class="keywordtype">int</span> i;
00733 
00734         gr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>;
00735         <span class="keywordflow">if</span> (!gr) {
00736                 gr = DWC_ALLOC(<span class="keyword">sizeof</span>(*gr));
00737                 <span class="keywordflow">if</span> (!gr) {
00738                         <span class="keywordflow">return</span> -DWC_E_NO_MEMORY;
00739                 }
00740                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a> = gr;
00741         }
00742 
00743         gr-&gt;gotgctl_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
00744         gr-&gt;gintmsk_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>);
00745         gr-&gt;gahbcfg_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>);
00746         gr-&gt;gusbcfg_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
00747         gr-&gt;grxfsiz_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
00748         gr-&gt;gnptxfsiz_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>);
00749         gr-&gt;hptxfsiz_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>);
00750 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
00751 <span class="preprocessor"></span>        gr-&gt;glpmcfg_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
00752 <span class="preprocessor">#endif</span>
00753 <span class="preprocessor"></span>        gr-&gt;gi2cctl_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>);
00754         gr-&gt;pcgcctl_local = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>);
00755         gr-&gt;gdfifocfg_local =
00756             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>);
00757         <span class="keywordflow">for</span> (i = 0; i &lt; MAX_EPS_CHANNELS; i++) {
00758                 gr-&gt;dtxfsiz_local[i] =
00759                     DWC_READ_REG32(&amp;(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i]));
00760         }
00761 
00762         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"===========Backing Global registers==========\n"</span>);
00763         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gotgctl   = %08x\n"</span>, gr-&gt;gotgctl_local);
00764         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gintmsk   = %08x\n"</span>, gr-&gt;gintmsk_local);
00765         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gahbcfg   = %08x\n"</span>, gr-&gt;gahbcfg_local);
00766         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gusbcfg   = %08x\n"</span>, gr-&gt;gusbcfg_local);
00767         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up grxfsiz   = %08x\n"</span>, gr-&gt;grxfsiz_local);
00768         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gnptxfsiz = %08x\n"</span>,
00769                     gr-&gt;gnptxfsiz_local);
00770         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up hptxfsiz  = %08x\n"</span>,
00771                     gr-&gt;hptxfsiz_local);
00772 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
00773 <span class="preprocessor"></span>        <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up glpmcfg   = %08x\n"</span>, gr-&gt;glpmcfg_local);
00774 <span class="preprocessor">#endif</span>
00775 <span class="preprocessor"></span>        <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gi2cctl   = %08x\n"</span>, gr-&gt;gi2cctl_local);
00776         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up pcgcctl   = %08x\n"</span>, gr-&gt;pcgcctl_local);
00777         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>,<span class="stringliteral">"Backed up gdfifocfg   = %08x\n"</span>,gr-&gt;gdfifocfg_local);
00778 
00779         <span class="keywordflow">return</span> 0;
00780 }
00781 
<a name="l00783"></a><a class="code" href="dwc__otg__cil_8c.html#a10">00783</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8c.html#a10">dwc_otg_save_gintmsk_reg</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00784 {
00785         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr;
00786 
00787         gr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>;
00788         <span class="keywordflow">if</span> (!gr) {
00789                 gr = DWC_ALLOC(<span class="keyword">sizeof</span>(*gr));
00790                 <span class="keywordflow">if</span> (!gr) {
00791                         <span class="keywordflow">return</span> -DWC_E_NO_MEMORY;
00792                 }
00793                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a> = gr;
00794         }
00795 
00796         gr-&gt;gintmsk_local = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>);
00797 
00798         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>,<span class="stringliteral">"=============Backing GINTMSK registers============\n"</span>);
00799         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up gintmsk   = %08x\n"</span>, gr-&gt;gintmsk_local);
00800 
00801         <span class="keywordflow">return</span> 0;
00802 }
00803 
<a name="l00804"></a><a class="code" href="dwc__otg__cil_8h.html#a64">00804</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a64">dwc_otg_save_dev_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00805 {
00806         <span class="keyword">struct </span>dwc_otg_dev_regs_backup *dr;
00807         <span class="keywordtype">int</span> i;
00808 
00809         dr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a>;
00810         <span class="keywordflow">if</span> (!dr) {
00811                 dr = DWC_ALLOC(<span class="keyword">sizeof</span>(*dr));
00812                 <span class="keywordflow">if</span> (!dr) {
00813                         <span class="keywordflow">return</span> -DWC_E_NO_MEMORY;
00814                 }
00815                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a> = dr;
00816         }
00817 
00818         dr-&gt;<a class="code" href="structdwc__otg__core__if.html#o26">dcfg</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
00819         dr-&gt;dctl = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>);
00820         dr-&gt;daintmsk =
00821             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>);
00822         dr-&gt;diepmsk =
00823             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>);
00824         dr-&gt;doepmsk =
00825             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>);
00826 
00827         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; ++i) {
00828                 dr-&gt;diepctl[i] =
00829                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
00830                 dr-&gt;dieptsiz[i] =
00831                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>);
00832                 dr-&gt;diepdma[i] =
00833                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>);
00834         }
00835 
00836         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>,
00837                     <span class="stringliteral">"=============Backing Host registers==============\n"</span>);
00838         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up dcfg            = %08x\n"</span>, dr-&gt;dcfg);
00839         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up dctl        = %08x\n"</span>, dr-&gt;dctl);
00840         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up daintmsk            = %08x\n"</span>,
00841                     dr-&gt;daintmsk);
00842         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up diepmsk        = %08x\n"</span>, dr-&gt;diepmsk);
00843         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up doepmsk        = %08x\n"</span>, dr-&gt;doepmsk);
00844         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; ++i) {
00845                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up diepctl[%d]        = %08x\n"</span>, i,
00846                             dr-&gt;diepctl[i]);
00847                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up dieptsiz[%d]        = %08x\n"</span>,
00848                             i, dr-&gt;dieptsiz[i]);
00849                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up diepdma[%d]        = %08x\n"</span>, i,
00850                             dr-&gt;diepdma[i]);
00851         }
00852 
00853         <span class="keywordflow">return</span> 0;
00854 }
00855 
<a name="l00856"></a><a class="code" href="dwc__otg__cil_8h.html#a65">00856</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a65">dwc_otg_save_host_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00857 {
00858         <span class="keyword">struct </span>dwc_otg_host_regs_backup *hr;
00859         <span class="keywordtype">int</span> i;
00860 
00861         hr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>;
00862         <span class="keywordflow">if</span> (!hr) {
00863                 hr = DWC_ALLOC(<span class="keyword">sizeof</span>(*hr));
00864                 <span class="keywordflow">if</span> (!hr) {
00865                         <span class="keywordflow">return</span> -DWC_E_NO_MEMORY;
00866                 }
00867                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a> = hr;
00868         }
00869 
00870         hr-&gt;hcfg_local =
00871             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
00872         hr-&gt;haintmsk_local =
00873             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o6">haintmsk</a>);
00874         <span class="keywordflow">for</span> (i = 0; i &lt; dwc_otg_get_param_host_channels(core_if); ++i) {
00875                 hr-&gt;hcintmsk_local[i] =
00876                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>);
00877         }
00878         hr-&gt;hprt0_local = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
00879         hr-&gt;hfir_local =
00880             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>);
00881 
00882         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>,
00883                     <span class="stringliteral">"=============Backing Host registers===============\n"</span>);
00884         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up hcfg            = %08x\n"</span>,
00885                     hr-&gt;hcfg_local);
00886         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up haintmsk = %08x\n"</span>, hr-&gt;haintmsk_local);
00887         <span class="keywordflow">for</span> (i = 0; i &lt; dwc_otg_get_param_host_channels(core_if); ++i) {
00888                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up hcintmsk[%02d]=%08x\n"</span>, i,
00889                             hr-&gt;hcintmsk_local[i]);
00890         }
00891         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up hprt0           = %08x\n"</span>,
00892                     hr-&gt;hprt0_local);
00893         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Backed up hfir           = %08x\n"</span>,
00894                     hr-&gt;hfir_local);
00895 
00896         <span class="keywordflow">return</span> 0;
00897 }
00898 
<a name="l00899"></a><a class="code" href="dwc__otg__cil_8h.html#a66">00899</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a66">dwc_otg_restore_global_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *core_if)
00900 {
00901         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr;
00902         <span class="keywordtype">int</span> i;
00903 
00904         gr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>;
00905         <span class="keywordflow">if</span> (!gr) {
00906                 <span class="keywordflow">return</span> -DWC_E_INVALID;
00907         }
00908    
00909         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, gr-&gt;gotgctl_local);
00910         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, gr-&gt;gintmsk_local);
00911         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, gr-&gt;gusbcfg_local);
00912         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, gr-&gt;gahbcfg_local);
00913         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>, gr-&gt;grxfsiz_local);
00914         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>,
00915                         gr-&gt;gnptxfsiz_local);
00916         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>,
00917                         gr-&gt;hptxfsiz_local);
00918         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>,
00919                         gr-&gt;gdfifocfg_local);
00920         <span class="keywordflow">for</span> (i = 0; i &lt; MAX_EPS_CHANNELS; i++) {
00921                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i],
00922                                 gr-&gt;dtxfsiz_local[i]);
00923         }
00924 
00925         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
00926         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, 0x0000100A);
00927         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>,
00928                         (gr-&gt;gahbcfg_local));
00929         <span class="keywordflow">return</span> 0;
00930 }
00931 
<a name="l00932"></a><a class="code" href="dwc__otg__cil_8h.html#a68">00932</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a68">dwc_otg_restore_dev_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keywordtype">int</span> rem_wakeup)
00933 {
00934         <span class="keyword">struct </span>dwc_otg_dev_regs_backup *dr;
00935         <span class="keywordtype">int</span> i;
00936 
00937         dr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a>;
00938 
00939         <span class="keywordflow">if</span> (!dr) {
00940                 <span class="keywordflow">return</span> -DWC_E_INVALID;
00941         }
00942 
00943         <span class="keywordflow">if</span> (!rem_wakeup)
00944         {
00945                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>);
00946         }
00947         
00948         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>);
00949         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>);
00950         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>);
00951 
00952         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; ++i) {
00953                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>[i]);
00954                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>[i]);
00955                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>, dr-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>[i]);
00956         }
00957         
00958         <span class="keywordflow">return</span> 0;
00959 }
00960 
<a name="l00961"></a><a class="code" href="dwc__otg__cil_8h.html#a67">00961</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a67">dwc_otg_restore_host_regs</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keywordtype">int</span> reset)
00962 {
00963         <span class="keyword">struct </span>dwc_otg_host_regs_backup *hr;
00964         <span class="keywordtype">int</span> i;
00965         hr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>;
00966 
00967         <span class="keywordflow">if</span> (!hr) {
00968                 <span class="keywordflow">return</span> -DWC_E_INVALID;
00969         }
00970 
00971         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>, hr-&gt;hcfg_local);
00972         <span class="comment">//if (!reset)</span>
00973         <span class="comment">//{</span>
00974         <span class="comment">//      DWC_WRITE_REG32(&amp;core_if-&gt;host_if-&gt;host_global_regs-&gt;hfir, hr-&gt;hfir_local);</span>
00975         <span class="comment">//}</span>
00976 
00977         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o6">haintmsk</a>,
00978                         hr-&gt;haintmsk_local);
00979         <span class="keywordflow">for</span> (i = 0; i &lt; dwc_otg_get_param_host_channels(core_if); ++i) {
00980                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>,
00981                                 hr-&gt;hcintmsk_local[i]);
00982         }
00983 
00984         <span class="keywordflow">return</span> 0;
00985 }
00986 
00987 <span class="keywordtype">int</span> restore_lpm_i2c_regs(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
00988 {
00989         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr;
00990 
00991         gr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>;
00992 
00993         <span class="comment">/* Restore values for LPM and I2C */</span>
00994 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
00995 <span class="preprocessor"></span>        DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>, gr-&gt;glpmcfg_local);
00996 <span class="preprocessor">#endif</span>
00997 <span class="preprocessor"></span>        DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>, gr-&gt;gi2cctl_local);
00998 
00999         <span class="keywordflow">return</span> 0;
01000 }
01001 
01002 <span class="keywordtype">int</span> restore_essential_regs(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keywordtype">int</span> rmode, <span class="keywordtype">int</span> is_host)
01003 {
01004         <span class="keyword">struct </span>dwc_otg_global_regs_backup *gr;
01005         <a class="code" href="unionpcgcctl__data.html">pcgcctl_data_t</a> pcgcctl = {.d32 = 0 };
01006         <a class="code" href="uniongahbcfg__data.html">gahbcfg_data_t</a> gahbcfg = {.d32 = 0 };
01007         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> gusbcfg = {.d32 = 0 };
01008         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> gintmsk = {.d32 = 0 };
01009 
01010         <span class="comment">/* Restore LPM and I2C registers */</span>
01011         restore_lpm_i2c_regs(core_if);
01012 
01013         <span class="comment">/* Set PCGCCTL to 0 */</span>
01014         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, 0x00000000);
01015 
01016         gr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>;
01017         <span class="comment">/* Load restore values for [31:14] bits */</span>
01018         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>,
01019                         ((gr-&gt;pcgcctl_local &amp; 0xffffc000) | 0x00020000));
01020 
01021         <span class="comment">/* Umnask global Interrupt in GAHBCFG and restore it */</span>
01022         gahbcfg.<a class="code" href="uniongahbcfg__data.html#o0">d32</a> = gr-&gt;gahbcfg_local;
01023         gahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o1">glblintrmsk</a> = 1;
01024         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, gahbcfg.<a class="code" href="uniongahbcfg__data.html#o0">d32</a>);
01025 
01026         <span class="comment">/* Clear all pending interupts */</span>
01027         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
01028 
01029         <span class="comment">/* Unmask restore done interrupt */</span>
01030         gintmsk.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o17">restoredone</a> = 1;
01031         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, gintmsk.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
01032 
01033         <span class="comment">/* Restore GUSBCFG and HCFG/DCFG */</span>
01034         gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o39">gr_backup</a>-&gt;gusbcfg_local;
01035         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01036 
01037         <span class="keywordflow">if</span> (is_host) {
01038                 <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg = {.d32 = 0 };
01039                 hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o40">hr_backup</a>-&gt;hcfg_local;
01040                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>,
01041                                 hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
01042 
01043                 <span class="comment">/* Load restore values for [31:14] bits */</span>
01044                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local &amp; 0xffffc000;
01045                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local | 0x00020000;
01046 
01047                 <span class="keywordflow">if</span> (rmode)
01048                         pcgcctl.<a class="code" href="unionpcgcctl__data.html#o21">b</a>.<a class="code" href="unionpcgcctl__data.html#o10">restoremode</a> = 1;
01049                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a>);
01050                 dwc_udelay(10);
01051 
01052                 <span class="comment">/* Load restore values for [31:14] bits and set EssRegRestored bit */</span>
01053                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local | 0xffffc000;
01054                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local &amp; 0xffffc000;
01055                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o21">b</a>.<a class="code" href="unionpcgcctl__data.html#o12">ess_reg_restored</a> = 1;
01056                 <span class="keywordflow">if</span> (rmode)
01057                         pcgcctl.<a class="code" href="unionpcgcctl__data.html#o21">b</a>.<a class="code" href="unionpcgcctl__data.html#o10">restoremode</a> = 1;
01058                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a>);
01059         } <span class="keywordflow">else</span> {
01060                 <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg = {.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = 0 };
01061                 dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o41">dr_backup</a>-&gt;<a class="code" href="structdwc__otg__core__if.html#o26">dcfg</a>;
01062                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
01063 
01064                 <span class="comment">/* Load restore values for [31:14] bits */</span>
01065                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local &amp; 0xffffc000;
01066                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local | 0x00020000;
01067                 <span class="keywordflow">if</span> (!rmode) {
01068                         pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> |= 0x208;
01069                 }
01070                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a>);
01071                 dwc_udelay(10);
01072 
01073                 <span class="comment">/* Load restore values for [31:14] bits */</span>
01074                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local &amp; 0xffffc000;
01075                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> = gr-&gt;pcgcctl_local | 0x00020000;
01076                 pcgcctl.<a class="code" href="unionpcgcctl__data.html#o21">b</a>.<a class="code" href="unionpcgcctl__data.html#o12">ess_reg_restored</a> = 1;
01077                 <span class="keywordflow">if</span> (!rmode)
01078                         pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a> |= 0x208;
01079                 DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, pcgcctl.<a class="code" href="unionpcgcctl__data.html#o0">d32</a>);
01080         }
01081 
01082         <span class="keywordflow">return</span> 0;
01083 }
01084 
<a name="l01089"></a><a class="code" href="dwc__otg__cil_8c.html#a18">01089</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a18">init_fslspclksel</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01090 {
01091         uint32_t val;
01092         <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg;
01093 
01094         <span class="keywordflow">if</span> (((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 2) &amp;&amp;
01095              (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 1) &amp;&amp;
01096              (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o25">ulpi_fs_ls</a>)) ||
01097             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> == DWC_PHY_TYPE_PARAM_FS)) {
01098                 <span class="comment">/* Full speed PHY */</span>
01099                 val = DWC_HCFG_48_MHZ;
01100         } <span class="keywordflow">else</span> {
01101                 <span class="comment">/* High speed PHY running at full speed or high speed */</span>
01102                 val = DWC_HCFG_30_60_MHZ;
01103         }
01104 
01105         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Initializing HCFG.FSLSPClkSel to 0x%1x\n"</span>, val);
01106         hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
01107         hcfg.<a class="code" href="unionhcfg__data.html#o12">b</a>.<a class="code" href="unionhcfg__data.html#o1">fslspclksel</a> = val;
01108         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>, hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
01109 }
01110 
<a name="l01115"></a><a class="code" href="dwc__otg__cil_8c.html#a19">01115</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a19">init_devspd</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01116 {
01117         uint32_t val;
01118         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
01119 
01120         <span class="keywordflow">if</span> (((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 2) &amp;&amp;
01121              (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 1) &amp;&amp;
01122              (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o25">ulpi_fs_ls</a>)) ||
01123             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> == DWC_PHY_TYPE_PARAM_FS)) {
01124                 <span class="comment">/* Full speed PHY */</span>
01125                 val = 0x3;
01126         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a> == DWC_SPEED_PARAM_FULL) {
01127                 <span class="comment">/* High speed PHY running at full speed */</span>
01128                 val = 0x1;
01129         } <span class="keywordflow">else</span> {
01130                 <span class="comment">/* High speed PHY running at high speed */</span>
01131                 val = 0x0;
01132         }
01133 
01134         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Initializing DCFG.DevSpd to 0x%1x\n"</span>, val);
01135 
01136         dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
01137         dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o1">devspd</a> = val;
01138         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
01139 }
01140 
<a name="l01147"></a><a class="code" href="dwc__otg__cil_8c.html#a20">01147</a> <span class="keyword">static</span> uint32_t <a class="code" href="dwc__otg__cil_8c.html#a20">calc_num_in_eps</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01148 {
01149         uint32_t num_in_eps = 0;
01150         uint32_t num_eps = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o6">num_dev_ep</a>;
01151         uint32_t hwcfg1 = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o20">hwcfg1</a>.<a class="code" href="unionhwcfg1__data.html#o0">d32</a> &gt;&gt; 3;
01152         uint32_t num_tx_fifos = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o14">num_in_eps</a>;
01153         <span class="keywordtype">int</span> i;
01154 
01155         <span class="keywordflow">for</span> (i = 0; i &lt; num_eps; ++i) {
01156                 <span class="keywordflow">if</span> (!(hwcfg1 &amp; 0x1))
01157                         num_in_eps++;
01158 
01159                 hwcfg1 &gt;&gt;= 2;
01160         }
01161 
01162         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o13">ded_fifo_en</a>) {
01163                 num_in_eps =
01164                     (num_in_eps &gt; num_tx_fifos) ? num_tx_fifos : num_in_eps;
01165         }
01166 
01167         <span class="keywordflow">return</span> num_in_eps;
01168 }
01169 
<a name="l01176"></a><a class="code" href="dwc__otg__cil_8c.html#a21">01176</a> <span class="keyword">static</span> uint32_t <a class="code" href="dwc__otg__cil_8c.html#a21">calc_num_out_eps</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01177 {
01178         uint32_t num_out_eps = 0;
01179         uint32_t num_eps = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o6">num_dev_ep</a>;
01180         uint32_t hwcfg1 = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o20">hwcfg1</a>.<a class="code" href="unionhwcfg1__data.html#o0">d32</a> &gt;&gt; 2;
01181         <span class="keywordtype">int</span> i;
01182 
01183         <span class="keywordflow">for</span> (i = 0; i &lt; num_eps; ++i) {
01184                 <span class="keywordflow">if</span> (!(hwcfg1 &amp; 0x1))
01185                         num_out_eps++;
01186 
01187                 hwcfg1 &gt;&gt;= 2;
01188         }
01189         <span class="keywordflow">return</span> num_out_eps;
01190 }
01191 
<a name="l01199"></a><a class="code" href="dwc__otg__core__if_8h.html#a62">01199</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a62">dwc_otg_core_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01200 {
01201         <span class="keywordtype">int</span> i = 0;
01202         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
01203         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
01204         <a class="code" href="uniongahbcfg__data.html">gahbcfg_data_t</a> ahbcfg = {.d32 = 0 };
01205         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg = {.d32 = 0 };
01206         <a class="code" href="uniongi2cctl__data.html">gi2cctl_data_t</a> i2cctl = {.d32 = 0 };
01207 
01208         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"dwc_otg_core_init(%p)\n"</span>, core_if);
01209 
01210         <span class="comment">/* Common Initialization */</span>
01211         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01212 
01213         <span class="comment">/* Program the ULPI External VBUS bit if needed */</span>
01214         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o16">ulpi_ext_vbus_drv</a> =
01215             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o23">phy_ulpi_ext_vbus</a> ==
01216              DWC_PHY_ULPI_EXTERNAL_VBUS) ? 1 : 0;
01217 
01218         <span class="comment">/* Set external TS Dline pulsing */</span>
01219         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o18">term_sel_dl_pulse</a> =
01220             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o26">ts_dline</a> == 1) ? 1 : 0;
01221         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01222 
01223         <span class="comment">/* Reset the Controller */</span>
01224         <a class="code" href="dwc__otg__cil_8h.html#a106">dwc_otg_core_reset</a>(core_if);
01225 
01226         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o43">adp_enable</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o37">adp_supp_enable</a>;
01227         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o42">power_down</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o42">power_down</a>;
01228         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o47">otg_sts</a> = 0;
01229 
01230         <span class="comment">/* Initialize parameters from Hardware configuration registers. */</span>
01231         dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a> = <a class="code" href="dwc__otg__cil_8c.html#a20">calc_num_in_eps</a>(core_if);
01232         dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o5">num_out_eps</a> = <a class="code" href="dwc__otg__cil_8c.html#a21">calc_num_out_eps</a>(core_if);
01233 
01234         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"num_dev_perio_in_ep=%d\n"</span>,
01235                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o1">num_dev_perio_in_ep</a>);
01236 
01237         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o1">num_dev_perio_in_ep</a>; i++) {
01238                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o6">perio_tx_fifo_size</a>[i] =
01239                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i]) &gt;&gt; 16;
01240                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Periodic Tx FIFO SZ #%d=0x%0x\n"</span>,
01241                             i, dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o6">perio_tx_fifo_size</a>[i]);
01242         }
01243 
01244         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o14">num_in_eps</a>; i++) {
01245                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o7">tx_fifo_size</a>[i] =
01246                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i]) &gt;&gt; 16;
01247                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Tx FIFO SZ #%d=0x%0x\n"</span>,
01248                             i, dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o7">tx_fifo_size</a>[i]);
01249         }
01250 
01251         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o11">total_fifo_size</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o12">dfifo_depth</a>;
01252         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o12">rx_fifo_size</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
01253         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o13">nperio_tx_fifo_size</a> =
01254             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16;
01255 
01256         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Total FIFO SZ=%d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o11">total_fifo_size</a>);
01257         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Rx FIFO SZ=%d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o12">rx_fifo_size</a>);
01258         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"NP Tx FIFO SZ=%d\n"</span>,
01259                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o13">nperio_tx_fifo_size</a>);
01260 
01261         <span class="comment">/* This programming sequence needs to happen in FS mode before any other</span>
01262 <span class="comment">         * programming occurs */</span>
01263         <span class="keywordflow">if</span> ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a> == DWC_SPEED_PARAM_FULL) &amp;&amp;
01264             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> == DWC_PHY_TYPE_PARAM_FS)) {
01265                 <span class="comment">/* If FS mode with FS PHY */</span>
01266 
01267                 <span class="comment">/* core_init() is now called on every switch so only call the</span>
01268 <span class="comment">                 * following for the first time through. */</span>
01269                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o5">phy_init_done</a>) {
01270                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o5">phy_init_done</a> = 1;
01271                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"FS_PHY detected\n"</span>);
01272                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01273                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> = 1;
01274                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01275 
01276                         <span class="comment">/* Reset after a PHY select */</span>
01277                         <a class="code" href="dwc__otg__cil_8h.html#a106">dwc_otg_core_reset</a>(core_if);
01278                 }
01279 
01280                 <span class="comment">/* Program DCFG.DevSpd or HCFG.FSLSPclkSel to 48Mhz in FS.      Also</span>
01281 <span class="comment">                 * do this on HNP Dev/Host mode switches (done in dev_init and</span>
01282 <span class="comment">                 * host_init). */</span>
01283                 <span class="keywordflow">if</span> (dwc_otg_is_host_mode(core_if)) {
01284                         <a class="code" href="dwc__otg__cil_8c.html#a18">init_fslspclksel</a>(core_if);
01285                 } <span class="keywordflow">else</span> {
01286                         <a class="code" href="dwc__otg__cil_8c.html#a19">init_devspd</a>(core_if);
01287                 }
01288 
01289                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o24">i2c_enable</a>) {
01290                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"FS_PHY Enabling I2c\n"</span>);
01291                         <span class="comment">/* Program GUSBCFG.OtgUtmifsSel to I2C */</span>
01292                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01293                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o12">otgutmifssel</a> = 1;
01294                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01295 
01296                         <span class="comment">/* Program GI2CCTL.I2CEn */</span>
01297                         i2cctl.<a class="code" href="uniongi2cctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>);
01298                         i2cctl.<a class="code" href="uniongi2cctl__data.html#o12">b</a>.<a class="code" href="uniongi2cctl__data.html#o7">i2cdevaddr</a> = 1;
01299                         i2cctl.<a class="code" href="uniongi2cctl__data.html#o12">b</a>.<a class="code" href="uniongi2cctl__data.html#o4">i2cen</a> = 0;
01300                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>, i2cctl.<a class="code" href="uniongi2cctl__data.html#o0">d32</a>);
01301                         i2cctl.<a class="code" href="uniongi2cctl__data.html#o12">b</a>.<a class="code" href="uniongi2cctl__data.html#o4">i2cen</a> = 1;
01302                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>, i2cctl.<a class="code" href="uniongi2cctl__data.html#o0">d32</a>);
01303                 }
01304 
01305         } <span class="comment">/* endif speed == DWC_SPEED_PARAM_FULL */</span>
01306         <span class="keywordflow">else</span> {
01307                 <span class="comment">/* High speed PHY. */</span>
01308                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o5">phy_init_done</a>) {
01309                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o5">phy_init_done</a> = 1;
01310                         <span class="comment">/* HS PHY parameters.  These parameters are preserved</span>
01311 <span class="comment">                         * during soft reset so only program the first time.  Do</span>
01312 <span class="comment">                         * a soft reset immediately after setting phyif.  */</span>
01313 
01314                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> == 2) {
01315                                 <span class="comment">/* ULPI interface */</span>
01316                                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> = 1;
01317                                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a> = 0;
01318                                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o6">ddrsel</a> =
01319                                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o22">phy_ulpi_ddr</a>;
01320                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> == 1) {
01321                                 <span class="comment">/* UTMI+ interface */</span>
01322                                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> = 0;
01323                                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o21">phy_utmi_width</a> == 16) {
01324                                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a> = 1;
01325 
01326                                 } <span class="keywordflow">else</span> {
01327                                         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a> = 0;
01328                                 }
01329                         } <span class="keywordflow">else</span> {
01330                                 DWC_ERROR(<span class="stringliteral">"FS PHY TYPE\n"</span>);
01331                         }
01332                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01333                         <span class="comment">/* Reset after setting the PHY parameters */</span>
01334                         <a class="code" href="dwc__otg__cil_8h.html#a106">dwc_otg_core_reset</a>(core_if);
01335                 }
01336         }
01337 
01338         <span class="keywordflow">if</span> ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 2) &amp;&amp;
01339             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 1) &amp;&amp;
01340             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o25">ulpi_fs_ls</a>)) {
01341                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Setting ULPI FSLS\n"</span>);
01342                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01343                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o13">ulpi_fsls</a> = 1;
01344                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o15">ulpi_clk_sus_m</a> = 1;
01345                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01346         } <span class="keywordflow">else</span> {
01347                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01348                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o13">ulpi_fsls</a> = 0;
01349                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o15">ulpi_clk_sus_m</a> = 0;
01350                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01351         }
01352 
01353         <span class="comment">/* Program the GAHBCFG Register. */</span>
01354         <span class="keywordflow">switch</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o2">architecture</a>) {
01355 
01356         <span class="keywordflow">case</span> DWC_SLAVE_ONLY_ARCH:
01357                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Slave Only Mode\n"</span>);
01358                 ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o5">nptxfemplvl_txfemplvl</a> =
01359                     DWC_GAHBCFG_TXFEMPTYLVL_HALFEMPTY;
01360                 ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o6">ptxfemplvl</a> = DWC_GAHBCFG_TXFEMPTYLVL_HALFEMPTY;
01361                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> = 0;
01362                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> = 0;
01363                 <span class="keywordflow">break</span>;
01364 
01365         <span class="keywordflow">case</span> DWC_EXT_DMA_ARCH:
01366                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"External DMA Mode\n"</span>);
01367                 {
01368                         uint8_t brst_sz = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o4">dma_burst_size</a>;
01369                         ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o2">hburstlen</a> = 0;
01370                         <span class="keywordflow">while</span> (brst_sz &gt; 1) {
01371                                 ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o2">hburstlen</a>++;
01372                                 brst_sz &gt;&gt;= 1;
01373                         }
01374                 }
01375                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o2">dma_enable</a> != 0);
01376                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> =
01377                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a> != 0);
01378                 <span class="keywordflow">break</span>;
01379 
01380         <span class="keywordflow">case</span> DWC_INT_DMA_ARCH:
01381                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Internal DMA Mode\n"</span>);
01382                 <span class="comment">/* Old value was DWC_GAHBCFG_INT_DMA_BURST_INCR - done for </span>
01383 <span class="comment">                  Host mode ISOC in issue fix - vahrama */</span>
01384                 ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o2">hburstlen</a> = DWC_GAHBCFG_INT_DMA_BURST_INCR4;
01385                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o2">dma_enable</a> != 0);
01386                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> =
01387                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a> != 0);
01388                 <span class="keywordflow">break</span>;
01389 
01390         }
01391         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
01392                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
01393                         DWC_PRINTF(<span class="stringliteral">"Using Descriptor DMA mode\n"</span>);
01394                 } <span class="keywordflow">else</span> {
01395                         DWC_PRINTF(<span class="stringliteral">"Using Buffer DMA mode\n"</span>);
01396 
01397                 }
01398         } <span class="keywordflow">else</span> {
01399                 DWC_PRINTF(<span class="stringliteral">"Using Slave mode\n"</span>);
01400                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> = 0;
01401         }
01402 
01403         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o41">ahb_single</a>) {
01404                 ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o10">ahbsingle</a> = 1;
01405         }
01406         
01407         ahbcfg.<a class="code" href="uniongahbcfg__data.html#o12">b</a>.<a class="code" href="uniongahbcfg__data.html#o3">dmaenable</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>;
01408         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>, ahbcfg.<a class="code" href="uniongahbcfg__data.html#o0">d32</a>);
01409 
01410         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o13">ded_fifo_en</a>;
01411 
01412         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o16">pti_enh_enable</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o33">pti_enable</a> != 0;
01413         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o34">mpi_enable</a>;
01414         DWC_PRINTF(<span class="stringliteral">"Periodic Transfer Interrupt Enhancement - %s\n"</span>,
01415                    ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o16">pti_enh_enable</a>) ? <span class="stringliteral">"enabled"</span> : <span class="stringliteral">"disabled"</span>));
01416         DWC_PRINTF(<span class="stringliteral">"Multiprocessor Interrupt Enhancement - %s\n"</span>,
01417                    ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) ? <span class="stringliteral">"enabled"</span> : <span class="stringliteral">"disabled"</span>));
01418 
01419         <span class="comment">/*</span>
01420 <span class="comment">         * Program the GUSBCFG register.</span>
01421 <span class="comment">         */</span>
01422         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
01423 
01424         <span class="keywordflow">switch</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a>) {
01425         <span class="keywordflow">case</span> DWC_MODE_HNP_SRP_CAPABLE:
01426                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> ==
01427                                    DWC_OTG_CAP_PARAM_HNP_SRP_CAPABLE);
01428                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> !=
01429                                    DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE);
01430                 <span class="keywordflow">break</span>;
01431 
01432         <span class="keywordflow">case</span> DWC_MODE_SRP_ONLY_CAPABLE:
01433                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01434                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> !=
01435                                    DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE);
01436                 <span class="keywordflow">break</span>;
01437 
01438         <span class="keywordflow">case</span> DWC_MODE_NO_HNP_SRP_CAPABLE:
01439                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01440                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = 0;
01441                 <span class="keywordflow">break</span>;
01442 
01443         <span class="keywordflow">case</span> DWC_MODE_SRP_CAPABLE_DEVICE:
01444                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01445                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> !=
01446                                    DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE);
01447                 <span class="keywordflow">break</span>;
01448 
01449         <span class="keywordflow">case</span> DWC_MODE_NO_SRP_CAPABLE_DEVICE:
01450                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01451                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = 0;
01452                 <span class="keywordflow">break</span>;
01453 
01454         <span class="keywordflow">case</span> DWC_MODE_SRP_CAPABLE_HOST:
01455                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01456                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> !=
01457                                    DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE);
01458                 <span class="keywordflow">break</span>;
01459 
01460         <span class="keywordflow">case</span> DWC_MODE_NO_SRP_CAPABLE_HOST:
01461                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = 0;
01462                 usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = 0;
01463                 <span class="keywordflow">break</span>;
01464         }
01465 
01466         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01467 
01468 <span class="preprocessor">#ifdef CONFIG_USB_DWC_OTG_LPM</span>
01469 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o32">lpm_enable</a>) {
01470                 <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg = {.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = 0 };
01471 
01472                 <span class="comment">/* To enable LPM support set lpm_cap_en bit */</span>
01473                 lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o1">lpm_cap_en</a> = 1;
01474 
01475                 <span class="comment">/* Make AppL1Res ACK */</span>
01476                 lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o2">appl_resp</a> = 1;
01477 
01478                 <span class="comment">/* Retry 3 times */</span>
01479                 lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o11">retry_count</a> = 3;
01480 
01481                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>,
01482                                  0, lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a>);
01483 
01484         }
01485 <span class="preprocessor">#endif</span>
01486 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o35">ic_usb_cap</a>) {
01487                 <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> gusbcfg = {.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = 0 };
01488                 gusbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o22">ic_usb_cap</a> = 1;
01489                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>,
01490                                  0, gusbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
01491         }
01492         {
01493                 <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> gotgctl = {.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = 0 };
01494                 gotgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o18">otgver</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o43">otg_ver</a>;
01495                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, 0,
01496                                  gotgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a>);
01497                 <span class="comment">/* Set OTG version supported */</span>
01498                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o46">otg_ver</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o43">otg_ver</a>;
01499                 DWC_PRINTF(<span class="stringliteral">"OTG VER PARAM: %d, OTG VER FLAG: %d\n"</span>,
01500                            core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o43">otg_ver</a>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o46">otg_ver</a>);
01501         }
01502         
01503 
01504         <span class="comment">/* Enable common interrupts */</span>
01505         <a class="code" href="dwc__otg__cil_8c.html#a6">dwc_otg_enable_common_interrupts</a>(core_if);
01506 
01507         <span class="comment">/* Do device or host intialization based on mode during PCD</span>
01508 <span class="comment">         * and HCD initialization  */</span>
01509         <span class="keywordflow">if</span> (dwc_otg_is_host_mode(core_if)) {
01510                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Host Mode\n"</span>);
01511                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o27">op_state</a> = A_HOST;
01512         } <span class="keywordflow">else</span> {
01513                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a7">DBG_ANY</a>, <span class="stringliteral">"Device Mode\n"</span>);
01514                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o27">op_state</a> = B_PERIPHERAL;
01515 <span class="preprocessor">#ifdef DWC_DEVICE_ONLY</span>
01516 <span class="preprocessor"></span>                <a class="code" href="dwc__otg__cil_8h.html#a74">dwc_otg_core_dev_init</a>(core_if);
01517 <span class="preprocessor">#endif</span>
01518 <span class="preprocessor"></span>        }
01519 }
01520 
<a name="l01526"></a><a class="code" href="dwc__otg__cil_8h.html#a88">01526</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a88">dwc_otg_enable_device_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01527 {
01528         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.d32 = 0 };
01529         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
01530 
01531         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"%s()\n"</span>, __func__);
01532 
01533         <span class="comment">/* Disable all interrupts. */</span>
01534         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, 0);
01535 
01536         <span class="comment">/* Clear any pending interrupts */</span>
01537         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
01538 
01539         <span class="comment">/* Enable the common interrupts */</span>
01540         <a class="code" href="dwc__otg__cil_8c.html#a6">dwc_otg_enable_common_interrupts</a>(core_if);
01541 
01542         <span class="comment">/* Enable interrupts */</span>
01543         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o13">usbreset</a> = 1;
01544         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o14">enumdone</a> = 1;
01545         <span class="comment">/* Disable Disconnect interrupt in Device mode */</span>
01546         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o30">disconnect</a> = 0;
01547 
01548         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01549                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o19">inepintr</a> = 1;
01550                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o20">outepintr</a> = 1;
01551         }
01552 
01553         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o11">erlysuspend</a> = 1;
01554 
01555         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
01556                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o18">epmismatch</a> = 1;
01557         }
01558 
01559         <span class="comment">//intr_mask.b.incomplisoout = 1;</span>
01560         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o21">incomplisoin</a> = 1;
01561         
01562 <span class="comment">/* Enable the ignore frame number for ISOC xfers - MAS */</span>
01563 <span class="comment">/* Disable to support high bandwith ISOC transfers - manukz */</span>
01564 <span class="preprocessor">#if 0</span>
01565 <span class="preprocessor"></span><span class="preprocessor">#ifdef DWC_UTE_PER_IO</span>
01566 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
01567                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
01568                         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl1 = {.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = 0 };
01569                         dctl1.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o13">ifrmnum</a> = 1;
01570                         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
01571                                          dctl, 0, dctl1.<a class="code" href="uniondctl__data.html#o0">d32</a>);
01572                         DWC_DEBUG(<span class="stringliteral">"----Enabled Ignore frame number (0x%08x)"</span>,
01573                                   DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
01574                                                  dev_global_regs-&gt;dctl));
01575                 }
01576         }
01577 <span class="preprocessor">#endif</span>
01578 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01579 <span class="preprocessor"></span><span class="preprocessor">#ifdef DWC_EN_ISOC</span>
01580 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
01581                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
01582                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o16">pti_enh_enable</a>) {
01583                                 <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniondctl__data.html#o0">d32</a> = 0 };
01584                                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o13">ifrmnum</a> = 1;
01585                                 DWC_MODIFY_REG32(&amp;core_if-&gt;
01586                                                  dev_if-&gt;dev_global_regs-&gt;dctl,
01587                                                  0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
01588                         } <span class="keywordflow">else</span> {
01589                                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o21">incomplisoin</a> = 1;
01590                                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o22">incomplisoout</a> = 1;
01591                         }
01592                 }
01593         } <span class="keywordflow">else</span> {
01594                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o21">incomplisoin</a> = 1;
01595                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o22">incomplisoout</a> = 1;
01596         }
01597 <span class="preprocessor">#endif </span><span class="comment">/* DWC_EN_ISOC */</span>
01598 
01600 <span class="preprocessor">#ifdef USE_PERIODIC_EP</span>
01601 <span class="preprocessor"></span>        intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o15">isooutdrop</a> = 1;
01602         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o16">eopframe</a> = 1;
01603         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o21">incomplisoin</a> = 1;
01604         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o22">incomplisoout</a> = 1;
01605 <span class="preprocessor">#endif</span>
01606 <span class="preprocessor"></span>
01607         DWC_MODIFY_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
01608 
01609         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"%s() gintmsk=%0x\n"</span>, __func__,
01610                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>));
01611 }
01612 
<a name="l01620"></a><a class="code" href="dwc__otg__cil_8h.html#a74">01620</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a74">dwc_otg_core_dev_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01621 {
01622         <span class="keywordtype">int</span> i;
01623         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
01624         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
01625         <a class="code" href="structdwc__otg__core__params.html">dwc_otg_core_params_t</a> *params = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>;
01626         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg = {.d32 = 0 };
01627         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> diepctl = {.d32 = 0 };
01628         <a class="code" href="uniongrstctl__data.html">grstctl_t</a> resetctl = {.d32 = 0 };
01629         uint32_t rx_fifo_size;
01630         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> nptxfifosize;
01631         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> txfifosize;
01632         <a class="code" href="uniondthrctl__data.html">dthrctl_data_t</a> dthrctl;
01633         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> ptxfifosize;
01634         uint16_t rxfsiz, nptxfsiz;
01635         <a class="code" href="uniongdfifocfg__data.html">gdfifocfg_data_t</a> gdfifocfg = {.d32 = 0 };
01636         <a class="code" href="unionhwcfg3__data.html">hwcfg3_data_t</a> hwcfg3 = {.d32 = 0 };
01637 
01638         <span class="comment">/* Restart the Phy Clock */</span>
01639         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, 0);
01640 
01641         <span class="comment">/* Device configuration register */</span>
01642         <a class="code" href="dwc__otg__cil_8c.html#a19">init_devspd</a>(core_if);
01643         dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
01644         dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o9">descdma</a> = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) ? 1 : 0;
01645         dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o5">perfrint</a> = DWC_DCFG_FRAME_INTERVAL_80;
01646         <span class="comment">/* Enable Device OUT NAK in case of DDMA mode*/</span>
01647         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a>) {
01648                 dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o6">endevoutnak</a> = 1;         
01649         }
01650 
01651         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o40">cont_on_bna</a>) {
01652                 <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniondcfg__data.html#o0">d32</a> = 0 };
01653                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o15">encontonbna</a> = 1;
01654                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, 0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
01655         }
01656         
01657 
01658         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
01659 
01660         <span class="comment">/* Configure data FIFO sizes */</span>
01661         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o9">dynamic_fifo</a> &amp;&amp; params-&gt;<a class="code" href="structdwc__otg__core__params.html#o8">enable_dynamic_fifo</a>) {
01662                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Total FIFO Size=%d\n"</span>,
01663                             core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o11">total_fifo_size</a>);
01664                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Rx FIFO Size=%d\n"</span>,
01665                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>);
01666                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"NP Tx FIFO Size=%d\n"</span>,
01667                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>);
01668 
01669                 <span class="comment">/* Rx FIFO */</span>
01670                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial grxfsiz=%08x\n"</span>,
01671                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>));
01672 
01673 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
01674 <span class="preprocessor"></span>                core_if-&gt;pwron_rxfsiz = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
01675                 core_if-&gt;init_rxfsiz = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>;
01676 <span class="preprocessor">#endif</span>
01677 <span class="preprocessor"></span>                rx_fifo_size = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>;
01678                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>, rx_fifo_size);
01679 
01680                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new grxfsiz=%08x\n"</span>,
01681                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>));
01682 
01684                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o31">p_tx_msk</a> = 0;
01685 
01687                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o32">tx_msk</a> = 0;
01688 
01689                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
01690                         <span class="comment">/* Non-periodic Tx FIFO */</span>
01691                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial gnptxfsiz=%08x\n"</span>,
01692                                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
01693 
01694                         nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>;
01695                         nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>;
01696 
01697                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>,
01698                                         nptxfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
01699 
01700                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new gnptxfsiz=%08x\n"</span>,
01701                                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
01702 
01704                         <span class="comment">/*</span>
01705 <span class="comment">                         * Periodic Tx FIFOs These FIFOs are numbered from 1 to 15.</span>
01706 <span class="comment">                         * Indexes of the FIFO size module parameters in the</span>
01707 <span class="comment">                         * dev_perio_tx_fifo_size array and the FIFO size registers in</span>
01708 <span class="comment">                         * the dptxfsiz array run from 0 to 14.</span>
01709 <span class="comment">                         */</span>
01711                         ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> =
01712                             nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> + nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a>;
01713                         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o1">num_dev_perio_in_ep</a>; i++) {
01714                                 ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> =
01715                                     params-&gt;<a class="code" href="structdwc__otg__core__params.html#o12">dev_perio_tx_fifo_size</a>[i];
01716                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
01717                                             <span class="stringliteral">"initial dtxfsiz[%d]=%08x\n"</span>, i,
01718                                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>
01719                                                            [i]));
01720                                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i],
01721                                                 ptxfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
01722                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new dtxfsiz[%d]=%08x\n"</span>,
01723                                             i,
01724                                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>
01725                                                            [i]));
01726                                 ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> += ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a>;
01727                         }
01728                 } <span class="keywordflow">else</span> {
01729                         <span class="comment">/*</span>
01730 <span class="comment">                         * Tx FIFOs These FIFOs are numbered from 1 to 15.</span>
01731 <span class="comment">                         * Indexes of the FIFO size module parameters in the</span>
01732 <span class="comment">                         * dev_tx_fifo_size array and the FIFO size registers in</span>
01733 <span class="comment">                         * the dtxfsiz array run from 0 to 14.</span>
01734 <span class="comment">                         */</span>
01735 
01736                         <span class="comment">/* Non-periodic Tx FIFO */</span>
01737                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial gnptxfsiz=%08x\n"</span>,
01738                                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
01739 
01740 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
01741 <span class="preprocessor"></span>                        core_if-&gt;pwron_gnptxfsiz =
01742                             (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16);
01743                         core_if-&gt;init_gnptxfsiz =
01744                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>;
01745 <span class="preprocessor">#endif</span>
01746 <span class="preprocessor"></span>                        nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>;
01747                         nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>;
01748 
01749                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>,
01750                                         nptxfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
01751 
01752                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new gnptxfsiz=%08x\n"</span>,
01753                                     DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
01754 
01755                         txfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> =
01756                             nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> + nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a>;
01757 
01758                         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o14">num_in_eps</a>; i++) {
01759 
01760                                 txfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> =
01761                                     params-&gt;<a class="code" href="structdwc__otg__core__params.html#o28">dev_tx_fifo_size</a>[i];
01762 
01763                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
01764                                             <span class="stringliteral">"initial dtxfsiz[%d]=%08x\n"</span>,
01765                                             i,
01766                                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>
01767                                                            [i]));
01768 
01769 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
01770 <span class="preprocessor"></span>                                core_if-&gt;pwron_txfsiz[i] =
01771                                     (DWC_READ_REG32
01772                                      (&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i]) &gt;&gt; 16);
01773                                 core_if-&gt;init_txfsiz[i] =
01774                                     params-&gt;<a class="code" href="structdwc__otg__core__params.html#o28">dev_tx_fifo_size</a>[i];
01775 <span class="preprocessor">#endif</span>
01776 <span class="preprocessor"></span>                                DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i],
01777                                                 txfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
01778 
01779                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
01780                                             <span class="stringliteral">"new dtxfsiz[%d]=%08x\n"</span>,
01781                                             i,
01782                                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>
01783                                                            [i]));
01784 
01785                                 txfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> += txfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a>;
01786                         }
01787                         <span class="comment">/* Calculating DFIFOCFG for Device mode to include RxFIFO and NPTXFIFO */</span>
01788                         gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>);
01789                         hwcfg3.<a class="code" href="unionhwcfg3__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o19">ghwcfg3</a>);
01790                         gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o3">b</a>.<a class="code" href="uniongdfifocfg__data.html#o1">gdfifocfg</a> = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o19">ghwcfg3</a>) &gt;&gt; 16);
01791                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>, gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o0">d32</a>);
01792                         rxfsiz = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>) &amp; 0x0000ffff);
01793                         nptxfsiz = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16);
01794                         gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o3">b</a>.<a class="code" href="uniongdfifocfg__data.html#o2">epinfobase</a> = rxfsiz + nptxfsiz;
01795                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>, gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o0">d32</a>);
01796                 }
01797         }
01798 
01799         <span class="comment">/* Flush the FIFOs */</span>
01800         <a class="code" href="dwc__otg__cil_8h.html#a104">dwc_otg_flush_tx_fifo</a>(core_if, 0x10);   <span class="comment">/* all Tx FIFOs */</span>
01801         <a class="code" href="dwc__otg__cil_8h.html#a105">dwc_otg_flush_rx_fifo</a>(core_if);
01802 
01803         <span class="comment">/* Flush the Learning Queue. */</span>
01804         resetctl.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o4">intknqflsh</a> = 1;
01805         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>, resetctl.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
01806 
01807         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
01808                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o49">start_predict</a> = 0;
01809                 <span class="keywordflow">for</span> (i = 0; i&lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; ++i) {
01810                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i] = 0xff;  <span class="comment">// 0xff - EP not active</span>
01811                 }
01812                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[0] = 0;     
01813                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a> = 0;
01814                 diepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
01815                 diepctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = 0;
01816                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, diepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
01817                 
01818                 <span class="comment">/* Update IN Endpoint Mismatch Count by active IN NP EP count + 1 */</span>
01819                 dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
01820                 dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o8">epmscnt</a> = 2;
01821                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
01822 
01823                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>,<span class="stringliteral">"%s first_in_nextep_seq= %2d; nextep_seq[]:\n"</span>, 
01824                         __func__, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a>);
01825                 <span class="keywordflow">for</span> (i=0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
01826                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"%2d "</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i]);
01827                 }
01828                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>,<span class="stringliteral">"\n"</span>);
01829         }
01830         
01831         <span class="comment">/* Clear all pending Device Interrupts */</span>
01835         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01836                 <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; ++i) {
01837                         DWC_WRITE_REG32(&amp;dev_if-&gt;
01838                                         dev_global_regs-&gt;diepeachintmsk[i], 0);
01839                 }
01840 
01841                 <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o5">num_out_eps</a>; ++i) {
01842                         DWC_WRITE_REG32(&amp;dev_if-&gt;
01843                                         dev_global_regs-&gt;doepeachintmsk[i], 0);
01844                 }
01845 
01846                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o14">deachint</a>, 0xFFFFFFFF);
01847                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o15">deachintmsk</a>, 0);
01848         } <span class="keywordflow">else</span> {
01849                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>, 0);
01850                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>, 0);
01851                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o6">daint</a>, 0xFFFFFFFF);
01852                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>, 0);
01853         }
01854 
01855         <span class="keywordflow">for</span> (i = 0; i &lt;= dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
01856                 <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
01857                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
01858                 <span class="keywordflow">if</span> (depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a>) {
01859                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
01860                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
01861                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o11">snak</a> = 1;
01862                 } <span class="keywordflow">else</span> {
01863                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
01864                 }
01865 
01866                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
01867 
01868                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, 0);
01869                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>, 0);
01870                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o2">diepint</a>, 0xFF);
01871         }
01872 
01873         <span class="keywordflow">for</span> (i = 0; i &lt;= dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o5">num_out_eps</a>; i++) {
01874                 <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
01875                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
01876                 <span class="keywordflow">if</span> (depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a>) {
01877                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
01878                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
01879                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o11">snak</a> = 1;
01880                 } <span class="keywordflow">else</span> {
01881                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
01882                 }
01883 
01884                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
01885 
01886                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>, 0);
01887                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>, 0);
01888                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o2">doepint</a>, 0xFF);
01889         }
01890 
01891         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
01892                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o10">non_iso_tx_thr_en</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a> &amp; 0x1;
01893                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o9">iso_tx_thr_en</a> = (params-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a> &gt;&gt; 1) &amp; 0x1;
01894                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o8">rx_thr_en</a> = (params-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a> &gt;&gt; 2) &amp; 0x1;
01895 
01896                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o11">rx_thr_length</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o31">rx_thr_length</a>;
01897                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o12">tx_thr_length</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o30">tx_thr_length</a>;
01898 
01899                 dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o16">setup_desc_index</a> = 0;
01900 
01901                 dthrctl.<a class="code" href="uniondthrctl__data.html#o0">d32</a> = 0;
01902                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o1">non_iso_thr_en</a> = dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o10">non_iso_tx_thr_en</a>;
01903                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o2">iso_thr_en</a> = dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o9">iso_tx_thr_en</a>;
01904                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o3">tx_thr_len</a> = dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o12">tx_thr_length</a>;
01905                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o6">rx_thr_en</a> = dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o8">rx_thr_en</a>;
01906                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o7">rx_thr_len</a> = dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o11">rx_thr_length</a>;
01907                 dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o4">ahb_thr_ratio</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o36">ahb_thr_ratio</a>;
01908 
01909                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o12">dtknqr3_dthrctl</a>,
01910                                 dthrctl.<a class="code" href="uniondthrctl__data.html#o0">d32</a>);
01911 
01912                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>,
01913                             <span class="stringliteral">"Non ISO Tx Thr - %d\nISO Tx Thr - %d\nRx Thr - %d\nTx Thr Len - %d\nRx Thr Len - %d\n"</span>,
01914                             dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o1">non_iso_thr_en</a>, dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o2">iso_thr_en</a>,
01915                             dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o6">rx_thr_en</a>, dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o3">tx_thr_len</a>,
01916                             dthrctl.<a class="code" href="uniondthrctl__data.html#o11">b</a>.<a class="code" href="uniondthrctl__data.html#o7">rx_thr_len</a>);
01917 
01918         }
01919 
01920         <a class="code" href="dwc__otg__cil_8h.html#a88">dwc_otg_enable_device_interrupts</a>(core_if);
01921 
01922         {
01923                 <a class="code" href="uniondiepint__data.html">diepmsk_data_t</a> msk = {.d32 = 0 };
01924                 msk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o9">txfifoundrn</a> = 1;
01925                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01926                         DWC_MODIFY_REG32(&amp;dev_if-&gt;
01927                                          dev_global_regs-&gt;diepeachintmsk[0],
01928                                          msk.<a class="code" href="uniondiepint__data.html#o0">d32</a>, msk.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
01929                 } <span class="keywordflow">else</span> {
01930                         DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>,
01931                                          msk.<a class="code" href="uniondiepint__data.html#o0">d32</a>, msk.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
01932                 }
01933         }
01934 
01935         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
01936                 <span class="comment">/* Set NAK on Babble */</span>
01937                 <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0 };
01938                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o14">nakonbble</a> = 1;
01939                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, 0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
01940         }
01941 
01942         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &gt;= OTG_CORE_REV_2_94a) {
01943                 <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniondctl__data.html#o0">d32</a> = 0 };
01944                 dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>);
01945                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o2">sftdiscon</a> = 0;
01946                 DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
01947         }
01948 }
01949 
<a name="l01955"></a><a class="code" href="dwc__otg__cil_8h.html#a98">01955</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a98">dwc_otg_enable_host_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01956 {
01957         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
01958         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.d32 = 0 };
01959 
01960         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"%s()\n"</span>, __func__);
01961 
01962         <span class="comment">/* Disable all interrupts. */</span>
01963         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, 0);
01964 
01965         <span class="comment">/* Clear any pending interrupts. */</span>
01966         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, 0xFFFFFFFF);
01967 
01968         <span class="comment">/* Enable the common interrupts */</span>
01969         <a class="code" href="dwc__otg__cil_8c.html#a6">dwc_otg_enable_common_interrupts</a>(core_if);
01970 
01971         <span class="comment">/*</span>
01972 <span class="comment">         * Enable host mode interrupts without disturbing common</span>
01973 <span class="comment">         * interrupts.</span>
01974 <span class="comment">         */</span>
01975 
01976         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o30">disconnect</a> = 1;
01977         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o25">portintr</a> = 1;
01978         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o26">hcintr</a> = 1;
01979 
01980         DWC_MODIFY_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
01981 }
01982 
<a name="l01988"></a><a class="code" href="dwc__otg__cil_8h.html#a99">01988</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a99">dwc_otg_disable_host_interrupts</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
01989 {
01990         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
01991         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.d32 = 0 };
01992 
01993         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"%s()\n"</span>, __func__);
01994 
01995         <span class="comment">/*</span>
01996 <span class="comment">         * Disable host mode interrupts without disturbing common</span>
01997 <span class="comment">         * interrupts.</span>
01998 <span class="comment">         */</span>
01999         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o4">sofintr</a> = 1;
02000         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o25">portintr</a> = 1;
02001         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o26">hcintr</a> = 1;
02002         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o27">ptxfempty</a> = 1;
02003         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o6">nptxfempty</a> = 1;
02004 
02005         DWC_MODIFY_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, 0);
02006 }
02007 
<a name="l02019"></a><a class="code" href="dwc__otg__cil_8h.html#a73">02019</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a73">dwc_otg_core_host_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
02020 {
02021         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
02022         <a class="code" href="structdwc__otg__host__if.html">dwc_otg_host_if_t</a> *host_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>;
02023         <a class="code" href="structdwc__otg__core__params.html">dwc_otg_core_params_t</a> *params = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>;
02024         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0 = {.d32 = 0 };
02025         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> nptxfifosize;
02026         <a class="code" href="unionfifosize__data.html">fifosize_data_t</a> ptxfifosize;
02027         uint16_t rxfsiz, nptxfsiz, hptxfsiz;
02028         <a class="code" href="uniongdfifocfg__data.html">gdfifocfg_data_t</a> gdfifocfg = {.d32 = 0 };
02029         <span class="keywordtype">int</span> i;
02030         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02031         <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg;
02032         <a class="code" href="unionhfir__data.html">hfir_data_t</a> hfir;
02033         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs;
02034         <span class="keywordtype">int</span> num_channels;
02035         <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> gotgctl = {.d32 = 0 };
02036 
02037         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"%s(%p)\n"</span>, __func__, core_if);
02038 
02039         <span class="comment">/* Restart the Phy Clock */</span>
02040         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>, 0);
02041 
02042         <span class="comment">/* Initialize Host Configuration Register */</span>
02043         <a class="code" href="dwc__otg__cil_8c.html#a18">init_fslspclksel</a>(core_if);
02044         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a> == DWC_SPEED_PARAM_FULL) {
02045                 hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
02046                 hcfg.<a class="code" href="unionhcfg__data.html#o12">b</a>.<a class="code" href="unionhcfg__data.html#o2">fslssupp</a> = 1;
02047                 DWC_WRITE_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>, hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
02048 
02049         }
02050 
02051         <span class="comment">/* This bit allows dynamic reloading of the HFIR register</span>
02052 <span class="comment">         * during runtime. This bit needs to be programmed during </span>
02053 <span class="comment">         * initial configuration and its value must not be changed</span>
02054 <span class="comment">         * during runtime.*/</span>
02055         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o38">reload_ctl</a> == 1) {
02056                 hfir.<a class="code" href="unionhfir__data.html#o0">d32</a> = DWC_READ_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>);
02057                 hfir.<a class="code" href="unionhfir__data.html#o4">b</a>.<a class="code" href="unionhfir__data.html#o2">hfirrldctrl</a> = 1;
02058                 DWC_WRITE_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>, hfir.<a class="code" href="unionhfir__data.html#o0">d32</a>);
02059         }
02060 
02061         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>) {
02062                 uint8_t op_mode = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a>;
02063                 <span class="keywordflow">if</span> (!
02064                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o15">desc_dma</a>
02065                      &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &gt;= OTG_CORE_REV_2_90a)
02066                      &amp;&amp; ((op_mode == DWC_HWCFG2_OP_MODE_HNP_SRP_CAPABLE_OTG)
02067                          || (op_mode == DWC_HWCFG2_OP_MODE_SRP_ONLY_CAPABLE_OTG)
02068                          || (op_mode ==
02069                              DWC_HWCFG2_OP_MODE_NO_HNP_SRP_CAPABLE_OTG)
02070                          || (op_mode == DWC_HWCFG2_OP_MODE_SRP_CAPABLE_HOST)
02071                          || (op_mode ==
02072                              DWC_HWCFG2_OP_MODE_NO_SRP_CAPABLE_HOST)))) {
02073 
02074                         DWC_ERROR(<span class="stringliteral">"Host can't operate in Descriptor DMA mode.\n"</span>
02075                                   <span class="stringliteral">"Either core version is below 2.90a or "</span>
02076                                   <span class="stringliteral">"GHWCFG2, GHWCFG4 registers' values do not allow Descriptor DMA in host mode.\n"</span>
02077                                   <span class="stringliteral">"To run the driver in Buffer DMA host mode set dma_desc_enable "</span>
02078                                   <span class="stringliteral">"module parameter to 0.\n"</span>);
02079                         <span class="keywordflow">return</span>;
02080                 }
02081                 hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
02082                 hcfg.<a class="code" href="unionhcfg__data.html#o12">b</a>.<a class="code" href="unionhcfg__data.html#o7">descdma</a> = 1;
02083                 DWC_WRITE_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>, hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
02084         }
02085 
02086         <span class="comment">/* Configure data FIFO sizes */</span>
02087         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o9">dynamic_fifo</a> &amp;&amp; params-&gt;<a class="code" href="structdwc__otg__core__params.html#o8">enable_dynamic_fifo</a>) {
02088                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Total FIFO Size=%d\n"</span>,
02089                             core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o11">total_fifo_size</a>);
02090                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"Rx FIFO Size=%d\n"</span>,
02091                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a>);
02092                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"NP Tx FIFO Size=%d\n"</span>,
02093                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o14">host_nperio_tx_fifo_size</a>);
02094                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"P Tx FIFO Size=%d\n"</span>,
02095                             params-&gt;<a class="code" href="structdwc__otg__core__params.html#o15">host_perio_tx_fifo_size</a>);
02096 
02097                 <span class="comment">/* Rx FIFO */</span>
02098                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial grxfsiz=%08x\n"</span>,
02099                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>));
02100                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>,
02101                                 params-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a>);
02102                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new grxfsiz=%08x\n"</span>,
02103                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>));
02104 
02105                 <span class="comment">/* Non-periodic Tx FIFO */</span>
02106                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial gnptxfsiz=%08x\n"</span>,
02107                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
02108                 nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o14">host_nperio_tx_fifo_size</a>;
02109                 nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a>;
02110                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>, nptxfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
02111                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new gnptxfsiz=%08x\n"</span>,
02112                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>));
02113 
02114                 <span class="comment">/* Periodic Tx FIFO */</span>
02115                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"initial hptxfsiz=%08x\n"</span>,
02116                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>));
02117                 ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a> = params-&gt;<a class="code" href="structdwc__otg__core__params.html#o15">host_perio_tx_fifo_size</a>;
02118                 ptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> =
02119                     nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o1">startaddr</a> + nptxfifosize.<a class="code" href="unionfifosize__data.html#o3">b</a>.<a class="code" href="unionfifosize__data.html#o2">depth</a>;
02120                 DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>, ptxfifosize.<a class="code" href="unionfifosize__data.html#o0">d32</a>);
02121                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a>, <span class="stringliteral">"new hptxfsiz=%08x\n"</span>,
02122                             DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>));
02123                 
02124                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a>) {
02125                         <span class="comment">/* Global DFIFOCFG calculation for Host mode - include RxFIFO, NPTXFIFO and HPTXFIFO */</span>
02126                         gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>);
02127                         rxfsiz = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>) &amp; 0x0000ffff);
02128                         nptxfsiz = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16);
02129                         hptxfsiz = (DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>) &gt;&gt; 16);
02130                         gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o3">b</a>.<a class="code" href="uniongdfifocfg__data.html#o2">epinfobase</a> = rxfsiz + nptxfsiz + hptxfsiz;
02131                         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>, gdfifocfg.<a class="code" href="uniongdfifocfg__data.html#o0">d32</a>);
02132                 }
02133         }
02134 
02135         <span class="comment">/* TODO - check this */</span>
02136         <span class="comment">/* Clear Host Set HNP Enable in the OTG Control Register */</span>
02137         gotgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o11">hstsethnpen</a> = 1;
02138         DWC_MODIFY_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, gotgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a>, 0);
02139         <span class="comment">/* Make sure the FIFOs are flushed. */</span>
02140         <a class="code" href="dwc__otg__cil_8h.html#a104">dwc_otg_flush_tx_fifo</a>(core_if, 0x10 <span class="comment">/* all TX FIFOs */</span> );
02141         <a class="code" href="dwc__otg__cil_8h.html#a105">dwc_otg_flush_rx_fifo</a>(core_if);
02142 
02143         <span class="comment">/* Clear Host Set HNP Enable in the OTG Control Register */</span>
02144         gotgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o11">hstsethnpen</a> = 1;
02145         DWC_MODIFY_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, gotgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a>, 0);
02146 
02147         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>) {
02148                 <span class="comment">/* Flush out any leftover queued requests. */</span>
02149                 num_channels = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o18">host_channels</a>;
02150 
02151                 <span class="keywordflow">for</span> (i = 0; i &lt; num_channels; i++) {
02152                         hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i];
02153                         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02154                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 0;
02155                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 1;
02156                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o3">epdir</a> = 0;
02157                         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02158                 }
02159 
02160                 <span class="comment">/* Halt all channels to put them into a known state. */</span>
02161                 <span class="keywordflow">for</span> (i = 0; i &lt; num_channels; i++) {
02162                         <span class="keywordtype">int</span> count = 0;
02163                         hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i];
02164                         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02165                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
02166                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 1;
02167                         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o3">epdir</a> = 0;
02168                         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02169                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Halt channel %d\n"</span>, __func__, i);
02170                         <span class="keywordflow">do</span> {
02171                                 hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02172                                 <span class="keywordflow">if</span> (++count &gt; 1000) {
02173                                         DWC_ERROR
02174                                             (<span class="stringliteral">"%s: Unable to clear halt on channel %d\n"</span>,
02175                                              __func__, i);
02176                                         <span class="keywordflow">break</span>;
02177                                 }
02178                                 dwc_udelay(1);
02179                         } <span class="keywordflow">while</span> (hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a>);
02180                 }
02181         }
02182 
02183         <span class="comment">/* Turn on the vbus power. */</span>
02184         DWC_PRINTF(<span class="stringliteral">"Init: Port Power? op_state=%d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o27">op_state</a>);
02185         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o27">op_state</a> == A_HOST) {
02186                 hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(core_if);
02187                 DWC_PRINTF(<span class="stringliteral">"Init: Power Port (%d)\n"</span>, hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a>);
02188                 <span class="keywordflow">if</span> (hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> == 0) {
02189                         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> = 1;
02190                         DWC_WRITE_REG32(host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
02191                 }
02192         }
02193 
02194         <a class="code" href="dwc__otg__cil_8h.html#a98">dwc_otg_enable_host_interrupts</a>(core_if);
02195 }
02196 
<a name="l02206"></a><a class="code" href="dwc__otg__cil_8h.html#a91">02206</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a91">dwc_otg_hc_init</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02207 {
02208         uint32_t intr_enable;
02209         <a class="code" href="unionhcintmsk__data.html">hcintmsk_data_t</a> hc_intr_mask;
02210         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> gintmsk = {.<a class="code" href="unionhprt0__data.html#o0">d32</a> = 0 };
02211         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02212         hcsplt_data_t hcsplt;
02213 
02214         uint8_t hc_num = hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>;
02215         <a class="code" href="structdwc__otg__host__if.html">dwc_otg_host_if_t</a> *host_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>;
02216         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs = host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc_num];
02217 
02218         <span class="comment">/* Clear old interrupt conditions for this host channel. */</span>
02219         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o0">d32</a> = 0xFFFFFFFF;
02220         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o15">reserved14_31</a> = 0;
02221         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o2">hcint</a>, hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o0">d32</a>);
02222 
02223         <span class="comment">/* Enable channel interrupts required for this transfer. */</span>
02224         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o0">d32</a> = 0;
02225         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o2">chhltd</a> = 1;
02226         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
02227                 <span class="comment">/* For Descriptor DMA mode core halts the channel on AHB error. Interrupt is not required */</span>
02228                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>)
02229                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o3">ahberr</a> = 1;
02230                 <span class="keywordflow">else</span> {
02231                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC)
02232                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o1">xfercompl</a> = 1;
02233                 }
02234 
02235                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_7">error_state</a> &amp;&amp; !hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a> &amp;&amp;
02236                     hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> != DWC_OTG_EP_TYPE_ISOC) {
02237                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02238                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02239                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o11">datatglerr</a> = 1;
02240                                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> != DWC_OTG_EP_TYPE_INTR) {
02241                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o5">nak</a> = 1;
02242                                 }
02243                         }
02244                 }
02245         } <span class="keywordflow">else</span> {
02246                 <span class="keywordflow">switch</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a>) {
02247                 <span class="keywordflow">case</span> DWC_OTG_EP_TYPE_CONTROL:
02248                 <span class="keywordflow">case</span> DWC_OTG_EP_TYPE_BULK:
02249                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o1">xfercompl</a> = 1;
02250                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o4">stall</a> = 1;
02251                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o8">xacterr</a> = 1;
02252                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o11">datatglerr</a> = 1;
02253                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02254                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o9">bblerr</a> = 1;
02255                         } <span class="keywordflow">else</span> {
02256                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o5">nak</a> = 1;
02257                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o7">nyet</a> = 1;
02258                                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_6">do_ping</a>) {
02259                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02260                                 }
02261                         }
02262 
02263                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02264                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o5">nak</a> = 1;
02265                                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a>) {
02266                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o7">nyet</a> = 1;
02267                                 } <span class="keywordflow">else</span> {
02268                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02269                                 }
02270                         }
02271 
02272                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_7">error_state</a>) {
02273                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02274                         }
02275                         <span class="keywordflow">break</span>;
02276                 <span class="keywordflow">case</span> DWC_OTG_EP_TYPE_INTR:
02277                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o1">xfercompl</a> = 1;
02278                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o5">nak</a> = 1;
02279                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o4">stall</a> = 1;
02280                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o8">xacterr</a> = 1;
02281                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o11">datatglerr</a> = 1;
02282                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o10">frmovrun</a> = 1;
02283 
02284                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02285                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o9">bblerr</a> = 1;
02286                         }
02287                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_7">error_state</a>) {
02288                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02289                         }
02290                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02291                                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a>) {
02292                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o7">nyet</a> = 1;
02293                                 } <span class="keywordflow">else</span> {
02294                                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02295                                 }
02296                         }
02297                         <span class="keywordflow">break</span>;
02298                 <span class="keywordflow">case</span> DWC_OTG_EP_TYPE_ISOC:
02299                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o1">xfercompl</a> = 1;
02300                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o10">frmovrun</a> = 1;
02301                         hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o6">ack</a> = 1;
02302 
02303                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02304                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o8">xacterr</a> = 1;
02305                                 hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o9">bblerr</a> = 1;
02306                         }
02307                         <span class="keywordflow">break</span>;
02308                 }
02309         }
02310         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>, hc_intr_mask.<a class="code" href="unionhcintmsk__data.html#o0">d32</a>);
02311 
02312         <span class="comment">/* Enable the top level host channel interrupt. */</span>
02313         intr_enable = (1 &lt;&lt; hc_num);
02314         DWC_MODIFY_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o6">haintmsk</a>, 0, intr_enable);
02315 
02316         <span class="comment">/* Make sure host channel interrupts are enabled. */</span>
02317         gintmsk.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o26">hcintr</a> = 1;
02318         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>, 0, gintmsk.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
02319 
02320         <span class="comment">/*</span>
02321 <span class="comment">         * Program the HCCHARn register with the endpoint characteristics for</span>
02322 <span class="comment">         * the current transfer.</span>
02323 <span class="comment">         */</span>
02324         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = 0;
02325         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o8">devaddr</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o1">dev_addr</a>;
02326         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o2">epnum</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o2">ep_num</a>;
02327         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o3">epdir</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>;
02328         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o5">lspddev</a> = (hc-&gt;<a class="code" href="structdwc__hc.html#o4">speed</a> == DWC_OTG_EP_SPEED_LOW);
02329         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o6">eptype</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a>;
02330         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o1">mps</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02331 
02332         DWC_WRITE_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc_num]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02333 
02334         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02335         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Dev Addr: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o8">devaddr</a>);
02336         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Ep Num: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o2">epnum</a>);
02337         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Is In: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o3">epdir</a>);
02338         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Is Low Speed: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o5">lspddev</a>);
02339         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Ep Type: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o6">eptype</a>);
02340         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Max Pkt: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o1">mps</a>);
02341         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Multi Cnt: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o7">multicnt</a>);
02342 
02343         <span class="comment">/*</span>
02344 <span class="comment">         * Program the HCSPLIT register for SPLITs</span>
02345 <span class="comment">         */</span>
02346         hcsplt.d32 = 0;
02347         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02348                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"Programming HC %d with split --&gt; %s\n"</span>,
02349                             hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>,
02350                             hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a> ? <span class="stringliteral">"CSPLIT"</span> : <span class="stringliteral">"SSPLIT"</span>);
02351                 hcsplt.b.compsplt = hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a>;
02352                 hcsplt.b.xactpos = hc-&gt;<a class="code" href="structdwc__hc.html#z34_15">xact_pos</a>;
02353                 hcsplt.b.hubaddr = hc-&gt;<a class="code" href="structdwc__hc.html#z34_13">hub_addr</a>;
02354                 hcsplt.b.prtaddr = hc-&gt;<a class="code" href="structdwc__hc.html#z34_14">port_addr</a>;
02355                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   comp split %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a>);
02356                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   xact pos %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_15">xact_pos</a>);
02357                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   hub addr %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_13">hub_addr</a>);
02358                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   port addr %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_14">port_addr</a>);
02359                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   is_in %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>);
02360                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   Max Pkt: %d\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o1">mps</a>);
02361                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"   xferlen: %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a>);
02362         }
02363         DWC_WRITE_REG32(&amp;host_if-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc_num]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o1">hcsplt</a>, hcsplt.d32);
02364 
02365 }
02366 
<a name="l02394"></a><a class="code" href="dwc__otg__cil_8h.html#a92">02394</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a92">dwc_otg_hc_halt</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
02395                      <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc, dwc_otg_halt_status_e halt_status)
02396 {
02397         <a class="code" href="uniongnptxsts__data.html">gnptxsts_data_t</a> nptxsts;
02398         hptxsts_data_t hptxsts;
02399         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02400         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs;
02401         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs;
02402         <a class="code" href="structdwc__otg__host__global__regs.html">dwc_otg_host_global_regs_t</a> *host_global_regs;
02403 
02404         hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02405         global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
02406         host_global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>;
02407 
02408         DWC_ASSERT(!(halt_status == DWC_OTG_HC_XFER_NO_HALT_STATUS),
02409                    <span class="stringliteral">"halt_status = %d\n"</span>, halt_status);
02410 
02411         <span class="keywordflow">if</span> (halt_status == DWC_OTG_HC_XFER_URB_DEQUEUE ||
02412             halt_status == DWC_OTG_HC_XFER_AHB_ERR) {
02413                 <span class="comment">/*</span>
02414 <span class="comment">                 * Disable all channel interrupts except Ch Halted. The QTD</span>
02415 <span class="comment">                 * and QH state associated with this transfer has been cleared</span>
02416 <span class="comment">                 * (in the case of URB_DEQUEUE), so the channel needs to be</span>
02417 <span class="comment">                 * shut down carefully to prevent crashes.</span>
02418 <span class="comment">                 */</span>
02419                 <a class="code" href="unionhcintmsk__data.html">hcintmsk_data_t</a> hcintmsk;
02420                 hcintmsk.<a class="code" href="unionhcintmsk__data.html#o0">d32</a> = 0;
02421                 hcintmsk.<a class="code" href="unionhcintmsk__data.html#o16">b</a>.<a class="code" href="unionhcintmsk__data.html#o2">chhltd</a> = 1;
02422                 DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>, hcintmsk.<a class="code" href="unionhcintmsk__data.html#o0">d32</a>);
02423 
02424                 <span class="comment">/*</span>
02425 <span class="comment">                 * Make sure no other interrupts besides halt are currently</span>
02426 <span class="comment">                 * pending. Handling another interrupt could cause a crash due</span>
02427 <span class="comment">                 * to the QTD and QH state.</span>
02428 <span class="comment">                 */</span>
02429                 DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o2">hcint</a>, ~hcintmsk.<a class="code" href="unionhcintmsk__data.html#o0">d32</a>);
02430 
02431                 <span class="comment">/*</span>
02432 <span class="comment">                 * Make sure the halt status is set to URB_DEQUEUE or AHB_ERR</span>
02433 <span class="comment">                 * even if the channel was already halted for some other</span>
02434 <span class="comment">                 * reason.</span>
02435 <span class="comment">                 */</span>
02436                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_10">halt_status</a> = halt_status;
02437 
02438                 hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02439                 <span class="keywordflow">if</span> (hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> == 0) {
02440                         <span class="comment">/*</span>
02441 <span class="comment">                         * The channel is either already halted or it hasn't</span>
02442 <span class="comment">                         * started yet. In DMA mode, the transfer may halt if</span>
02443 <span class="comment">                         * it finishes normally or a condition occurs that</span>
02444 <span class="comment">                         * requires driver intervention. Don't want to halt</span>
02445 <span class="comment">                         * the channel again. In either Slave or DMA mode,</span>
02446 <span class="comment">                         * it's possible that the transfer has been assigned</span>
02447 <span class="comment">                         * to a channel, but not started yet when an URB is</span>
02448 <span class="comment">                         * dequeued. Don't want to halt a channel that hasn't</span>
02449 <span class="comment">                         * started yet.</span>
02450 <span class="comment">                         */</span>
02451                         <span class="keywordflow">return</span>;
02452                 }
02453         }
02454         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_9">halt_pending</a>) {
02455                 <span class="comment">/*</span>
02456 <span class="comment">                 * A halt has already been issued for this channel. This might</span>
02457 <span class="comment">                 * happen when a transfer is aborted by a higher level in</span>
02458 <span class="comment">                 * the stack.</span>
02459 <span class="comment">                 */</span>
02460 <span class="preprocessor">#ifdef DEBUG</span>
02461 <span class="preprocessor"></span>                DWC_PRINTF
02462                     (<span class="stringliteral">"*** %s: Channel %d, _hc-&gt;halt_pending already set ***\n"</span>,
02463                      __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02464 
02465 <span class="preprocessor">#endif</span>
02466 <span class="preprocessor"></span>                <span class="keywordflow">return</span>;
02467         }
02468 
02469         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02470 
02471         <span class="comment">/* No need to set the bit in DDMA for disabling the channel */</span>
02472         <span class="comment">//TODO check it everywhere channel is disabled          </span>
02473         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>)
02474                 hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
02475         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 1;
02476 
02477         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
02478                 <span class="comment">/* Check for space in the request queue to issue the halt. */</span>
02479                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_CONTROL ||
02480                     hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_BULK) {
02481                         nptxsts.<a class="code" href="uniongnptxsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>);
02482                         <span class="keywordflow">if</span> (nptxsts.<a class="code" href="uniongnptxsts__data.html#o7">b</a>.<a class="code" href="uniongnptxsts__data.html#o2">nptxqspcavail</a> == 0) {
02483                                 hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 0;
02484                         }
02485                 } <span class="keywordflow">else</span> {
02486                         hptxsts.<a class="code" href="unionhcchar__data.html#o0">d32</a> =
02487                             DWC_READ_REG32(&amp;host_global_regs-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o4">hptxsts</a>);
02488                         <span class="keywordflow">if</span> ((hptxsts.b.ptxqspcavail == 0)
02489                             || (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o19">queuing_high_bandwidth</a>)) {
02490                                 hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 0;
02491                         }
02492                 }
02493         }
02494         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02495 
02496         hc-&gt;<a class="code" href="structdwc__hc.html#z34_10">halt_status</a> = halt_status;
02497 
02498         <span class="keywordflow">if</span> (hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a>) {
02499                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_9">halt_pending</a> = 1;
02500                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_8">halt_on_queue</a> = 0;
02501         } <span class="keywordflow">else</span> {
02502                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_8">halt_on_queue</a> = 1;
02503         }
02504 
02505         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02506         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  hcchar: 0x%08x\n"</span>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02507         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  halt_pending: %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_9">halt_pending</a>);
02508         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  halt_on_queue: %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_8">halt_on_queue</a>);
02509         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  halt_status: %d\n"</span>, hc-&gt;<a class="code" href="structdwc__hc.html#z34_10">halt_status</a>);
02510 
02511         <span class="keywordflow">return</span>;
02512 }
02513 
<a name="l02521"></a><a class="code" href="dwc__otg__cil_8h.html#a93">02521</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a93">dwc_otg_hc_cleanup</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02522 {
02523         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs;
02524 
02525         hc-&gt;<a class="code" href="structdwc__hc.html#z34_5">xfer_started</a> = 0;
02526 
02527         <span class="comment">/*</span>
02528 <span class="comment">         * Clear channel interrupt enables and any unhandled channel interrupt</span>
02529 <span class="comment">         * conditions.</span>
02530 <span class="comment">         */</span>
02531         hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02532         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>, 0);
02533         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o2">hcint</a>, 0xFFFFFFFF);
02534 <span class="preprocessor">#ifdef DEBUG</span>
02535 <span class="preprocessor"></span>        DWC_TIMER_CANCEL(core_if-&gt;hc_xfer_timer[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>]);
02536 <span class="preprocessor">#endif</span>
02537 <span class="preprocessor"></span>}
02538 
<a name="l02549"></a><a class="code" href="dwc__otg__cil_8c.html#a31">02549</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a31">hc_set_even_odd_frame</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
02550                                          <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc, <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> * hcchar)
02551 {
02552         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_INTR ||
02553             hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC) {
02554                 <a class="code" href="unionhfnum__data.html">hfnum_data_t</a> hfnum;
02555                 hfnum.<a class="code" href="unionhfnum__data.html#o0">d32</a> =
02556                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o2">hfnum</a>);
02557 
02558                 <span class="comment">/* 1 if _next_ frame is odd, 0 if it's even */</span>
02559                 hcchar-&gt;<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o9">oddfrm</a> = (hfnum.<a class="code" href="unionhfnum__data.html#o3">b</a>.<a class="code" href="unionhfnum__data.html#o1">frnum</a> &amp; 0x1) ? 0 : 1;
02560 <span class="preprocessor">#ifdef DEBUG</span>
02561 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_INTR &amp;&amp; hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>
02562                     &amp;&amp; !hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a>) {
02563                         <span class="keywordflow">switch</span> (hfnum.<a class="code" href="unionhfnum__data.html#o3">b</a>.<a class="code" href="unionhfnum__data.html#o1">frnum</a> &amp; 0x7) {
02564                         <span class="keywordflow">case</span> 7:
02565                                 core_if-&gt;hfnum_7_samples++;
02566                                 core_if-&gt;hfnum_7_frrem_accum += hfnum.<a class="code" href="unionhfnum__data.html#o3">b</a>.<a class="code" href="unionhfnum__data.html#o2">frrem</a>;
02567                                 <span class="keywordflow">break</span>;
02568                         <span class="keywordflow">case</span> 0:
02569                                 core_if-&gt;hfnum_0_samples++;
02570                                 core_if-&gt;hfnum_0_frrem_accum += hfnum.<a class="code" href="unionhfnum__data.html#o3">b</a>.<a class="code" href="unionhfnum__data.html#o2">frrem</a>;
02571                                 <span class="keywordflow">break</span>;
02572                         <span class="keywordflow">default</span>:
02573                                 core_if-&gt;hfnum_other_samples++;
02574                                 core_if-&gt;hfnum_other_frrem_accum +=
02575                                     hfnum.<a class="code" href="unionhfnum__data.html#o3">b</a>.<a class="code" href="unionhfnum__data.html#o2">frrem</a>;
02576                                 <span class="keywordflow">break</span>;
02577                         }
02578                 }
02579 <span class="preprocessor">#endif</span>
02580 <span class="preprocessor"></span>        }
02581 }
02582 
02583 <span class="preprocessor">#ifdef DEBUG</span>
02584 <span class="preprocessor"></span><span class="keywordtype">void</span> hc_xfer_timeout(<span class="keywordtype">void</span> *ptr)
02585 {
02586         hc_xfer_info_t *xfer_info = NULL;
02587         <span class="keywordtype">int</span> hc_num = 0;
02588 
02589         <span class="keywordflow">if</span> (ptr)
02590                 xfer_info = (hc_xfer_info_t *) ptr;
02591 
02592         <span class="keywordflow">if</span> (!xfer_info-&gt;hc) {
02593                 DWC_ERROR(<span class="stringliteral">"xfer_info-&gt;hc = %p\n"</span>, xfer_info-&gt;hc);
02594                 <span class="keywordflow">return</span>;
02595         }
02596 
02597         hc_num = xfer_info-&gt;hc-&gt;hc_num;
02598         DWC_WARN(<span class="stringliteral">"%s: timeout on channel %d\n"</span>, __func__, hc_num);
02599         DWC_WARN(<span class="stringliteral">"      start_hcchar_val 0x%08x\n"</span>,
02600                  xfer_info-&gt;core_if-&gt;start_hcchar_val[hc_num]);
02601 }
02602 <span class="preprocessor">#endif</span>
02603 <span class="preprocessor"></span>
02604 <span class="keywordtype">void</span> ep_xfer_timeout(<span class="keywordtype">void</span> *ptr)
02605 {
02606         ep_xfer_info_t *xfer_info = NULL;
02607         <span class="keywordtype">int</span> ep_num = 0;
02608         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="unionhfnum__data.html#o0">d32</a> = 0 };
02609         <a class="code" href="uniongintsts__data.html">gintsts_data_t</a> gintsts = {.<a class="code" href="unionhfnum__data.html#o0">d32</a> = 0 };
02610         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> gintmsk = {.<a class="code" href="unionhfnum__data.html#o0">d32</a> = 0 };
02611 
02612         <span class="keywordflow">if</span> (ptr)
02613                 xfer_info = (ep_xfer_info_t *) ptr;
02614 
02615         <span class="keywordflow">if</span> (!xfer_info-&gt;ep) {
02616                 DWC_ERROR(<span class="stringliteral">"xfer_info-&gt;ep = %p\n"</span>, xfer_info-&gt;ep);
02617                 <span class="keywordflow">return</span>;
02618         }
02619 
02620         ep_num = xfer_info-&gt;ep-&gt;num;
02621         DWC_WARN(<span class="stringliteral">"%s: timeout on endpoit %d\n"</span>, __func__, ep_num);
02622         <span class="comment">/* Put the sate to 2 as it was time outed */</span>
02623         xfer_info-&gt;state = 2;
02624 
02625         dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;xfer_info-&gt;core_if-&gt;
02626                 dev_if-&gt;dev_global_regs-&gt;dctl);
02627         gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;xfer_info-&gt;core_if-&gt;
02628                 core_global_regs-&gt;gintsts);
02629         gintmsk.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = DWC_READ_REG32(&amp;xfer_info-&gt;core_if-&gt;
02630                 core_global_regs-&gt;gintmsk);
02631 
02632         <span class="keywordflow">if</span> (!gintmsk.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o8">goutnakeff</a>) {
02633                 <span class="comment">/* Unmask it */</span>
02634                 gintmsk.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o8">goutnakeff</a> = 1;
02635                 DWC_WRITE_REG32(&amp;xfer_info-&gt;core_if-&gt;
02636                         core_global_regs-&gt;gintmsk, gintmsk.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
02637 
02638         }
02639 
02640         <span class="keywordflow">if</span> (!gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o8">goutnakeff</a>) {
02641                 dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o8">sgoutnak</a> = 1;
02642         }
02643         DWC_WRITE_REG32(&amp;xfer_info-&gt;core_if-&gt;dev_if-&gt;
02644                 dev_global_regs-&gt;dctl, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
02645 
02646 }
02647 
02648 <span class="keywordtype">void</span> set_pid_isoc(<a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02649 {
02650         <span class="comment">/* Set up the initial PID for the transfer. */</span>
02651         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o4">speed</a> == DWC_OTG_EP_SPEED_HIGH) {
02652                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02653                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a> == 1) {
02654                                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_DATA0;
02655                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a> == 2) {
02656                                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_DATA1;
02657                         } <span class="keywordflow">else</span> {
02658                                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_DATA2;
02659                         }
02660                 } <span class="keywordflow">else</span> {
02661                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a> == 1) {
02662                                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_DATA0;
02663                         } <span class="keywordflow">else</span> {
02664                                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_MDATA;
02665                         }
02666                 }
02667         } <span class="keywordflow">else</span> {
02668                 hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> = DWC_OTG_HC_PID_DATA0;
02669         }
02670 }
02671 
<a name="l02703"></a><a class="code" href="dwc__otg__cil_8h.html#a94">02703</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a94">dwc_otg_hc_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02704 {
02705         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02706         <a class="code" href="unionhctsiz__data.html">hctsiz_data_t</a> hctsiz;
02707         uint16_t num_packets;
02708         uint32_t max_hc_xfer_size = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o16">max_transfer_size</a>;
02709         uint16_t max_hc_pkt_count = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o17">max_packet_count</a>;
02710         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02711 
02712         hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a> = 0;
02713 
02714         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_6">do_ping</a>) {
02715                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
02716                         <a class="code" href="dwc__otg__cil_8h.html#a96">dwc_otg_hc_do_ping</a>(core_if, hc);
02717                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_5">xfer_started</a> = 1;
02718                         <span class="keywordflow">return</span>;
02719                 } <span class="keywordflow">else</span> {
02720                         hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o4">dopng</a> = 1;
02721                 }
02722         }
02723 
02724         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02725                 num_packets = 1;
02726 
02727                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_12">complete_split</a> &amp;&amp; !hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02728                         <span class="comment">/* For CSPLIT OUT Transfer, set the size to 0 so the</span>
02729 <span class="comment">                         * core doesn't expect any data written to the FIFO */</span>
02730                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = 0;
02731                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a> || (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>)) {
02732                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02733                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a> &amp;&amp; (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; 188)) {
02734                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = 188;
02735                 }
02736 
02737                 hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o1">xfersize</a> = hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a>;
02738         } <span class="keywordflow">else</span> {
02739                 <span class="comment">/*</span>
02740 <span class="comment">                 * Ensure that the transfer length and packet count will fit</span>
02741 <span class="comment">                 * in the widths allocated for them in the HCTSIZn register.</span>
02742 <span class="comment">                 */</span>
02743                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_INTR ||
02744                     hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC) {
02745                         <span class="comment">/*</span>
02746 <span class="comment">                         * Make sure the transfer size is no larger than one</span>
02747 <span class="comment">                         * (micro)frame's worth of data. (A check was done</span>
02748 <span class="comment">                         * when the periodic transfer was accepted to ensure</span>
02749 <span class="comment">                         * that a (micro)frame's worth of data can be</span>
02750 <span class="comment">                         * programmed into a channel.)</span>
02751 <span class="comment">                         */</span>
02752                         uint32_t max_periodic_len =
02753                             hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a> * hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02754                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; max_periodic_len) {
02755                                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = max_periodic_len;
02756                         } <span class="keywordflow">else</span> {
02757                         }
02758                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; max_hc_xfer_size) {
02759                         <span class="comment">/* Make sure that xfer_len is a multiple of max packet size. */</span>
02760                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = max_hc_xfer_size - hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a> + 1;
02761                 }
02762 
02763                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; 0) {
02764                         num_packets =
02765                             (hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> + hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a> -
02766                              1) / hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02767                         <span class="keywordflow">if</span> (num_packets &gt; max_hc_pkt_count) {
02768                                 num_packets = max_hc_pkt_count;
02769                                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = num_packets * hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02770                         }
02771                 } <span class="keywordflow">else</span> {
02772                         <span class="comment">/* Need 1 packet for transfer length of 0. */</span>
02773                         num_packets = 1;
02774                 }
02775 
02776                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02777                         <span class="comment">/* Always program an integral # of max packets for IN transfers. */</span>
02778                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> = num_packets * hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
02779                 }
02780 
02781                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_INTR ||
02782                     hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC) {
02783                         <span class="comment">/*</span>
02784 <span class="comment">                         * Make sure that the multi_count field matches the</span>
02785 <span class="comment">                         * actual transfer length.</span>
02786 <span class="comment">                         */</span>
02787                         hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a> = num_packets;
02788                 }
02789 
02790                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC)
02791                         set_pid_isoc(hc);
02792 
02793                 hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o1">xfersize</a> = hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a>;
02794         }
02795 
02796         hc-&gt;<a class="code" href="structdwc__hc.html#z34_4">start_pkt_count</a> = num_packets;
02797         hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o2">pktcnt</a> = num_packets;
02798         hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o3">pid</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a>;
02799         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o4">hctsiz</a>, hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a>);
02800 
02801         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02802         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Xfer Size: %d\n"</span>, hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o1">xfersize</a>);
02803         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Num Pkts: %d\n"</span>, hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o2">pktcnt</a>);
02804         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Start PID: %d\n"</span>, hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o3">pid</a>);
02805 
02806         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
02807                 dwc_dma_t dma_addr;
02808                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_1">align_buff</a>) {
02809                         dma_addr = hc-&gt;<a class="code" href="structdwc__hc.html#z34_1">align_buff</a>;
02810                 } <span class="keywordflow">else</span> {
02811                         dma_addr = ((<span class="keywordtype">unsigned</span> long)hc-&gt;<a class="code" href="structdwc__hc.html#z34_0">xfer_buff</a> &amp; 0xffffffff);
02812                 }
02813                 DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o5">hcdma</a>, dma_addr);
02814         }
02815 
02816         <span class="comment">/* Start the split */</span>
02817         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02818                 hcsplt_data_t hcsplt;
02819                 hcsplt.d32 = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o1">hcsplt</a>);
02820                 hcsplt.b.spltena = 1;
02821                 DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o1">hcsplt</a>, hcsplt.d32);
02822         }
02823 
02824         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02825         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o7">multicnt</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a>;
02826         <a class="code" href="dwc__otg__cil_8c.html#a31">hc_set_even_odd_frame</a>(core_if, hc, &amp;hcchar);
02827 <span class="preprocessor">#ifdef DEBUG</span>
02828 <span class="preprocessor"></span>        core_if-&gt;start_hcchar_val[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>] = hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>;
02829         <span class="keywordflow">if</span> (hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a>) {
02830                 DWC_WARN(<span class="stringliteral">"%s: chdis set, channel %d, hcchar 0x%08x\n"</span>,
02831                          __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02832         }
02833 <span class="preprocessor">#endif</span>
02834 <span class="preprocessor"></span>
02835         <span class="comment">/* Set host channel enable after all other setup is complete. */</span>
02836         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
02837         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 0;
02838         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02839 
02840         hc-&gt;<a class="code" href="structdwc__hc.html#z34_5">xfer_started</a> = 1;
02841         hc-&gt;<a class="code" href="structdwc__hc.html#z34_17">requests</a>++;
02842 
02843         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> &amp;&amp; !hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a> &amp;&amp; hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> &gt; 0) {
02844                 <span class="comment">/* Load OUT packet into the appropriate Tx FIFO. */</span>
02845                 dwc_otg_hc_write_packet(core_if, hc);
02846         }
02847 <span class="preprocessor">#ifdef DEBUG</span>
02848 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> != DWC_OTG_EP_TYPE_INTR) {
02849                 core_if-&gt;hc_xfer_info[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>].core_if = core_if;
02850                 core_if-&gt;hc_xfer_info[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>].hc = hc;
02851 
02852                 <span class="comment">/* Start a timer for this transfer. */</span>
02853                 DWC_TIMER_SCHEDULE(core_if-&gt;hc_xfer_timer[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>], 10000);
02854         }
02855 <span class="preprocessor">#endif</span>
02856 <span class="preprocessor"></span>}
02857 
<a name="l02872"></a><a class="code" href="dwc__otg__cil_8h.html#a100">02872</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a100">dwc_otg_hc_start_transfer_ddma</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02873 {
02874         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02875         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02876         <a class="code" href="unionhctsiz__data.html">hctsiz_data_t</a> hctsiz;
02877         <a class="code" href="unionhcdma__data.html">hcdma_data_t</a> hcdma;
02878 
02879         hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a> = 0;
02880 
02881         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_6">do_ping</a>)
02882                 hctsiz.<a class="code" href="unionhctsiz__data.html#o9">b_ddma</a>.<a class="code" href="unionhctsiz__data.html#o4">dopng</a> = 1;
02883 
02884         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC)
02885                 set_pid_isoc(hc);
02886 
02887         <span class="comment">/* Packet Count and Xfer Size are not used in Descriptor DMA mode */</span>
02888         hctsiz.<a class="code" href="unionhctsiz__data.html#o9">b_ddma</a>.<a class="code" href="unionhctsiz__data.html#o3">pid</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a>;
02889         hctsiz.<a class="code" href="unionhctsiz__data.html#o9">b_ddma</a>.<a class="code" href="unionhctsiz__data.html#o7">ntd</a> = hc-&gt;<a class="code" href="structdwc__hc.html#z36_0">ntd</a> - 1;        <span class="comment">/* 0 - 1 descriptor, 1 - 2 descriptors, etc. */</span>
02890         hctsiz.<a class="code" href="unionhctsiz__data.html#o9">b_ddma</a>.<a class="code" href="unionhctsiz__data.html#o6">schinfo</a> = hc-&gt;<a class="code" href="structdwc__hc.html#z36_2">schinfo</a>;    <span class="comment">/* Non-zero only for high-speed interrupt endpoints */</span>
02891 
02892         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02893         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  Start PID: %d\n"</span>, hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o3">pid</a>);
02894         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  NTD: %d\n"</span>, hctsiz.<a class="code" href="unionhctsiz__data.html#o9">b_ddma</a>.<a class="code" href="unionhctsiz__data.html#o7">ntd</a>);
02895 
02896         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o4">hctsiz</a>, hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a>);
02897 
02898         hcdma.<a class="code" href="unionhcdma__data.html#o0">d32</a> = 0;
02899         hcdma.<a class="code" href="unionhcdma__data.html#o4">b</a>.<a class="code" href="unionhcdma__data.html#o3">dma_addr</a> = ((uint32_t) hc-&gt;<a class="code" href="structdwc__hc.html#z36_1">desc_list_addr</a>) &gt;&gt; 11;
02900 
02901         <span class="comment">/* Always start from first descriptor. */</span>
02902         hcdma.<a class="code" href="unionhcdma__data.html#o4">b</a>.<a class="code" href="unionhcdma__data.html#o2">ctd</a> = 0;
02903         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o5">hcdma</a>, hcdma.<a class="code" href="unionhcdma__data.html#o0">d32</a>);
02904 
02905         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02906         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o7">multicnt</a> = hc-&gt;<a class="code" href="structdwc__hc.html#o8">multi_count</a>;
02907 
02908 <span class="preprocessor">#ifdef DEBUG</span>
02909 <span class="preprocessor"></span>        core_if-&gt;start_hcchar_val[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>] = hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>;
02910         <span class="keywordflow">if</span> (hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a>) {
02911                 DWC_WARN(<span class="stringliteral">"%s: chdis set, channel %d, hcchar 0x%08x\n"</span>,
02912                          __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02913         }
02914 <span class="preprocessor">#endif</span>
02915 <span class="preprocessor"></span>
02916         <span class="comment">/* Set host channel enable after all other setup is complete. */</span>
02917         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
02918         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 0;
02919 
02920         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02921 
02922         hc-&gt;<a class="code" href="structdwc__hc.html#z34_5">xfer_started</a> = 1;
02923         hc-&gt;<a class="code" href="structdwc__hc.html#z34_17">requests</a>++;
02924 
02925 <span class="preprocessor">#ifdef DEBUG</span>
02926 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> != DWC_OTG_EP_TYPE_INTR)
02927             &amp;&amp; (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> != DWC_OTG_EP_TYPE_ISOC)) {
02928                 core_if-&gt;hc_xfer_info[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>].core_if = core_if;
02929                 core_if-&gt;hc_xfer_info[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>].hc = hc;
02930                 <span class="comment">/* Start a timer for this transfer. */</span>
02931                 DWC_TIMER_SCHEDULE(core_if-&gt;hc_xfer_timer[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>], 10000);
02932         }
02933 <span class="preprocessor">#endif</span>
02934 <span class="preprocessor"></span>
02935 }
02936 
<a name="l02952"></a><a class="code" href="dwc__otg__cil_8h.html#a95">02952</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__cil_8h.html#a95">dwc_otg_hc_continue_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
02953 {
02954         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
02955 
02956         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_11">do_split</a>) {
02957                 <span class="comment">/* SPLITs always queue just once per channel */</span>
02958                 <span class="keywordflow">return</span> 0;
02959         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o7">data_pid_start</a> == DWC_OTG_HC_PID_SETUP) {
02960                 <span class="comment">/* SETUPs are queued only once since they can't be NAKed. */</span>
02961                 <span class="keywordflow">return</span> 0;
02962         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o3">ep_is_in</a>) {
02963                 <span class="comment">/*</span>
02964 <span class="comment">                 * Always queue another request for other IN transfers. If</span>
02965 <span class="comment">                 * back-to-back INs are issued and NAKs are received for both,</span>
02966 <span class="comment">                 * the driver may still be processing the first NAK when the</span>
02967 <span class="comment">                 * second NAK is received. When the interrupt handler clears</span>
02968 <span class="comment">                 * the NAK interrupt for the first NAK, the second NAK will</span>
02969 <span class="comment">                 * not be seen. So we can't depend on the NAK interrupt</span>
02970 <span class="comment">                 * handler to requeue a NAKed request. Instead, IN requests</span>
02971 <span class="comment">                 * are issued each time this function is called. When the</span>
02972 <span class="comment">                 * transfer completes, the extra requests for the channel will</span>
02973 <span class="comment">                 * be flushed.</span>
02974 <span class="comment">                 */</span>
02975                 <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02976                 <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs =
02977                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02978 
02979                 hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02980                 <a class="code" href="dwc__otg__cil_8c.html#a31">hc_set_even_odd_frame</a>(core_if, hc, &amp;hcchar);
02981                 hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
02982                 hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 0;
02983                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"  IN xfer: hcchar = 0x%08x\n"</span>,
02984                             hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02985                 DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
02986                 hc-&gt;<a class="code" href="structdwc__hc.html#z34_17">requests</a>++;
02987                 <span class="keywordflow">return</span> 1;
02988         } <span class="keywordflow">else</span> {
02989                 <span class="comment">/* OUT transfers. */</span>
02990                 <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#z34_3">xfer_count</a> &lt; hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a>) {
02991                         <span class="keywordflow">if</span> (hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_INTR ||
02992                             hc-&gt;<a class="code" href="structdwc__hc.html#o5">ep_type</a> == DWC_OTG_EP_TYPE_ISOC) {
02993                                 <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
02994                                 <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs;
02995                                 hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
02996                                 hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
02997                                 <a class="code" href="dwc__otg__cil_8c.html#a31">hc_set_even_odd_frame</a>(core_if, hc, &amp;hcchar);
02998                         }
02999 
03000                         <span class="comment">/* Load OUT packet into the appropriate Tx FIFO. */</span>
03001                         dwc_otg_hc_write_packet(core_if, hc);
03002                         hc-&gt;<a class="code" href="structdwc__hc.html#z34_17">requests</a>++;
03003                         <span class="keywordflow">return</span> 1;
03004                 } <span class="keywordflow">else</span> {
03005                         <span class="keywordflow">return</span> 0;
03006                 }
03007         }
03008 }
03009 
<a name="l03014"></a><a class="code" href="dwc__otg__cil_8h.html#a96">03014</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a96">dwc_otg_hc_do_ping</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
03015 {
03016         <a class="code" href="unionhcchar__data.html">hcchar_data_t</a> hcchar;
03017         <a class="code" href="unionhctsiz__data.html">hctsiz_data_t</a> hctsiz;
03018         <a class="code" href="structdwc__otg__hc__regs.html">dwc_otg_hc_regs_t</a> *hc_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
03019 
03020         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a5">DBG_HCDV</a>, <span class="stringliteral">"%s: Channel %d\n"</span>, __func__, hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>);
03021 
03022         hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a> = 0;
03023         hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o4">dopng</a> = 1;
03024         hctsiz.<a class="code" href="unionhctsiz__data.html#o5">b</a>.<a class="code" href="unionhctsiz__data.html#o2">pktcnt</a> = 1;
03025         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o4">hctsiz</a>, hctsiz.<a class="code" href="unionhctsiz__data.html#o0">d32</a>);
03026 
03027         hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a> = DWC_READ_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>);
03028         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o11">chen</a> = 1;
03029         hcchar.<a class="code" href="unionhcchar__data.html#o12">b</a>.<a class="code" href="unionhcchar__data.html#o10">chdis</a> = 0;
03030         DWC_WRITE_REG32(&amp;hc_regs-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>, hcchar.<a class="code" href="unionhcchar__data.html#o0">d32</a>);
03031 }
03032 
03033 <span class="comment">/*</span>
03034 <span class="comment"> * This function writes a packet into the Tx FIFO associated with the Host</span>
03035 <span class="comment"> * Channel. For a channel associated with a non-periodic EP, the non-periodic</span>
03036 <span class="comment"> * Tx FIFO is written. For a channel associated with a periodic EP, the</span>
03037 <span class="comment"> * periodic Tx FIFO is written. This function should only be called in Slave</span>
03038 <span class="comment"> * mode.</span>
03039 <span class="comment"> *</span>
03040 <span class="comment"> * Upon return the xfer_buff and xfer_count fields in _hc are incremented by</span>
03041 <span class="comment"> * then number of bytes written to the Tx FIFO.</span>
03042 <span class="comment"> */</span>
03043 <span class="keywordtype">void</span> dwc_otg_hc_write_packet(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__hc.html">dwc_hc_t</a> * hc)
03044 {
03045         uint32_t i;
03046         uint32_t remaining_count;
03047         uint32_t byte_count;
03048         uint32_t dword_count;
03049 
03050         uint32_t *data_buff = (uint32_t *) (hc-&gt;<a class="code" href="structdwc__hc.html#z34_0">xfer_buff</a>);
03051         uint32_t *data_fifo = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[hc-&gt;<a class="code" href="structdwc__hc.html#o0">hc_num</a>];
03052 
03053         remaining_count = hc-&gt;<a class="code" href="structdwc__hc.html#z34_2">xfer_len</a> - hc-&gt;<a class="code" href="structdwc__hc.html#z34_3">xfer_count</a>;
03054         <span class="keywordflow">if</span> (remaining_count &gt; hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>) {
03055                 byte_count = hc-&gt;<a class="code" href="structdwc__hc.html#o6">max_packet</a>;
03056         } <span class="keywordflow">else</span> {
03057                 byte_count = remaining_count;
03058         }
03059 
03060         dword_count = (byte_count + 3) / 4;
03061 
03062         <span class="keywordflow">if</span> ((((<span class="keywordtype">unsigned</span> long)data_buff) &amp; 0x3) == 0) {
03063                 <span class="comment">/* xfer_buff is DWORD aligned. */</span>
03064                 <span class="keywordflow">for</span> (i = 0; i &lt; dword_count; i++, data_buff++) {
03065                         DWC_WRITE_REG32(data_fifo, *data_buff);
03066                 }
03067         } <span class="keywordflow">else</span> {
03068                 <span class="comment">/* xfer_buff is not DWORD aligned. */</span>
03069                 <span class="keywordflow">for</span> (i = 0; i &lt; dword_count; i++, data_buff++) {
03070                         uint32_t data;
03071                         data =
03072                             (data_buff[0] | data_buff[1] &lt;&lt; 8 | data_buff[2] &lt;&lt;
03073                              16 | data_buff[3] &lt;&lt; 24);
03074                         DWC_WRITE_REG32(data_fifo, data);
03075                 }
03076         }
03077 
03078         hc-&gt;<a class="code" href="structdwc__hc.html#z34_3">xfer_count</a> += byte_count;
03079         hc-&gt;<a class="code" href="structdwc__hc.html#z34_0">xfer_buff</a> += byte_count;
03080 }
03081 
<a name="l03086"></a><a class="code" href="dwc__otg__cil_8h.html#a77">03086</a> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a77">dwc_otg_get_frame_number</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
03087 {
03088         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts;
03089         dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
03090 
03091         <span class="comment">/* read current frame/microframe number from DSTS register */</span>
03092         <span class="keywordflow">return</span> dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o5">soffn</a>;
03093 }
03094 
<a name="l03102"></a><a class="code" href="dwc__otg__cil_8h.html#a101">03102</a> uint32_t <a class="code" href="dwc__otg__cil_8h.html#a101">calc_frame_interval</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
03103 {
03104         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg;
03105         <a class="code" href="unionhwcfg2__data.html">hwcfg2_data_t</a> hwcfg2;
03106         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
03107         <span class="keywordtype">int</span> clock = 60;         <span class="comment">// default value</span>
03108         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
03109         hwcfg2.<a class="code" href="unionhwcfg2__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o18">ghwcfg2</a>);
03110         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
03111         <span class="keywordflow">if</span> (!usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp; usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a>)
03112                 clock = 60;
03113         <span class="keywordflow">if</span> (usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp; hwcfg2.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 3)
03114                 clock = 48;
03115         <span class="keywordflow">if</span> (!usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o11">phylpwrclksel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp;
03116             !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> &amp;&amp; usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a>)
03117                 clock = 30;
03118         <span class="keywordflow">if</span> (!usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o11">phylpwrclksel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp;
03119             !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a>)
03120                 clock = 60;
03121         <span class="keywordflow">if</span> (usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o11">phylpwrclksel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp;
03122             !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o3">ulpi_utmi_sel</a> &amp;&amp; usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a>)
03123                 clock = 48;
03124         <span class="keywordflow">if</span> (usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp; !usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o2">phyif</a> &amp;&amp; hwcfg2.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 2)
03125                 clock = 48;
03126         <span class="keywordflow">if</span> (usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o5">physel</a> &amp;&amp; hwcfg2.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 1)
03127                 clock = 48;
03128         <span class="keywordflow">if</span> (hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o14">prtspd</a> == 0)
03129                 <span class="comment">/* High speed case */</span>
03130                 <span class="keywordflow">return</span> 125 * clock;
03131         <span class="keywordflow">else</span>
03132                 <span class="comment">/* FS/LS case */</span>
03133                 <span class="keywordflow">return</span> 1000 * clock;
03134 }
03135 
<a name="l03144"></a><a class="code" href="dwc__otg__cil_8h.html#a76">03144</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a76">dwc_otg_read_setup_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t * dest)
03145 {
03146         <span class="comment">/* Get the 8 bytes of a setup transaction data */</span>
03147 
03148         <span class="comment">/* Pop 2 DWORDS off the receive data FIFO into memory */</span>
03149         dest[0] = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[0]);
03150         dest[1] = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[0]);
03151 }
03152 
<a name="l03161"></a><a class="code" href="dwc__otg__cil_8h.html#a78">03161</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a78">dwc_otg_ep0_activate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03162 {
03163         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
03164         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts;
03165         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> diepctl;
03166         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> doepctl;
03167         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.d32 = 0 };
03168 
03169         <span class="comment">/* Read the Device Status and Endpoint 0 Control registers */</span>
03170         dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
03171         diepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
03172         doepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
03173 
03174         <span class="comment">/* Set the MPS of the IN EP based on the enumeration speed */</span>
03175         <span class="keywordflow">switch</span> (dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o2">enumspd</a>) {
03176         <span class="keywordflow">case</span> DWC_DSTS_ENUMSPD_HS_PHY_30MHZ_OR_60MHZ:
03177         <span class="keywordflow">case</span> DWC_DSTS_ENUMSPD_FS_PHY_30MHZ_OR_60MHZ:
03178         <span class="keywordflow">case</span> DWC_DSTS_ENUMSPD_FS_PHY_48MHZ:
03179                 diepctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o1">mps</a> = DWC_DEP0CTL_MPS_64;
03180                 <span class="keywordflow">break</span>;
03181         <span class="keywordflow">case</span> DWC_DSTS_ENUMSPD_LS_PHY_6MHZ:
03182                 diepctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o1">mps</a> = DWC_DEP0CTL_MPS_8;
03183                 <span class="keywordflow">break</span>;
03184         }
03185 
03186         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, diepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03187 
03188         <span class="comment">/* Enable OUT EP for receive */</span>
03189         doepctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
03190         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>, doepctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03191 
03192 <span class="preprocessor">#ifdef VERBOSE</span>
03193 <span class="preprocessor"></span>        <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"doepctl0=%0x\n"</span>,
03194                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>));
03195         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"diepctl0=%0x\n"</span>,
03196                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>));
03197 <span class="preprocessor">#endif</span>
03198 <span class="preprocessor"></span>        dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o7">cgnpinnak</a> = 1;
03199 
03200         DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
03201         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"dctl=%0x\n"</span>,
03202                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>));
03203 
03204 }
03205 
<a name="l03214"></a><a class="code" href="dwc__otg__cil_8h.html#a79">03214</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a79">dwc_otg_ep_activate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03215 {
03216         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
03217         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
03218         <span class="keyword">volatile</span> uint32_t *addr;
03219         <a class="code" href="uniondaint__data.html">daint_data_t</a> daintmsk = {.d32 = 0 };
03220         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
03221         uint8_t i;
03222 
03223         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"%s() EP%d-%s\n"</span>, __func__, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>,
03224                     (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> ? <span class="stringliteral">"IN"</span> : <span class="stringliteral">"OUT"</span>));
03225 
03226 <span class="preprocessor">#ifdef DWC_UTE_PER_IO</span>
03227 <span class="preprocessor"></span>        ep-&gt;xiso_frame_num = 0xFFFFFFFF;
03228         ep-&gt;xiso_active_xfers = 0;
03229         ep-&gt;xiso_queued_xfers = 0;
03230 <span class="preprocessor">#endif</span>
03231 <span class="preprocessor"></span>        <span class="comment">/* Read DEPCTLn register */</span>
03232         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03233                 addr = &amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>;
03234                 daintmsk.<a class="code" href="uniondaint__data.html#o3">ep</a>.<a class="code" href="uniondaint__data.html#o1">in</a> = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03235         } <span class="keywordflow">else</span> {
03236                 addr = &amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>;
03237                 daintmsk.<a class="code" href="uniondaint__data.html#o3">ep</a>.<a class="code" href="uniondaint__data.html#o2">out</a> = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03238         }
03239 
03240         <span class="comment">/* If the EP is already active don't change the EP Control</span>
03241 <span class="comment">         * register. */</span>
03242         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
03243         <span class="keywordflow">if</span> (!depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o3">usbactep</a>) {
03244                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o1">mps</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03245                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o6">eptype</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a>;
03246                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o9">txfnum</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o3">tx_fifo_num</a>;
03247 
03248                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC) {
03249                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;  <span class="comment">// ???</span>
03250                 } <span class="keywordflow">else</span> {
03251                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;
03252                 }
03253                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o3">usbactep</a> = 1;
03254 
03255                 <span class="comment">/* Update nextep_seq array and EPMSCNT in DCFG*/</span>
03256                 <span class="keywordflow">if</span> (!(depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o6">eptype</a> &amp; 1) &amp;&amp; (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1)) {       <span class="comment">// NP IN EP</span>
03257                         <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
03258                                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i] == core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a>)
03259                                 <span class="keywordflow">break</span>;
03260                         }
03261                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i] = ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;       
03262                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>] = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a>;
03263                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
03264                         dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
03265                         dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o8">epmscnt</a>++;
03266                         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
03267 
03268                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>,<span class="stringliteral">"%s first_in_nextep_seq= %2d; nextep_seq[]:\n"</span>, 
03269                                 __func__, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a>);
03270                         <span class="keywordflow">for</span> (i=0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
03271                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"%2d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i]);
03272                         }
03273 
03274                 }
03275 
03276 
03277                 DWC_WRITE_REG32(addr, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03278                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"DEPCTL=%08x\n"</span>, DWC_READ_REG32(addr));
03279         }
03280 
03281         <span class="comment">/* Enable the Interrupt for this EP */</span>
03282         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
03283                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03284                         <a class="code" href="uniondiepint__data.html">diepmsk_data_t</a> diepmsk = {.<a class="code" href="uniondcfg__data.html#o0">d32</a> = 0 };
03285                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o1">xfercompl</a> = 1;
03286                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o4">timeout</a> = 1;
03287                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o2">epdisabled</a> = 1;
03288                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o3">ahberr</a> = 1;
03289                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o6">intknepmis</a> = 1;
03290                         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>)
03291                                 diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o6">intknepmis</a> = 0; 
03292                         diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o9">txfifoundrn</a> = 1;      <span class="comment">//?????</span>
03293                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC) {
03294                                 diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o12">nak</a> = 1;
03295                         }
03296 
03297                         
03298                         
03299 <span class="comment">/*</span>
03300 <span class="comment">                        if (core_if-&gt;dma_desc_enable) {</span>
03301 <span class="comment">                                diepmsk.b.bna = 1;</span>
03302 <span class="comment">                        }</span>
03303 <span class="comment">*/</span>
03304 <span class="comment">/*                      </span>
03305 <span class="comment">                        if (core_if-&gt;dma_enable) {</span>
03306 <span class="comment">                                doepmsk.b.nak = 1;</span>
03307 <span class="comment">                        }</span>
03308 <span class="comment">*/</span>
03309                         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
03310                                         diepeachintmsk[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>], diepmsk.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
03311 
03312                 } <span class="keywordflow">else</span> {
03313                         <a class="code" href="uniondoepint__data.html">doepmsk_data_t</a> doepmsk = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0 };
03314                         doepmsk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o1">xfercompl</a> = 1;
03315                         doepmsk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o3">ahberr</a> = 1;
03316                         doepmsk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o2">epdisabled</a> = 1;
03317                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC)
03318                                 doepmsk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o5">outtknepdis</a> = 1;
03319 
03320 <span class="comment">/*                      </span>
03321 <span class="comment"></span>
03322 <span class="comment">                        if (core_if-&gt;dma_desc_enable) {</span>
03323 <span class="comment">                                doepmsk.b.bna = 1;</span>
03324 <span class="comment">                        }</span>
03325 <span class="comment">*/</span>
03326 <span class="comment">/*                      </span>
03327 <span class="comment">                        doepmsk.b.babble = 1;</span>
03328 <span class="comment">                        doepmsk.b.nyet = 1;</span>
03329 <span class="comment">                        doepmsk.b.nak = 1;</span>
03330 <span class="comment">*/</span>
03331                         DWC_WRITE_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
03332                                         doepeachintmsk[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>], doepmsk.<a class="code" href="uniondoepint__data.html#o0">d32</a>);
03333                 }
03334                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o15">deachintmsk</a>,
03335                                  0, daintmsk.<a class="code" href="uniondaint__data.html#o0">d32</a>);
03336         } <span class="keywordflow">else</span> {
03337                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC) {
03338                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a>)
03339                         {
03340                                 <a class="code" href="uniondiepint__data.html">diepmsk_data_t</a> diepmsk = {.<a class="code" href="uniondoepint__data.html#o0">d32</a> = 0 };
03341                                 diepmsk.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o12">nak</a> = 1;
03342                                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>, 0, diepmsk.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
03343                         } <span class="keywordflow">else</span> {
03344                                 <a class="code" href="uniondoepint__data.html">doepmsk_data_t</a> doepmsk = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0 };
03345                                 doepmsk.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o5">outtknepdis</a> = 1;
03346                                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>, 0, doepmsk.<a class="code" href="uniondoepint__data.html#o0">d32</a>);
03347                         }
03348                 }
03349                 DWC_MODIFY_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>,
03350                                  0, daintmsk.<a class="code" href="uniondaint__data.html#o0">d32</a>);
03351         }
03352 
03353         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"DAINTMSK=%0x\n"</span>,
03354                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>));
03355 
03356         ep-&gt;<a class="code" href="structdwc__ep.html#z32_9">stall_clear_flag</a> = 0;
03357 
03358         <span class="keywordflow">return</span>;
03359 }
03360 
<a name="l03369"></a><a class="code" href="dwc__otg__cil_8h.html#a80">03369</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a80">dwc_otg_ep_deactivate</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03370 {
03371         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl = {.d32 = 0 };
03372         <span class="keyword">volatile</span> uint32_t *addr;
03373         <a class="code" href="uniondaint__data.html">daint_data_t</a> daintmsk = {.d32 = 0 };
03374         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
03375         uint8_t i = 0;
03376 
03377 <span class="preprocessor">#ifdef DWC_UTE_PER_IO</span>
03378 <span class="preprocessor"></span>        ep-&gt;xiso_frame_num = 0xFFFFFFFF;
03379         ep-&gt;xiso_active_xfers = 0;
03380         ep-&gt;xiso_queued_xfers = 0;
03381 <span class="preprocessor">#endif</span>
03382 <span class="preprocessor"></span>
03383         <span class="comment">/* Read DEPCTLn register */</span>
03384         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03385                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>;
03386                 daintmsk.<a class="code" href="uniondaint__data.html#o3">ep</a>.<a class="code" href="uniondaint__data.html#o1">in</a> = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03387         } <span class="keywordflow">else</span> {
03388                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>;
03389                 daintmsk.<a class="code" href="uniondaint__data.html#o3">ep</a>.<a class="code" href="uniondaint__data.html#o2">out</a> = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03390         }
03391 
03392         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
03393 
03394         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o3">usbactep</a> = 0;
03395         
03396         <span class="comment">/* Update nextep_seq array and EPMSCNT in DCFG*/</span>
03397         <span class="keywordflow">if</span> (!(depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o6">eptype</a> &amp; 1) &amp;&amp; ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) { <span class="comment">// NP EP IN</span>
03398                 <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
03399                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i] == ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>)
03400                         <span class="keywordflow">break</span>;
03401                 }
03402                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i] = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];  
03403                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a> == ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>)
03404                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a> = i;
03405                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>] = 0xff;
03406                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = 0;
03407                 dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
03408                 dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o8">epmscnt</a>--;
03409                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
03410 
03411                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>,<span class="stringliteral">"%s first_in_nextep_seq= %2d; nextep_seq[]:\n"</span>, 
03412                                 __func__, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o51">first_in_nextep_seq</a>);
03413                         <span class="keywordflow">for</span> (i=0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
03414                                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"%2d\n"</span>, core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[i]);
03415                         }
03416         }
03417                 
03418         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1)
03419                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o9">txfnum</a> = 0;
03420 
03421         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>)
03422                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
03423 
03424         DWC_WRITE_REG32(addr, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03425         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
03426         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> &amp;&amp; ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC &amp;&amp; depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a>)
03427         {
03428                 <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl = {.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0};
03429                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a>)
03430                 {
03431                         <a class="code" href="uniondiepint__data.html">diepint_data_t</a> diepint = {.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0};
03432                         
03433                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o11">snak</a> = 1;
03434                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepctl, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03435                         <span class="keywordflow">do</span> 
03436                         {
03437                                 dwc_udelay(10);
03438                                 diepint.<a class="code" href="uniondiepint__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
03439                                                                                         in_ep_regs[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint);
03440                         } <span class="keywordflow">while</span> (!diepint.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o7">inepnakeff</a>); 
03441                         diepint.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o7">inepnakeff</a> = 1;
03442                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
03443                                                         in_ep_regs[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint, diepint.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
03444                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
03445                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
03446                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepctl, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03447                         <span class="keywordflow">do</span> 
03448                         {
03449                                 dwc_udelay(10);
03450                                 diepint.<a class="code" href="uniondiepint__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
03451                                                                                         in_ep_regs[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint);
03452                         } <span class="keywordflow">while</span> (!diepint.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o2">epdisabled</a>); 
03453                         diepint.<a class="code" href="uniondiepint__data.html#o14">b</a>.<a class="code" href="uniondiepint__data.html#o2">epdisabled</a> = 1;
03454                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;diepint, diepint.<a class="code" href="uniondiepint__data.html#o0">d32</a>);
03455                 } <span class="keywordflow">else</span> {
03456                         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0};
03457                         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> gintsts = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0};
03458                         <a class="code" href="uniondoepint__data.html">doepint_data_t</a> doepint = {.<a class="code" href="uniondiepint__data.html#o0">d32</a> = 0};
03459                         dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o8">sgoutnak</a> = 1;
03460                         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, 0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
03461                         <span class="keywordflow">do</span> 
03462                         {
03463                                 dwc_udelay(10);
03464                                 gintsts.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>);
03465                         } <span class="keywordflow">while</span> (!gintsts.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o8">goutnakeff</a>); 
03466                         gintsts.<a class="code" href="uniongintmsk__data.html#o0">d32</a> = 0;
03467                         gintsts.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o8">goutnakeff</a> = 1;
03468                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>, gintsts.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
03469 
03470                         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
03471                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
03472                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o11">snak</a> = 1;
03473                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;doepctl, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03474                         <span class="keywordflow">do</span> 
03475                         {
03476                                 dwc_udelay(10);
03477                                 doepint.<a class="code" href="uniondoepint__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
03478                                                                                         out_ep_regs[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;doepint);
03479                         } <span class="keywordflow">while</span> (!doepint.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o2">epdisabled</a>); 
03480 
03481                         doepint.<a class="code" href="uniondoepint__data.html#o17">b</a>.<a class="code" href="uniondoepint__data.html#o2">epdisabled</a> = 1;
03482                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;doepint, doepint.<a class="code" href="uniondoepint__data.html#o0">d32</a>);
03483 
03484                         dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = 0;
03485                         dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o9">cgoutnak</a> = 1;
03486                         DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>, 0, dctl.<a class="code" href="uniondctl__data.html#o0">d32</a>);
03487                 }               
03488         }
03489 
03490         <span class="comment">/* Disable the Interrupt for this EP */</span>
03491         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o17">multiproc_int_enable</a>) {
03492                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o15">deachintmsk</a>,
03493                                  daintmsk.<a class="code" href="uniondaint__data.html#o0">d32</a>, 0);
03494 
03495                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03496                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
03497                                         diepeachintmsk[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>], 0);
03498                 } <span class="keywordflow">else</span> {
03499                         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
03500                                         doepeachintmsk[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>], 0);
03501                 }
03502         } <span class="keywordflow">else</span> {
03503                 DWC_MODIFY_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>,
03504                                  daintmsk.<a class="code" href="uniondaint__data.html#o0">d32</a>, 0);
03505         }
03506 
03507 }
03508 
<a name="l03515"></a><a class="code" href="dwc__otg__cil_8c.html#a45">03515</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a45">init_dma_desc_chain</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03516 {
03517         <a class="code" href="structdwc__otg__dev__dma__desc.html">dwc_otg_dev_dma_desc_t</a> *dma_desc;
03518         uint32_t offset;
03519         uint32_t xfer_est;
03520         <span class="keywordtype">int</span> i;
03521         <span class="keywordtype">unsigned</span> maxxfer_local, total_len;
03522         
03523         <span class="keywordflow">if</span> (!ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> &amp;&amp; ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_INTR &amp;&amp; 
03524                                         (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>%4)) {
03525                 maxxfer_local = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03526                 total_len = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
03527         } <span class="keywordflow">else</span> {
03528                 maxxfer_local = ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a>;
03529                 total_len = ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a>;
03530         }
03531 
03532         ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> = (total_len / maxxfer_local) +
03533             ((total_len % maxxfer_local) ? 1 : 0);
03534 
03535         <span class="keywordflow">if</span> (!ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a>)
03536                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> = 1;
03537 
03538         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> &gt; MAX_DMA_DESC_CNT)
03539                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> = MAX_DMA_DESC_CNT;
03540 
03541         dma_desc = ep-&gt;<a class="code" href="structdwc__ep.html#z32_2">desc_addr</a>;
03542         <span class="keywordflow">if</span> (maxxfer_local == ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
03543                 <span class="keywordflow">if</span> ((total_len % maxxfer_local) &amp;&amp;
03544                                 (total_len/maxxfer_local &lt; MAX_DMA_DESC_CNT)) {
03545                         xfer_est = (ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> - 1) * maxxfer_local +
03546                                         (total_len % maxxfer_local);
03547                 } <span class="keywordflow">else</span>
03548                         xfer_est = ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a> * maxxfer_local;
03549         }
03550         <span class="keywordflow">else</span>
03551                 xfer_est = total_len;
03552         offset = 0;
03553         <span class="keywordflow">for</span> (i = 0; i &lt; ep-&gt;<a class="code" href="structdwc__ep.html#z32_10">desc_cnt</a>; ++i) {
03555                 <span class="keywordflow">if</span> (xfer_est &gt; maxxfer_local) {
03556                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
03557                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 0;
03558                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 0;
03559                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o7">sp</a> = 0;
03560                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = maxxfer_local;
03561                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a> + offset;
03562                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
03563                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
03564 
03565                         xfer_est -= maxxfer_local;
03566                         offset += maxxfer_local;
03567                 } <span class="keywordflow">else</span> {
03568                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
03569                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 1;
03570                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 1;
03571                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a>) {
03572                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o7">sp</a> =
03573                                     (xfer_est %
03574                                      ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) ? 1 : ((ep-&gt;
03575                                                             sent_zlp) ? 1 : 0);
03576                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = xfer_est;
03577                         } <span class="keywordflow">else</span> {
03578                                 <span class="keywordflow">if</span> (maxxfer_local == ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>)
03579                                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = xfer_est;
03580                                 <span class="keywordflow">else</span>    
03581                                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> =
03582                                                 xfer_est + ((4 - (xfer_est &amp; 0x3)) &amp; 0x3);
03583                         }
03584 
03585                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a> + offset;
03586                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
03587                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
03588                 }
03589                 dma_desc++;
03590         }
03591 }
<a name="l03596"></a><a class="code" href="dwc__otg__cil_8c.html#a46">03596</a> <span class="keyword">static</span> int32_t <a class="code" href="dwc__otg__cil_8c.html#a46">write_isoc_tx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * <a class="code" href="structdwc__ep.html">dwc_ep</a>)
03597 {
03598         <a class="code" href="structdwc__otg__dev__if.html">dwc_otg_dev_if_t</a> *dev_if = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>;
03599         <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *ep_regs;
03600         <a class="code" href="uniondtxfsts__data.html">dtxfsts_data_t</a> txstatus = {.d32 = 0 };
03601         uint32_t len = 0;
03602         <span class="keywordtype">int</span> epnum = dwc_ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03603         <span class="keywordtype">int</span> dwords;
03604 
03605         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"Dedicated TxFifo Empty: %d \n"</span>, epnum);
03606 
03607         ep_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[epnum];
03608 
03609         len = dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
03610 
03611         <span class="keywordflow">if</span> (len &gt; dwc_ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
03612                 len = dwc_ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03613         }
03614 
03615         dwords = (len + 3) / 4;
03616 
03617         <span class="comment">/* While there is space in the queue and space in the FIFO and</span>
03618 <span class="comment">         * More data to tranfer, Write packets to the Tx FIFO */</span>
03619         txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[epnum]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o6">dtxfsts</a>);
03620         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"b4 dtxfsts[%d]=0x%08x\n"</span>, epnum, txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a>);
03621 
03622         <span class="keywordflow">while</span> (txstatus.<a class="code" href="uniondtxfsts__data.html#o3">b</a>.<a class="code" href="uniondtxfsts__data.html#o1">txfspcavail</a> &gt; dwords &amp;&amp;
03623                dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> &lt; dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &amp;&amp;
03624                dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> != 0) {
03625                 <span class="comment">/* Write the FIFO */</span>
03626                 <a class="code" href="dwc__otg__cil_8h.html#a85">dwc_otg_ep_write_packet</a>(core_if, dwc_ep, 0);
03627 
03628                 len = dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - dwc_ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
03629                 <span class="keywordflow">if</span> (len &gt; dwc_ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
03630                         len = dwc_ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03631                 }
03632 
03633                 dwords = (len + 3) / 4;
03634                 txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> =
03635                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[epnum]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o6">dtxfsts</a>);
03636                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"dtxfsts[%d]=0x%08x\n"</span>, epnum,
03637                             txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a>);
03638         }
03639 
03640         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"b4 dtxfsts[%d]=0x%08x\n"</span>, epnum,
03641                     DWC_READ_REG32(&amp;dev_if-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[epnum]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o6">dtxfsts</a>));
03642 
03643         <span class="keywordflow">return</span> 1;
03644 }
<a name="l03655"></a><a class="code" href="dwc__otg__cil_8h.html#a81">03655</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a81">dwc_otg_ep_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03656 {
03657         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
03658         <a class="code" href="uniondeptsiz__data.html">deptsiz_data_t</a> deptsiz;
03659         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> = 0 };
03660 
03661         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a> | <a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>), <span class="stringliteral">"%s()\n"</span>, __func__);
03662         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"ep%d-%s xfer_len=%d xfer_cnt=%d "</span>
03663                     <span class="stringliteral">"xfer_buff=%p start_xfer_buff=%p, total_len = %d\n"</span>,
03664                     ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>, (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> ? <span class="stringliteral">"IN"</span> : <span class="stringliteral">"OUT"</span>), ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>,
03665                     ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>, ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a>, ep-&gt;<a class="code" href="structdwc__ep.html#z32_3">start_xfer_buff</a>,
03666                     ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a>);
03667         <span class="comment">/* IN endpoint */</span>
03668         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03669                 <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *in_regs =
03670                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
03671 
03672                 <a class="code" href="uniongnptxsts__data.html">gnptxsts_data_t</a> gtxstatus;
03673 
03674                 gtxstatus.<a class="code" href="uniongnptxsts__data.html#o0">d32</a> =
03675                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>);
03676 
03677                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0
03678                     &amp;&amp; gtxstatus.<a class="code" href="uniongnptxsts__data.html#o7">b</a>.<a class="code" href="uniongnptxsts__data.html#o2">nptxqspcavail</a> == 0
03679                     &amp;&amp; !core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
03680 <span class="preprocessor">#ifdef DEBUG</span>
03681 <span class="preprocessor"></span>                        DWC_PRINTF(<span class="stringliteral">"TX Queue Full (0x%0x)\n"</span>, gtxstatus.<a class="code" href="uniongnptxsts__data.html#o0">d32</a>);
03682 <span class="preprocessor">#endif</span>
03683 <span class="preprocessor"></span>                        <span class="keywordflow">return</span>;
03684                 }
03685 
03686                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>));
03687                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>));
03688 
03689                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> &gt; ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> / MAX_PKT_CNT)
03690                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> += (ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> &lt; (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>)) ?
03691                                 ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>);
03692                 <span class="keywordflow">else</span> 
03693                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> += (<a class="code" href="dwc__otg__regs_8h.html#a60">MAX_PKT_CNT</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> &lt; (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>)) ?
03694                                  <a class="code" href="dwc__otg__regs_8h.html#a60">MAX_PKT_CNT</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>);
03695 
03696 
03697                 <span class="comment">/* Zero Length Packet? */</span>
03698                 <span class="keywordflow">if</span> ((ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>) == 0) {
03699                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = 0;
03700                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = 1;
03701                 } <span class="keywordflow">else</span> {
03702                         <span class="comment">/* Program the transfer size and packet count</span>
03703 <span class="comment">                         *      as follows: xfersize = N * maxpacket +</span>
03704 <span class="comment">                         *      short_packet pktcnt = N + (short_packet</span>
03705 <span class="comment">                         *      exist ? 1 : 0) </span>
03706 <span class="comment">                         */</span>
03707                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
03708                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> =
03709                             (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> - 1 +
03710                              ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) / ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03711                         <span class="keywordflow">if</span> (deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> &gt; MAX_PKT_CNT) {
03712                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = MAX_PKT_CNT;
03713                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03714                         } 
03715                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC) 
03716                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o3">mc</a> = deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a>;
03717                 }
03718 
03719                 <span class="comment">/* Write the DMA register */</span>
03720                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
03721                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
03722                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> != DWC_OTG_EP_TYPE_ISOC)
03723                                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o3">mc</a> = 1;
03724                                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>,
03725                                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03726                                 DWC_WRITE_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>),
03727                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
03728                         } <span class="keywordflow">else</span> {
03729 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
03730 <span class="preprocessor"></span>                                <span class="comment">/* The descriptor chain should be already initialized by now */</span>
03731                                 <span class="keywordflow">if</span> (ep-&gt;buff_mode != BM_STANDARD) {
03732                                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>,
03733                                                         ep-&gt;descs_dma_addr);
03734                                 } <span class="keywordflow">else</span> {
03735 <span class="preprocessor">#endif</span>
03736 <span class="preprocessor"></span>                                        <a class="code" href="dwc__otg__cil_8c.html#a45">init_dma_desc_chain</a>(core_if, ep);
03738                                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>,
03739                                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_1">dma_desc_addr</a>);
03740 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
03741 <span class="preprocessor"></span>                                }
03742 <span class="preprocessor">#endif</span>
03743 <span class="preprocessor"></span>                        }
03744                 } <span class="keywordflow">else</span> {
03745                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03746                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> != DWC_OTG_EP_TYPE_ISOC) {
03752                                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
03753                                         intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o6">nptxfempty</a> = 1;
03754                                         DWC_MODIFY_REG32
03755                                             (&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>,
03756                                              intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
03757                                 } <span class="keywordflow">else</span> {
03758                                         <span class="comment">/* Enable the Tx FIFO Empty Interrupt for this EP */</span>
03759                                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &gt; 0) {
03760                                                 uint32_t fifoemptymsk = 0;
03761                                                 fifoemptymsk = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03762                                                 DWC_MODIFY_REG32
03763                                                     (&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o13">dtknqr4_fifoemptymsk</a>,
03764                                                      0, fifoemptymsk);
03765 
03766                                         }
03767                                 }
03768                         }  <span class="keywordflow">else</span> {
03769                                          <a class="code" href="dwc__otg__cil_8c.html#a46">write_isoc_tx_fifo</a>(core_if, ep);
03770                         }
03771                 }
03772                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>)
03773                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
03774                 
03775                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC)
03776                 {
03777                         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts = {.d32 = 0};
03778                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a> == 1) {
03779                                 dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> =
03780                                         DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
03781                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> = dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o5">soffn</a> + ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a>;
03782                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &gt; 0x3FFF)
03783                                 {
03784                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_13">frm_overrun</a> = 1;
03785                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &amp;= 0x3FFF;
03786                                 } <span class="keywordflow">else</span> 
03787                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_13">frm_overrun</a> = 0;
03788                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &amp; 0x1) {
03789                                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o13">setd1pid</a> = 1;
03790                                 } <span class="keywordflow">else</span> {
03791                                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;
03792                                 }
03793                         }
03794                 }
03795                 <span class="comment">/* EP enable, IN data in FIFO */</span>
03796                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
03797                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
03798                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03799 
03800         } <span class="keywordflow">else</span> {
03801                 <span class="comment">/* OUT endpoint */</span>
03802                 <a class="code" href="structdwc__otg__dev__out__ep__regs.html">dwc_otg_dev_out_ep_regs_t</a> *out_regs =
03803                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
03804 
03805                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>));
03806                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>));
03807 
03808                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {        
03809                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> &gt; ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> / MAX_PKT_CNT)
03810                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> += (ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> &lt; (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>)) ?
03811                                 ep-&gt;<a class="code" href="structdwc__ep.html#o8">maxxfer</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>);
03812                 <span class="keywordflow">else</span>
03813                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> += (<a class="code" href="dwc__otg__regs_8h.html#a60">MAX_PKT_CNT</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> &lt; (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> 
03814                                         - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>)) ? <a class="code" href="dwc__otg__regs_8h.html#a60">MAX_PKT_CNT</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>);
03815                 }
03816 
03817                 <span class="comment">/* Program the transfer size and packet count as follows:</span>
03818 <span class="comment">                 *</span>
03819 <span class="comment">                 *      pktcnt = N                                                                                </span>
03820 <span class="comment">                 *      xfersize = N * maxpacket</span>
03821 <span class="comment">                 */</span>
03822                 <span class="keywordflow">if</span> ((ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>) == 0) {
03823                         <span class="comment">/* Zero Length Packet */</span>
03824                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03825                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = 1;
03826                 } <span class="keywordflow">else</span> {
03827                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> =
03828                             (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> +
03829                              (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> - 1)) / ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03830                         <span class="keywordflow">if</span> (deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> &gt; MAX_PKT_CNT) {
03831                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = MAX_PKT_CNT;
03832                         }
03833                         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
03834                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> =
03835                                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> + ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
03836                         }
03837                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
03838                 }
03839 
03840                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"ep%d xfersize=%d pktcnt=%d\n"</span>,
03841                             ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a>);
03842 
03843                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
03844                         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
03845                                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>,
03846                                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03847 
03848                                 DWC_WRITE_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>),
03849                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
03850                         } <span class="keywordflow">else</span> {
03851 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
03852 <span class="preprocessor"></span>                                <span class="comment">/* The descriptor chain should be already initialized by now */</span>
03853                                 <span class="keywordflow">if</span> (ep-&gt;buff_mode != BM_STANDARD) {
03854                                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>,
03855                                                         ep-&gt;descs_dma_addr);
03856                                 } <span class="keywordflow">else</span> {
03857 <span class="preprocessor">#endif</span>
03858 <span class="preprocessor"></span>
03859                                         <span class="keywordflow">if</span> (!ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>)
03860                                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a>;
03861                                         <a class="code" href="dwc__otg__cil_8c.html#a45">init_dma_desc_chain</a>(core_if, ep);
03862 
03863                                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a>) {
03864                                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_BULK) {
03865                                                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> +
03866                                                                 (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> - 1)) / ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
03867                                                         deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a>;
03868                                                         <span class="comment">/* Remember initial value of doeptsiz */</span>
03869                                                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o35">start_doeptsiz_val</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>] = deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>;
03870                                                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>,
03871                                                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);                                                                                                   
03872                                                 }
03873                                         }
03875                                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>,
03876                                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_1">dma_desc_addr</a>);
03877 <span class="preprocessor">#ifdef DWC_UTE_CFI</span>
03878 <span class="preprocessor"></span>                                }
03879 <span class="preprocessor">#endif</span>
03880 <span class="preprocessor"></span>                        }
03881                 } <span class="keywordflow">else</span> {
03882                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03883                 }
03884 
03885                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_ISOC)
03886                 {
03887                         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts = {.<a class="code" href="uniondeptsiz__data.html#o0">d32</a> = 0};
03888                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a> == 1) {
03889                                 dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> =
03890                                         DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
03891                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> = dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o5">soffn</a> + ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a>;
03892                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &gt; 0x3FFF)
03893                                 {
03894                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_13">frm_overrun</a> = 1;
03895                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &amp;= 0x3FFF;
03896                                 } <span class="keywordflow">else</span> 
03897                                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_13">frm_overrun</a> = 0;
03898 
03899                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_12">frame_num</a> &amp; 0x1) {
03900                                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o13">setd1pid</a> = 1;
03901                                 } <span class="keywordflow">else</span> {
03902                                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;
03903                                 }
03904                         }
03905                 }
03906 
03907                 <span class="comment">/* EP enable */</span>
03908                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
03909                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
03910 
03911                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
03912 
03913                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DOEPCTL=%08x DOEPTSIZ=%08x\n"</span>,
03914                             DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>),
03915                             DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>));
03916                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DAINTMSK=%08x GINTMSK=%08x\n"</span>,
03917                             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
03918                                            dev_global_regs-&gt;daintmsk),
03919                             DWC_READ_REG32(&amp;core_if-&gt;
03920                                            core_global_regs-&gt;gintmsk));
03921 
03922 
03923                 <span class="comment">/* Timer is scheduling only for out bulk transfers for </span>
03924 <span class="comment">                 * "Device DDMA OUT NAK Enhancement" feature to inform user </span>
03925 <span class="comment">                 * about received data payload in case of timeout </span>
03926 <span class="comment">                 */</span>
03927                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a>) {
03928                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_BULK) {
03929                                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o36">ep_xfer_info</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>].core_if = core_if;
03930                                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o36">ep_xfer_info</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>].ep = ep;
03931                                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o36">ep_xfer_info</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>].state = 1;
03932 
03933                                 <span class="comment">/* Start a timer for this transfer. */</span>
03934                                 DWC_TIMER_SCHEDULE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o37">ep_xfer_timer</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>], 10000);
03935                         }
03936                 }
03937         }
03938 }
03939 
<a name="l03948"></a><a class="code" href="dwc__otg__cil_8h.html#a82">03948</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a82">dwc_otg_ep_start_zl_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
03949 {
03950 
03951         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
03952         <a class="code" href="uniondeptsiz__data.html">deptsiz_data_t</a> deptsiz;
03953         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.d32 = 0 };
03954 
03955         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a> | <a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>), <span class="stringliteral">"%s()\n"</span>, __func__);
03956         DWC_PRINTF(<span class="stringliteral">"zero length transfer is called\n"</span>);
03957 
03958         <span class="comment">/* IN endpoint */</span>
03959         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
03960                 <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *in_regs =
03961                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
03962 
03963                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>));
03964                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>));
03965 
03966                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = 0;
03967                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = 1;
03968 
03969                 <span class="comment">/* Write the DMA register */</span>
03970                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
03971                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
03972                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o3">mc</a> = 1;
03973                                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>,
03974                                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03975                                 DWC_WRITE_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>),
03976                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
03977                         }
03978                 } <span class="keywordflow">else</span> {
03979                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
03985                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
03986                                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o6">nptxfempty</a> = 1;
03987                                 DWC_MODIFY_REG32(&amp;core_if-&gt;
03988                                                  core_global_regs-&gt;gintmsk,
03989                                                  intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
03990                         } <span class="keywordflow">else</span> {
03991                                 <span class="comment">/* Enable the Tx FIFO Empty Interrupt for this EP */</span>
03992                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &gt; 0) {
03993                                         uint32_t fifoemptymsk = 0;
03994                                         fifoemptymsk = 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
03995                                         DWC_MODIFY_REG32(&amp;core_if-&gt;
03996                                                          dev_if-&gt;dev_global_regs-&gt;dtknqr4_fifoemptymsk,
03997                                                          0, fifoemptymsk);
03998                                 }
03999                         }
04000                 }
04001 
04002                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>)
04003                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
04004                 <span class="comment">/* EP enable, IN data in FIFO */</span>
04005                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04006                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04007                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04008 
04009         } <span class="keywordflow">else</span> {
04010                 <span class="comment">/* OUT endpoint */</span>
04011                 <a class="code" href="structdwc__otg__dev__out__ep__regs.html">dwc_otg_dev_out_ep_regs_t</a> *out_regs =
04012                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
04013 
04014                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>));
04015                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a> = DWC_READ_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>));
04016 
04017                 <span class="comment">/* Zero Length Packet */</span>
04018                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04019                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> = 1;
04020 
04021                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04022                         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
04023                                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>,
04024                                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
04025 
04026                                 DWC_WRITE_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>),
04027                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
04028                         }
04029                 } <span class="keywordflow">else</span> {
04030                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
04031                 }
04032 
04033                 <span class="comment">/* EP enable */</span>
04034                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04035                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04036 
04037                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04038 
04039         }
04040 }
04041 
<a name="l04051"></a><a class="code" href="dwc__otg__cil_8h.html#a83">04051</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a83">dwc_otg_ep0_start_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
04052 {
04053         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
04054         <a class="code" href="uniondeptsiz0__data.html">deptsiz0_data_t</a> deptsiz;
04055         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0 };
04056         <a class="code" href="structdwc__otg__dev__dma__desc.html">dwc_otg_dev_dma_desc_t</a> *dma_desc;
04057 
04058         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"ep%d-%s xfer_len=%d xfer_cnt=%d "</span>
04059                     <span class="stringliteral">"xfer_buff=%p start_xfer_buff=%p \n"</span>,
04060                     ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>, (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> ? <span class="stringliteral">"IN"</span> : <span class="stringliteral">"OUT"</span>), ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>,
04061                     ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>, ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a>, ep-&gt;<a class="code" href="structdwc__ep.html#z32_3">start_xfer_buff</a>);
04062 
04063         ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
04064 
04065         <span class="comment">/* IN endpoint */</span>
04066         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
04067                 <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *in_regs =
04068                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0];
04069 
04070                 <a class="code" href="uniongnptxsts__data.html">gnptxsts_data_t</a> gtxstatus;
04071 
04072                 gtxstatus.<a class="code" href="uniongnptxsts__data.html#o0">d32</a> =
04073                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>);
04074 
04075                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0
04076                     &amp;&amp; gtxstatus.<a class="code" href="uniongnptxsts__data.html#o7">b</a>.<a class="code" href="uniongnptxsts__data.html#o2">nptxqspcavail</a> == 0
04077                     &amp;&amp; !core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04078 <span class="preprocessor">#ifdef DEBUG</span>
04079 <span class="preprocessor"></span>                        deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a> = DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>);
04080                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DIEPCTL0=%0x\n"</span>,
04081                                     DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>));
04082                         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DIEPTSIZ0=%0x (sz=%d, pcnt=%d)\n"</span>,
04083                                     deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>,
04084                                     deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a>);
04085                         DWC_PRINTF(<span class="stringliteral">"TX Queue or FIFO Full (0x%0x)\n"</span>,
04086                                    gtxstatus.<a class="code" href="uniongnptxsts__data.html#o0">d32</a>);
04087 <span class="preprocessor">#endif</span>
04088 <span class="preprocessor"></span>                        <span class="keywordflow">return</span>;
04089                 }
04090 
04091                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
04092                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a> = DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>);
04093 
04094                 <span class="comment">/* Zero Length Packet? */</span>
04095                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> == 0) {
04096                         deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> = 0;
04097                         deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a> = 1;
04098                 } <span class="keywordflow">else</span> {
04099                         <span class="comment">/* Program the transfer size and packet count</span>
04100 <span class="comment">                         *      as follows: xfersize = N * maxpacket +</span>
04101 <span class="comment">                         *      short_packet pktcnt = N + (short_packet</span>
04102 <span class="comment">                         *      exist ? 1 : 0) </span>
04103 <span class="comment">                         */</span>
04104                         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &gt; ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
04105                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04106                                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04107                         } <span class="keywordflow">else</span> {
04108                                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
04109                         }
04110                         deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a> = 1;
04111 
04112                 }
04113                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>,
04114                             <span class="stringliteral">"IN len=%d  xfersize=%d pktcnt=%d [%08x]\n"</span>,
04115                             ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a>,
04116                             deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04117 
04118                 <span class="comment">/* Write the DMA register */</span>
04119                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04120                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
04121                                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>,
04122                                                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04123 
04124                                 DWC_WRITE_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>),
04125                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
04126                         } <span class="keywordflow">else</span> {
04127                                 dma_desc = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o18">in_desc_addr</a>;
04128 
04130                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
04131                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 1;
04132                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 1;
04133                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o7">sp</a> =
04134                                     (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> == ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) ? 0 : 1;
04135                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
04136                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>;
04137                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
04138                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
04139 
04141                                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>,
04142                                                 core_if-&gt;
04143                                                 dev_if-&gt;dma_in_desc_addr);
04144                         }
04145                 } <span class="keywordflow">else</span> {
04146                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04147                 }
04148 
04149                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>)
04150                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
04151                 <span class="comment">/* EP enable, IN data in FIFO */</span>
04152                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04153                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04154                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04155 
04160                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04161                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
04162                                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o6">nptxfempty</a> = 1;
04163                                 DWC_MODIFY_REG32(&amp;core_if-&gt;
04164                                                  core_global_regs-&gt;gintmsk,
04165                                                  intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
04166                         } <span class="keywordflow">else</span> {
04167                                 <span class="comment">/* Enable the Tx FIFO Empty Interrupt for this EP */</span>
04168                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &gt; 0) {
04169                                         uint32_t fifoemptymsk = 0;
04170                                         fifoemptymsk |= 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
04171                                         DWC_MODIFY_REG32(&amp;core_if-&gt;
04172                                                          dev_if-&gt;dev_global_regs-&gt;dtknqr4_fifoemptymsk,
04173                                                          0, fifoemptymsk);
04174                                 }
04175                         }
04176                 }
04177         } <span class="keywordflow">else</span> {
04178                 <span class="comment">/* OUT endpoint */</span>
04179                 <a class="code" href="structdwc__otg__dev__out__ep__regs.html">dwc_otg_dev_out_ep_regs_t</a> *out_regs =
04180                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[0];
04181 
04182                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
04183                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a> = DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>);
04184 
04185                 <span class="comment">/* Program the transfer size and packet count as follows:</span>
04186 <span class="comment">                 *      xfersize = N * (maxpacket + 4 - (maxpacket % 4))</span>
04187 <span class="comment">                 *      pktcnt = N                                                                                      */</span>
04188                 <span class="comment">/* Zero Length Packet */</span>
04189                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04190                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a> = 1;
04191 
04192                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"len=%d  xfersize=%d pktcnt=%d\n"</span>,
04193                             ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a>);
04194 
04195                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04196                         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
04197                                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>,
04198                                                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04199 
04200                                 DWC_WRITE_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>),
04201                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
04202                         } <span class="keywordflow">else</span> {
04203                                 dma_desc = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o20">out_desc_addr</a>;
04204 
04206                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
04207                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 1;
04208                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 1;
04209                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04210                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>;
04211                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
04212                                 dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
04213 
04215                                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>,
04216                                                 core_if-&gt;
04217                                                 dev_if-&gt;dma_out_desc_addr);
04218                         }
04219                 } <span class="keywordflow">else</span> {
04220                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04221                 }
04222 
04223                 <span class="comment">/* EP enable */</span>
04224                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04225                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04226                 DWC_WRITE_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>), depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04227         }
04228 }
04229 
<a name="l04239"></a><a class="code" href="dwc__otg__cil_8h.html#a84">04239</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a84">dwc_otg_ep0_continue_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
04240 {
04241         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
04242         <a class="code" href="uniondeptsiz0__data.html">deptsiz0_data_t</a> deptsiz;
04243         <a class="code" href="uniongintmsk__data.html">gintmsk_data_t</a> intr_mask = {.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0 };
04244         <a class="code" href="structdwc__otg__dev__dma__desc.html">dwc_otg_dev_dma_desc_t</a> *dma_desc;
04245 
04246         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
04247                 <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *in_regs =
04248                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[0];
04249                 <a class="code" href="uniongnptxsts__data.html">gnptxsts_data_t</a> tx_status = {.d32 = 0 };
04250 
04251                 tx_status.<a class="code" href="uniongnptxsts__data.html#o0">d32</a> =
04252                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>);
04256                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
04257                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a> = DWC_READ_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>);
04258 
04259                 <span class="comment">/* Program the transfer size and packet count</span>
04260 <span class="comment">                 *      as follows: xfersize = N * maxpacket +</span>
04261 <span class="comment">                 *      short_packet pktcnt = N + (short_packet</span>
04262 <span class="comment">                 *      exist ? 1 : 0) </span>
04263 <span class="comment">                 */</span>
04264 
04265                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
04266                         deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> =
04267                             (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>) &gt;
04268                             ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> ? ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> -
04269                                                              ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>);
04270                         deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a> = 1;
04271                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> == 0) {
04272                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> += deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>;
04273                         } <span class="keywordflow">else</span> {
04274                                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> = deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>;
04275                         }
04276                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04277                 } <span class="keywordflow">else</span> {
04278                         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> =
04279                             (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>) &gt;
04280                             ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> ? ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> : (ep-&gt;<a class="code" href="structdwc__ep.html#z32_8">total_len</a> -
04281                                                              ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>);
04282 
04283                         dma_desc = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o18">in_desc_addr</a>;
04284 
04286                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
04287                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 1;
04288                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 1;
04289                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o7">sp</a> =
04290                             (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> == ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) ? 0 : 1;
04291                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
04292                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>;
04293                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
04294                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
04295 
04297                         DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>,
04298                                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o17">dma_in_desc_addr</a>);
04299                 }
04300 
04301                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>,
04302                             <span class="stringliteral">"IN len=%d  xfersize=%d pktcnt=%d [%08x]\n"</span>,
04303                             ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a>,
04304                             deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04305 
04306                 <span class="comment">/* Write the DMA register */</span>
04307                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o2">architecture</a> == DWC_INT_DMA_ARCH) {
04308                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0)
04309                                 DWC_WRITE_REG32(&amp;(in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>),
04310                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
04311                 }
04312                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>)
04313                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o2">nextep</a> = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o50">nextep_seq</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
04314                 <span class="comment">/* EP enable, IN data in FIFO */</span>
04315                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04316                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04317                 DWC_WRITE_REG32(&amp;in_regs-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04318 
04323                 <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
04324                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
04325                                 <span class="comment">/* First clear it from GINTSTS */</span>
04326                                 intr_mask.<a class="code" href="uniongintmsk__data.html#o33">b</a>.<a class="code" href="uniongintmsk__data.html#o6">nptxfempty</a> = 1;
04327                                 DWC_MODIFY_REG32(&amp;core_if-&gt;
04328                                                  core_global_regs-&gt;gintmsk,
04329                                                  intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>, intr_mask.<a class="code" href="uniongintmsk__data.html#o0">d32</a>);
04330 
04331                         } <span class="keywordflow">else</span> {
04332                                 <span class="comment">/* Enable the Tx FIFO Empty Interrupt for this EP */</span>
04333                                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &gt; 0) {
04334                                         uint32_t fifoemptymsk = 0;
04335                                         fifoemptymsk |= 1 &lt;&lt; ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>;
04336                                         DWC_MODIFY_REG32(&amp;core_if-&gt;
04337                                                          dev_if-&gt;dev_global_regs-&gt;dtknqr4_fifoemptymsk,
04338                                                          0, fifoemptymsk);
04339                                 }
04340                         }
04341                 }
04342         } <span class="keywordflow">else</span> {
04343                 <a class="code" href="structdwc__otg__dev__out__ep__regs.html">dwc_otg_dev_out_ep_regs_t</a> *out_regs =
04344                     core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[0];
04345 
04346                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
04347                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a> = DWC_READ_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>);
04348 
04349                 <span class="comment">/* Program the transfer size and packet count</span>
04350 <span class="comment">                 *      as follows: xfersize = N * maxpacket +</span>
04351 <span class="comment">                 *      short_packet pktcnt = N + (short_packet</span>
04352 <span class="comment">                 *      exist ? 1 : 0) </span>
04353 <span class="comment">                 */</span>
04354                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04355                 deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a> = 1;
04356 
04357                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0) {
04358                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04359                 } <span class="keywordflow">else</span> {
04360                         dma_desc = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o20">out_desc_addr</a>;
04361 
04363                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_BUSY;
04364                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o8">l</a> = 1;
04365                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o6">ioc</a> = 1;
04366                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o1">bytes</a> = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04367                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o1">buf</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>;
04368                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o9">sts</a> = 0;
04369                         dma_desc-&gt;<a class="code" href="structdwc__otg__dev__dma__desc.html#o0">status</a>.<a class="code" href="uniondev__dma__desc__sts.html#o11">b</a>.<a class="code" href="uniondev__dma__desc__sts.html#o10">bs</a> = BS_HOST_READY;
04370 
04372                         DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>,
04373                                         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o19">dma_out_desc_addr</a>);
04374                 }
04375 
04376                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>,
04377                             <span class="stringliteral">"IN len=%d  xfersize=%d pktcnt=%d [%08x]\n"</span>,
04378                             ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o1">xfersize</a>, deptsiz.<a class="code" href="uniondeptsiz0__data.html#o7">b</a>.<a class="code" href="uniondeptsiz0__data.html#o3">pktcnt</a>,
04379                             deptsiz.<a class="code" href="uniondeptsiz0__data.html#o0">d32</a>);
04380 
04381                 <span class="comment">/* Write the DMA register */</span>
04382                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o2">architecture</a> == DWC_INT_DMA_ARCH) {
04383                         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a> == 0)
04384                                 DWC_WRITE_REG32(&amp;(out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>),
04385                                                 (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
04386 
04387                 }
04388 
04389                 <span class="comment">/* EP enable, IN data in FIFO */</span>
04390                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
04391                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
04392                 DWC_WRITE_REG32(&amp;out_regs-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04393 
04394         }
04395 }
04396 
04397 <span class="preprocessor">#ifdef DEBUG</span>
04398 <span class="preprocessor"></span><span class="keywordtype">void</span> dump_msg(<span class="keyword">const</span> u8 * buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length)
04399 {
04400         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> start, num, i;
04401         <span class="keywordtype">char</span> line[52], *p;
04402 
04403         <span class="keywordflow">if</span> (length &gt;= 512)
04404                 <span class="keywordflow">return</span>;
04405         start = 0;
04406         <span class="keywordflow">while</span> (length &gt; 0) {
04407                 num = length &lt; 16u ? length : 16u;
04408                 p = line;
04409                 <span class="keywordflow">for</span> (i = 0; i &lt; num; ++i) {
04410                         <span class="keywordflow">if</span> (i == 8)
04411                                 *p++ = <span class="charliteral">' '</span>;
04412                         DWC_SPRINTF(p, <span class="stringliteral">" %02x"</span>, buf[i]);
04413                         p += 3;
04414                 }
04415                 *p = 0;
04416                 DWC_PRINTF(<span class="stringliteral">"%6x: %s\n"</span>, start, line);
04417                 buf += num;
04418                 start += num;
04419                 length -= num;
04420         }
04421 }
04422 <span class="preprocessor">#else</span>
04423 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dump_msg(<span class="keyword">const</span> u8 * buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length)
04424 {
04425 }
04426 <span class="preprocessor">#endif</span>
04427 <span class="preprocessor"></span>
<a name="l04438"></a><a class="code" href="dwc__otg__cil_8h.html#a85">04438</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a85">dwc_otg_ep_write_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep,
04439                              <span class="keywordtype">int</span> dma)
04440 {
04456         uint32_t i;
04457         uint32_t byte_count;
04458         uint32_t dword_count;
04459         uint32_t *fifo;
04460         uint32_t *data_buff = (uint32_t *) ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a>;
04461 
04462         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a> | <a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>), <span class="stringliteral">"%s(%p,%p)\n"</span>, __func__, core_if,
04463                     ep);
04464         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> &gt;= ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>) {
04465                 DWC_WARN(<span class="stringliteral">"%s() No data for EP%d!!!\n"</span>, __func__, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>);
04466                 <span class="keywordflow">return</span>;
04467         }
04468 
04469         <span class="comment">/* Find the byte length of the packet either short packet or MPS */</span>
04470         <span class="keywordflow">if</span> ((ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>) &lt; ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
04471                 byte_count = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
04472         } <span class="keywordflow">else</span> {
04473                 byte_count = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
04474         }
04475 
04476         <span class="comment">/* Find the DWORD length, padded by extra bytes as neccessary if MPS</span>
04477 <span class="comment">         * is not a multiple of DWORD */</span>
04478         dword_count = (byte_count + 3) / 4;
04479 
04480 <span class="preprocessor">#ifdef VERBOSE</span>
04481 <span class="preprocessor"></span>        dump_msg(ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a>, byte_count);
04482 <span class="preprocessor">#endif</span>
04483 <span class="preprocessor"></span>
04487         fifo = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
04488 
04489         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a> | <a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>), <span class="stringliteral">"fifo=%p buff=%p *p=%08x bc=%d\n"</span>,
04490                     fifo, data_buff, *data_buff, byte_count);
04491 
04492         <span class="keywordflow">if</span> (!dma) {
04493                 <span class="keywordflow">for</span> (i = 0; i &lt; dword_count; i++, data_buff++) {
04494                         DWC_WRITE_REG32(fifo, *data_buff);
04495                 }
04496         }
04497 
04498         ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> += byte_count;
04499         ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a> += byte_count;
04500         ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a> += byte_count;
04501 }
04502 
<a name="l04509"></a><a class="code" href="dwc__otg__cil_8h.html#a86">04509</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a86">dwc_otg_ep_set_stall</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
04510 {
04511         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
04512         <span class="keyword">volatile</span> uint32_t *depctl_addr;
04513 
04514         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"%s ep%d-%s\n"</span>, __func__, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>,
04515                     (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> ? <span class="stringliteral">"IN"</span> : <span class="stringliteral">"OUT"</span>));
04516 
04517         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
04518                 depctl_addr = &amp;(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
04519                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(depctl_addr);
04520 
04521                 <span class="comment">/* set the disable and stall bits */</span>
04522                 <span class="keywordflow">if</span> (depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a>) {
04523                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o14">epdis</a> = 1;
04524                 }
04525                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o8">stall</a> = 1;
04526                 DWC_WRITE_REG32(depctl_addr, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04527         } <span class="keywordflow">else</span> {
04528                 depctl_addr = &amp;(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
04529                 depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(depctl_addr);
04530 
04531                 <span class="comment">/* set the stall bit */</span>
04532                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o8">stall</a> = 1;
04533                 DWC_WRITE_REG32(depctl_addr, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04534         }
04535 
04536         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DEPCTL=%0x\n"</span>, DWC_READ_REG32(depctl_addr));
04537 
04538         <span class="keywordflow">return</span>;
04539 }
04540 
<a name="l04547"></a><a class="code" href="dwc__otg__cil_8h.html#a87">04547</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a87">dwc_otg_ep_clear_stall</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
04548 {
04549         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl;
04550         <span class="keyword">volatile</span> uint32_t *depctl_addr;
04551 
04552         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"%s ep%d-%s\n"</span>, __func__, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>,
04553                     (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> ? <span class="stringliteral">"IN"</span> : <span class="stringliteral">"OUT"</span>));
04554 
04555         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> == 1) {
04556                 depctl_addr = &amp;(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>);
04557         } <span class="keywordflow">else</span> {
04558                 depctl_addr = &amp;(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>);
04559         }
04560 
04561         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(depctl_addr);
04562 
04563         <span class="comment">/* clear the stall bits */</span>
04564         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o8">stall</a> = 0;
04565 
04566         <span class="comment">/*</span>
04567 <span class="comment">         * USB Spec 9.4.5: For endpoints using data toggle, regardless</span>
04568 <span class="comment">         * of whether an endpoint has the Halt feature set, a</span>
04569 <span class="comment">         * ClearFeature(ENDPOINT_HALT) request always results in the</span>
04570 <span class="comment">         * data toggle being reinitialized to DATA0.</span>
04571 <span class="comment">         */</span>
04572         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_INTR ||
04573             ep-&gt;<a class="code" href="structdwc__ep.html#o4">type</a> == DWC_OTG_EP_TYPE_BULK) {
04574                 depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;  <span class="comment">/* DATA0 */</span>
04575         }
04576 
04577         DWC_WRITE_REG32(depctl_addr, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
04578         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a2">DBG_PCD</a>, <span class="stringliteral">"DEPCTL=%0x\n"</span>, DWC_READ_REG32(depctl_addr));
04579         <span class="keywordflow">return</span>;
04580 }
04581 
<a name="l04590"></a><a class="code" href="dwc__otg__cil_8h.html#a103">04590</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a103">dwc_otg_read_packet</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
04591                          uint8_t * dest, uint16_t bytes)
04592 {
04593         <span class="keywordtype">int</span> i;
04594         <span class="keywordtype">int</span> word_count = (bytes + 3) / 4;
04595 
04596         <span class="keyword">volatile</span> uint32_t *fifo = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o10">data_fifo</a>[0];
04597         uint32_t *data_buff = (uint32_t *) dest;
04598 
04605         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a> | <a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>), <span class="stringliteral">"%s(%p,%p,%d)\n"</span>, __func__,
04606                     core_if, dest, bytes);
04607 
04608         <span class="keywordflow">for</span> (i = 0; i &lt; word_count; i++, data_buff++) {
04609                 *data_buff = DWC_READ_REG32(fifo);
04610         }
04611 
04612         <span class="keywordflow">return</span>;
04613 }
04614 
<a name="l04620"></a><a class="code" href="dwc__otg__core__if_8h.html#a158">04620</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a158">dwc_otg_dump_dev_registers</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
04621 {
04622         <span class="keywordtype">int</span> i;
04623         <span class="keyword">volatile</span> uint32_t *addr;
04624 
04625         DWC_PRINTF(<span class="stringliteral">"Device Global Registers\n"</span>);
04626         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>;
04627         DWC_PRINTF(<span class="stringliteral">"DCFG                 @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) addr,
04628                    DWC_READ_REG32(addr));
04629         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>;
04630         DWC_PRINTF(<span class="stringliteral">"DCTL                 @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) addr,
04631                    DWC_READ_REG32(addr));
04632         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>;
04633         DWC_PRINTF(<span class="stringliteral">"DSTS                 @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) addr,
04634                    DWC_READ_REG32(addr));
04635         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o4">diepmsk</a>;
04636         DWC_PRINTF(<span class="stringliteral">"DIEPMSK      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04637                    DWC_READ_REG32(addr));
04638         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o5">doepmsk</a>;
04639         DWC_PRINTF(<span class="stringliteral">"DOEPMSK      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04640                    DWC_READ_REG32(addr));
04641         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o6">daint</a>;
04642         DWC_PRINTF(<span class="stringliteral">"DAINT        @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04643                    DWC_READ_REG32(addr));
04644         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o7">daintmsk</a>;
04645         DWC_PRINTF(<span class="stringliteral">"DAINTMSK     @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04646                    DWC_READ_REG32(addr));
04647         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o8">dtknqr1</a>;
04648         DWC_PRINTF(<span class="stringliteral">"DTKNQR1      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04649                    DWC_READ_REG32(addr));
04650         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o14">dev_token_q_depth</a> &gt; 6) {
04651                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o9">dtknqr2</a>;
04652                 DWC_PRINTF(<span class="stringliteral">"DTKNQR2      @0x%08lX : 0x%08X\n"</span>,
04653                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04654         }
04655 
04656         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o10">dvbusdis</a>;
04657         DWC_PRINTF(<span class="stringliteral">"DVBUSID      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04658                    DWC_READ_REG32(addr));
04659 
04660         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o11">dvbuspulse</a>;
04661         DWC_PRINTF(<span class="stringliteral">"DVBUSPULSE  @0x%08lX : 0x%08X\n"</span>,
04662                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04663 
04664         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o12">dtknqr3_dthrctl</a>;
04665         DWC_PRINTF(<span class="stringliteral">"DTKNQR3_DTHRCTL      @0x%08lX : 0x%08X\n"</span>,
04666                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04667 
04668         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o14">dev_token_q_depth</a> &gt; 22) {
04669                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o13">dtknqr4_fifoemptymsk</a>;
04670                 DWC_PRINTF(<span class="stringliteral">"DTKNQR4      @0x%08lX : 0x%08X\n"</span>,
04671                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04672         }
04673 
04674         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o13">dtknqr4_fifoemptymsk</a>;
04675         DWC_PRINTF(<span class="stringliteral">"FIFOEMPMSK   @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04676                    DWC_READ_REG32(addr));
04677 
04678         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o10">multi_proc_int</a>) {
04679 
04680                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o14">deachint</a>;
04681                 DWC_PRINTF(<span class="stringliteral">"DEACHINT     @0x%08lX : 0x%08X\n"</span>,
04682                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04683                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o15">deachintmsk</a>;
04684                 DWC_PRINTF(<span class="stringliteral">"DEACHINTMSK  @0x%08lX : 0x%08X\n"</span>,
04685                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04686 
04687                 <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
04688                         addr =
04689                             &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
04690                             diepeachintmsk[i];
04691                         DWC_PRINTF(<span class="stringliteral">"DIEPEACHINTMSK[%d]   @0x%08lX : 0x%08X\n"</span>,
04692                                    i, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04693                                    DWC_READ_REG32(addr));
04694                 }
04695 
04696                 <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o5">num_out_eps</a>; i++) {
04697                         addr =
04698                             &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;
04699                             doepeachintmsk[i];
04700                         DWC_PRINTF(<span class="stringliteral">"DOEPEACHINTMSK[%d]   @0x%08lX : 0x%08X\n"</span>,
04701                                    i, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04702                                    DWC_READ_REG32(addr));
04703                 }
04704         }
04705 
04706         <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o4">num_in_eps</a>; i++) {
04707                 DWC_PRINTF(<span class="stringliteral">"Device IN EP %d Registers\n"</span>, i);
04708                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>;
04709                 DWC_PRINTF(<span class="stringliteral">"DIEPCTL      @0x%08lX : 0x%08X\n"</span>,
04710                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04711                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o2">diepint</a>;
04712                 DWC_PRINTF(<span class="stringliteral">"DIEPINT      @0x%08lX : 0x%08X\n"</span>,
04713                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04714                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o4">dieptsiz</a>;
04715                 DWC_PRINTF(<span class="stringliteral">"DIETSIZ      @0x%08lX : 0x%08X\n"</span>,
04716                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04717                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o5">diepdma</a>;
04718                 DWC_PRINTF(<span class="stringliteral">"DIEPDMA      @0x%08lX : 0x%08X\n"</span>,
04719                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04720                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o6">dtxfsts</a>;
04721                 DWC_PRINTF(<span class="stringliteral">"DTXFSTS      @0x%08lX : 0x%08X\n"</span>,
04722                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04723                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o7">diepdmab</a>;
04724                 DWC_PRINTF(<span class="stringliteral">"DIEPDMAB     @0x%08lX : 0x%08X\n"</span>,
04725                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, 0 <span class="comment">/*DWC_READ_REG32(addr) */</span> );
04726         }
04727 
04728         <span class="keywordflow">for</span> (i = 0; i &lt;= core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o5">num_out_eps</a>; i++) {
04729                 DWC_PRINTF(<span class="stringliteral">"Device OUT EP %d Registers\n"</span>, i);
04730                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>;
04731                 DWC_PRINTF(<span class="stringliteral">"DOEPCTL      @0x%08lX : 0x%08X\n"</span>,
04732                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04733                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o2">doepint</a>;
04734                 DWC_PRINTF(<span class="stringliteral">"DOEPINT      @0x%08lX : 0x%08X\n"</span>,
04735                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04736                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o4">doeptsiz</a>;
04737                 DWC_PRINTF(<span class="stringliteral">"DOETSIZ      @0x%08lX : 0x%08X\n"</span>,
04738                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04739                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o5">doepdma</a>;
04740                 DWC_PRINTF(<span class="stringliteral">"DOEPDMA      @0x%08lX : 0x%08X\n"</span>,
04741                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04742                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {      <span class="comment">/* Don't access this register in SLAVE mode */</span>
04743                         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o7">doepdmab</a>;
04744                         DWC_PRINTF(<span class="stringliteral">"DOEPDMAB     @0x%08lX : 0x%08X\n"</span>,
04745                                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04746                 }
04747 
04748         }
04749 }
04750 
<a name="l04756"></a><a class="code" href="dwc__otg__core__if_8h.html#a159">04756</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a159">dwc_otg_dump_spram</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
04757 {
04758         <span class="keyword">volatile</span> uint8_t *addr, *start_addr, *end_addr;
04759 
04760         DWC_PRINTF(<span class="stringliteral">"SPRAM Data:\n"</span>);
04761         start_addr = (<span class="keywordtype">void</span> *)core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
04762         DWC_PRINTF(<span class="stringliteral">"Base Address: 0x%8lX\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)start_addr);
04763         start_addr += 0x00028000;
04764         end_addr = (<span class="keywordtype">void</span> *)core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
04765         end_addr += 0x000280e0;
04766 
04767         <span class="keywordflow">for</span> (addr = start_addr; addr &lt; end_addr; addr += 16) {
04768                 DWC_PRINTF
04769                     (<span class="stringliteral">"0x%8lX:\t%2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X %2X\n"</span>,
04770                      (<span class="keywordtype">unsigned</span> long)addr, addr[0], addr[1], addr[2], addr[3],
04771                      addr[4], addr[5], addr[6], addr[7], addr[8], addr[9],
04772                      addr[10], addr[11], addr[12], addr[13], addr[14], addr[15]
04773                     );
04774         }
04775 
04776         <span class="keywordflow">return</span>;
04777 }
04778 
<a name="l04784"></a><a class="code" href="dwc__otg__core__if_8h.html#a160">04784</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a160">dwc_otg_dump_host_registers</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
04785 {
04786         <span class="keywordtype">int</span> i;
04787         <span class="keyword">volatile</span> uint32_t *addr;
04788 
04789         DWC_PRINTF(<span class="stringliteral">"Host Global Registers\n"</span>);
04790         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>;
04791         DWC_PRINTF(<span class="stringliteral">"HCFG                 @0x%08lX : 0x%08X\n"</span>,
04792                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04793         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>;
04794         DWC_PRINTF(<span class="stringliteral">"HFIR                 @0x%08lX : 0x%08X\n"</span>,
04795                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04796         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o2">hfnum</a>;
04797         DWC_PRINTF(<span class="stringliteral">"HFNUM        @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04798                    DWC_READ_REG32(addr));
04799         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o4">hptxsts</a>;
04800         DWC_PRINTF(<span class="stringliteral">"HPTXSTS      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04801                    DWC_READ_REG32(addr));
04802         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o5">haint</a>;
04803         DWC_PRINTF(<span class="stringliteral">"HAINT        @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04804                    DWC_READ_REG32(addr));
04805         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o6">haintmsk</a>;
04806         DWC_PRINTF(<span class="stringliteral">"HAINTMSK     @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04807                    DWC_READ_REG32(addr));
04808         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
04809                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o7">hflbaddr</a>;
04810                 DWC_PRINTF(<span class="stringliteral">"HFLBADDR     @0x%08lX : 0x%08X\n"</span>,
04811                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04812         }
04813 
04814         addr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>;
04815         DWC_PRINTF(<span class="stringliteral">"HPRT0        @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04816                    DWC_READ_REG32(addr));
04817 
04818         <span class="keywordflow">for</span> (i = 0; i &lt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o18">host_channels</a>; i++) {
04819                 DWC_PRINTF(<span class="stringliteral">"Host Channel %d Specific Registers\n"</span>, i);
04820                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o0">hcchar</a>;
04821                 DWC_PRINTF(<span class="stringliteral">"HCCHAR       @0x%08lX : 0x%08X\n"</span>,
04822                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04823                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o1">hcsplt</a>;
04824                 DWC_PRINTF(<span class="stringliteral">"HCSPLT       @0x%08lX : 0x%08X\n"</span>,
04825                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04826                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o2">hcint</a>;
04827                 DWC_PRINTF(<span class="stringliteral">"HCINT        @0x%08lX : 0x%08X\n"</span>,
04828                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04829                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o3">hcintmsk</a>;
04830                 DWC_PRINTF(<span class="stringliteral">"HCINTMSK     @0x%08lX : 0x%08X\n"</span>,
04831                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04832                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o4">hctsiz</a>;
04833                 DWC_PRINTF(<span class="stringliteral">"HCTSIZ       @0x%08lX : 0x%08X\n"</span>,
04834                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04835                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o5">hcdma</a>;
04836                 DWC_PRINTF(<span class="stringliteral">"HCDMA        @0x%08lX : 0x%08X\n"</span>,
04837                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04838                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o15">dma_desc_enable</a>) {
04839                         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o2">hc_regs</a>[i]-&gt;<a class="code" href="structdwc__otg__hc__regs.html#o7">hcdmab</a>;
04840                         DWC_PRINTF(<span class="stringliteral">"HCDMAB       @0x%08lX : 0x%08X\n"</span>,
04841                                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04842                 }
04843 
04844         }
04845         <span class="keywordflow">return</span>;
04846 }
04847 
<a name="l04853"></a><a class="code" href="dwc__otg__core__if_8h.html#a161">04853</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a161">dwc_otg_dump_global_registers</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
04854 {
04855         <span class="keywordtype">int</span> i, ep_num;
04856         <span class="keyword">volatile</span> uint32_t *addr;
04857         <span class="keywordtype">char</span> *txfsiz;
04858 
04859         DWC_PRINTF(<span class="stringliteral">"Core Global Registers\n"</span>);
04860         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>;
04861         DWC_PRINTF(<span class="stringliteral">"GOTGCTL      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04862                    DWC_READ_REG32(addr));
04863         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o1">gotgint</a>;
04864         DWC_PRINTF(<span class="stringliteral">"GOTGINT      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04865                    DWC_READ_REG32(addr));
04866         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o2">gahbcfg</a>;
04867         DWC_PRINTF(<span class="stringliteral">"GAHBCFG      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04868                    DWC_READ_REG32(addr));
04869         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>;
04870         DWC_PRINTF(<span class="stringliteral">"GUSBCFG      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04871                    DWC_READ_REG32(addr));
04872         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>;
04873         DWC_PRINTF(<span class="stringliteral">"GRSTCTL      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04874                    DWC_READ_REG32(addr));
04875         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>;
04876         DWC_PRINTF(<span class="stringliteral">"GINTSTS      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04877                    DWC_READ_REG32(addr));
04878         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o6">gintmsk</a>;
04879         DWC_PRINTF(<span class="stringliteral">"GINTMSK      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04880                    DWC_READ_REG32(addr));
04881         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o7">grxstsr</a>;
04882         DWC_PRINTF(<span class="stringliteral">"GRXSTSR      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04883                    DWC_READ_REG32(addr));
04884         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>;
04885         DWC_PRINTF(<span class="stringliteral">"GRXFSIZ      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04886                    DWC_READ_REG32(addr));
04887         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>;
04888         DWC_PRINTF(<span class="stringliteral">"GNPTXFSIZ @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04889                    DWC_READ_REG32(addr));
04890         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>;
04891         DWC_PRINTF(<span class="stringliteral">"GNPTXSTS     @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04892                    DWC_READ_REG32(addr));
04893         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o12">gi2cctl</a>;
04894         DWC_PRINTF(<span class="stringliteral">"GI2CCTL      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04895                    DWC_READ_REG32(addr));
04896         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o13">gpvndctl</a>;
04897         DWC_PRINTF(<span class="stringliteral">"GPVNDCTL     @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04898                    DWC_READ_REG32(addr));
04899         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o14">ggpio</a>;
04900         DWC_PRINTF(<span class="stringliteral">"GGPIO        @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04901                    DWC_READ_REG32(addr));
04902         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o15">guid</a>;
04903         DWC_PRINTF(<span class="stringliteral">"GUID                 @0x%08lX : 0x%08X\n"</span>,
04904                    (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04905         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o16">gsnpsid</a>;
04906         DWC_PRINTF(<span class="stringliteral">"GSNPSID      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04907                    DWC_READ_REG32(addr));
04908         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o17">ghwcfg1</a>;
04909         DWC_PRINTF(<span class="stringliteral">"GHWCFG1      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04910                    DWC_READ_REG32(addr));
04911         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o18">ghwcfg2</a>;
04912         DWC_PRINTF(<span class="stringliteral">"GHWCFG2      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04913                    DWC_READ_REG32(addr));
04914         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o19">ghwcfg3</a>;
04915         DWC_PRINTF(<span class="stringliteral">"GHWCFG3      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04916                    DWC_READ_REG32(addr));
04917         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o20">ghwcfg4</a>;
04918         DWC_PRINTF(<span class="stringliteral">"GHWCFG4      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04919                    DWC_READ_REG32(addr));
04920         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>;
04921         DWC_PRINTF(<span class="stringliteral">"GLPMCFG      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04922                    DWC_READ_REG32(addr));
04923         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o22">gpwrdn</a>;
04924         DWC_PRINTF(<span class="stringliteral">"GPWRDN       @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04925                    DWC_READ_REG32(addr));
04926         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o23">gdfifocfg</a>;
04927         DWC_PRINTF(<span class="stringliteral">"GDFIFOCFG    @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04928                    DWC_READ_REG32(addr));
04929         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o24">adpctl</a>;
04930         DWC_PRINTF(<span class="stringliteral">"ADPCTL       @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04931                    <a class="code" href="dwc__otg__adp_8h.html#a5">dwc_otg_adp_read_reg</a>(core_if));
04932         addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>;
04933         DWC_PRINTF(<span class="stringliteral">"HPTXFSIZ     @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04934                    DWC_READ_REG32(addr));
04935 
04936         <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o18">en_multiple_tx_fifo</a> == 0) {
04937                 ep_num = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o1">num_dev_perio_in_ep</a>;
04938                 txfsiz = <span class="stringliteral">"DPTXFSIZ"</span>;
04939         } <span class="keywordflow">else</span> {
04940                 ep_num = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o14">num_in_eps</a>;
04941                 txfsiz = <span class="stringliteral">"DIENPTXF"</span>;
04942         }
04943         <span class="keywordflow">for</span> (i = 0; i &lt; ep_num; i++) {
04944                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[i];
04945                 DWC_PRINTF(<span class="stringliteral">"%s[%d] @0x%08lX : 0x%08X\n"</span>, txfsiz, i + 1,
04946                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr, DWC_READ_REG32(addr));
04947         }
04948         addr = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o9">pcgcctl</a>;
04949         DWC_PRINTF(<span class="stringliteral">"PCGCCTL      @0x%08lX : 0x%08X\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)addr,
04950                    DWC_READ_REG32(addr));
04951 }
04952 
<a name="l04959"></a><a class="code" href="dwc__otg__cil_8h.html#a104">04959</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a104">dwc_otg_flush_tx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <span class="keyword">const</span> <span class="keywordtype">int</span> num)
04960 {
04961         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
04962         <span class="keyword">volatile</span> <a class="code" href="uniongrstctl__data.html">grstctl_t</a> greset = {.d32 = 0 };
04963         <span class="keywordtype">int</span> count = 0;
04964 
04965         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a> | <a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>), <span class="stringliteral">"Flush Tx FIFO %d\n"</span>, num);
04966 
04967         greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o6">txfflsh</a> = 1;
04968         greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o7">txfnum</a> = num;
04969         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>, greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
04970 
04971         <span class="keywordflow">do</span> {
04972                 greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>);
04973                 <span class="keywordflow">if</span> (++count &gt; 10000) {
04974                         DWC_WARN(<span class="stringliteral">"%s() HANG! GRSTCTL=%0x GNPTXSTS=0x%08x\n"</span>,
04975                                  __func__, greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>,
04976                                  DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o11">gnptxsts</a>));
04977                         <span class="keywordflow">break</span>;
04978                 }
04979                 dwc_udelay(1);
04980         } <span class="keywordflow">while</span> (greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o6">txfflsh</a> == 1);
04981 
04982         <span class="comment">/* Wait for 3 PHY Clocks */</span>
04983         dwc_udelay(1);
04984 }
04985 
<a name="l04991"></a><a class="code" href="dwc__otg__cil_8h.html#a105">04991</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a105">dwc_otg_flush_rx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
04992 {
04993         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
04994         <span class="keyword">volatile</span> <a class="code" href="uniongrstctl__data.html">grstctl_t</a> greset = {.d32 = 0 };
04995         <span class="keywordtype">int</span> count = 0;
04996 
04997         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>((<a class="code" href="dwc__otg__dbg_8h.html#a0">DBG_CIL</a> | <a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>), <span class="stringliteral">"%s\n"</span>, __func__);
04998         <span class="comment">/*</span>
04999 <span class="comment">         *</span>
05000 <span class="comment">         */</span>
05001         greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o5">rxfflsh</a> = 1;
05002         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>, greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
05003 
05004         <span class="keywordflow">do</span> {
05005                 greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>);
05006                 <span class="keywordflow">if</span> (++count &gt; 10000) {
05007                         DWC_WARN(<span class="stringliteral">"%s() HANG! GRSTCTL=%0x\n"</span>, __func__,
05008                                  greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
05009                         <span class="keywordflow">break</span>;
05010                 }
05011                 dwc_udelay(1);
05012         } <span class="keywordflow">while</span> (greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o5">rxfflsh</a> == 1);
05013 
05014         <span class="comment">/* Wait for 3 PHY Clocks */</span>
05015         dwc_udelay(1);
05016 }
05017 
<a name="l05022"></a><a class="code" href="dwc__otg__cil_8h.html#a106">05022</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a106">dwc_otg_core_reset</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05023 {
05024         <a class="code" href="structdwc__otg__core__global__regs.html">dwc_otg_core_global_regs_t</a> *global_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>;
05025         <span class="keyword">volatile</span> <a class="code" href="uniongrstctl__data.html">grstctl_t</a> greset = {.d32 = 0 };
05026         <span class="keywordtype">int</span> count = 0;
05027 
05028         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a1">DBG_CILV</a>, <span class="stringliteral">"%s\n"</span>, __func__);
05029         <span class="comment">/* Wait for AHB master IDLE state. */</span>
05030         <span class="keywordflow">do</span> {
05031                 dwc_udelay(10);
05032                 greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>);
05033                 <span class="keywordflow">if</span> (++count &gt; 100000) {
05034                         DWC_WARN(<span class="stringliteral">"%s() HANG! AHB Idle GRSTCTL=%0x\n"</span>, __func__,
05035                                  greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
05036                         <span class="keywordflow">return</span>;
05037                 }
05038         }
05039         <span class="keywordflow">while</span> (greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o10">ahbidle</a> == 0);
05040 
05041         <span class="comment">/* Core Soft Reset */</span>
05042         count = 0;
05043         greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o1">csftrst</a> = 1;
05044         DWC_WRITE_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>, greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
05045         <span class="keywordflow">do</span> {
05046                 greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;global_regs-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o4">grstctl</a>);
05047                 <span class="keywordflow">if</span> (++count &gt; 10000) {
05048                         DWC_WARN(<span class="stringliteral">"%s() HANG! Soft Reset GRSTCTL=%0x\n"</span>,
05049                                  __func__, greset.<a class="code" href="uniongrstctl__data.html#o0">d32</a>);
05050                         <span class="keywordflow">break</span>;
05051                 }
05052                 dwc_udelay(1);
05053         }
05054         <span class="keywordflow">while</span> (greset.<a class="code" href="uniongrstctl__data.html#o11">b</a>.<a class="code" href="uniongrstctl__data.html#o1">csftrst</a> == 1);
05055 
05056         <span class="comment">/* Wait for 3 PHY Clocks */</span>
05057         dwc_mdelay(100);
05058 }
05059 
05060 uint8_t dwc_otg_is_device_mode(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if)
05061 {
05062         <span class="keywordflow">return</span> (<a class="code" href="dwc__otg__cil_8h.html#a115">dwc_otg_mode</a>(_core_if) != DWC_HOST_MODE);
05063 }
05064 
05065 uint8_t dwc_otg_is_host_mode(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * _core_if)
05066 {
05067         <span class="keywordflow">return</span> (<a class="code" href="dwc__otg__cil_8h.html#a115">dwc_otg_mode</a>(_core_if) == DWC_HOST_MODE);
05068 }
05069 
<a name="l05078"></a><a class="code" href="dwc__otg__cil_8h.html#a117">05078</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a117">dwc_otg_cil_register_hcd_callbacks</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05079                                         <a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks_t</a> * cb, <span class="keywordtype">void</span> *p)
05080 {
05081         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o29">hcd_cb</a> = cb;
05082         cb-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a> = p;
05083 }
05084 
<a name="l05093"></a><a class="code" href="dwc__otg__cil_8h.html#a116">05093</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a116">dwc_otg_cil_register_pcd_callbacks</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05094                                         <a class="code" href="structdwc__otg__cil__callbacks.html">dwc_otg_cil_callbacks_t</a> * cb, <span class="keywordtype">void</span> *p)
05095 {
05096         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o30">pcd_cb</a> = cb;
05097         cb-&gt;<a class="code" href="structdwc__otg__cil__callbacks.html#o6">p</a> = p;
05098 }
05099 
05100 <span class="preprocessor">#ifdef DWC_EN_ISOC</span>
05101 <span class="preprocessor"></span>
<a name="l05109"></a><a class="code" href="dwc__otg__cil_8c.html#a67">05109</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a67">write_isoc_frame_data</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
05110 {
05111         <a class="code" href="structdwc__otg__dev__in__ep__regs.html">dwc_otg_dev_in_ep_regs_t</a> *ep_regs;
05112         <a class="code" href="uniondtxfsts__data.html">dtxfsts_data_t</a> txstatus = {.d32 = 0 };
05113         uint32_t len = 0;
05114         uint32_t dwords;
05115 
05116         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_22">data_per_frame</a>;
05117         ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> = 0;
05118 
05119         ep_regs = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>];
05120 
05121         len = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
05122 
05123         <span class="keywordflow">if</span> (len &gt; ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
05124                 len = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
05125         }
05126 
05127         dwords = (len + 3) / 4;
05128 
05129         <span class="comment">/* While there is space in the queue and space in the FIFO and</span>
05130 <span class="comment">         * More data to tranfer, Write packets to the Tx FIFO */</span>
05131         txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> =
05132             DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;dtxfsts);
05133         <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"b4 dtxfsts[%d]=0x%08x\n"</span>, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>, txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a>);
05134 
05135         <span class="keywordflow">while</span> (txstatus.<a class="code" href="uniondtxfsts__data.html#o3">b</a>.<a class="code" href="uniondtxfsts__data.html#o1">txfspcavail</a> &gt; dwords &amp;&amp;
05136                ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> &lt; ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> &amp;&amp; ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> != 0) {
05137                 <span class="comment">/* Write the FIFO */</span>
05138                 <a class="code" href="dwc__otg__cil_8h.html#a85">dwc_otg_ep_write_packet</a>(core_if, ep, 0);
05139 
05140                 len = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a>;
05141                 <span class="keywordflow">if</span> (len &gt; ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) {
05142                         len = ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
05143                 }
05144 
05145                 dwords = (len + 3) / 4;
05146                 txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> =
05147                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;
05148                                    in_ep_regs[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;dtxfsts);
05149                 <a class="code" href="dwc__otg__dbg_8h.html#a10">DWC_DEBUGPL</a>(<a class="code" href="dwc__otg__dbg_8h.html#a3">DBG_PCDV</a>, <span class="stringliteral">"dtxfsts[%d]=0x%08x\n"</span>, ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>,
05150                             txstatus.<a class="code" href="uniondtxfsts__data.html#o0">d32</a>);
05151         }
05152 }
05153 
<a name="l05161"></a><a class="code" href="dwc__otg__cil_8h.html#a89">05161</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8h.html#a89">dwc_otg_iso_ep_start_frm_transfer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05162                                        <a class="code" href="structdwc__ep.html">dwc_ep_t</a> * ep)
05163 {
05164         <a class="code" href="uniondeptsiz__data.html">deptsiz_data_t</a> deptsiz = {.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> = 0 };
05165         <a class="code" href="uniondepctl__data.html">depctl_data_t</a> depctl = {.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> = 0 };
05166         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts = {.<a class="code" href="uniondtxfsts__data.html#o0">d32</a> = 0 };
05167         <span class="keyword">volatile</span> uint32_t *addr;
05168 
05169         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a>) {
05170                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__in__ep__regs.html#o0">diepctl</a>;
05171         } <span class="keywordflow">else</span> {
05172                 addr = &amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;<a class="code" href="structdwc__otg__dev__out__ep__regs.html#o0">doepctl</a>;
05173         }
05174 
05175         ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_22">data_per_frame</a>;
05176         ep-&gt;<a class="code" href="structdwc__ep.html#z32_6">xfer_count</a> = 0;
05177         ep-&gt;<a class="code" href="structdwc__ep.html#z32_4">xfer_buff</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_30">cur_pkt_addr</a>;
05178         ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_31">cur_pkt_dma_addr</a>;
05179 
05180         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a>) {
05181                 <span class="comment">/* Program the transfer size and packet count</span>
05182 <span class="comment">                 *      as follows: xfersize = N * maxpacket +</span>
05183 <span class="comment">                 *      short_packet pktcnt = N + (short_packet</span>
05184 <span class="comment">                 *      exist ? 1 : 0) </span>
05185 <span class="comment">                 */</span>
05186                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a>;
05187                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> =
05188                     (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> - 1 + ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>) / ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
05189                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o3">mc</a> = deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a>;
05190                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;dieptsiz,
05191                                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
05192 
05193                 <span class="comment">/* Write the DMA register */</span>
05194                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
05195                         DWC_WRITE_REG32(&amp;
05196                                         (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o1">in_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;
05197                                          diepdma), (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
05198                 }
05199         } <span class="keywordflow">else</span> {
05200                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> =
05201                     (ep-&gt;<a class="code" href="structdwc__ep.html#z32_5">xfer_len</a> + (ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a> - 1)) / ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
05202                 deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o1">xfersize</a> = deptsiz.<a class="code" href="uniondeptsiz__data.html#o5">b</a>.<a class="code" href="uniondeptsiz__data.html#o2">pktcnt</a> * ep-&gt;<a class="code" href="structdwc__ep.html#o7">maxpacket</a>;
05203 
05204                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;
05205                                 doeptsiz, deptsiz.<a class="code" href="uniondeptsiz__data.html#o0">d32</a>);
05206 
05207                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>) {
05208                         DWC_WRITE_REG32(&amp;
05209                                         (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o2">out_ep_regs</a>[ep-&gt;<a class="code" href="structdwc__ep.html#o0">num</a>]-&gt;
05210                                          doepdma), (uint32_t) ep-&gt;<a class="code" href="structdwc__ep.html#z32_0">dma_addr</a>);
05211                 }
05212         }
05213 
05216         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = 0;
05217         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a> == 1) {
05218                 dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> =
05219                     DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
05220                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_26">next_frame</a> = dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o5">soffn</a> + ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a>;
05221 
05222                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_26">next_frame</a> &amp; 0x1) {
05223                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o13">setd1pid</a> = 1;
05224                 } <span class="keywordflow">else</span> {
05225                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;
05226                 }
05227         } <span class="keywordflow">else</span> {
05228                 ep-&gt;<a class="code" href="structdwc__ep.html#z32_26">next_frame</a> += ep-&gt;<a class="code" href="structdwc__ep.html#z32_11">bInterval</a>;
05229 
05230                 <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#z32_26">next_frame</a> &amp; 0x1) {
05231                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o13">setd1pid</a> = 1;
05232                 } <span class="keywordflow">else</span> {
05233                         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o12">setd0pid</a> = 1;
05234                 }
05235         }
05236         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o15">epena</a> = 1;
05237         depctl.<a class="code" href="uniondepctl__data.html#o16">b</a>.<a class="code" href="uniondepctl__data.html#o10">cnak</a> = 1;
05238 
05239         DWC_MODIFY_REG32(addr, 0, depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a>);
05240         depctl.<a class="code" href="uniondepctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
05241 
05242         <span class="keywordflow">if</span> (ep-&gt;<a class="code" href="structdwc__ep.html#o1">is_in</a> &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a> == 0) {
05243                 <a class="code" href="dwc__otg__cil_8c.html#a67">write_isoc_frame_data</a>(core_if, ep);
05244         }
05245 
05246 }
05247 <span class="preprocessor">#endif </span><span class="comment">/* DWC_EN_ISOC */</span>
05248 
05249 <span class="keyword">static</span> <span class="keywordtype">void</span> dwc_otg_set_uninitialized(int32_t * p, <span class="keywordtype">int</span> size)
05250 {
05251         <span class="keywordtype">int</span> i;
05252         <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) {
05253                 p[i] = -1;
05254         }
05255 }
05256 
05257 <span class="keyword">static</span> <span class="keywordtype">int</span> dwc_otg_param_initialized(int32_t val)
05258 {
05259         <span class="keywordflow">return</span> val != -1;
05260 }
05261 
05262 <span class="keyword">static</span> <span class="keywordtype">int</span> dwc_otg_setup_params(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05263 {
05264         <span class="keywordtype">int</span> i;
05265         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a> = DWC_ALLOC(<span class="keyword">sizeof</span>(*core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>));
05266         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>) {
05267                 <span class="keywordflow">return</span> -DWC_E_NO_MEMORY;
05268         }
05269         dwc_otg_set_uninitialized((int32_t *) core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>,
05270                                   <span class="keyword">sizeof</span>(*core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>) /
05271                                   <span class="keyword">sizeof</span>(int32_t));
05272         DWC_PRINTF(<span class="stringliteral">"Setting default values for core params\n"</span>);
05273         <a class="code" href="dwc__otg__core__if_8h.html#a70">dwc_otg_set_param_otg_cap</a>(core_if, dwc_param_otg_cap_default);
05274         <a class="code" href="dwc__otg__core__if_8h.html#a74">dwc_otg_set_param_dma_enable</a>(core_if, dwc_param_dma_enable_default);
05275         <a class="code" href="dwc__otg__core__if_8h.html#a76">dwc_otg_set_param_dma_desc_enable</a>(core_if,
05276                                           dwc_param_dma_desc_enable_default);
05277         dwc_otg_set_param_opt(core_if, dwc_param_opt_default);
05278         <a class="code" href="dwc__otg__core__if_8h.html#a78">dwc_otg_set_param_dma_burst_size</a>(core_if,
05279                                          dwc_param_dma_burst_size_default);
05280         <a class="code" href="dwc__otg__core__if_8h.html#a82">dwc_otg_set_param_host_support_fs_ls_low_power</a>(core_if,
05281                                                        dwc_param_host_support_fs_ls_low_power_default);
05282         <a class="code" href="dwc__otg__core__if_8h.html#a86">dwc_otg_set_param_enable_dynamic_fifo</a>(core_if,
05283                                               dwc_param_enable_dynamic_fifo_default);
05284         <a class="code" href="dwc__otg__core__if_8h.html#a88">dwc_otg_set_param_data_fifo_size</a>(core_if,
05285                                          dwc_param_data_fifo_size_default);
05286         <a class="code" href="dwc__otg__core__if_8h.html#a90">dwc_otg_set_param_dev_rx_fifo_size</a>(core_if,
05287                                            dwc_param_dev_rx_fifo_size_default);
05288         <a class="code" href="dwc__otg__core__if_8h.html#a92">dwc_otg_set_param_dev_nperio_tx_fifo_size</a>(core_if,
05289                                                   dwc_param_dev_nperio_tx_fifo_size_default);
05290         <a class="code" href="dwc__otg__core__if_8h.html#a96">dwc_otg_set_param_host_rx_fifo_size</a>(core_if,
05291                                             dwc_param_host_rx_fifo_size_default);
05292         <a class="code" href="dwc__otg__core__if_8h.html#a98">dwc_otg_set_param_host_nperio_tx_fifo_size</a>(core_if,
05293                                                    dwc_param_host_nperio_tx_fifo_size_default);
05294         <a class="code" href="dwc__otg__core__if_8h.html#a100">dwc_otg_set_param_host_perio_tx_fifo_size</a>(core_if,
05295                                                   dwc_param_host_perio_tx_fifo_size_default);
05296         <a class="code" href="dwc__otg__core__if_8h.html#a102">dwc_otg_set_param_max_transfer_size</a>(core_if,
05297                                             dwc_param_max_transfer_size_default);
05298         <a class="code" href="dwc__otg__core__if_8h.html#a104">dwc_otg_set_param_max_packet_count</a>(core_if,
05299                                            dwc_param_max_packet_count_default);
05300         <a class="code" href="dwc__otg__core__if_8h.html#a106">dwc_otg_set_param_host_channels</a>(core_if,
05301                                         dwc_param_host_channels_default);
05302         <a class="code" href="dwc__otg__core__if_8h.html#a108">dwc_otg_set_param_dev_endpoints</a>(core_if,
05303                                         dwc_param_dev_endpoints_default);
05304         <a class="code" href="dwc__otg__core__if_8h.html#a110">dwc_otg_set_param_phy_type</a>(core_if, dwc_param_phy_type_default);
05305         <a class="code" href="dwc__otg__core__if_8h.html#a80">dwc_otg_set_param_speed</a>(core_if, dwc_param_speed_default);
05306         <a class="code" href="dwc__otg__core__if_8h.html#a84">dwc_otg_set_param_host_ls_low_power_phy_clk</a>(core_if,
05307                                                     dwc_param_host_ls_low_power_phy_clk_default);
05308         <a class="code" href="dwc__otg__core__if_8h.html#a114">dwc_otg_set_param_phy_ulpi_ddr</a>(core_if, dwc_param_phy_ulpi_ddr_default);
05309         <a class="code" href="dwc__otg__core__if_8h.html#a116">dwc_otg_set_param_phy_ulpi_ext_vbus</a>(core_if,
05310                                             dwc_param_phy_ulpi_ext_vbus_default);
05311         <a class="code" href="dwc__otg__core__if_8h.html#a112">dwc_otg_set_param_phy_utmi_width</a>(core_if,
05312                                          dwc_param_phy_utmi_width_default);
05313         dwc_otg_set_param_ts_dline(core_if, dwc_param_ts_dline_default);
05314         <a class="code" href="dwc__otg__core__if_8h.html#a118">dwc_otg_set_param_i2c_enable</a>(core_if, dwc_param_i2c_enable_default);
05315         dwc_otg_set_param_ulpi_fs_ls(core_if, dwc_param_ulpi_fs_ls_default);
05316         <a class="code" href="dwc__otg__core__if_8h.html#a124">dwc_otg_set_param_en_multiple_tx_fifo</a>(core_if,
05317                                               dwc_param_en_multiple_tx_fifo_default);
05318         <span class="keywordflow">for</span> (i = 0; i &lt; 15; i++) {
05319                 <a class="code" href="dwc__otg__core__if_8h.html#a94">dwc_otg_set_param_dev_perio_tx_fifo_size</a>(core_if,
05320                                                          dwc_param_dev_perio_tx_fifo_size_default,
05321                                                          i);
05322         }
05323 
05324         <span class="keywordflow">for</span> (i = 0; i &lt; 15; i++) {
05325                 <a class="code" href="dwc__otg__core__if_8h.html#a126">dwc_otg_set_param_dev_tx_fifo_size</a>(core_if,
05326                                                    dwc_param_dev_tx_fifo_size_default,
05327                                                    i);
05328         }
05329         <a class="code" href="dwc__otg__core__if_8h.html#a128">dwc_otg_set_param_thr_ctl</a>(core_if, dwc_param_thr_ctl_default);
05330         <a class="code" href="dwc__otg__core__if_8h.html#a138">dwc_otg_set_param_mpi_enable</a>(core_if, dwc_param_mpi_enable_default);
05331         <a class="code" href="dwc__otg__core__if_8h.html#a136">dwc_otg_set_param_pti_enable</a>(core_if, dwc_param_pti_enable_default);
05332         <a class="code" href="dwc__otg__core__if_8h.html#a134">dwc_otg_set_param_lpm_enable</a>(core_if, dwc_param_lpm_enable_default);
05333         <a class="code" href="dwc__otg__core__if_8h.html#a142">dwc_otg_set_param_ic_usb_cap</a>(core_if, dwc_param_ic_usb_cap_default);
05334         <a class="code" href="dwc__otg__core__if_8h.html#a130">dwc_otg_set_param_tx_thr_length</a>(core_if,
05335                                         dwc_param_tx_thr_length_default);
05336         <a class="code" href="dwc__otg__core__if_8h.html#a132">dwc_otg_set_param_rx_thr_length</a>(core_if,
05337                                         dwc_param_rx_thr_length_default);
05338         dwc_otg_set_param_ahb_thr_ratio(core_if,
05339                                         dwc_param_ahb_thr_ratio_default);
05340         dwc_otg_set_param_power_down(core_if, dwc_param_power_down_default);
05341         dwc_otg_set_param_reload_ctl(core_if, dwc_param_reload_ctl_default);
05342         dwc_otg_set_param_dev_out_nak(core_if, dwc_param_dev_out_nak_default);
05343         dwc_otg_set_param_cont_on_bna(core_if, dwc_param_cont_on_bna_default);
05344         dwc_otg_set_param_ahb_single(core_if, dwc_param_ahb_single_default);
05345         dwc_otg_set_param_otg_ver(core_if, dwc_param_otg_ver_default);
05346         <a class="code" href="dwc__otg__core__if_8h.html#a140">dwc_otg_set_param_adp_enable</a>(core_if, dwc_param_adp_enable_default);
05347         <span class="keywordflow">return</span> 0;
05348 }
05349 
05350 uint8_t dwc_otg_is_dma_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05351 {
05352         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o14">dma_enable</a>;
05353 }
05354 
05355 <span class="comment">/* Checks if the parameter is outside of its valid range of values */</span>
05356 <span class="preprocessor">#define DWC_OTG_PARAM_TEST(_param_, _low_, _high_) \</span>
05357 <span class="preprocessor">                (((_param_) &lt; (_low_)) || \</span>
05358 <span class="preprocessor">                ((_param_) &gt; (_high_)))</span>
05359 <span class="preprocessor"></span>
05360 <span class="comment">/* Parameter access functions */</span>
<a name="l05361"></a><a class="code" href="dwc__otg__core__if_8h.html#a70">05361</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a70">dwc_otg_set_param_otg_cap</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05362 {
05363         <span class="keywordtype">int</span> valid;
05364         <span class="keywordtype">int</span> retval = 0;
05365         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 2)) {
05366                 DWC_WARN(<span class="stringliteral">"Wrong value for otg_cap parameter\n"</span>);
05367                 DWC_WARN(<span class="stringliteral">"otg_cap parameter must be 0,1 or 2\n"</span>);
05368                 retval = -DWC_E_INVALID;
05369                 <span class="keywordflow">goto</span> out;
05370         }
05371 
05372         valid = 1;
05373         <span class="keywordflow">switch</span> (val) {
05374         <span class="keywordflow">case</span> DWC_OTG_CAP_PARAM_HNP_SRP_CAPABLE:
05375                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> !=
05376                     DWC_HWCFG2_OP_MODE_HNP_SRP_CAPABLE_OTG)
05377                         valid = 0;
05378                 <span class="keywordflow">break</span>;
05379         <span class="keywordflow">case</span> DWC_OTG_CAP_PARAM_SRP_ONLY_CAPABLE:
05380                 <span class="keywordflow">if</span> ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> !=
05381                      DWC_HWCFG2_OP_MODE_HNP_SRP_CAPABLE_OTG)
05382                     &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> !=
05383                         DWC_HWCFG2_OP_MODE_SRP_ONLY_CAPABLE_OTG)
05384                     &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> !=
05385                         DWC_HWCFG2_OP_MODE_SRP_CAPABLE_DEVICE)
05386                     &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> !=
05387                         DWC_HWCFG2_OP_MODE_SRP_CAPABLE_HOST)) {
05388                         valid = 0;
05389                 }
05390                 <span class="keywordflow">break</span>;
05391         <span class="keywordflow">case</span> DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE:
05392                 <span class="comment">/* always valid */</span>
05393                 <span class="keywordflow">break</span>;
05394         }
05395         <span class="keywordflow">if</span> (!valid) {
05396                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a>)) {
05397                         DWC_ERROR
05398                             (<span class="stringliteral">"%d invalid for otg_cap paremter. Check HW configuration.\n"</span>,
05399                              val);
05400                 }
05401                 val =
05402                     (((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> ==
05403                        DWC_HWCFG2_OP_MODE_HNP_SRP_CAPABLE_OTG)
05404                       || (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> ==
05405                           DWC_HWCFG2_OP_MODE_SRP_ONLY_CAPABLE_OTG)
05406                       || (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> ==
05407                           DWC_HWCFG2_OP_MODE_SRP_CAPABLE_DEVICE)
05408                       || (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o1">op_mode</a> ==
05409                           DWC_HWCFG2_OP_MODE_SRP_CAPABLE_HOST)) ?
05410                      DWC_OTG_CAP_PARAM_SRP_ONLY_CAPABLE :
05411                      DWC_OTG_CAP_PARAM_NO_HNP_SRP_CAPABLE);
05412                 retval = -DWC_E_INVALID;
05413         }
05414 
05415         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a> = val;
05416 out:
05417         <span class="keywordflow">return</span> retval;
05418 }
05419 
05420 int32_t dwc_otg_get_param_otg_cap(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05421 {
05422         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o1">otg_cap</a>;
05423 }
05424 
05425 <span class="keywordtype">int</span> dwc_otg_set_param_opt(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05426 {
05427         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05428                 DWC_WARN(<span class="stringliteral">"Wrong value for opt parameter\n"</span>);
05429                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05430         }
05431         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o0">opt</a> = val;
05432         <span class="keywordflow">return</span> 0;
05433 }
05434 
05435 int32_t dwc_otg_get_param_opt(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05436 {
05437         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o0">opt</a>;
05438 }
05439 
<a name="l05440"></a><a class="code" href="dwc__otg__core__if_8h.html#a74">05440</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a74">dwc_otg_set_param_dma_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05441 {
05442         <span class="keywordtype">int</span> retval = 0;
05443         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05444                 DWC_WARN(<span class="stringliteral">"Wrong value for dma enable\n"</span>);
05445                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05446         }
05447 
05448         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o2">architecture</a> == 0)) {
05449                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o2">dma_enable</a>)) {
05450                         DWC_ERROR
05451                             (<span class="stringliteral">"%d invalid for dma_enable paremter. Check HW configuration.\n"</span>,
05452                              val);
05453                 }
05454                 val = 0;
05455                 retval = -DWC_E_INVALID;
05456         }
05457 
05458         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o2">dma_enable</a> = val;
05459         <span class="keywordflow">if</span> (val == 0) {
05460                 <a class="code" href="dwc__otg__core__if_8h.html#a76">dwc_otg_set_param_dma_desc_enable</a>(core_if, 0);
05461         }
05462         <span class="keywordflow">return</span> retval;
05463 }
05464 
05465 int32_t dwc_otg_get_param_dma_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05466 {
05467         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o2">dma_enable</a>;
05468 }
05469 
<a name="l05470"></a><a class="code" href="dwc__otg__core__if_8h.html#a76">05470</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a76">dwc_otg_set_param_dma_desc_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05471 {
05472         <span class="keywordtype">int</span> retval = 0;
05473         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05474                 DWC_WARN(<span class="stringliteral">"Wrong value for dma_enable\n"</span>);
05475                 DWC_WARN(<span class="stringliteral">"dma_desc_enable must be 0 or 1\n"</span>);
05476                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05477         }
05478 
05479         <span class="keywordflow">if</span> ((val == 1)
05480             &amp;&amp; ((dwc_otg_get_param_dma_enable(core_if) == 0)
05481                 || (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o15">desc_dma</a> == 0))) {
05482                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05483                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>)) {
05484                         DWC_ERROR
05485                             (<span class="stringliteral">"%d invalid for dma_desc_enable paremter. Check HW configuration.\n"</span>,
05486                              val);
05487                 }
05488                 val = 0;
05489                 retval = -DWC_E_INVALID;
05490         }
05491         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a> = val;
05492         <span class="keywordflow">return</span> retval;
05493 }
05494 
05495 int32_t dwc_otg_get_param_dma_desc_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05496 {
05497         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>;
05498 }
05499 
<a name="l05500"></a><a class="code" href="dwc__otg__core__if_8h.html#a82">05500</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a82">dwc_otg_set_param_host_support_fs_ls_low_power</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05501                                                    int32_t val)
05502 {
05503         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05504                 DWC_WARN(<span class="stringliteral">"Wrong value for host_support_fs_low_power\n"</span>);
05505                 DWC_WARN(<span class="stringliteral">"host_support_fs_low_power must be 0 or 1\n"</span>);
05506                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05507         }
05508         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o6">host_support_fs_ls_low_power</a> = val;
05509         <span class="keywordflow">return</span> 0;
05510 }
05511 
05512 int32_t dwc_otg_get_param_host_support_fs_ls_low_power(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> *
05513                                                        core_if)
05514 {
05515         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o6">host_support_fs_ls_low_power</a>;
05516 }
05517 
<a name="l05518"></a><a class="code" href="dwc__otg__core__if_8h.html#a86">05518</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a86">dwc_otg_set_param_enable_dynamic_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05519                                           int32_t val)
05520 {
05521         <span class="keywordtype">int</span> retval = 0;
05522         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05523                 DWC_WARN(<span class="stringliteral">"Wrong value for enable_dynamic_fifo\n"</span>);
05524                 DWC_WARN(<span class="stringliteral">"enable_dynamic_fifo must be 0 or 1\n"</span>);
05525                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05526         }
05527 
05528         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o9">dynamic_fifo</a> == 0)) {
05529                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05530                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o8">enable_dynamic_fifo</a>)) {
05531                         DWC_ERROR
05532                             (<span class="stringliteral">"%d invalid for enable_dynamic_fifo paremter. Check HW configuration.\n"</span>,
05533                              val);
05534                 }
05535                 val = 0;
05536                 retval = -DWC_E_INVALID;
05537         }
05538         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o8">enable_dynamic_fifo</a> = val;
05539         <span class="keywordflow">return</span> retval;
05540 }
05541 
05542 int32_t dwc_otg_get_param_enable_dynamic_fifo(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05543 {
05544         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o8">enable_dynamic_fifo</a>;
05545 }
05546 
<a name="l05547"></a><a class="code" href="dwc__otg__core__if_8h.html#a88">05547</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a88">dwc_otg_set_param_data_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05548 {
05549         <span class="keywordtype">int</span> retval = 0;
05550         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 32, 32768)) {
05551                 DWC_WARN(<span class="stringliteral">"Wrong value for data_fifo_size\n"</span>);
05552                 DWC_WARN(<span class="stringliteral">"data_fifo_size must be 32-32768\n"</span>);
05553                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05554         }
05555 
05556         <span class="keywordflow">if</span> (val &gt; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o12">dfifo_depth</a>) {
05557                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05558                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o9">data_fifo_size</a>)) {
05559                         DWC_ERROR
05560                             (<span class="stringliteral">"%d invalid for data_fifo_size parameter. Check HW configuration.\n"</span>,
05561                              val);
05562                 }
05563                 val = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o12">dfifo_depth</a>;
05564                 retval = -DWC_E_INVALID;
05565         }
05566 
05567         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o9">data_fifo_size</a> = val;
05568         <span class="keywordflow">return</span> retval;
05569 }
05570 
05571 int32_t dwc_otg_get_param_data_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05572 {
05573         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o9">data_fifo_size</a>;
05574 }
05575 
<a name="l05576"></a><a class="code" href="dwc__otg__core__if_8h.html#a90">05576</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a90">dwc_otg_set_param_dev_rx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05577 {
05578         <span class="keywordtype">int</span> retval = 0;
05579         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 16, 32768)) {
05580                 DWC_WARN(<span class="stringliteral">"Wrong value for dev_rx_fifo_size\n"</span>);
05581                 DWC_WARN(<span class="stringliteral">"dev_rx_fifo_size must be 16-32768\n"</span>);
05582                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05583         }
05584 
05585         <span class="keywordflow">if</span> (val &gt; DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>)) {
05586                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>)) {
05587                 DWC_WARN(<span class="stringliteral">"%d invalid for dev_rx_fifo_size parameter\n"</span>, val);
05588                 }
05589                 val = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
05590                 retval = -DWC_E_INVALID;
05591         }
05592 
05593         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a> = val;
05594         <span class="keywordflow">return</span> retval;
05595 }
05596 
05597 int32_t dwc_otg_get_param_dev_rx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05598 {
05599         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o10">dev_rx_fifo_size</a>;
05600 }
05601 
<a name="l05602"></a><a class="code" href="dwc__otg__core__if_8h.html#a92">05602</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a92">dwc_otg_set_param_dev_nperio_tx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05603                                               int32_t val)
05604 {
05605         <span class="keywordtype">int</span> retval = 0;
05606 
05607         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 16, 32768)) {
05608                 DWC_WARN(<span class="stringliteral">"Wrong value for dev_nperio_tx_fifo\n"</span>);
05609                 DWC_WARN(<span class="stringliteral">"dev_nperio_tx_fifo must be 16-32768\n"</span>);
05610                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05611         }
05612 
05613         <span class="keywordflow">if</span> (val &gt; (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16)) {
05614                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05615                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>)) {
05616                         DWC_ERROR
05617                             (<span class="stringliteral">"%d invalid for dev_nperio_tx_fifo_size. Check HW configuration.\n"</span>,
05618                              val);
05619                 }
05620                 val =
05621                     (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt;
05622                      16);
05623                 retval = -DWC_E_INVALID;
05624         }
05625 
05626         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a> = val;
05627         <span class="keywordflow">return</span> retval;
05628 }
05629 
05630 int32_t dwc_otg_get_param_dev_nperio_tx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05631 {
05632         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o11">dev_nperio_tx_fifo_size</a>;
05633 }
05634 
<a name="l05635"></a><a class="code" href="dwc__otg__core__if_8h.html#a96">05635</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a96">dwc_otg_set_param_host_rx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05636                                         int32_t val)
05637 {
05638         <span class="keywordtype">int</span> retval = 0;
05639 
05640         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 16, 32768)) {
05641                 DWC_WARN(<span class="stringliteral">"Wrong value for host_rx_fifo_size\n"</span>);
05642                 DWC_WARN(<span class="stringliteral">"host_rx_fifo_size must be 16-32768\n"</span>);
05643                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05644         }
05645 
05646         <span class="keywordflow">if</span> (val &gt; DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>)) {
05647                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05648                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a>)) {
05649                         DWC_ERROR
05650                             (<span class="stringliteral">"%d invalid for host_rx_fifo_size. Check HW configuration.\n"</span>,
05651                              val);
05652                 }
05653                 val = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
05654                 retval = -DWC_E_INVALID;
05655         }
05656 
05657         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a> = val;
05658         <span class="keywordflow">return</span> retval;
05659 
05660 }
05661 
05662 int32_t dwc_otg_get_param_host_rx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05663 {
05664         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o13">host_rx_fifo_size</a>;
05665 }
05666 
<a name="l05667"></a><a class="code" href="dwc__otg__core__if_8h.html#a98">05667</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a98">dwc_otg_set_param_host_nperio_tx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05668                                                int32_t val)
05669 {
05670         <span class="keywordtype">int</span> retval = 0;
05671 
05672         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 16, 32768)) {
05673                 DWC_WARN(<span class="stringliteral">"Wrong value for host_nperio_tx_fifo_size\n"</span>);
05674                 DWC_WARN(<span class="stringliteral">"host_nperio_tx_fifo_size must be 16-32768\n"</span>);
05675                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05676         }
05677 
05678         <span class="keywordflow">if</span> (val &gt; (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt; 16)) {
05679                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05680                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o14">host_nperio_tx_fifo_size</a>)) {
05681                         DWC_ERROR
05682                             (<span class="stringliteral">"%d invalid for host_nperio_tx_fifo_size. Check HW configuration.\n"</span>,
05683                              val);
05684                 }
05685                 val =
05686                     (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>) &gt;&gt;
05687                      16);
05688                 retval = -DWC_E_INVALID;
05689         }
05690 
05691         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o14">host_nperio_tx_fifo_size</a> = val;
05692         <span class="keywordflow">return</span> retval;
05693 }
05694 
05695 int32_t dwc_otg_get_param_host_nperio_tx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05696 {
05697         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o14">host_nperio_tx_fifo_size</a>;
05698 }
05699 
<a name="l05700"></a><a class="code" href="dwc__otg__core__if_8h.html#a100">05700</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a100">dwc_otg_set_param_host_perio_tx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05701                                               int32_t val)
05702 {
05703         <span class="keywordtype">int</span> retval = 0;
05704         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 16, 32768)) {
05705                 DWC_WARN(<span class="stringliteral">"Wrong value for host_perio_tx_fifo_size\n"</span>);
05706                 DWC_WARN(<span class="stringliteral">"host_perio_tx_fifo_size must be 16-32768\n"</span>);
05707                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05708         }
05709 
05710         <span class="keywordflow">if</span> (val &gt;
05711                 ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o24">hptxfsiz</a>.<a class="code" href="unionfifosize__data.html#o0">d32</a>)&gt;&gt; 16)) {
05712                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05713                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o15">host_perio_tx_fifo_size</a>)) {
05714                         DWC_ERROR
05715                             (<span class="stringliteral">"%d invalid for host_perio_tx_fifo_size. Check HW configuration.\n"</span>,
05716                              val);
05717                 }
05718                 val = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o24">hptxfsiz</a>.<a class="code" href="unionfifosize__data.html#o0">d32</a>) &gt;&gt; 16;
05719                 retval = -DWC_E_INVALID;
05720         }
05721 
05722         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o15">host_perio_tx_fifo_size</a> = val;
05723         <span class="keywordflow">return</span> retval;
05724 }
05725 
05726 int32_t dwc_otg_get_param_host_perio_tx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05727 {
05728         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o15">host_perio_tx_fifo_size</a>;
05729 }
05730 
<a name="l05731"></a><a class="code" href="dwc__otg__core__if_8h.html#a102">05731</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a102">dwc_otg_set_param_max_transfer_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05732                                         int32_t val)
05733 {
05734         <span class="keywordtype">int</span> retval = 0;
05735 
05736         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 2047, 524288)) {
05737                 DWC_WARN(<span class="stringliteral">"Wrong value for max_transfer_size\n"</span>);
05738                 DWC_WARN(<span class="stringliteral">"max_transfer_size must be 2047-524288\n"</span>);
05739                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05740         }
05741 
05742         <span class="keywordflow">if</span> (val &gt;= (1 &lt;&lt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o1">xfer_size_cntr_width</a> + 11))) {
05743                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05744                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o16">max_transfer_size</a>)) {
05745                         DWC_ERROR
05746                             (<span class="stringliteral">"%d invalid for max_transfer_size. Check HW configuration.\n"</span>,
05747                              val);
05748                 }
05749                 val =
05750                     ((1 &lt;&lt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o2">packet_size_cntr_width</a> + 11)) -
05751                      1);
05752                 retval = -DWC_E_INVALID;
05753         }
05754 
05755         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o16">max_transfer_size</a> = val;
05756         <span class="keywordflow">return</span> retval;
05757 }
05758 
05759 int32_t dwc_otg_get_param_max_transfer_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05760 {
05761         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o16">max_transfer_size</a>;
05762 }
05763 
<a name="l05764"></a><a class="code" href="dwc__otg__core__if_8h.html#a104">05764</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a104">dwc_otg_set_param_max_packet_count</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05765 {
05766         <span class="keywordtype">int</span> retval = 0;
05767 
05768         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 15, 511)) {
05769                 DWC_WARN(<span class="stringliteral">"Wrong value for max_packet_count\n"</span>);
05770                 DWC_WARN(<span class="stringliteral">"max_packet_count must be 15-511\n"</span>);
05771                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05772         }
05773 
05774         <span class="keywordflow">if</span> (val &gt; (1 &lt;&lt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o2">packet_size_cntr_width</a> + 4))) {
05775                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05776                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o17">max_packet_count</a>)) {
05777                         DWC_ERROR
05778                             (<span class="stringliteral">"%d invalid for max_packet_count. Check HW configuration.\n"</span>,
05779                              val);
05780                 }
05781                 val =
05782                     ((1 &lt;&lt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o2">packet_size_cntr_width</a> + 4)) - 1);
05783                 retval = -DWC_E_INVALID;
05784         }
05785 
05786         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o17">max_packet_count</a> = val;
05787         <span class="keywordflow">return</span> retval;
05788 }
05789 
05790 int32_t dwc_otg_get_param_max_packet_count(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05791 {
05792         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o17">max_packet_count</a>;
05793 }
05794 
<a name="l05795"></a><a class="code" href="dwc__otg__core__if_8h.html#a106">05795</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a106">dwc_otg_set_param_host_channels</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05796 {
05797         <span class="keywordtype">int</span> retval = 0;
05798 
05799         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 1, 16)) {
05800                 DWC_WARN(<span class="stringliteral">"Wrong value for host_channels\n"</span>);
05801                 DWC_WARN(<span class="stringliteral">"host_channels must be 1-16\n"</span>);
05802                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05803         }
05804 
05805         <span class="keywordflow">if</span> (val &gt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o7">num_host_chan</a> + 1)) {
05806                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05807                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o18">host_channels</a>)) {
05808                         DWC_ERROR
05809                             (<span class="stringliteral">"%d invalid for host_channels. Check HW configurations.\n"</span>,
05810                              val);
05811                 }
05812                 val = (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o7">num_host_chan</a> + 1);
05813                 retval = -DWC_E_INVALID;
05814         }
05815 
05816         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o18">host_channels</a> = val;
05817         <span class="keywordflow">return</span> retval;
05818 }
05819 
05820 int32_t dwc_otg_get_param_host_channels(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05821 {
05822         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o18">host_channels</a>;
05823 }
05824 
<a name="l05825"></a><a class="code" href="dwc__otg__core__if_8h.html#a108">05825</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a108">dwc_otg_set_param_dev_endpoints</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05826 {
05827         <span class="keywordtype">int</span> retval = 0;
05828 
05829         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 1, 15)) {
05830                 DWC_WARN(<span class="stringliteral">"Wrong value for dev_endpoints\n"</span>);
05831                 DWC_WARN(<span class="stringliteral">"dev_endpoints must be 1-15\n"</span>);
05832                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05833         }
05834 
05835         <span class="keywordflow">if</span> (val &gt; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o6">num_dev_ep</a>)) {
05836                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05837                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o19">dev_endpoints</a>)) {
05838                         DWC_ERROR
05839                             (<span class="stringliteral">"%d invalid for dev_endpoints. Check HW configurations.\n"</span>,
05840                              val);
05841                 }
05842                 val = core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o6">num_dev_ep</a>;
05843                 retval = -DWC_E_INVALID;
05844         }
05845 
05846         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o19">dev_endpoints</a> = val;
05847         <span class="keywordflow">return</span> retval;
05848 }
05849 
05850 int32_t dwc_otg_get_param_dev_endpoints(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05851 {
05852         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o19">dev_endpoints</a>;
05853 }
05854 
<a name="l05855"></a><a class="code" href="dwc__otg__core__if_8h.html#a110">05855</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a110">dwc_otg_set_param_phy_type</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05856 {
05857         <span class="keywordtype">int</span> retval = 0;
05858         <span class="keywordtype">int</span> valid = 0;
05859 
05860         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 2)) {
05861                 DWC_WARN(<span class="stringliteral">"Wrong value for phy_type\n"</span>);
05862                 DWC_WARN(<span class="stringliteral">"phy_type must be 0,1 or 2\n"</span>);
05863                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05864         }
05865 <span class="preprocessor">#ifndef NO_FS_PHY_HW_CHECKS</span>
05866 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((val == DWC_PHY_TYPE_PARAM_UTMI) &amp;&amp;
05867             ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 1) ||
05868              (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 3))) {
05869                 valid = 1;
05870         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((val == DWC_PHY_TYPE_PARAM_ULPI) &amp;&amp;
05871                    ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 2) ||
05872                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 3))) {
05873                 valid = 1;
05874         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((val == DWC_PHY_TYPE_PARAM_FS) &amp;&amp;
05875                    (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o5">fs_phy_type</a> == 1)) {
05876                 valid = 1;
05877         }
05878         <span class="keywordflow">if</span> (!valid) {
05879                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a>)) {
05880                         DWC_ERROR
05881                             (<span class="stringliteral">"%d invalid for phy_type. Check HW configurations.\n"</span>,
05882                              val);
05883                 }
05884                 <span class="keywordflow">if</span> (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a>) {
05885                         <span class="keywordflow">if</span> ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 3) ||
05886                             (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o4">hs_phy_type</a> == 1)) {
05887                                 val = DWC_PHY_TYPE_PARAM_UTMI;
05888                         } <span class="keywordflow">else</span> {
05889                                 val = DWC_PHY_TYPE_PARAM_ULPI;
05890                         }
05891                 }
05892                 retval = -DWC_E_INVALID;
05893         }
05894 <span class="preprocessor">#endif</span>
05895 <span class="preprocessor"></span>        core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a> = val;
05896         <span class="keywordflow">return</span> retval;
05897 }
05898 
05899 int32_t dwc_otg_get_param_phy_type(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05900 {
05901         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o20">phy_type</a>;
05902 }
05903 
<a name="l05904"></a><a class="code" href="dwc__otg__core__if_8h.html#a80">05904</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a80">dwc_otg_set_param_speed</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05905 {
05906         <span class="keywordtype">int</span> retval = 0;
05907         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05908                 DWC_WARN(<span class="stringliteral">"Wrong value for speed parameter\n"</span>);
05909                 DWC_WARN(<span class="stringliteral">"max_speed parameter must be 0 or 1\n"</span>);
05910                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05911         }
05912         <span class="keywordflow">if</span> ((val == 0)
05913             &amp;&amp; dwc_otg_get_param_phy_type(core_if) == DWC_PHY_TYPE_PARAM_FS) {
05914                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a>)) {
05915                         DWC_ERROR
05916                             (<span class="stringliteral">"%d invalid for speed paremter. Check HW configuration.\n"</span>,
05917                              val);
05918                 }
05919                 val =
05920                     (dwc_otg_get_param_phy_type(core_if) ==
05921                      DWC_PHY_TYPE_PARAM_FS ? 1 : 0);
05922                 retval = -DWC_E_INVALID;
05923         }
05924         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a> = val;
05925         <span class="keywordflow">return</span> retval;
05926 }
05927 
05928 int32_t dwc_otg_get_param_speed(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05929 {
05930         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o5">speed</a>;
05931 }
05932 
<a name="l05933"></a><a class="code" href="dwc__otg__core__if_8h.html#a84">05933</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a84">dwc_otg_set_param_host_ls_low_power_phy_clk</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05934                                                 int32_t val)
05935 {
05936         <span class="keywordtype">int</span> retval = 0;
05937 
05938         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05939                 DWC_WARN
05940                     (<span class="stringliteral">"Wrong value for host_ls_low_power_phy_clk parameter\n"</span>);
05941                 DWC_WARN(<span class="stringliteral">"host_ls_low_power_phy_clk must be 0 or 1\n"</span>);
05942                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05943         }
05944 
05945         <span class="keywordflow">if</span> ((val == DWC_HOST_LS_LOW_POWER_PHY_CLK_PARAM_48MHZ)
05946             &amp;&amp; (dwc_otg_get_param_phy_type(core_if) == DWC_PHY_TYPE_PARAM_FS)) {
05947                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
05948                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o7">host_ls_low_power_phy_clk</a>)) {
05949                         DWC_ERROR
05950                             (<span class="stringliteral">"%d invalid for host_ls_low_power_phy_clk. Check HW configuration.\n"</span>,
05951                              val);
05952                 }
05953                 val =
05954                     (dwc_otg_get_param_phy_type(core_if) ==
05955                      DWC_PHY_TYPE_PARAM_FS) ?
05956                     DWC_HOST_LS_LOW_POWER_PHY_CLK_PARAM_6MHZ :
05957                     DWC_HOST_LS_LOW_POWER_PHY_CLK_PARAM_48MHZ;
05958                 retval = -DWC_E_INVALID;
05959         }
05960 
05961         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o7">host_ls_low_power_phy_clk</a> = val;
05962         <span class="keywordflow">return</span> retval;
05963 }
05964 
05965 int32_t dwc_otg_get_param_host_ls_low_power_phy_clk(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05966 {
05967         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o7">host_ls_low_power_phy_clk</a>;
05968 }
05969 
<a name="l05970"></a><a class="code" href="dwc__otg__core__if_8h.html#a114">05970</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a114">dwc_otg_set_param_phy_ulpi_ddr</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
05971 {
05972         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05973                 DWC_WARN(<span class="stringliteral">"Wrong value for phy_ulpi_ddr\n"</span>);
05974                 DWC_WARN(<span class="stringliteral">"phy_upli_ddr must be 0 or 1\n"</span>);
05975                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05976         }
05977 
05978         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o22">phy_ulpi_ddr</a> = val;
05979         <span class="keywordflow">return</span> 0;
05980 }
05981 
05982 int32_t dwc_otg_get_param_phy_ulpi_ddr(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
05983 {
05984         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o22">phy_ulpi_ddr</a>;
05985 }
05986 
<a name="l05987"></a><a class="code" href="dwc__otg__core__if_8h.html#a116">05987</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a116">dwc_otg_set_param_phy_ulpi_ext_vbus</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
05988                                         int32_t val)
05989 {
05990         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
05991                 DWC_WARN(<span class="stringliteral">"Wrong valaue for phy_ulpi_ext_vbus\n"</span>);
05992                 DWC_WARN(<span class="stringliteral">"phy_ulpi_ext_vbus must be 0 or 1\n"</span>);
05993                 <span class="keywordflow">return</span> -DWC_E_INVALID;
05994         }
05995 
05996         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o23">phy_ulpi_ext_vbus</a> = val;
05997         <span class="keywordflow">return</span> 0;
05998 }
05999 
06000 int32_t dwc_otg_get_param_phy_ulpi_ext_vbus(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06001 {
06002         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o23">phy_ulpi_ext_vbus</a>;
06003 }
06004 
<a name="l06005"></a><a class="code" href="dwc__otg__core__if_8h.html#a112">06005</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a112">dwc_otg_set_param_phy_utmi_width</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06006 {
06007         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 8, 8) &amp;&amp; DWC_OTG_PARAM_TEST(val, 16, 16)) {
06008                 DWC_WARN(<span class="stringliteral">"Wrong valaue for phy_utmi_width\n"</span>);
06009                 DWC_WARN(<span class="stringliteral">"phy_utmi_width must be 8 or 16\n"</span>);
06010                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06011         }
06012 
06013         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o21">phy_utmi_width</a> = val;
06014         <span class="keywordflow">return</span> 0;
06015 }
06016 
06017 int32_t dwc_otg_get_param_phy_utmi_width(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06018 {
06019         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o21">phy_utmi_width</a>;
06020 }
06021 
06022 <span class="keywordtype">int</span> dwc_otg_set_param_ulpi_fs_ls(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06023 {
06024         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06025                 DWC_WARN(<span class="stringliteral">"Wrong valaue for ulpi_fs_ls\n"</span>);
06026                 DWC_WARN(<span class="stringliteral">"ulpi_fs_ls must be 0 or 1\n"</span>);
06027                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06028         }
06029 
06030         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o25">ulpi_fs_ls</a> = val;
06031         <span class="keywordflow">return</span> 0;
06032 }
06033 
06034 int32_t dwc_otg_get_param_ulpi_fs_ls(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06035 {
06036         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o25">ulpi_fs_ls</a>;
06037 }
06038 
06039 <span class="keywordtype">int</span> dwc_otg_set_param_ts_dline(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06040 {
06041         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06042                 DWC_WARN(<span class="stringliteral">"Wrong valaue for ts_dline\n"</span>);
06043                 DWC_WARN(<span class="stringliteral">"ts_dline must be 0 or 1\n"</span>);
06044                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06045         }
06046 
06047         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o26">ts_dline</a> = val;
06048         <span class="keywordflow">return</span> 0;
06049 }
06050 
06051 int32_t dwc_otg_get_param_ts_dline(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06052 {
06053         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o26">ts_dline</a>;
06054 }
06055 
<a name="l06056"></a><a class="code" href="dwc__otg__core__if_8h.html#a118">06056</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a118">dwc_otg_set_param_i2c_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06057 {
06058         <span class="keywordtype">int</span> retval = 0;
06059         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06060                 DWC_WARN(<span class="stringliteral">"Wrong valaue for i2c_enable\n"</span>);
06061                 DWC_WARN(<span class="stringliteral">"i2c_enable must be 0 or 1\n"</span>);
06062                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06063         }
06064 <span class="preprocessor">#ifndef NO_FS_PHY_HW_CHECK</span>
06065 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (val == 1 &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o4">i2c</a> == 0) {
06066                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o24">i2c_enable</a>)) {
06067                         DWC_ERROR
06068                             (<span class="stringliteral">"%d invalid for i2c_enable. Check HW configuration.\n"</span>,
06069                              val);
06070                 }
06071                 val = 0;
06072                 retval = -DWC_E_INVALID;
06073         }
06074 <span class="preprocessor">#endif</span>
06075 <span class="preprocessor"></span>
06076         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o24">i2c_enable</a> = val;
06077         <span class="keywordflow">return</span> retval;
06078 }
06079 
06080 int32_t dwc_otg_get_param_i2c_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06081 {
06082         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o24">i2c_enable</a>;
06083 }
06084 
<a name="l06085"></a><a class="code" href="dwc__otg__core__if_8h.html#a94">06085</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a94">dwc_otg_set_param_dev_perio_tx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
06086                                              int32_t val, <span class="keywordtype">int</span> fifo_num)
06087 {
06088         <span class="keywordtype">int</span> retval = 0;
06089 
06090         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 4, 768)) {
06091                 DWC_WARN(<span class="stringliteral">"Wrong value for dev_perio_tx_fifo_size\n"</span>);
06092                 DWC_WARN(<span class="stringliteral">"dev_perio_tx_fifo_size must be 4-768\n"</span>);
06093                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06094         }
06095 
06096         <span class="keywordflow">if</span> (val &gt;
06097             (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[fifo_num]))) {
06098                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
06099                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o12">dev_perio_tx_fifo_size</a>[fifo_num])) {
06100                         DWC_ERROR
06101                             (<span class="stringliteral">"`%d' invalid for parameter `dev_perio_fifo_size_%d'. Check HW configuration.\n"</span>,
06102                              val, fifo_num);
06103                 }
06104                 val = (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[fifo_num]));
06105                 retval = -DWC_E_INVALID;
06106         }
06107 
06108         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o12">dev_perio_tx_fifo_size</a>[fifo_num] = val;
06109         <span class="keywordflow">return</span> retval;
06110 }
06111 
06112 int32_t dwc_otg_get_param_dev_perio_tx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
06113                                                  <span class="keywordtype">int</span> fifo_num)
06114 {
06115         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o12">dev_perio_tx_fifo_size</a>[fifo_num];
06116 }
06117 
<a name="l06118"></a><a class="code" href="dwc__otg__core__if_8h.html#a124">06118</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a124">dwc_otg_set_param_en_multiple_tx_fifo</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
06119                                           int32_t val)
06120 {
06121         <span class="keywordtype">int</span> retval = 0;
06122         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06123                 DWC_WARN(<span class="stringliteral">"Wrong valaue for en_multiple_tx_fifo,\n"</span>);
06124                 DWC_WARN(<span class="stringliteral">"en_multiple_tx_fifo must be 0 or 1\n"</span>);
06125                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06126         }
06127 
06128         <span class="keywordflow">if</span> (val == 1 &amp;&amp; core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o13">ded_fifo_en</a> == 0) {
06129                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
06130                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a>)) {
06131                         DWC_ERROR
06132                             (<span class="stringliteral">"%d invalid for parameter en_multiple_tx_fifo. Check HW configuration.\n"</span>,
06133                              val);
06134                 }
06135                 val = 0;
06136                 retval = -DWC_E_INVALID;
06137         }
06138 
06139         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a> = val;
06140         <span class="keywordflow">return</span> retval;
06141 }
06142 
06143 int32_t dwc_otg_get_param_en_multiple_tx_fifo(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06144 {
06145         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o27">en_multiple_tx_fifo</a>;
06146 }
06147 
06148 <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a126">dwc_otg_set_param_dev_tx_fifo_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val,
06149                                        <span class="keywordtype">int</span> fifo_num)
06150 {
06151         <span class="keywordtype">int</span> retval = 0;
06152 
06153         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 4, 768)) {
06154                 DWC_WARN(<span class="stringliteral">"Wrong value for dev_tx_fifo_size\n"</span>);
06155                 DWC_WARN(<span class="stringliteral">"dev_tx_fifo_size must be 4-768\n"</span>);
06156                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06157         }
06158 
06159         <span class="keywordflow">if</span> (val &gt;
06160             (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[fifo_num]))) {
06161                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
06162                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o28">dev_tx_fifo_size</a>[fifo_num])) {
06163                         DWC_ERROR
06164                             (<span class="stringliteral">"`%d' invalid for parameter `dev_tx_fifo_size_%d'. Check HW configuration.\n"</span>,
06165                              val, fifo_num);
06166                 }
06167                 val = (DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o27">dtxfsiz</a>[fifo_num]));
06168                 retval = -DWC_E_INVALID;
06169         }
06170 
06171         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o28">dev_tx_fifo_size</a>[fifo_num] = val;
06172         <span class="keywordflow">return</span> retval;
06173 }
06174 
06175 int32_t dwc_otg_get_param_dev_tx_fifo_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if,
06176                                            <span class="keywordtype">int</span> fifo_num)
06177 {
06178         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o28">dev_tx_fifo_size</a>[fifo_num];
06179 }
06180 
<a name="l06181"></a><a class="code" href="dwc__otg__core__if_8h.html#a128">06181</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a128">dwc_otg_set_param_thr_ctl</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06182 {
06183         <span class="keywordtype">int</span> retval = 0;
06184 
06185         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 7)) {
06186                 DWC_WARN(<span class="stringliteral">"Wrong value for thr_ctl\n"</span>);
06187                 DWC_WARN(<span class="stringliteral">"thr_ctl must be 0-7\n"</span>);
06188                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06189         }
06190 
06191         <span class="keywordflow">if</span> ((val != 0) &amp;&amp;
06192             (!dwc_otg_get_param_dma_enable(core_if) ||
06193              !core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o23">hwcfg4</a>.<a class="code" href="unionhwcfg4__data.html#o17">b</a>.<a class="code" href="unionhwcfg4__data.html#o13">ded_fifo_en</a>)) {
06194                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a>)) {
06195                         DWC_ERROR
06196                             (<span class="stringliteral">"%d invalid for parameter thr_ctl. Check HW configuration.\n"</span>,
06197                              val);
06198                 }
06199                 val = 0;
06200                 retval = -DWC_E_INVALID;
06201         }
06202 
06203         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a> = val;
06204         <span class="keywordflow">return</span> retval;
06205 }
06206 
06207 int32_t dwc_otg_get_param_thr_ctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06208 {
06209         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o29">thr_ctl</a>;
06210 }
06211 
<a name="l06212"></a><a class="code" href="dwc__otg__core__if_8h.html#a134">06212</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a134">dwc_otg_set_param_lpm_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06213 {
06214         <span class="keywordtype">int</span> retval = 0;
06215 
06216         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06217                 DWC_WARN(<span class="stringliteral">"Wrong value for lpm_enable\n"</span>);
06218                 DWC_WARN(<span class="stringliteral">"lpm_enable must be 0 or 1\n"</span>);
06219                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06220         }
06221 
06222         <span class="keywordflow">if</span> (val &amp;&amp; !core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o11">otg_lpm_en</a>) {
06223                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o32">lpm_enable</a>)) {
06224                         DWC_ERROR
06225                             (<span class="stringliteral">"%d invalid for parameter lpm_enable. Check HW configuration.\n"</span>,
06226                              val);
06227                 }
06228                 val = 0;
06229                 retval = -DWC_E_INVALID;
06230         }
06231 
06232         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o32">lpm_enable</a> = val;
06233         <span class="keywordflow">return</span> retval;
06234 }
06235 
06236 int32_t dwc_otg_get_param_lpm_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06237 {
06238         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o32">lpm_enable</a>;
06239 }
06240 
<a name="l06241"></a><a class="code" href="dwc__otg__core__if_8h.html#a130">06241</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a130">dwc_otg_set_param_tx_thr_length</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06242 {
06243         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 8, 128)) {
06244                 DWC_WARN(<span class="stringliteral">"Wrong valaue for tx_thr_length\n"</span>);
06245                 DWC_WARN(<span class="stringliteral">"tx_thr_length must be 8 - 128\n"</span>);
06246                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06247         }
06248 
06249         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o30">tx_thr_length</a> = val;
06250         <span class="keywordflow">return</span> 0;
06251 }
06252 
06253 int32_t dwc_otg_get_param_tx_thr_length(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06254 {
06255         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o30">tx_thr_length</a>;
06256 }
06257 
<a name="l06258"></a><a class="code" href="dwc__otg__core__if_8h.html#a132">06258</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a132">dwc_otg_set_param_rx_thr_length</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06259 {
06260         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 8, 128)) {
06261                 DWC_WARN(<span class="stringliteral">"Wrong valaue for rx_thr_length\n"</span>);
06262                 DWC_WARN(<span class="stringliteral">"rx_thr_length must be 8 - 128\n"</span>);
06263                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06264         }
06265 
06266         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o31">rx_thr_length</a> = val;
06267         <span class="keywordflow">return</span> 0;
06268 }
06269 
06270 int32_t dwc_otg_get_param_rx_thr_length(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06271 {
06272         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o31">rx_thr_length</a>;
06273 }
06274 
<a name="l06275"></a><a class="code" href="dwc__otg__core__if_8h.html#a78">06275</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a78">dwc_otg_set_param_dma_burst_size</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06276 {
06277         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 1, 1) &amp;&amp;
06278             DWC_OTG_PARAM_TEST(val, 4, 4) &amp;&amp;
06279             DWC_OTG_PARAM_TEST(val, 8, 8) &amp;&amp;
06280             DWC_OTG_PARAM_TEST(val, 16, 16) &amp;&amp;
06281             DWC_OTG_PARAM_TEST(val, 32, 32) &amp;&amp;
06282             DWC_OTG_PARAM_TEST(val, 64, 64) &amp;&amp;
06283             DWC_OTG_PARAM_TEST(val, 128, 128) &amp;&amp;
06284             DWC_OTG_PARAM_TEST(val, 256, 256)) {
06285                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `dma_burst_size'\n"</span>, val);
06286                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06287         }
06288         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o4">dma_burst_size</a> = val;
06289         <span class="keywordflow">return</span> 0;
06290 }
06291 
06292 int32_t dwc_otg_get_param_dma_burst_size(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06293 {
06294         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o4">dma_burst_size</a>;
06295 }
06296 
<a name="l06297"></a><a class="code" href="dwc__otg__core__if_8h.html#a136">06297</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a136">dwc_otg_set_param_pti_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06298 {
06299         <span class="keywordtype">int</span> retval = 0;
06300         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06301                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `pti_enable'\n"</span>, val);
06302                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06303         }
06304         <span class="keywordflow">if</span> (val &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_72a)) {
06305                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o33">pti_enable</a>)) {
06306                         DWC_ERROR
06307                             (<span class="stringliteral">"%d invalid for parameter pti_enable. Check HW configuration.\n"</span>,
06308                              val);
06309                 }
06310                 retval = -DWC_E_INVALID;
06311                 val = 0;
06312         }
06313         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o33">pti_enable</a> = val;
06314         <span class="keywordflow">return</span> retval;
06315 }
06316 
06317 int32_t dwc_otg_get_param_pti_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06318 {
06319         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o33">pti_enable</a>;
06320 }
06321 
<a name="l06322"></a><a class="code" href="dwc__otg__core__if_8h.html#a138">06322</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a138">dwc_otg_set_param_mpi_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06323 {
06324         <span class="keywordtype">int</span> retval = 0;
06325         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06326                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `mpi_enable'\n"</span>, val);
06327                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06328         }
06329         <span class="keywordflow">if</span> (val &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o10">multi_proc_int</a> == 0)) {
06330                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o34">mpi_enable</a>)) {
06331                         DWC_ERROR
06332                             (<span class="stringliteral">"%d invalid for parameter mpi_enable. Check HW configuration.\n"</span>,
06333                              val);
06334                 }
06335                 retval = -DWC_E_INVALID;
06336                 val = 0;
06337         }
06338         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o34">mpi_enable</a> = val;
06339         <span class="keywordflow">return</span> retval;
06340 }
06341 
06342 int32_t dwc_otg_get_param_mpi_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06343 {
06344         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o34">mpi_enable</a>;
06345 }
06346 
<a name="l06347"></a><a class="code" href="dwc__otg__core__if_8h.html#a140">06347</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a140">dwc_otg_set_param_adp_enable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06348 {
06349         <span class="keywordtype">int</span> retval = 0;
06350         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06351                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `adp_enable'\n"</span>, val);
06352                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06353         }
06354         <span class="keywordflow">if</span> (val &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o22">hwcfg3</a>.<a class="code" href="unionhwcfg3__data.html#o13">b</a>.<a class="code" href="unionhwcfg3__data.html#o8">adp_supp</a> == 0)) {
06355                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
06356                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o37">adp_supp_enable</a>)) {
06357                         DWC_ERROR
06358                             (<span class="stringliteral">"%d invalid for parameter adp_enable. Check HW configuration.\n"</span>,
06359                              val);
06360                 }
06361                 retval = -DWC_E_INVALID;
06362                 val = 0;
06363         }
06364         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o37">adp_supp_enable</a> = val;
06365         <span class="comment">/*Set OTG version 2.0 in case of enabling ADP*/</span>
06366         <span class="keywordflow">if</span> (val)
06367                 dwc_otg_set_param_otg_ver(core_if, 1);
06368 
06369         <span class="keywordflow">return</span> retval;
06370 }
06371 
06372 int32_t dwc_otg_get_param_adp_enable(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06373 {
06374         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o37">adp_supp_enable</a>;
06375 }
06376 
<a name="l06377"></a><a class="code" href="dwc__otg__core__if_8h.html#a142">06377</a> <span class="keywordtype">int</span> <a class="code" href="dwc__otg__core__if_8h.html#a142">dwc_otg_set_param_ic_usb_cap</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06378 {
06379         <span class="keywordtype">int</span> retval = 0;
06380         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06381                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `ic_usb_cap'\n"</span>, val);
06382                 DWC_WARN(<span class="stringliteral">"ic_usb_cap must be 0 or 1\n"</span>);
06383                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06384         }
06385 
06386         <span class="keywordflow">if</span> (val &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o21">hwcfg2</a>.<a class="code" href="unionhwcfg2__data.html#o16">b</a>.<a class="code" href="unionhwcfg2__data.html#o15">otg_enable_ic_usb</a> == 0)) {
06387                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o35">ic_usb_cap</a>)) {
06388                         DWC_ERROR
06389                             (<span class="stringliteral">"%d invalid for parameter ic_usb_cap. Check HW configuration.\n"</span>,
06390                              val);
06391                 }
06392                 retval = -DWC_E_INVALID;
06393                 val = 0;
06394         }
06395         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o35">ic_usb_cap</a> = val;
06396         <span class="keywordflow">return</span> retval;
06397 }
06398 
06399 int32_t dwc_otg_get_param_ic_usb_cap(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06400 {
06401         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o35">ic_usb_cap</a>;
06402 }
06403 
06404 <span class="keywordtype">int</span> dwc_otg_set_param_ahb_thr_ratio(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06405 {
06406         <span class="keywordtype">int</span> retval = 0;
06407         <span class="keywordtype">int</span> valid = 1;
06408 
06409         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 3)) {
06410                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `ahb_thr_ratio'\n"</span>, val);
06411                 DWC_WARN(<span class="stringliteral">"ahb_thr_ratio must be 0 - 3\n"</span>);
06412                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06413         }
06414 
06415         <span class="keywordflow">if</span> (val
06416             &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_81a
06417                 || !dwc_otg_get_param_thr_ctl(core_if))) {
06418                 valid = 0;
06419         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val
06420                    &amp;&amp; ((dwc_otg_get_param_tx_thr_length(core_if) / (1 &lt;&lt; val)) &lt;
06421                        4)) {
06422                 valid = 0;
06423         }
06424         <span class="keywordflow">if</span> (valid == 0) {
06425                 <span class="keywordflow">if</span> (dwc_otg_param_initialized
06426                     (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o36">ahb_thr_ratio</a>)) {
06427                         DWC_ERROR
06428                             (<span class="stringliteral">"%d invalid for parameter ahb_thr_ratio. Check HW configuration.\n"</span>,
06429                              val);
06430                 }
06431                 retval = -DWC_E_INVALID;
06432                 val = 0;
06433         }
06434 
06435         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o36">ahb_thr_ratio</a> = val;
06436         <span class="keywordflow">return</span> retval;
06437 }
06438 
06439 int32_t dwc_otg_get_param_ahb_thr_ratio(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06440 {
06441         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o36">ahb_thr_ratio</a>;
06442 }
06443 
06444 <span class="keywordtype">int</span> dwc_otg_set_param_power_down(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06445 {
06446         <span class="keywordtype">int</span> retval = 0;
06447         <span class="keywordtype">int</span> valid = 1;
06448 
06449         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 2)) {
06450                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `power_down'\n"</span>, val);
06451                 DWC_WARN(<span class="stringliteral">"power_down must be 0 - 2\n"</span>);
06452                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06453         }
06454 
06455         <span class="keywordflow">if</span> ((val == 2) &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_91a)) {
06456                 valid = 0;
06457         }
06458         <span class="keywordflow">if</span> (valid == 0) {
06459                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o42">power_down</a>)) {
06460                         DWC_ERROR
06461                             (<span class="stringliteral">"%d invalid for parameter power_down. Check HW configuration.\n"</span>,
06462                              val);
06463                 }
06464                 retval = -DWC_E_INVALID;
06465                 val = 0;
06466         }
06467         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o42">power_down</a> = val;
06468         <span class="keywordflow">return</span> retval;
06469 }
06470 
06471 int32_t dwc_otg_get_param_power_down(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06472 {
06473         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o42">power_down</a>;
06474 }
06475 
06476 <span class="keywordtype">int</span> dwc_otg_set_param_reload_ctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06477 {
06478         <span class="keywordtype">int</span> retval = 0;
06479         <span class="keywordtype">int</span> valid = 1;
06480 
06481         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06482                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `reload_ctl'\n"</span>, val);
06483                 DWC_WARN(<span class="stringliteral">"reload_ctl must be 0 or 1\n"</span>);
06484                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06485         }
06486 
06487         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_92a)) {
06488                 valid = 0;
06489         }
06490         <span class="keywordflow">if</span> (valid == 0) {
06491                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o38">reload_ctl</a>)) {
06492                         DWC_ERROR(<span class="stringliteral">"%d invalid for parameter reload_ctl."</span>
06493                                   <span class="stringliteral">"Check HW configuration.\n"</span>, val);
06494                 }
06495                 retval = -DWC_E_INVALID;
06496                 val = 0;
06497         }
06498         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o38">reload_ctl</a> = val;
06499         <span class="keywordflow">return</span> retval;
06500 }
06501 
06502 int32_t dwc_otg_get_param_reload_ctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06503 {
06504         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o38">reload_ctl</a>;
06505 }
06506 
06507 <span class="keywordtype">int</span> dwc_otg_set_param_dev_out_nak(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06508 {
06509         <span class="keywordtype">int</span> retval = 0;
06510         <span class="keywordtype">int</span> valid = 1;
06511 
06512         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06513                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `dev_out_nak'\n"</span>, val);
06514                 DWC_WARN(<span class="stringliteral">"dev_out_nak must be 0 or 1\n"</span>);
06515                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06516         }
06517 
06518         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_93a) ||
06519                 !(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>))) {
06520                 valid = 0;
06521         }
06522         <span class="keywordflow">if</span> (valid == 0) {
06523                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a>)) {
06524                         DWC_ERROR(<span class="stringliteral">"%d invalid for parameter dev_out_nak."</span>
06525                                 <span class="stringliteral">"Check HW configuration.\n"</span>, val);
06526                 }
06527                 retval = -DWC_E_INVALID;
06528                 val = 0;
06529         }
06530         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a> = val;
06531         <span class="keywordflow">return</span> retval;
06532 }
06533 
06534 int32_t dwc_otg_get_param_dev_out_nak(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06535 {
06536         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o39">dev_out_nak</a>;
06537 }
06538 
06539 <span class="keywordtype">int</span> dwc_otg_set_param_cont_on_bna(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06540 {
06541         <span class="keywordtype">int</span> retval = 0;
06542         <span class="keywordtype">int</span> valid = 1;
06543 
06544         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06545                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `cont_on_bna'\n"</span>, val);
06546                 DWC_WARN(<span class="stringliteral">"cont_on_bna must be 0 or 1\n"</span>);
06547                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06548         }
06549 
06550         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_94a) ||
06551                 !(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o3">dma_desc_enable</a>))) {
06552                         valid = 0;
06553         }
06554         <span class="keywordflow">if</span> (valid == 0) {
06555                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o40">cont_on_bna</a>)) {
06556                         DWC_ERROR(<span class="stringliteral">"%d invalid for parameter cont_on_bna."</span>
06557                                 <span class="stringliteral">"Check HW configuration.\n"</span>, val);
06558                 }
06559                 retval = -DWC_E_INVALID;
06560                 val = 0;
06561         }
06562         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o40">cont_on_bna</a> = val;
06563         <span class="keywordflow">return</span> retval;
06564 }
06565 
06566 int32_t dwc_otg_get_param_cont_on_bna(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06567 {
06568         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o40">cont_on_bna</a>;
06569 }
06570 
06571 <span class="keywordtype">int</span> dwc_otg_set_param_ahb_single(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06572 {
06573         <span class="keywordtype">int</span> retval = 0;
06574         <span class="keywordtype">int</span> valid = 1;
06575 
06576         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06577                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `ahb_single'\n"</span>, val);
06578                 DWC_WARN(<span class="stringliteral">"ahb_single must be 0 or 1\n"</span>);
06579                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06580         }
06581 
06582         <span class="keywordflow">if</span> ((val == 1) &amp;&amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a> &lt; OTG_CORE_REV_2_94a)) {
06583                         valid = 0;
06584         }
06585         <span class="keywordflow">if</span> (valid == 0) {
06586                 <span class="keywordflow">if</span> (dwc_otg_param_initialized(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o41">ahb_single</a>)) {
06587                         DWC_ERROR(<span class="stringliteral">"%d invalid for parameter ahb_single."</span>
06588                                 <span class="stringliteral">"Check HW configuration.\n"</span>, val);
06589                 }
06590                 retval = -DWC_E_INVALID;
06591                 val = 0;
06592         }
06593         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o41">ahb_single</a> = val;
06594         <span class="keywordflow">return</span> retval;
06595 }
06596 
06597 int32_t dwc_otg_get_param_ahb_single(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06598 {
06599         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o41">ahb_single</a>;
06600 }
06601 
06602 <span class="keywordtype">int</span> dwc_otg_set_param_otg_ver(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, int32_t val)
06603 {
06604         <span class="keywordtype">int</span> retval = 0;
06605 
06606         <span class="keywordflow">if</span> (DWC_OTG_PARAM_TEST(val, 0, 1)) {
06607                 DWC_WARN(<span class="stringliteral">"`%d' invalid for parameter `otg_ver'\n"</span>, val);
06608                 DWC_WARN
06609                     (<span class="stringliteral">"otg_ver must be 0(for OTG 1.3 support) or 1(for OTG 2.0 support)\n"</span>);
06610                 <span class="keywordflow">return</span> -DWC_E_INVALID;
06611         }
06612 
06613         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o43">otg_ver</a> = val;
06614         <span class="keywordflow">return</span> retval;
06615 }
06616 
06617 int32_t dwc_otg_get_param_otg_ver(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06618 {
06619         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o43">otg_ver</a>;
06620 }
06621 
<a name="l06622"></a><a class="code" href="dwc__otg__core__if_8h.html#a162">06622</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a162">dwc_otg_get_hnpstatus</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06623 {
06624         <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> otgctl;
06625         otgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
06626         <span class="keywordflow">return</span> otgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o9">hstnegscs</a>;
06627 }
06628 
<a name="l06629"></a><a class="code" href="dwc__otg__core__if_8h.html#a163">06629</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a163">dwc_otg_get_srpstatus</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06630 {
06631         <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> otgctl;
06632         otgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
06633         <span class="keywordflow">return</span> otgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o1">sesreqscs</a>;
06634 }
06635 
<a name="l06636"></a><a class="code" href="dwc__otg__core__if_8h.html#a164">06636</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a164">dwc_otg_set_hnpreq</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06637 {
06638         <span class="keywordflow">if</span>(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o46">otg_ver</a> == 0) {
06639                 <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> otgctl;
06640                 otgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
06641                 otgctl.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o10">hnpreq</a> = val;
06642                 DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, otgctl.<a class="code" href="uniongotgctl__data.html#o0">d32</a>);
06643         } <span class="keywordflow">else</span> {
06644                 core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o47">otg_sts</a> = val;
06645         }
06646 }
06647 
<a name="l06648"></a><a class="code" href="dwc__otg__core__if_8h.html#a165">06648</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a165">dwc_otg_get_gsnpsid</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06649 {
06650         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o4">snpsid</a>;
06651 }
06652 
<a name="l06653"></a><a class="code" href="dwc__otg__core__if_8h.html#a166">06653</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a166">dwc_otg_get_mode</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06654 {
06655         <a class="code" href="uniongintsts__data.html">gintsts_data_t</a> gintsts;
06656         gintsts.<a class="code" href="uniongintsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o5">gintsts</a>);
06657         <span class="keywordflow">return</span> gintsts.<a class="code" href="uniongintsts__data.html#o33">b</a>.<a class="code" href="uniongintsts__data.html#o1">curmode</a>;
06658 }
06659 
<a name="l06660"></a><a class="code" href="dwc__otg__core__if_8h.html#a167">06660</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a167">dwc_otg_get_hnpcapable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06661 {
06662         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg;
06663         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
06664         <span class="keywordflow">return</span> usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a>;
06665 }
06666 
<a name="l06667"></a><a class="code" href="dwc__otg__core__if_8h.html#a168">06667</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a168">dwc_otg_set_hnpcapable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06668 {
06669         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg;
06670         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
06671         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o8">hnpcap</a> = val;
06672         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
06673 }
06674 
<a name="l06675"></a><a class="code" href="dwc__otg__core__if_8h.html#a169">06675</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a169">dwc_otg_get_srpcapable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06676 {
06677         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg;
06678         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
06679         <span class="keywordflow">return</span> usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a>;
06680 }
06681 
<a name="l06682"></a><a class="code" href="dwc__otg__core__if_8h.html#a170">06682</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a170">dwc_otg_set_srpcapable</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06683 {
06684         <a class="code" href="uniongusbcfg__data.html">gusbcfg_data_t</a> usbcfg;
06685         usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
06686         usbcfg.<a class="code" href="uniongusbcfg__data.html#o28">b</a>.<a class="code" href="uniongusbcfg__data.html#o7">srpcap</a> = val;
06687         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, usbcfg.<a class="code" href="uniongusbcfg__data.html#o0">d32</a>);
06688 }
06689 
<a name="l06690"></a><a class="code" href="dwc__otg__core__if_8h.html#a171">06690</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a171">dwc_otg_get_devspeed</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06691 {
06692         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
06693         dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
06694         <span class="keywordflow">return</span> dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o1">devspd</a>;
06695 }
06696 
<a name="l06697"></a><a class="code" href="dwc__otg__core__if_8h.html#a172">06697</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a172">dwc_otg_set_devspeed</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06698 {
06699         <a class="code" href="uniondcfg__data.html">dcfg_data_t</a> dcfg;
06700         dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>);
06701         dcfg.<a class="code" href="uniondcfg__data.html#o12">b</a>.<a class="code" href="uniondcfg__data.html#o1">devspd</a> = val;
06702         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o0">dcfg</a>, dcfg.<a class="code" href="uniondcfg__data.html#o0">d32</a>);
06703 }
06704 
<a name="l06705"></a><a class="code" href="dwc__otg__core__if_8h.html#a173">06705</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a173">dwc_otg_get_busconnected</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06706 {
06707         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06708         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
06709         <span class="keywordflow">return</span> hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o1">prtconnsts</a>;
06710 }
06711 
<a name="l06712"></a><a class="code" href="dwc__otg__core__if_8h.html#a174">06712</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a174">dwc_otg_get_enumspeed</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06713 {
06714         <a class="code" href="uniondsts__data.html">dsts_data_t</a> dsts;
06715         dsts.<a class="code" href="uniondsts__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o2">dsts</a>);
06716         <span class="keywordflow">return</span> dsts.<a class="code" href="uniondsts__data.html#o7">b</a>.<a class="code" href="uniondsts__data.html#o2">enumspd</a>;
06717 }
06718 
<a name="l06719"></a><a class="code" href="dwc__otg__core__if_8h.html#a175">06719</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a175">dwc_otg_get_prtpower</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06720 {
06721         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06722         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
06723         <span class="keywordflow">return</span> hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a>;
06724 
06725 }
06726 
<a name="l06727"></a><a class="code" href="dwc__otg__core__if_8h.html#a176">06727</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a176">dwc_otg_get_core_state</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06728 {
06729         <span class="keywordflow">return</span> core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o45">hibernation_suspend</a>;
06730 }
06731 
<a name="l06732"></a><a class="code" href="dwc__otg__core__if_8h.html#a177">06732</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a177">dwc_otg_set_prtpower</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06733 {
06734         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06735         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(core_if);
06736         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o12">prtpwr</a> = val;
06737         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
06738 }
06739 
<a name="l06740"></a><a class="code" href="dwc__otg__core__if_8h.html#a178">06740</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a178">dwc_otg_get_prtsuspend</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06741 {
06742         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06743         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
06744         <span class="keywordflow">return</span> hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o8">prtsusp</a>;
06745 
06746 }
06747 
<a name="l06748"></a><a class="code" href="dwc__otg__core__if_8h.html#a179">06748</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a179">dwc_otg_set_prtsuspend</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06749 {
06750         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06751         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(core_if);
06752         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o8">prtsusp</a> = val;
06753         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
06754 }
06755 
<a name="l06756"></a><a class="code" href="dwc__otg__core__if_8h.html#a182">06756</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a182">dwc_otg_get_fr_interval</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06757 {
06758         <a class="code" href="unionhfir__data.html">hfir_data_t</a> hfir;
06759         hfir.<a class="code" href="unionhfir__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>);
06760         <span class="keywordflow">return</span> hfir.<a class="code" href="unionhfir__data.html#o4">b</a>.<a class="code" href="unionhfir__data.html#o1">frint</a>;
06761 
06762 }
06763 
<a name="l06764"></a><a class="code" href="dwc__otg__core__if_8h.html#a183">06764</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a183">dwc_otg_set_fr_interval</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06765 {
06766         <a class="code" href="unionhfir__data.html">hfir_data_t</a> hfir;
06767         uint32_t fram_int;
06768         fram_int = <a class="code" href="dwc__otg__cil_8h.html#a101">calc_frame_interval</a>(core_if);
06769         hfir.<a class="code" href="unionhfir__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>);
06770         <span class="keywordflow">if</span> (!core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o0">core_params</a>-&gt;<a class="code" href="structdwc__otg__core__params.html#o38">reload_ctl</a>) {
06771                 DWC_WARN(<span class="stringliteral">"\nCannot reload HFIR register.HFIR.HFIRRldCtrl bit is"</span>
06772                          <span class="stringliteral">"not set to 1.\nShould load driver with reload_ctl=1"</span>
06773                          <span class="stringliteral">" module parameter\n"</span>);
06774                 <span class="keywordflow">return</span>;
06775         }
06776         <span class="keywordflow">switch</span> (fram_int) {
06777         <span class="keywordflow">case</span> 3750:
06778                 <span class="keywordflow">if</span> ((val &lt; 3350) || (val &gt; 4150)) {
06779                         DWC_WARN(<span class="stringliteral">"HFIR interval for HS core and 30 MHz"</span>
06780                                  <span class="stringliteral">"clock freq should be from 3350 to 4150\n"</span>);
06781                         <span class="keywordflow">return</span>;
06782                 }
06783                 <span class="keywordflow">break</span>;
06784         <span class="keywordflow">case</span> 30000:
06785                 <span class="keywordflow">if</span> ((val &lt; 26820) || (val &gt; 33180)) {
06786                         DWC_WARN(<span class="stringliteral">"HFIR interval for FS/LS core and 30 MHz"</span>
06787                                  <span class="stringliteral">"clock freq should be from 26820 to 33180\n"</span>);
06788                         <span class="keywordflow">return</span>;
06789                 }
06790                 <span class="keywordflow">break</span>;
06791         <span class="keywordflow">case</span> 6000:
06792                 <span class="keywordflow">if</span> ((val &lt; 5360) || (val &gt; 6640)) {
06793                         DWC_WARN(<span class="stringliteral">"HFIR interval for HS core and 48 MHz"</span>
06794                                  <span class="stringliteral">"clock freq should be from 5360 to 6640\n"</span>);
06795                         <span class="keywordflow">return</span>;
06796                 }
06797                 <span class="keywordflow">break</span>;
06798         <span class="keywordflow">case</span> 48000:
06799                 <span class="keywordflow">if</span> ((val &lt; 42912) || (val &gt; 53088)) {
06800                         DWC_WARN(<span class="stringliteral">"HFIR interval for FS/LS core and 48 MHz"</span>
06801                                  <span class="stringliteral">"clock freq should be from 42912 to 53088\n"</span>);
06802                         <span class="keywordflow">return</span>;
06803                 }
06804                 <span class="keywordflow">break</span>;
06805         <span class="keywordflow">case</span> 7500:
06806                 <span class="keywordflow">if</span> ((val &lt; 6700) || (val &gt; 8300)) {
06807                         DWC_WARN(<span class="stringliteral">"HFIR interval for HS core and 60 MHz"</span>
06808                                  <span class="stringliteral">"clock freq should be from 6700 to 8300\n"</span>);
06809                         <span class="keywordflow">return</span>;
06810                 }
06811                 <span class="keywordflow">break</span>;
06812         <span class="keywordflow">case</span> 60000:
06813                 <span class="keywordflow">if</span> ((val &lt; 53640) || (val &gt; 65536)) {
06814                         DWC_WARN(<span class="stringliteral">"HFIR interval for FS/LS core and 60 MHz"</span>
06815                                  <span class="stringliteral">"clock freq should be from 53640 to 65536\n"</span>);
06816                         <span class="keywordflow">return</span>;
06817                 }
06818                 <span class="keywordflow">break</span>;
06819         <span class="keywordflow">default</span>:
06820                 DWC_WARN(<span class="stringliteral">"Unknown frame interval\n"</span>);
06821                 <span class="keywordflow">return</span>;
06822                 <span class="keywordflow">break</span>;
06823 
06824         }
06825         hfir.<a class="code" href="unionhfir__data.html#o4">b</a>.<a class="code" href="unionhfir__data.html#o1">frint</a> = val;
06826         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o1">hfir</a>, hfir.<a class="code" href="unionhfir__data.html#o0">d32</a>);
06827 }
06828 
<a name="l06829"></a><a class="code" href="dwc__otg__core__if_8h.html#a180">06829</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a180">dwc_otg_get_mode_ch_tim</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06830 {
06831         <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg;
06832         hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
06833         <span class="keywordflow">return</span> hcfg.<a class="code" href="unionhcfg__data.html#o12">b</a>.<a class="code" href="unionhcfg__data.html#o11">modechtimen</a>;
06834 
06835 }
06836 
<a name="l06837"></a><a class="code" href="dwc__otg__core__if_8h.html#a181">06837</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a181">dwc_otg_set_mode_ch_tim</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06838 {
06839         <a class="code" href="unionhcfg__data.html">hcfg_data_t</a> hcfg;
06840         hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>);
06841         hcfg.<a class="code" href="unionhcfg__data.html#o12">b</a>.<a class="code" href="unionhcfg__data.html#o11">modechtimen</a> = val;
06842         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o0">host_global_regs</a>-&gt;<a class="code" href="structdwc__otg__host__global__regs.html#o0">hcfg</a>, hcfg.<a class="code" href="unionhcfg__data.html#o0">d32</a>);
06843 }
06844 
<a name="l06845"></a><a class="code" href="dwc__otg__core__if_8h.html#a184">06845</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a184">dwc_otg_set_prtresume</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06846 {
06847         <a class="code" href="unionhprt0__data.html">hprt0_data_t</a> hprt0;
06848         hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a> = <a class="code" href="dwc__otg__cil_8h.html#a102">dwc_otg_read_hprt0</a>(core_if);
06849         hprt0.<a class="code" href="unionhprt0__data.html#o16">b</a>.<a class="code" href="unionhprt0__data.html#o7">prtres</a> = val;
06850         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, hprt0.<a class="code" href="unionhprt0__data.html#o0">d32</a>);
06851 }
06852 
<a name="l06853"></a><a class="code" href="dwc__otg__core__if_8h.html#a185">06853</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a185">dwc_otg_get_remotewakesig</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06854 {
06855         <a class="code" href="uniondctl__data.html">dctl_data_t</a> dctl;
06856         dctl.<a class="code" href="uniondctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o2">dev_if</a>-&gt;<a class="code" href="structdwc__otg__dev__if.html#o0">dev_global_regs</a>-&gt;<a class="code" href="structdwc__otg__dev__global__regs.html#o1">dctl</a>);
06857         <span class="keywordflow">return</span> dctl.<a class="code" href="uniondctl__data.html#o17">b</a>.<a class="code" href="uniondctl__data.html#o1">rmtwkupsig</a>;
06858 }
06859 
<a name="l06860"></a><a class="code" href="dwc__otg__core__if_8h.html#a186">06860</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a186">dwc_otg_get_lpm_portsleepstatus</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06861 {
06862         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06863         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06864 
06865         DWC_ASSERT(!
06866                    ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o38">lx_state</a> == <a class="code" href="dwc__otg__cil_8h.html#a129a57">DWC_OTG_L1</a>) ^ lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o8">prt_sleep_sts</a>),
06867                    <span class="stringliteral">"lx_state = %d, lmpcfg.prt_sleep_sts = %d\n"</span>,
06868                    core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o38">lx_state</a>, lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o8">prt_sleep_sts</a>);
06869 
06870         <span class="keywordflow">return</span> lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o8">prt_sleep_sts</a>;
06871 }
06872 
<a name="l06873"></a><a class="code" href="dwc__otg__core__if_8h.html#a187">06873</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a187">dwc_otg_get_lpm_remotewakeenabled</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06874 {
06875         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06876         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06877         <span class="keywordflow">return</span> lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o4">rem_wkup_en</a>;
06878 }
06879 
<a name="l06880"></a><a class="code" href="dwc__otg__core__if_8h.html#a188">06880</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a188">dwc_otg_get_lpmresponse</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06881 {
06882         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06883         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06884         <span class="keywordflow">return</span> lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o2">appl_resp</a>;
06885 }
06886 
<a name="l06887"></a><a class="code" href="dwc__otg__core__if_8h.html#a189">06887</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a189">dwc_otg_set_lpmresponse</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06888 {
06889         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06890         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06891         lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o2">appl_resp</a> = val;
06892         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>, lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a>);
06893 }
06894 
<a name="l06895"></a><a class="code" href="dwc__otg__core__if_8h.html#a190">06895</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a190">dwc_otg_get_hsic_connect</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06896 {
06897         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06898         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06899         <span class="keywordflow">return</span> lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o15">hsic_connect</a>;
06900 }
06901 
<a name="l06902"></a><a class="code" href="dwc__otg__core__if_8h.html#a191">06902</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a191">dwc_otg_set_hsic_connect</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06903 {
06904         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06905         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06906         lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o15">hsic_connect</a> = val;
06907         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>, lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a>);
06908 }
06909 
<a name="l06910"></a><a class="code" href="dwc__otg__core__if_8h.html#a192">06910</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a192">dwc_otg_get_inv_sel_hsic</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06911 {
06912         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06913         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06914         <span class="keywordflow">return</span> lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o16">inv_sel_hsic</a>;
06915 
06916 }
06917 
<a name="l06918"></a><a class="code" href="dwc__otg__core__if_8h.html#a193">06918</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__core__if_8h.html#a193">dwc_otg_set_inv_sel_hsic</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06919 {
06920         <a class="code" href="unionglpmctl__data.html">glpmcfg_data_t</a> lpmcfg;
06921         lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a> = DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>);
06922         lpmcfg.<a class="code" href="unionglpmctl__data.html#o17">b</a>.<a class="code" href="unionglpmctl__data.html#o16">inv_sel_hsic</a> = val;
06923         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o21">glpmcfg</a>, lpmcfg.<a class="code" href="unionglpmctl__data.html#o0">d32</a>);
06924 }
06925 
<a name="l06926"></a><a class="code" href="dwc__otg__core__if_8h.html#a194">06926</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a194">dwc_otg_get_gotgctl</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06927 {
06928         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
06929 }
06930 
06931 <span class="keywordtype">void</span> dwc_otg_set_gotgctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06932 {
06933         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>, val);
06934 }
06935 
<a name="l06936"></a><a class="code" href="dwc__otg__core__if_8h.html#a196">06936</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a196">dwc_otg_get_gusbcfg</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06937 {
06938         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>);
06939 }
06940 
06941 <span class="keywordtype">void</span> dwc_otg_set_gusbcfg(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06942 {
06943         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o3">gusbcfg</a>, val);
06944 }
06945 
<a name="l06946"></a><a class="code" href="dwc__otg__core__if_8h.html#a198">06946</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a198">dwc_otg_get_grxfsiz</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06947 {
06948         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>);
06949 }
06950 
06951 <span class="keywordtype">void</span> dwc_otg_set_grxfsiz(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06952 {
06953         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o9">grxfsiz</a>, val);
06954 }
06955 
<a name="l06956"></a><a class="code" href="dwc__otg__core__if_8h.html#a200">06956</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a200">dwc_otg_get_gnptxfsiz</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06957 {
06958         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>);
06959 }
06960 
06961 <span class="keywordtype">void</span> dwc_otg_set_gnptxfsiz(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06962 {
06963         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o10">gnptxfsiz</a>, val);
06964 }
06965 
06966 uint32_t dwc_otg_get_gpvndctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06967 {
06968         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o13">gpvndctl</a>);
06969 }
06970 
06971 <span class="keywordtype">void</span> dwc_otg_set_gpvndctl(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06972 {
06973         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o13">gpvndctl</a>, val);
06974 }
06975 
<a name="l06976"></a><a class="code" href="dwc__otg__core__if_8h.html#a204">06976</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a204">dwc_otg_get_ggpio</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06977 {
06978         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o14">ggpio</a>);
06979 }
06980 
06981 <span class="keywordtype">void</span> dwc_otg_set_ggpio(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06982 {
06983         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o14">ggpio</a>, val);
06984 }
06985 
<a name="l06986"></a><a class="code" href="dwc__otg__core__if_8h.html#a208">06986</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a208">dwc_otg_get_hprt0</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06987 {
06988         <span class="keywordflow">return</span> DWC_READ_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>);
06989 
06990 }
06991 
06992 <span class="keywordtype">void</span> dwc_otg_set_hprt0(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
06993 {
06994         DWC_WRITE_REG32(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o3">host_if</a>-&gt;<a class="code" href="structdwc__otg__host__if.html#o1">hprt0</a>, val);
06995 }
06996 
<a name="l06997"></a><a class="code" href="dwc__otg__core__if_8h.html#a206">06997</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a206">dwc_otg_get_guid</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
06998 {
06999         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o15">guid</a>);
07000 }
07001 
07002 <span class="keywordtype">void</span> dwc_otg_set_guid(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if, uint32_t val)
07003 {
07004         DWC_WRITE_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o15">guid</a>, val);
07005 }
07006 
<a name="l07007"></a><a class="code" href="dwc__otg__core__if_8h.html#a210">07007</a> uint32_t <a class="code" href="dwc__otg__core__if_8h.html#a210">dwc_otg_get_hptxfsiz</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
07008 {
07009         <span class="keywordflow">return</span> DWC_READ_REG32(&amp;core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o26">hptxfsiz</a>);
07010 }
07011 
<a name="l07012"></a><a class="code" href="dwc__otg__hcd__if_8h.html#a20">07012</a> uint16_t <a class="code" href="dwc__otg__hcd__if_8h.html#a20">dwc_otg_get_otg_version</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
07013 {
07014         <span class="keywordflow">return</span> ((core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o46">otg_ver</a> == 1) ? (uint16_t)0x0200 : (uint16_t)0x0103);
07015 }
07016 
<a name="l07023"></a><a class="code" href="dwc__otg__cil_8c.html#a210">07023</a> <span class="keywordtype">void</span> <a class="code" href="dwc__otg__cil_8c.html#a210">dwc_otg_pcd_start_srp_timer</a>(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
07024 {
07025         core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o7">srp_timer_started</a> = 1;
07026         DWC_TIMER_SCHEDULE(core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o8">srp_timer</a>, 6000 <span class="comment">/* 6 secs */</span> );
07027 }
07028 
07029 <span class="keywordtype">void</span> dwc_otg_initiate_srp(<a class="code" href="structdwc__otg__core__if.html">dwc_otg_core_if_t</a> * core_if)
07030 {
07031         uint32_t *addr = (uint32_t *) &amp; (core_if-&gt;<a class="code" href="structdwc__otg__core__if.html#o1">core_global_regs</a>-&gt;<a class="code" href="structdwc__otg__core__global__regs.html#o0">gotgctl</a>);
07032         <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> mem;
07033         <a class="code" href="uniongotgctl__data.html">gotgctl_data_t</a> val;
07034 
07035         val.<a class="code" href="uniongotgctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
07036         <span class="keywordflow">if</span> (val.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o2">sesreq</a>) {
07037                 DWC_ERROR(<span class="stringliteral">"Session Request Already active!\n"</span>);
07038                 <span class="keywordflow">return</span>;
07039         }
07040 
07041         DWC_INFO(<span class="stringliteral">"Session Request Initated\n"</span>); <span class="comment">//NOTICE</span>
07042         mem.<a class="code" href="uniongotgctl__data.html#o0">d32</a> = DWC_READ_REG32(addr);
07043         mem.<a class="code" href="uniongotgctl__data.html#o23">b</a>.<a class="code" href="uniongotgctl__data.html#o2">sesreq</a> = 1;
07044         DWC_WRITE_REG32(addr, mem.<a class="code" href="uniongotgctl__data.html#o0">d32</a>);
07045 
07046         <span class="comment">/* Start the SRP timer */</span>
07047         <a class="code" href="dwc__otg__cil_8c.html#a210">dwc_otg_pcd_start_srp_timer</a>(core_if);
07048         <span class="keywordflow">return</span>;
07049 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 27 03:56:37 2011 for DesignWare USB 2.0 OTG Controller (DWC_otg) Device Driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
